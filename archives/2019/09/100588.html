<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="知识图谱" />


    <meta name="description" content="一. 半结构化数据的获取简介本文章针对半结构化数据的获取，介绍基于scrapy构建的百度百科爬虫和互动百科爬虫。同时为了练手还根据教程制作了基于BeautifulSoup和urllib2的百度百..." />



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />

    <!--Title-->


<title>从零开始构建知识图谱-Windows下开发环境搭建 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    




<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">





    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx" />


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

<meta name="generator" content="Hexo 7.3.0"></head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="从零开始构建知识图谱-Windows下开发环境搭建">
            
	            从零开始构建知识图谱-Windows下开发环境搭建
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/cloud/">云计算</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-none-link" href="/tags/knowledgegraph/" rel="tag">知识图谱</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/09/23</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>2002</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <h1 id="一-半结构化数据的获取"><a href="#一-半结构化数据的获取" class="headerlink" title="一. 半结构化数据的获取"></a>一. 半结构化数据的获取</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本文章针对半结构化数据的获取，介绍基于scrapy构建的百度百科爬虫和互动百科爬虫。同时为了练手还根据教程制作了基于BeautifulSoup和urllib2的百度百科爬虫、微信公众号爬虫和虎嗅网爬虫。</p>
<p>目前百度百科爬虫，爬取电影类数据，包含电影22219部，演员13967人。互动百科爬虫， 爬取电影类数据，包含电影13866部，演员5931 人。</p>
<h2 id="1-mysql"><a href="#1-mysql" class="headerlink" title="1. mysql"></a>1. mysql</h2><p>MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，目前属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件之一。</p>
<p>MySQL官网<a href="https://cdn.mysql.com//Downloads/MySQLInstaller/mysql-installer-community-8.0.17.0.msi">安装包</a>，该安装包有安装指引，按步骤完成即可。</p>
<p>如果想安装MySQL绿色版（不建议），需要手工配置，请参考文章<a href="https://blog.csdn.net/qq_37350706/article/details/81707862">MySQL 8.0.16安装教程(windows 64位)</a>。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> actor_to_movie <span class="keyword">DROP</span> actor_movie_id;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> actor_to_movie <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (actor_id,movie_id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> actor_to_movie <span class="keyword">ADD</span> <span class="keyword">FOREIGN KEY</span> actor_to_movie_fk_1 (movie_id) <span class="keyword">REFERENCES</span> movie (movie_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO ACTION</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">NO ACTION</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> actor_to_movie <span class="keyword">ADD</span> <span class="keyword">FOREIGN KEY</span> actor_to_movie_fk_2 (actor_id) <span class="keyword">REFERENCES</span> actor (actor_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO ACTION</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">NO ACTION</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> movie_to_genre <span class="keyword">DROP</span> movie_genre_id;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> movie_to_genre <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (movie_id,genre_id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> movie_to_genre <span class="keyword">ADD</span> <span class="keyword">FOREIGN KEY</span> movie_to_genre_fk_1 (movie_id) <span class="keyword">REFERENCES</span> movie (movie_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO ACTION</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">NO ACTION</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> movie_to_genre <span class="keyword">ADD</span> <span class="keyword">FOREIGN KEY</span> movie_to_genre_fk_2 (genre_id) <span class="keyword">REFERENCES</span> genre (genre_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO ACTION</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">NO ACTION</span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-Python"><a href="#2-Python" class="headerlink" title="2. Python"></a>2. Python</h2><p>Python是一种跨平台的计算机程序设计语言。是一种面向对象的动态类型语言，最初被设计用于编写自动化脚本(shell)，随着版本的不断更新和语言新功能的添加，越来越多被用于独立的、大型项目的开发。</p>
<p>对于初学者和完成普通任务，Python语言是非常简单易用的。连Google都在大规模使用Python，你就不用担心学了会没用。</p>
<p>项目是Python2开发的，建议安装Python3。</p>
<p>Python官网下载地址：<a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a> ，该安装包有安装指引，按步骤完成即可。</p>
<p>详细步骤请参考文章<a href="https://baijiahao.baidu.com/s?id=1606573927720991570&wfr=spider&for=pc">新手必看！如何在windows下安装Python(Python入门教程)</a>。</p>
<p>python安装好之后，我们要检测一下是否安装成功，用系统管理员打开命令行工具cmd，输入“python -V”,然后敲回车，如果出现如下信息，则表示我们安装成功了。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">C</span>:\Users\mmm&gt;python -V</span><br><span class="line"><span class="attribute">Python</span> <span class="number">3</span>.<span class="number">7</span>.<span class="number">4</span></span><br></pre></td></tr></table></figure>

<h2 id="3-IDE（PyCharm）"><a href="#3-IDE（PyCharm）" class="headerlink" title="3. IDE（PyCharm）"></a>3. IDE（PyCharm）</h2><p>PyCharm是一种Python IDE，带有一整套可以帮助用户在使用Python语言开发时提高其效率的工具，比如调试、语法高亮、Project管理、代码跳转、智能提示、自动完成、单元测试、版本控制。此外，该IDE提供了一些高级功能，以用于支持Django框架下的专业Web开发。</p>
<p>a. 官网Professional(专业版)下载地址：<a href="https://www.jetbrains.com/pycharm/download/#section=windows">https://www.jetbrains.com/pycharm/download/#section=windows</a></p>
<p>b. 下载Jetbrains系列产品2019.2.2激活破解补丁jetbrains-agent.jar文件</p>
<p>网盘链接：<a href="https://pan.baidu.com/s/1FGZ9d5J5amnvf0vMFqSOsQ">https://pan.baidu.com/s/1FGZ9d5J5amnvf0vMFqSOsQ</a> 提取码：mmk6</p>
<p>c. 参考<a href="https://www.cnblogs.com/RyanLea/p/11289424.html">pycharm永久激活教程</a>，永久激活。</p>
<h2 id="4-Scrapy"><a href="#4-Scrapy" class="headerlink" title="4. Scrapy"></a>4. Scrapy</h2><p>Scrapy是一个为了爬取网站数据，提取结构性数据而编写的应用框架。 可以应用在包括数据挖掘，信息处理或存储历史数据等一系列的程序中。</p>
<p>Scrapy依赖的库比较多，在安装之前，你需要确保以下库已经安装：wheel、lxml、pyOpenSSL、Twisted、pywin32，先装完，再装Scrapy。使用可阅读文章<a href="https://www.jianshu.com/p/0c0759bc3d27">Scrapy入门简介及Demo</a>。<br>库地址：<a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/">https://www.lfd.uci.edu/~gohlke/pythonlibs/</a></p>
<h3 id="安装wheel"><a href="#安装wheel" class="headerlink" title="安装wheel"></a>安装wheel</h3><h4 id="用途："><a href="#用途：" class="headerlink" title="用途："></a>用途：</h4><p>pip安装固然方便，但有时候会遇到安装失败的问题。wheel和egg都是打包的格式，支持不需要编译或制作的安装过程。wheel现在被认为是Python标准的二进制打包格式。</p>
<h4 id="安装命令："><a href="#安装命令：" class="headerlink" title="安装命令："></a>安装命令：</h4><p>pip install wheel</p>
<p><em>注意：如果你是刚刚安装过python并且从没有安装过wheel，你可以直接运行上述命令。但如果你的pip版本不够新，你需要在执行install命令之前更新一下pip，在命令行中输入：python -m pip install –upgrade pip更新pip，再输入安装命令即可。</em></p>
<h3 id="安装lxml"><a href="#安装lxml" class="headerlink" title="安装lxml"></a>安装lxml</h3><h4 id="用途：-1"><a href="#用途：-1" class="headerlink" title="用途："></a>用途：</h4><p>python的一个解析库,支持HTML和XML的解析,支持XPath解析方式,而且解析效率非常高。</p>
<h4 id="安装命令：-1"><a href="#安装命令：-1" class="headerlink" title="安装命令："></a>安装命令：</h4><h4 id="安装方式一-在线-："><a href="#安装方式一-在线-：" class="headerlink" title="安装方式一(在线)："></a>安装方式一(在线)：</h4><p>pip install lxml</p>
<h4 id="安装方式二（离线-："><a href="#安装方式二（离线-：" class="headerlink" title="安装方式二（离线)："></a>安装方式二（离线)：</h4><p>你可以进入地址<br>[<a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml]">https://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml]</a>:</p>
<p>去下载lxml，然后用安装.whl文件的方式安装。<br>pip install lxml‑4.4.1‑cp37‑cp37m‑win_amd64.whl</p>
<p><strong>下面安装都省略离线安装方式。</strong></p>
<h3 id="安装zope-interface"><a href="#安装zope-interface" class="headerlink" title="安装zope.interface"></a>安装zope.interface</h3><h4 id="用途：-2"><a href="#用途：-2" class="headerlink" title="用途："></a>用途：</h4><p>python本身不提供interface的实现,需要通过第三方扩展库来使用类似interface的功能,一般都是zope.interface。</p>
<p><em>注意：不安装zope.interface可能会出现pyOpenSSL安装失败。</em></p>
<h4 id="安装命令：-2"><a href="#安装命令：-2" class="headerlink" title="安装命令："></a>安装命令：</h4><p>pip install zope.interface</p>
<h3 id="安装pyOpenSSL"><a href="#安装pyOpenSSL" class="headerlink" title="安装pyOpenSSL"></a>安装pyOpenSSL</h3><h4 id="用途：-3"><a href="#用途：-3" class="headerlink" title="用途："></a>用途：</h4><p>让python支持SSL通信协议，简单来说就是加密解密等这系列操作。</p>
<h4 id="安装命令：-3"><a href="#安装命令：-3" class="headerlink" title="安装命令："></a>安装命令：</h4><p>pip install pyOpenSSL</p>
<h3 id="安装Twisted"><a href="#安装Twisted" class="headerlink" title="安装Twisted"></a>安装Twisted</h3><h4 id="用途：-4"><a href="#用途：-4" class="headerlink" title="用途："></a>用途：</h4><p>Twisted是用Python实现的基于事件驱动的网络引擎框架，Twisted支持许多常见的传输及应用层协议，包括TCP、UDP、SSL&#x2F;TLS、HTTP、IMAP、SSH、IRC以及FTP。就像Python一样，Twisted也具有“内置电池”（batteries-included）的特点。Twisted对于其支持的所有协议都带有客户端和服务器实现，同时附带有基于命令行的工具，使得配置和部署产品级的Twisted应用变得非常方便。</p>
<p>详情参见[<a href="https://www.cnblogs.com/misswangxing/p/7712318.html]">https://www.cnblogs.com/misswangxing/p/7712318.html]</a></p>
<h4 id="安装命令：-4"><a href="#安装命令：-4" class="headerlink" title="安装命令："></a>安装命令：</h4><p>pip install Twisted</p>
<h3 id="安装pywin32"><a href="#安装pywin32" class="headerlink" title="安装pywin32"></a>安装pywin32</h3><h4 id="用途：-5"><a href="#用途：-5" class="headerlink" title="用途："></a>用途：</h4><p>python不自带访问Windows API的库，需要下载这个库做支持。</p>
<h4 id="安装命令：-5"><a href="#安装命令：-5" class="headerlink" title="安装命令："></a>安装命令：</h4><p>pip install pywin32</p>
<p>#在python安装根路径的Scripts目录下执行<br>python pywin32_postinstall.py -install</p>
<h3 id="安装Scrapy"><a href="#安装Scrapy" class="headerlink" title="安装Scrapy"></a>安装Scrapy</h3><h4 id="安装命令：-6"><a href="#安装命令：-6" class="headerlink" title="安装命令："></a>安装命令：</h4><p>命令：pip install scrapy</p>
<h3 id="可能出现的问题"><a href="#可能出现的问题" class="headerlink" title="可能出现的问题"></a><strong>可能出现的问题</strong></h3><p>问题：You are using pip version 19.0.3, however version 19.X is available.<br>解决方法：输入命令python -m pip install -U pip 或 python -m pip install –upgrade pip </p>
<p>模块安装完毕，输入’scrapy -h’, 输出信息如下则表示Scrapy安装成功。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\mmm&gt;scrapy -h</span><br><span class="line">Scrapy <span class="number">1.7</span><span class="number">.3</span> - no active project</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  scrapy &lt;<span class="keyword">command</span>&gt; [<span class="title">options</span>] [<span class="title">args</span>]</span><br><span class="line"></span><br><span class="line">Available commands:</span><br><span class="line">  bench         Run quick benchmark test</span><br><span class="line">  fetch         Fetch <span class="keyword">a</span> <span class="built_in">URL</span> <span class="keyword">using</span> <span class="keyword">the</span> Scrapy downloader</span><br><span class="line">  genspider     Generate <span class="built_in">new</span> spider <span class="keyword">using</span> pre-defined templates</span><br><span class="line">  runspider     Run <span class="keyword">a</span> self-contained spider (<span class="keyword">without</span> creating <span class="keyword">a</span> project)</span><br><span class="line">  settings      Get settings values</span><br><span class="line">  <span class="built_in">shell</span>         Interactive scraping console</span><br><span class="line">  startproject  Create <span class="built_in">new</span> project</span><br><span class="line">  <span class="built_in">version</span>       Print Scrapy <span class="built_in">version</span></span><br><span class="line">  view          Open <span class="built_in">URL</span> <span class="keyword">in</span> browser, <span class="keyword">as</span> seen <span class="keyword">by</span> Scrapy</span><br><span class="line"></span><br><span class="line">  [ more ]      More commands available when run <span class="built_in">from</span> project <span class="built_in">directory</span></span><br></pre></td></tr></table></figure>

<h3 id="使用工具，快速解决系列：Anaconda"><a href="#使用工具，快速解决系列：Anaconda" class="headerlink" title="使用工具，快速解决系列：Anaconda"></a>使用工具，快速解决系列：Anaconda</h3><p>其实，你还可以登录Scrapy中文网，使用Anaconda进行安装，这个方式可能更适合初学编程的童鞋。地址如下：</p>
<p>[ <a href="http://www.scrapyd.cn/doc/124.html">http://www.scrapyd.cn/doc/124.html</a> ]</p>
<h3 id="验证安装是否成功"><a href="#验证安装是否成功" class="headerlink" title="验证安装是否成功"></a>验证安装是否成功</h3><h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h4><p>命令行：pip list</p>
<p>列表中出现了Scrapy，安装成功。</p>
<h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h4><p>命令行：scrapy</p>
<p>正确执行命令，安装成功。</p>
<h3 id="文件的功能"><a href="#文件的功能" class="headerlink" title="文件的功能"></a>文件的功能</h3><p>scrapy.cfg：配置文件</p>
<p>spiders：存放你Spider文件，也就是你爬取的py文件</p>
<p>items.py：相当于一个容器，和字典较像</p>
<p>middlewares.py：定义Downloader Middlewares(下载器中间件)和Spider Middlewares(蜘蛛中间件)的实现</p>
<p>pipelines.py:定义Item Pipeline的实现，实现数据的清洗，储存，验证。</p>
<p>settings.py：全局配置</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>a. 创建工程结构</p>
<p>cmd中执行命令：scrapy startproject  工程名</p>
<p><strong>快速打开当前文件夹的dos命令窗口：找到指定文件的文件夹，按住“shift+右键”，选择“在此处打开命令窗口”或“在此处打开Powershell窗口”即可。</strong></p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS C:\d\mmm\pycharm&gt; scrapy startproject baidu_baike</span><br><span class="line">New Scrapy project <span class="string">&#x27;baidu_baike&#x27;</span>, <span class="keyword">using</span> template <span class="built_in">directory</span> <span class="string">&#x27;c:\my\python\lib\site-packages\scrapy\templates\project&#x27;</span>, created <span class="keyword">in</span>:</span><br><span class="line">    C:\d\mmm\pycharm\baidu_baike</span><br><span class="line"></span><br><span class="line">You can <span class="built_in">start</span> your <span class="keyword">first</span> spider <span class="keyword">with</span>:</span><br><span class="line">    cd baidu_baike</span><br><span class="line">    scrapy genspider example example.com</span><br></pre></td></tr></table></figure>

<p>b. 创建一个spider（爬虫文件）</p>
<p>cmd中执行命令：scrapy genspider 文件名 要爬取的网址。</p>
<p>在spiders文件夹下创建</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS <span class="name">C</span>:\d\mmm\pycharm\baidu_baike\baidu_baike\spiders&gt; scrapy genspider -t basic baidubaike baike.baidu.com</span><br><span class="line">Created spider <span class="string">&#x27;baidubaike&#x27;</span> <span class="keyword">using</span> template <span class="string">&#x27;basic&#x27;</span> <span class="keyword">in</span> <span class="name">module</span>:</span><br><span class="line">  baidu_baike.spiders.baidubaike</span><br></pre></td></tr></table></figure>

<p>生成baidubaike.py的代码</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">import scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaidubaikeSpider</span>(scrapy.<span class="title class_">Spider</span>):</span><br><span class="line">    name = <span class="string">&#x27;baidu&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;baike.baidu.com&#x27;</span>]</span><br><span class="line">    start_urls = [<span class="string">&#x27;http://baike.baidu.com/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params"><span class="variable language_">self</span>, response</span>):</span><br><span class="line">        pass</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>name：是项目的名字</p>
<p>allowed_domains：是允许爬取的域名，比如一些网站有相关链接，域名就和本网站不同，这些就会忽略。</p>
<p>atart_urls：是Spider爬取的网站，定义初始的请求url，可以多个。</p>
<p>parse方法：是Spider的一个方法，在请求start_url后，之后的方法，这个方法是对网页的解析，与提取自己想要的东西。</p>
<p>response参数：是请求网页后返回的内容，也就是你需要解析的网页。</p>
<p>c. 运行</p>
<p>项目<a href="https://github.com/Pelhans/Z_knowledge_graph">从零开始构建知识图谱项目链接</a>是python2编写的，在python3环境下运行需要修改代码</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#settings</span>.py文件</span><br><span class="line">#修改前 mysql的配置，PORT的值为数字，不可加单引号</span><br><span class="line">HOST_IP = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">PORT = <span class="number">3306</span>  </span><br><span class="line">USER = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">PASSWD = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">DB_NAME = <span class="string">&#x27;baidu_baike&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#baidu_baike</span>.py文件</span><br><span class="line">#修改前 urlparse<span class="selector-class">.urljoin</span></span><br><span class="line">urllib<span class="selector-class">.parse</span><span class="selector-class">.urljoin</span></span><br><span class="line">#修改前 urlparse</span><br><span class="line">urllib</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#pipelines</span>.py文件</span><br><span class="line">#修改前 <span class="selector-class">.decode</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="selector-class">.encode</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">#删除#port=settings.PORT的注释</span><br><span class="line">port=settings<span class="selector-class">.PORT</span></span><br><span class="line">#删除代码</span><br><span class="line">import sys</span><br><span class="line"><span class="function"><span class="title">reload</span><span class="params">(sys)</span></span></span><br><span class="line">sys<span class="selector-class">.setdefaultencoding</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>cmd中执行命令：scrapy crawl 项目名</p>
<p>在项目根路径下执行</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">PS C:\d\mmm\pycharm\baidu_baike&gt; scrapy crawl baidu</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">40</span> [scrapy.utils.log] INFO: Scrapy <span class="number">1.7</span>.<span class="number">3</span> started (bot: baidu_baike)</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">40</span> [scrapy.utils.log] INFO: Versions: lxml <span class="number">4.4</span>.<span class="number">1.0</span>, libxml2 <span class="number">2.9</span>.<span class="number">5</span>, cssselect <span class="number">1.1</span>.<span class="number">0</span>, parsel <span class="number">1.5</span>.<span class="number">2</span>, w3lib <span class="number">1.21</span>.<span class="number">0</span>, Twisted <span class="number">19.7</span>.<span class="number">0</span>, Python <span class="number">3.7</span>.<span class="number">4</span> (tags/v3.<span class="number">7.4</span>:e09359112e, Jul  <span class="number">8</span> <span class="number">2019</span>, <span class="number">20</span>:<span class="number">34</span>:<span class="number">20</span>) [MSC v.<span class="number">1916</span> <span class="number">64</span> bit (AMD64)], pyOpenSSL <span class="number">19.0</span>.<span class="number">0</span> (OpenSSL <span class="number">1.1</span>.<span class="number">1</span>c  <span class="number">28</span> May <span class="number">2019</span>), cryptography <span class="number">2.7</span>, Platform Windows-<span class="number">10</span>-<span class="number">10.0</span>.<span class="number">18362</span>-SP<span class="number">0</span></span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">40</span> [scrapy.crawler] INFO: Overridden settings: &#123;<span class="string">&#x27;BOT_NAME&#x27;</span>: <span class="string">&#x27;baidu_baike&#x27;</span>, <span class="string">&#x27;NEWSPIDER_MODULE&#x27;</span>: <span class="string">&#x27;baidu_baike.spiders&#x27;</span>, <span class="string">&#x27;SPIDER_MODULES&#x27;</span>: [<span class="string">&#x27;baidu_baike.spiders&#x27;</span>], <span class="string">&#x27;USER_AGENT&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36&#x27;</span>&#125;</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">40</span> [scrapy.extensions.telnet] INFO: Telnet Password: <span class="number">4</span>e0e039c01ca23b2</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">40</span> [scrapy.middleware] INFO: Enabled extensions:</span><br><span class="line">[<span class="string">&#x27;scrapy.extensions.corestats.CoreStats&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.extensions.telnet.TelnetConsole&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.extensions.logstats.LogStats&#x27;</span>]</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">41</span> [scrapy.middleware] INFO: Enabled downloader middlewares:</span><br><span class="line">[<span class="string">&#x27;baidu_baike.middlewares.RandomUserAgent&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;baidu_baike.middlewares.ProxyMiddleWare&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.useragent.UserAgentMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.retry.RetryMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.redirect.RedirectMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.cookies.CookiesMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.downloadermiddlewares.stats.DownloaderStats&#x27;</span>]</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">41</span> [scrapy.middleware] INFO: Enabled spider middlewares:</span><br><span class="line">[<span class="string">&#x27;scrapy.spidermiddlewares.httperror.HttpErrorMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.spidermiddlewares.offsite.OffsiteMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.spidermiddlewares.referer.RefererMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.spidermiddlewares.urllength.UrlLengthMiddleware&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;scrapy.spidermiddlewares.depth.DepthMiddleware&#x27;</span>]</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">41</span> [scrapy.middleware] INFO: Enabled <span class="type">item</span> pipelines:</span><br><span class="line">[<span class="string">&#x27;baidu_baike.pipelines.BaiduBaikePipeline&#x27;</span>]</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">41</span> [scrapy.core.engine] INFO: Spider opened</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">41</span> [scrapy.extensions.logstats] INFO: Crawled <span class="number">0</span> pages (<span class="keyword">at</span> <span class="number">0</span> pages/min), scraped <span class="number">0</span> items (<span class="keyword">at</span> <span class="number">0</span> items/min)</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">41</span> [scrapy.extensions.telnet] INFO: Telnet console listening on <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6023</span></span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">41</span> [scrapy.core.engine] DEBUG: Crawled (<span class="number">200</span>) &lt;GET https://baike.baidu.com/<span class="type">item</span>/<span class="meta">%E5</span><span class="meta">%88</span><span class="meta">%98</span><span class="meta">%E5</span><span class="meta">%BE</span><span class="meta">%B7</span><span class="meta">%E5</span><span class="meta">%8D</span><span class="meta">%8E</span>/<span class="number">114923</span>&gt; (referer: None)</span><br><span class="line">Get a actor page</span><br><span class="line"><span class="number">2019</span>-09-<span class="number">26</span> 09:<span class="number">45</span>:<span class="number">42</span> [scrapy.core.scraper] DEBUG: Scraped from &lt;<span class="number">200</span> https://baike.baidu.com/<span class="type">item</span>/<span class="meta">%E5</span><span class="meta">%88</span><span class="meta">%98</span><span class="meta">%E5</span><span class="meta">%BE</span><span class="meta">%B7</span><span class="meta">%E5</span><span class="meta">%8D</span><span class="meta">%8E</span>/<span class="number">114923</span>&gt;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>


<h1 id="二-数据库到-NTriples-以及通过Apache-jena-访问NT"><a href="#二-数据库到-NTriples-以及通过Apache-jena-访问NT" class="headerlink" title="二. 数据库到 NTriples 以及通过Apache jena 访问NT"></a>二. 数据库到 NTriples 以及通过Apache jena 访问NT</h1><h2 id="1-Protege"><a href="#1-Protege" class="headerlink" title="1. Protege"></a>1. Protege</h2><p>斯坦福大学开发的本体编辑和知识获取软件。开发语言采用Java，属于开放源码软件。由于其优秀的设计和众多的插件，<a href="https://protege.stanford.edu/">Protege</a>已成为目前使用最广泛的本体论编辑器之一。软件不需要安装，需要配置相应的Java环境。详细使用可阅读<a href="https://protegewiki.stanford.edu/wiki/Main_Page">官方教程</a>。</p>
<p>打开protege，看到和下图类似的界面。在Ontology IRI中填写我们新建本体资源的IRI。读者可以填写自己的符合标准的IRI。如下：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//www.kgdemo.com</span></span><br></pre></td></tr></table></figure>
<h2 id="2-d2rq"><a href="#2-d2rq" class="headerlink" title="2. d2rq"></a>2. d2rq</h2><p>D2RQ平台用于访问关系数据库系统是虚拟的,只读RDF图。它提供了基于RDF的访问关系数据库的内容,而无需复制成RDF存储。使用D2RQ可参考文章<a href="https://blog.csdn.net/dqc406839653/article/details/83054710">使用d2rq的第一步</a>，<a href="http://d2rq.org/d2rq-language">官方文档</a>。</p>
<p>官方网站：<a href="http://d2rq.org/">http://d2rq.org/</a></p>
<p>a. 下载后得到了<a href="https://github.s3.amazonaws.com/downloads/d2rq/d2rq/d2rq-0.8.1.zip?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAISTNZFOVBIJMK3TQ/20190925/us-east-1/s3/aws4_request&X-Amz-Date=20190925T071020Z&X-Amz-Expires=300&X-Amz-SignedHeaders=host&X-Amz-Signature=dbb8bdb6cb59c0f812600b5089aabd5173e84852d3c349706befbb1be0c60aeb">d2rq-0.8.1.zip</a>的压缩文件，d2rq不需要安装，直接将其解压到运行目录，再配置运行环境即可。</p>
<p>b. 项目需要将d2rq与java、mysql进行联合应用，因此需要JDBC driver，将<a href="https://cdn.mysql.com//Downloads/Connector-J/mysql-connector-java-5.1.48.zip">mysql-connector-java-5.1.48-bin.jar</a>文件放入d2rq的&#x2F;lib文件夹中。</p>
<p>c. 用generate-mapping工具为数据库创建mapping file（映射文件）。cmd中运行 cd C:\my\d2rq命令，转到d2rq目录。<br>运行以下命令，创建mappling映射文件。?useSSL&#x3D;false语句设置SSL为false以避免提示警告，数据库没设置主键会提示警告。</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS C:\my\d2rq&gt; .\<span class="keyword">generate</span>-mapping -u root -p root -o kg_demo_mapping_baidu_baike<span class="variable">.ttl</span> jdbc:mysql:<span class="comment">///baidu_baike?useSSL=false</span></span><br><span class="line">## -u 后root是数据库用户，-p 后root是用户密码,jdbc:mysql: 后baidu_baike是数据库名称；</span><br><span class="line">## 注意笔者是Windows PowerShell命令窗口运行命令，若在cmd中去掉前面的.\，即：<span class="keyword">generate</span>-mapping开始。下面的命令也如此。</span><br></pre></td></tr></table></figure>

<p>下面是根据我们定义的本体修改的mapping文件。</p>
<ol>
<li>为了表达简练，我们给本体做一些修改。</li>
</ol>
<p>这样<code>http://www.kgdemo.com#Actor就可以表达为</code>:Actor&#96;，其他的词汇同理。</p>
<p><em>vocab</em>前缀，它表示输出本体的命名空间，也就是说，所有来自<em>D2RQ</em>的<em>RDF</em>都必须使用具有<em>vocab</em>前缀的命名空间的类和属性描述。这样做的目的是为了使它们是唯一的，在需要读取某个类或属性时可以直接操作，而不必先动态获得命名空间了。</p>
<ol start="2">
<li>把默认的映射词汇改为我们本体中的词汇即可。在处理外键的时候要注意当前编辑的属性的domain和range，belongsToClassMap是domain，refersToClassMap是range。</li>
</ol>
<p>为了实现生成及修改全自自动，需编写dos下的bat实现，auto.bat代码如下：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off&amp;<span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> db=baidu_baike</span><br><span class="line"><span class="built_in">set</span> file=kg_demo_mapping_<span class="variable">%db%</span>.ttl</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> generate-mapping -u root -p root -o <span class="variable">%file%</span> jdbc:mysql:///<span class="variable">%db%</span>?useSSL=false</span><br><span class="line"></span><br><span class="line">:: <span class="keyword">call</span> <span class="built_in">findstr</span> /i /v /C:&quot;@prefix vocab&quot; &quot;<span class="variable">%file%</span>&quot;&gt;&gt;<span class="variable">%file%</span>.bk</span><br><span class="line">:: <span class="built_in">move</span> /y <span class="variable">%file%</span>.bk <span class="variable">%file%</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=<span class="number">1</span>,* delims=:&quot; <span class="variable">%%b</span> <span class="keyword">in</span> (&#x27;<span class="built_in">findstr</span> /n &quot;.*&quot; &quot;<span class="variable">%file%</span>&quot;&#x27;)<span class="keyword">do</span> (</span><br><span class="line">	<span class="built_in">set</span> &quot;var=<span class="variable">%%c</span>&quot;</span><br><span class="line">	<span class="keyword">if</span> &quot;<span class="variable">!var!</span>&quot; <span class="keyword">neq</span> &quot;@prefix vocab: &lt;vocab/&gt; .&quot; (</span><br><span class="line">		<span class="keyword">if</span> &quot;<span class="variable">!var!</span>&quot; <span class="keyword">equ</span> &quot;&quot; (</span><br><span class="line">			&gt;&gt;<span class="variable">%file%</span>.bk <span class="built_in">echo</span>,<span class="variable">!var!</span>) ^</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> &quot;<span class="variable">!var!</span>&quot; <span class="keyword">equ</span> &quot;@prefix jdbc: &lt;http://d2rq.org/terms/jdbc/&gt; .&quot; (</span><br><span class="line">		  &gt;&gt;<span class="variable">%file%</span>.bk <span class="built_in">echo</span>,<span class="variable">!var!</span></span><br><span class="line">			&gt;&gt;<span class="variable">%file%</span>.bk <span class="built_in">echo</span>,@prefix : ^&lt;http://www.kgdemo.com#^&gt; .) ^</span><br><span class="line">		<span class="keyword">else</span> (</span><br><span class="line">			<span class="built_in">echo</span>;&quot;<span class="variable">!var!</span>&quot;|<span class="built_in">find</span> &quot;jdbcDSN&quot;&amp;&amp;(</span><br><span class="line">				&gt;&gt;<span class="variable">%file%</span>.bk <span class="built_in">echo</span>,  d2rq:jdbcDSN ^&quot;jdbc:mysql:///<span class="variable">%db%</span>?useUnicode=true^&amp;characterEncoding=utf8^&amp;useSSL=false^&quot;;)||(</span><br><span class="line">				<span class="built_in">set</span> &quot;var=!var:vocab= !&quot;</span><br><span class="line">	    	<span class="built_in">set</span> &quot;var=<span class="variable">!var:actor_actor=actor!</span>&quot;</span><br><span class="line">	    	&gt;&gt;<span class="variable">%file%</span>.bk <span class="built_in">echo</span>,<span class="variable">!var!</span>))</span><br><span class="line">	)</span><br><span class="line">)</span><br><span class="line"><span class="built_in">move</span> /y <span class="variable">%file%</span>.bk <span class="variable">%file%</span></span><br></pre></td></tr></table></figure>
<p>d. 运行dump-rdf工具，创建rdf的转存,命令将数据转换为Ntriples。<br>按照官方的介绍，运行以下命令生成rdf，在d2rq文件夹中查看生成的nt文件可以看到RDF结构。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\<span class="keyword">my</span>\d2rq&gt; ./<span class="keyword">dump</span>-rdf -o baidu_baike.nt kg_demo_mapping_baidu_baike.ttl</span><br></pre></td></tr></table></figure>

<p>e. 使用下面的命令启动D2R Server</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\my\d2rq&gt; ./d2r-server kg_demo_mapping_baidu_baike.ttl</span><br><span class="line">17:10:16 INFO  JettyLauncher        :: [[[ Server started at http://localhost:2020/ ]]]</span><br></pre></td></tr></table></figure>

<p>f.SPARQL查询</p>
<p>例如：“周星驰出演了哪些电影？”</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">SELECT</span> <span class="string">?n</span> <span class="variable constant_">WHERE</span> &#123;</span><br><span class="line">  <span class="string">?s</span> <span class="symbol">rdf:</span>type <span class="symbol">:Actor</span>.</span><br><span class="line">  <span class="string">?s</span> <span class="symbol">:actor_chName</span> <span class="string">&#x27;周星驰&#x27;</span>.</span><br><span class="line">  <span class="string">?o</span> <span class="symbol">:movie_chName</span> <span class="string">?n</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable constant_">LIMIT</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>结果为:</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SPARQL resul<span class="symbol">ts:</span></span><br><span class="line"><span class="built_in">n</span></span><br><span class="line"><span class="string">&quot;七小福&quot;</span></span><br><span class="line"><span class="string">&quot;大众电影百花奖&quot;</span></span><br><span class="line"><span class="string">&quot;台湾电影金马奖&quot;</span></span><br><span class="line"><span class="string">&quot;香港电影金像奖&quot;</span></span><br><span class="line"><span class="string">&quot;香港电影导演会&quot;</span></span><br><span class="line"><span class="string">&quot;长江7号&quot;</span></span><br><span class="line"><span class="string">&quot;第28届香港电影金像奖&quot;</span></span><br><span class="line"><span class="string">&quot;跳出去&quot;</span></span><br><span class="line"><span class="string">&quot;少林少女&quot;</span></span><br><span class="line"><span class="string">&quot;西游：降魔篇&quot;</span></span><br></pre></td></tr></table></figure>

<p>就我们这个例子而言，可以不要“?s rdf:type :Actor”，这里只是让查询图更具体（在拥有复杂关系的RDF图中，可能会存在不同的类拥有相同的属性名。比如，猫和狗名字的属性名都是”name”，我们想查询一只叫汤姆的猫；如果不指定类型，返回结果可能也包含一只叫汤姆的狗）。图模式中，每个RDF用英文句号进行分割。</p>
<p>例如：“少林足球这部电影有哪些演员参演”：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">SELECT</span> <span class="string">?n</span> <span class="variable constant_">WHERE</span> &#123;</span><br><span class="line">  <span class="string">?s</span> <span class="symbol">rdf:</span>type <span class="symbol">:Movie</span>.</span><br><span class="line">  <span class="string">?s</span> <span class="symbol">:movie_chName</span> <span class="string">&#x27;少林足球&#x27;</span>.</span><br><span class="line">  <span class="string">?a</span> <span class="symbol">:hasActedIn</span> <span class="string">?s</span>.</span><br><span class="line">  <span class="string">?a</span> <span class="symbol">:actor_chName</span> <span class="string">?n</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果为:</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">n</span></span><br><span class="line"><span class="string">&quot;周星驰&quot;</span></span><br><span class="line"><span class="string">&quot;吴孟达&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Apache-jena"><a href="#3-Apache-jena" class="headerlink" title="3. Apache jena"></a>3. Apache jena</h2><p>Apache Jena是一个开源的Java语义网框架（open source Semantic Web Framework for Java），用于构建语义网和链接数据应用。安装可阅读文章<a href="https://blog.csdn.net/weixin_41104835/article/details/88635600">Jena 和 Fuseki安装与SPARQL查询</a>。</p>
<p>下载地址：<a href="http://jena.apache.org/download/">http://jena.apache.org/download/</a></p>
<p>TDB：用于存储RDF的组件。<br>Jena：提供了RDFS、OWL和通用规则推理机。下载<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/jena/binaries/apache-jena-3.12.0.zip">Jena</a><br>Fuseki：Jena提供的SPARQL服务器，也就是SPARQL endpoint。下载<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/jena/binaries/apache-jena-fuseki-3.12.0.zip">Fuseki</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>java开发的软件免安装。</p>
<h3 id="基本使用-1"><a href="#基本使用-1" class="headerlink" title="基本使用"></a>基本使用</h3><p>a. 将RDF数据转换以TDB的方式存储<br>运行命令：tdbloader –loc&#x3D;”..\tdb” “....\d2rq\baidu_baike.nt”</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">PS</span> C:\my\apache-jena\bat&gt; ./tdbloader --loc=<span class="string">&quot;..\tdb&quot;</span> <span class="string">&quot;..\..\d2rq\baidu_baike.nt&quot;</span></span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">28</span> INFO  loader               :: -- Start triples data phase</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">28</span> INFO  loader               :: ** Load empty triples table</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">28</span> INFO  loader               :: -- Start quads data phase</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">28</span> INFO  loader               :: ** Load empty quads table</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">28</span> INFO  loader               :: Load: ..\..\d2rq\baidu_baike.nt -- <span class="number">2019</span>/<span class="number">09</span>/<span class="number">27</span> <span class="number">16</span>:<span class="number">03</span>:<span class="number">28</span> CST</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">30</span> INFO  loader               :: Add: <span class="number">50</span>,<span class="number">000</span> triples (Batch: <span class="number">31</span>,<span class="number">867</span> / Avg: <span class="number">31</span>,<span class="number">867</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">30</span> INFO  loader               :: Add: <span class="number">100</span>,<span class="number">000</span> triples (Batch: <span class="number">124</span>,<span class="number">688</span> / Avg: <span class="number">50</span>,<span class="number">761</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">31</span> INFO  loader               :: Add: <span class="number">150</span>,<span class="number">000</span> triples (Batch: <span class="number">147</span>,<span class="number">928</span> / Avg: <span class="number">64</span>,<span class="number">991</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">31</span> INFO  loader               :: Add: <span class="number">200</span>,<span class="number">000</span> triples (Batch: <span class="number">124</span>,<span class="number">378</span> / Avg: <span class="number">73</span>,<span class="number">800</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">31</span> INFO  loader               :: Add: <span class="number">250</span>,<span class="number">000</span> triples (Batch: <span class="number">128</span>,<span class="number">534</span> / Avg: <span class="number">80</span>,<span class="number">671</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">32</span> INFO  loader               :: Add: <span class="number">300</span>,<span class="number">000</span> triples (Batch: <span class="number">152</span>,<span class="number">905</span> / Avg: <span class="number">87</span>,<span class="number">565</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">32</span> INFO  loader               :: Add: <span class="number">350</span>,<span class="number">000</span> triples (Batch: <span class="number">131</span>,<span class="number">926</span> / Avg: <span class="number">91</span>,<span class="number">984</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">32</span> INFO  loader               :: Add: <span class="number">400</span>,<span class="number">000</span> triples (Batch: <span class="number">135</span>,<span class="number">501</span> / Avg: <span class="number">95</span>,<span class="number">831</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">33</span> INFO  loader               :: Add: <span class="number">450</span>,<span class="number">000</span> triples (Batch: <span class="number">154</span>,<span class="number">798</span> / Avg: <span class="number">100</span>,<span class="number">066</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">33</span> INFO  loader               :: Add: <span class="number">500</span>,<span class="number">000</span> triples (Batch: <span class="number">145</span>,<span class="number">348</span> / Avg: <span class="number">103</span>,<span class="number">284</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">33</span> INFO  loader               ::   Elapsed: <span class="number">4</span>.<span class="number">84</span> seconds<span class="meta"> [2019/09/27 16:03:33 CST]</span></span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">33</span> INFO  loader               :: Add: <span class="number">550</span>,<span class="number">000</span> triples (Batch: <span class="number">160</span>,<span class="number">256</span> / Avg: <span class="number">106</span>,<span class="number">733</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">34</span> INFO  loader               :: Add: <span class="number">600</span>,<span class="number">000</span> triples (Batch: <span class="number">145</span>,<span class="number">348</span> / Avg: <span class="number">109</span>,<span class="number">150</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">34</span> INFO  loader               :: Add: <span class="number">650</span>,<span class="number">000</span> triples (Batch: <span class="number">125</span>,<span class="number">628</span> / Avg: <span class="number">110</span>,<span class="number">262</span>)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">34</span> INFO  loader               :: -- Finish triples data phase</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">34</span> INFO  loader               :: ** Data: <span class="number">663</span>,<span class="number">080</span> triples loaded in <span class="number">6</span>.<span class="number">08</span> seconds<span class="meta"> [Rate: 109,059.21 per second]</span></span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">34</span> INFO  loader               :: -- Finish quads data phase</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">34</span> INFO  loader               :: -- Start triples index phase</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">35</span> INFO  loader               :: Index SPO-&gt;POS: <span class="number">100</span>,<span class="number">000</span> slots (Batch: <span class="number">418</span>,<span class="number">410</span> slots/s / Avg: <span class="number">418</span>,<span class="number">410</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">35</span> INFO  loader               :: Index SPO-&gt;POS: <span class="number">200</span>,<span class="number">000</span> slots (Batch: <span class="number">662</span>,<span class="number">251</span> slots/s / Avg: <span class="number">512</span>,<span class="number">820</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">35</span> INFO  loader               :: Index SPO-&gt;POS: <span class="number">300</span>,<span class="number">000</span> slots (Batch: <span class="number">598</span>,<span class="number">802</span> slots/s / Avg: <span class="number">538</span>,<span class="number">599</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">35</span> INFO  loader               :: Index SPO-&gt;POS: <span class="number">400</span>,<span class="number">000</span> slots (Batch: <span class="number">588</span>,<span class="number">235</span> slots/s / Avg: <span class="number">550</span>,<span class="number">206</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">35</span> INFO  loader               :: Index SPO-&gt;POS: <span class="number">500</span>,<span class="number">000</span> slots (Batch: <span class="number">581</span>,<span class="number">395</span> slots/s / Avg: <span class="number">556</span>,<span class="number">173</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">35</span> INFO  loader               :: Index SPO-&gt;POS: <span class="number">600</span>,<span class="number">000</span> slots (Batch: <span class="number">598</span>,<span class="number">802</span> slots/s / Avg: <span class="number">562</span>,<span class="number">851</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">36</span> INFO  loader               :: ** Index SPO-&gt;POS: <span class="number">663</span>,<span class="number">080</span> slots indexed in <span class="number">1</span>.<span class="number">19</span> seconds<span class="meta"> [Rate: 558,618.38 per second]</span></span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">36</span> INFO  loader               :: Index SPO-&gt;OSP: <span class="number">100</span>,<span class="number">000</span> slots (Batch: <span class="number">657</span>,<span class="number">894</span> slots/s / Avg: <span class="number">657</span>,<span class="number">894</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">36</span> INFO  loader               :: Index SPO-&gt;OSP: <span class="number">200</span>,<span class="number">000</span> slots (Batch: <span class="number">694</span>,<span class="number">444</span> slots/s / Avg: <span class="number">675</span>,<span class="number">675</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">36</span> INFO  loader               :: Index SPO-&gt;OSP: <span class="number">300</span>,<span class="number">000</span> slots (Batch: <span class="number">584</span>,<span class="number">795</span> slots/s / Avg: <span class="number">642</span>,<span class="number">398</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">36</span> INFO  loader               :: Index SPO-&gt;OSP: <span class="number">400</span>,<span class="number">000</span> slots (Batch: <span class="number">561</span>,<span class="number">797</span> slots/s / Avg: <span class="number">620</span>,<span class="number">155</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">36</span> INFO  loader               :: Index SPO-&gt;OSP: <span class="number">500</span>,<span class="number">000</span> slots (Batch: <span class="number">595</span>,<span class="number">238</span> slots/s / Avg: <span class="number">615</span>,<span class="number">006</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">37</span> INFO  loader               :: Index SPO-&gt;OSP: <span class="number">600</span>,<span class="number">000</span> slots (Batch: <span class="number">546</span>,<span class="number">448</span> slots/s / Avg: <span class="number">602</span>,<span class="number">409</span> slots/s)</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">37</span> INFO  loader               :: ** Index SPO-&gt;OSP: <span class="number">663</span>,<span class="number">080</span> slots indexed in <span class="number">1</span>.<span class="number">11</span> seconds<span class="meta"> [Rate: 595,224.44 per second]</span></span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">37</span> INFO  loader               :: -- Finish triples index phase</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">37</span> INFO  loader               :: ** <span class="number">663</span>,<span class="number">080</span> triples indexed in <span class="number">2</span>.<span class="number">31</span> seconds<span class="meta"> [Rate: 287,171.94 per second]</span></span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">37</span> INFO  loader               :: -- Finish triples load</span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">37</span> INFO  loader               :: ** Completed: <span class="number">663</span>,<span class="number">080</span> triples loaded in <span class="number">8</span>.<span class="number">41</span> seconds<span class="meta"> [Rate: 78,844.23 per second]</span></span><br><span class="line"><span class="attribute">16</span>:<span class="number">03</span>:<span class="number">37</span> INFO  loader               :: -- Finish quads load</span><br></pre></td></tr></table></figure>
<p><em>注意：“–loc”指定tdb存储的位置；第二个参数是由Mysql数据转换得到的RDF数据。</em></p>
<p>b. 通过Fuseki进行开启服务<br>进入fuseki目录下，运行命令：fuseki-server –loc&#x3D;..\apache-jena\tdb &#x2F;kg_movie</p>
<p><em>注意：–loc的参数是上一步TDB数据库的路径,kg_movie是显示的数据库名。</em></p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\my\apache-jena-fuseki&gt; ./fuseki-server --loc=..\apache-jena\tdb /kg_movie</span><br><span class="line">[2019<span class="string">-09</span><span class="string">-25</span> 16:35:32] Server     INFO  Running in read-only mode for /kg_movie</span><br><span class="line">[2019<span class="string">-09</span><span class="string">-25</span> 16:35:32] Server     INFO  Apache Jena Fuseki 3.12.0</span><br><span class="line">[2019<span class="string">-09</span><span class="string">-25</span> 16:35:32] Config     INFO  FUSEKI_HOME=C:\my\apache-jena-fuseki\.</span><br><span class="line">[2019<span class="string">-09</span><span class="string">-25</span> 16:35:32] Config     INFO  FUSEKI_BASE=C:\my\apache-jena-fuseki\run</span><br><span class="line">[2019<span class="string">-09</span><span class="string">-25</span> 16:35:32] Config     INFO  Shiro file: file://C:\my\apache-jena-fuseki\run\shiro.ini</span><br><span class="line">[2019<span class="string">-09</span><span class="string">-25</span> 16:35:32] Config     INFO  Template file: templates/config-tdb-dir</span><br><span class="line">[2019<span class="string">-09</span><span class="string">-25</span> 16:35:32] Config     INFO  TDB dataset: directory=..\apache-jena\tdb</span><br><span class="line">[2019<span class="string">-09</span><span class="string">-25</span> 16:35:33] Config     INFO  Register: /kg_movie</span><br><span class="line">[2019<span class="string">-09</span><span class="string">-25</span> 16:35:33] Server     INFO  Started 2019/09/25 16:35:33 CST on port 3030</span><br></pre></td></tr></table></figure>
<p>测试查询,可以通过网页端和命令行方式进行SPQRQL查询</p>
<p>如：过滤出变量包含“长江7号”的实体</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">SELECT</span> <span class="string">?s</span>ubject <span class="string">?p</span>redicate <span class="string">?o</span>bject</span><br><span class="line"><span class="variable constant_">WHERE</span> &#123;</span><br><span class="line">  <span class="string">?s</span>ubject <span class="string">?p</span>redicate <span class="string">?o</span>bject</span><br><span class="line">  <span class="variable constant_">FILTER</span> regex(<span class="string">?o</span>bject, <span class="string">&quot;长江7号&quot;</span>) </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable constant_">LIMIT</span> <span class="number">25</span></span><br></pre></td></tr></table></figure>
<p>返回结果：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">	subject	predicate	object</span><br><span class="line"><span class="number">1</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/6&gt;</span></span><br><span class="line">&lt;http:<span class="regexp">//</span>www.kgdemo.com<span class="comment">#movie_chName&gt;</span></span><br><span class="line"><span class="string">&quot;长江7号&quot;</span></span><br><span class="line"><span class="number">2</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/6&gt;</span></span><br><span class="line">&lt;http:<span class="regexp">//</span>www.kgdemo.com<span class="comment">#movie_bio&gt;</span></span><br><span class="line"><span class="string">&quot; 《长江7号》是由周星驰执导，周星驰、徐娇、张雨绮、林子聪主演的科幻喜剧电影。该片于2008年1月30日在中国上映。影片讲述一名父亲将意外拾获的外星玩具狗当做礼物送给儿子，从而让父子两人的生活发生变化的故事。 [1]  &quot;</span></span><br><span class="line"><span class="number">3</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/10221&gt;</span></span><br><span class="line">&lt;http:<span class="regexp">//</span>www.kgdemo.com<span class="comment">#movie_chName&gt;</span></span><br><span class="line"><span class="string">&quot;长江7号爱地球&quot;</span></span><br><span class="line"><span class="number">4</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/10221&gt;</span></span><br><span class="line">&lt;http:<span class="regexp">//</span>www.kgdemo.com<span class="comment">#movie_bio&gt;</span></span><br><span class="line"><span class="string">&quot; 《长江7号爱地球》是由袁建滔执导的动画电影，石班瑜、徐娇、董洁等联合配音。该片于2010年7月9日在中国内地上映。该片讲述了狄爸以在建筑工地打散工养家，在垃圾堆意外捡到神秘外星生物7仔的故事。 [1]  &quot;</span></span><br><span class="line"><span class="number">5</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#actor/1&gt;</span></span><br><span class="line">&lt;http:<span class="regexp">//</span>www.kgdemo.com<span class="comment">#actor_bio&gt;</span></span><br><span class="line"><span class="string">&quot; 周星驰，1962年6月22日生于香港，祖籍浙江宁波，中国香港演员、导演、编剧、制作人、商人，毕业于无线电视艺员训练班。1980年成为丽的电视台的特约演员，从而进入演艺圈。1981年出演个人首部电视剧《IQ成熟时》。1988年将演艺事业的重心转向大银幕，并于同年出演电影处女作《捕风汉子》。1990年凭借喜剧片《一本漫画闯天涯》确立其无厘头的表演风格 [1]  ；同年，因其主演的喜剧动作片《赌圣》打破香港地区票房纪录而获得关注 [2]  。1991年主演喜剧片《逃学威龙》，并再次打破香港地区票房纪录 [3]  。1995年凭借喜剧爱情片《大话西游》奠定其在华语影坛的地位。1999年自导自演的喜剧片《喜剧之王》获得香港电影年度票房冠军 [4]  。2002年凭借喜剧片《少林足球》获得第21届香港电影金像奖最佳男主角奖以及最佳导演奖 [5]  。2003年成为美国《时代周刊》封面人物 [6]  。2005年凭借喜剧动作片《功夫》获得第42届台湾电影金马奖最佳导演奖 [7]  。2008年自导自演的科幻喜剧片《长江7号》获得香港电影年度票房冠军 [8]  。2013年执导古装喜剧片《西游·降魔篇》，该片以2.18亿美元的票房成绩打破华语电影在全球的票房纪录 [9-10]  。2016年担任科幻喜剧片《美人鱼》的导演、编剧、制作人，该片以超过33亿元的票房创下中国内地电影票房纪录 [11-14]  。2017年1月28日，担任监制、编剧的古装喜剧片《西游伏妖篇》上映 [15]  。2018年执导《美人鱼2》 [16]  。演艺事业外，周星驰还涉足商界。1989年成立星炜有限公司 [17]  。1996年成立星辉公司 [18]  。2010年出任比高集团有限公司执行董事 [19]  。 &quot;</span></span><br><span class="line"><span class="number">6</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/10218&gt;</span></span><br><span class="line">&lt;http:<span class="regexp">//</span>www.kgdemo.com<span class="comment">#movie_bio&gt;</span></span><br><span class="line"><span class="string">&quot; 曾谨昌是香港资深编剧家。他于1981年加入电视广播有限公司(TVB)，编写过多部脍炙人口的电视剧，作品有《白蛇传说》、《长江7号爱地球》等。 &quot;</span></span><br></pre></td></tr></table></figure>
<p>c. 实现OWL推理</p>
<p>上一步运行完退出。程序会为我们在当前目录自动创建“run”文件夹实现。将我们的本体文件“kg_movie_tultle.owl”移动到“run”文件夹下的“databases”文件夹中，并将“owl”后缀名改为“ttl”。在“run”文件夹下的“configuration”中，我们创建名为“fuseki_conf.ttl”的文本文件（取名没有要求），加入如下内容：</p>
<ol>
<li>TDB</li>
</ol>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@prefix :</span>       &lt;#&gt; .</span><br><span class="line"><span class="variable">@prefix</span> <span class="attribute">fuseki</span>: &lt;<span class="attribute">http</span>:<span class="comment">//jena.apache.org/fuseki#&gt; .</span></span><br><span class="line"><span class="variable">@prefix</span> <span class="attribute">rdf</span>: 		&lt;<span class="attribute">http</span>:<span class="comment">//www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .</span></span><br><span class="line"><span class="variable">@prefix</span> <span class="attribute">rdfs</span>: 	&lt;<span class="attribute">http</span>:<span class="comment">//www.w3.org/2000/01/rdf-schema#&gt; .</span></span><br><span class="line"><span class="variable">@prefix</span> <span class="attribute">tdb</span>: 		&lt;<span class="attribute">http</span>:<span class="comment">//jena.hpl.hp.com/2008/tdb#&gt; .</span></span><br><span class="line"><span class="variable">@prefix</span> <span class="attribute">ja</span>: 		&lt;<span class="attribute">http</span>:<span class="comment">//jena.hpl.hp.com/2005/11/Assembler#&gt; .</span></span><br><span class="line"></span><br><span class="line">[] <span class="attribute">rdf</span>:type <span class="attribute">fuseki</span>:Server ;</span><br><span class="line"> fuseki:services (</span><br><span class="line"> &lt;#service1&gt;</span><br><span class="line"> ) .</span><br><span class="line"></span><br><span class="line">## ---------------------------------------------------------------</span><br><span class="line">## Service with only SPARQL query on an inference model.</span><br><span class="line">## Inference model base data in TDB.</span><br><span class="line"></span><br><span class="line">&lt;#service1&gt; rdf:type fuseki:Service ;</span><br><span class="line">    fuseki:name         &quot;kg_movie&quot; ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:query;  fuseki:name &quot;sparql&quot;  ] ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:query;  fuseki:name &quot;query&quot;   ] ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:update; fuseki:name &quot;update&quot;  ] ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:upload; fuseki:name &quot;upload&quot;  ] ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:gsp_r;  fuseki:name &quot;get&quot;     ] ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:gsp_rw; fuseki:name &quot;data&quot;    ] ;</span><br><span class="line">    fuseki:dataset  &lt;#dataset&gt; .</span><br><span class="line"></span><br><span class="line">&lt;#dataset&gt; rdf:type tdb:DatasetTDB ;</span><br><span class="line">    ja:context [ ja:cxtName &quot;arq:queryTimeout&quot; ;  ja:cxtValue &quot;10000,30000&quot; ] ;</span><br><span class="line">    tdb:location &quot;../apache-jena/tdb&quot; .</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在内存，同步加载本体和三元组</li>
</ol>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">@prefix :       &lt;<span class="comment">#&gt; .</span></span><br><span class="line">@prefix fuseki: &lt;http:<span class="regexp">//</span>jena.apache.org/fuseki<span class="comment">#&gt; .</span></span><br><span class="line">@prefix rdf: 		&lt;http:<span class="regexp">//</span>www.w3.org<span class="regexp">/1999/</span><span class="number">02</span>/<span class="number">22</span>-rdf-syntax-ns<span class="comment">#&gt; .</span></span><br><span class="line">@prefix rdfs: 	&lt;http:<span class="regexp">//</span>www.w3.org<span class="regexp">/2000/</span><span class="number">01</span>/rdf-schema<span class="comment">#&gt; .</span></span><br><span class="line">@prefix tdb: 		&lt;http:<span class="regexp">//</span>jena.hpl.hp.com<span class="regexp">/2008/</span>tdb<span class="comment">#&gt; .</span></span><br><span class="line">@prefix ja: 		&lt;http:<span class="regexp">//</span>jena.hpl.hp.com<span class="regexp">/2005/</span><span class="number">11</span>/Assembler<span class="comment">#&gt; .</span></span><br><span class="line"></span><br><span class="line">[] rdf:type fuseki:Server ;</span><br><span class="line"> fuseki:services (</span><br><span class="line"> &lt;<span class="comment">#service1&gt;</span></span><br><span class="line"> ) .</span><br><span class="line"></span><br><span class="line"><span class="comment">## ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment">## Service with only SPARQL query on an inference model.</span></span><br><span class="line"><span class="comment">## Inference model base data in TDB.</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="comment">#service1&gt; rdf:type fuseki:Service ;</span></span><br><span class="line">    fuseki:name         <span class="string">&quot;kg_movie&quot;</span> ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:query;  fuseki:name <span class="string">&quot;sparql&quot;</span>  ] ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:query;  fuseki:name <span class="string">&quot;query&quot;</span>   ] ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:update; fuseki:name <span class="string">&quot;update&quot;</span>  ] ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:upload; fuseki:name <span class="string">&quot;upload&quot;</span>  ] ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:gsp_r;  fuseki:name <span class="string">&quot;get&quot;</span>     ] ;</span><br><span class="line">    fuseki:endpoint [ fuseki:operation fuseki:gsp_rw; fuseki:name <span class="string">&quot;data&quot;</span>    ] ;</span><br><span class="line">    fuseki:dataset  &lt;<span class="comment">#dataset&gt; .</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="comment">#dataset&gt; rdf:type ja:RDFDataset ;</span></span><br><span class="line">	ja:defaultGraph</span><br><span class="line">      [ a ja:MemoryModel ;</span><br><span class="line">        ja:content [ja:externalContent &lt;file:..<span class="regexp">/databases/</span>kg_movie_tultle.ttl&gt; ] ;</span><br><span class="line">        ja:content [ja:externalContent &lt;file:..<span class="regexp">/../</span>..<span class="regexp">/d2rq/</span>baidu_baike.nt&gt; ] ;</span><br><span class="line">      ] ;</span><br><span class="line">    .</span><br></pre></td></tr></table></figure>

<p>再次运行“fuseki-server.bat”，如果出现如下界面表示运行成功：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\my\apache-jena-fuseki&gt; ./fuseki-<span class="keyword">server</span></span><br><span class="line">[<span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">42</span>] <span class="keyword">Server</span>     <span class="keyword">INFO</span>  Apache Jena Fuseki <span class="number">3.12</span><span class="number">.0</span></span><br><span class="line">[<span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">42</span>] Config     <span class="keyword">INFO</span>  FUSEKI_HOME=C:\my\apache-jena-fuseki\.</span><br><span class="line">[<span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">42</span>] Config     <span class="keyword">INFO</span>  FUSEKI_BASE=C:\my\apache-jena-fuseki\run</span><br><span class="line">[<span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">42</span>] Config     <span class="keyword">INFO</span>  Shiro file: file://C:\my\apache-jena-fuseki\run\shiro.ini</span><br><span class="line">[<span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">42</span>] Config     <span class="keyword">INFO</span>  <span class="keyword">Configuration</span> file: C:\my\apache-jena-fuseki\run\config.ttl</span><br><span class="line">[<span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">42</span>] riot       WARN  [<span class="type">line</span>: <span class="number">5</span>, col: <span class="number">9</span> ] Bad IRI: &lt;C:\my\apache-jena-fuseki\run\config.ttl#&gt; Code: <span class="number">4</span>/UNWISE_CHARACTER <span class="keyword">in</span> <span class="type">PATH</span>: The <span class="type">character</span> matches <span class="keyword">no</span> grammar rules <span class="keyword">of</span> URIs/IRIs. These characters are permitted <span class="keyword">in</span> RDF URI <span class="keyword">References</span>, <span class="type">XML</span> <span class="keyword">system</span> identifiers, <span class="keyword">and</span> <span class="type">XML</span> <span class="keyword">Schema</span> anyURIs.</span><br><span class="line">[<span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">43</span>] Config     <span class="keyword">INFO</span>  <span class="keyword">Load</span> <span class="keyword">configuration</span>: file:///C:/my/apache-jena-fuseki/run/<span class="keyword">configuration</span>/fuseki_conf.ttl</span><br><span class="line">[<span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">43</span>] Config     <span class="keyword">INFO</span>  Register: /kg_movie</span><br><span class="line">[<span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">43</span>] <span class="keyword">Server</span>     <span class="keyword">INFO</span>  Started <span class="number">2019</span>/<span class="number">09</span>/<span class="number">26</span> <span class="number">10</span>:<span class="number">48</span>:<span class="number">43</span> CST <span class="keyword">on</span> port <span class="number">3030</span></span><br></pre></td></tr></table></figure>

<p><strong>需要注意的是，每次运行fuseki服务器后，会在TDB文件夹内生成一些以prefix*开头的文件，重新运行fuseki服务的话不删除它们可能会报错。</strong></p>
<p>测试查询,可以通过网页端和命令行方式进行SPQRQL查询，经过实践，发现丧失推理能力。</p>
<p>如：查询电影鹿鼎记的所有属性</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PREFIX : &lt;http:<span class="regexp">//</span>www.kgdemo.com<span class="comment">#&gt;</span></span><br><span class="line">PREFIX rdf: &lt;http:<span class="regexp">//</span>www.w3.org<span class="regexp">/1999/</span><span class="number">02</span>/<span class="number">22</span>-rdf-syntax-ns<span class="comment">#&gt;</span></span><br><span class="line">PREFIX rdfs: &lt;http:<span class="regexp">//</span>www.w3.org<span class="regexp">/2000/</span><span class="number">01</span>/rdf-schema<span class="comment">#&gt;</span></span><br><span class="line"></span><br><span class="line">SELECT * WHERE &#123;</span><br><span class="line">?x :movie_chName <span class="string">&#x27;鹿鼎记&#x27;</span>.</span><br><span class="line">?x ?p ?o.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回的结果：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">x	p	o</span><br><span class="line"><span class="number">1</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">rdfs:label</span><br><span class="line"><span class="string">&quot;movie #35&quot;</span></span><br><span class="line"><span class="number">2</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">rdf:type</span><br><span class="line">:Movie</span><br><span class="line"><span class="number">3</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_language</span><br><span class="line"><span class="string">&quot;粤语&quot;</span></span><br><span class="line"><span class="number">4</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_screenwriter</span><br><span class="line"><span class="string">&quot;王晶&quot;</span></span><br><span class="line"><span class="number">5</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_rekeaseTime</span><br><span class="line"><span class="string">&quot;1992年07月30日&quot;</span></span><br><span class="line"><span class="number">6</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_prodTime</span><br><span class="line"><span class="string">&quot;None&quot;</span></span><br><span class="line"><span class="number">7</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_id</span><br><span class="line"><span class="string">&quot;35&quot;</span>^^xsd:integer</span><br><span class="line"><span class="number">8</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_foreName</span><br><span class="line"><span class="string">&quot;Royal Tramp&quot;</span></span><br><span class="line"><span class="number">9</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_genre</span><br><span class="line"><span class="string">&quot;动作&quot;</span></span><br><span class="line"><span class="number">10</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_star</span><br><span class="line"><span class="string">&quot;周星驰，温兆伦，邱淑贞，张敏，吴孟达，徐锦江&quot;</span></span><br><span class="line"><span class="number">11</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_achiem</span><br><span class="line"><span class="string">&quot;None&quot;</span></span><br><span class="line"><span class="number">12</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_chName</span><br><span class="line"><span class="string">&quot;鹿鼎记&quot;</span></span><br><span class="line"><span class="number">13</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_director</span><br><span class="line"><span class="string">&quot;王晶&quot;</span></span><br><span class="line"><span class="number">14</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_prodCompany</span><br><span class="line"><span class="string">&quot;香港永盛电影公司&quot;</span></span><br><span class="line"><span class="number">15</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_bio</span><br><span class="line"><span class="string">&quot; 《鹿鼎记》是改编自金庸小说的一部武侠喜剧。影片由王晶执导，周星驰、吴孟达、温兆伦、林青霞 、 李嘉欣、袁洁莹、邱淑贞、陈德容等联合出演。影片讲述清朝初期，康熙皇帝年少，奸臣鳌拜从中控制政权。韦小宝有幸加入推翻清朝的民间组织“天地会”，被派到王宫当卧底，偷取藏有清朝秘密的四十二章经。韦小宝很快成为皇上的心腹，做了大官。他既要执行任务却又跟皇帝成为了好朋友，陷入了两难的状态。 [1]  该片于1992年7月30日上映。 &quot;</span></span><br><span class="line"><span class="number">16</span>	</span><br><span class="line">&lt;file:<span class="regexp">//</span><span class="regexp">/C:/my</span><span class="regexp">/d2rq/</span>baidu_baike.nt<span class="comment">#movie/35&gt;</span></span><br><span class="line">:movie_length</span><br><span class="line"><span class="string">&quot;106 分钟&quot;</span></span><br></pre></td></tr></table></figure>



<h1 id="三-基于REfO的简单知识问答"><a href="#三-基于REfO的简单知识问答" class="headerlink" title="三. 基于REfO的简单知识问答"></a>三. 基于REfO的简单知识问答</h1><p>项目<a href="https://github.com/Pelhans/Z_knowledge_graph">从零开始构建知识图谱项目链接</a>是python2编写的，在python3环境下运行需要修改代码</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#word_tagging</span>.py文件</span><br><span class="line">#修改前 word<span class="selector-class">.encode</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">bytes<span class="selector-class">.decode</span>(word<span class="selector-class">.encode</span>(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#rules</span>.py文件</span><br><span class="line">#原代码 w<span class="selector-class">.token</span><span class="selector-class">.encode</span>(<span class="string">&quot;utf-8&quot;</span>) </span><br><span class="line">w<span class="selector-class">.token</span></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#query</span>.py文件</span><br><span class="line">#原代码 <span class="built_in">raw_input</span>()</span><br><span class="line"><span class="selector-tag">input</span>()</span><br></pre></td></tr></table></figure>

<p>运行，提问示例结果：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">C:\my\Python\python<span class="selector-class">.exe</span> C:/d/mmm/pycharm/patternREfO/query<span class="selector-class">.py</span></span><br><span class="line">Building prefix dict from the default dictionary ...</span><br><span class="line">init...........</span><br><span class="line">Loading model from cache C:\Users\mmm\AppData\Local\Temp\jieba<span class="selector-class">.cache</span></span><br><span class="line">Loading model cost <span class="number">0.816</span> seconds.</span><br><span class="line">Prefix dict has been built succesfully.</span><br><span class="line">done </span><br><span class="line"></span><br><span class="line">Please <span class="selector-tag">input</span> your question: </span><br><span class="line">刘德华是哪个</span><br><span class="line">Result:   刘德华（Andy Lau），<span class="number">1961</span>年<span class="number">9</span>月<span class="number">27</span>日出生于中国香港，中国香港男演员、歌手、作词人、制片人。<span class="number">1981</span>年出演电影处女作《彩云曲》 <span class="selector-attr">[1]</span>  。<span class="number">1983</span>年主演的武侠剧《神雕侠侣》在香港获得<span class="number">62</span>点的收视纪录 <span class="selector-attr">[2-3]</span>  。<span class="number">1991</span>年创办天幕电影公司 <span class="selector-attr">[4]</span>  。<span class="number">1992</span>年，凭借传记片《五亿探长雷洛传》获得第<span class="number">11</span>届香港电影金像奖最佳男主角提名 <span class="selector-attr">[5]</span>  。<span class="number">1994</span>年担任剧情片《天与地》的制片人 <span class="selector-attr">[6]</span>  。<span class="number">2000</span>年凭借警匪片《暗战》获得第<span class="number">19</span>届香港电影金像奖最佳男主角奖 <span class="selector-attr">[7]</span>  。<span class="number">2004</span>年凭借警匪片《无间道<span class="number">3</span>：终极无间》获得第<span class="number">41</span>届台湾金马奖最佳男主角奖 <span class="selector-attr">[8]</span>  。<span class="number">2005</span>年获得香港UA院线颁发的全港最高累积票房香港男演员”奖 <span class="selector-attr">[9]</span>  。<span class="number">2006</span>年获得釜山国际电影节亚洲最有贡献电影人奖 <span class="selector-attr">[10]</span>  。<span class="number">2011</span>年主演剧情片《桃姐》，并凭借该片先后获得台湾金马奖最佳男主角奖、香港电影金像奖最佳男主角奖 <span class="selector-attr">[11]</span>  ；同年担任第<span class="number">49</span>届台湾电影金马奖评审团主席 <span class="selector-attr">[12]</span>  。<span class="number">2017</span>年主演警匪动作片《拆弹专家》 <span class="selector-attr">[13]</span>  。<span class="number">1985</span>年发行首张个人专辑《只知道此刻爱你》 <span class="selector-attr">[14]</span>  。<span class="number">1990</span>年凭借专辑《可不可以》在歌坛获得关注 <span class="selector-attr">[15]</span>  。<span class="number">1994</span>年获得十大劲歌金曲最受欢迎男歌星奖 <span class="selector-attr">[16]</span>  。<span class="number">1995</span>年在央视春晚上演唱歌曲《忘情水》 <span class="selector-attr">[17]</span>  。<span class="number">2000</span>年被《吉尼斯世界纪录大全》评为“获奖最多的香港男歌手” <span class="selector-attr">[18]</span>  。<span class="number">2004</span>年第六次获得十大劲歌金曲最受欢迎男歌星奖。<span class="number">2016</span>年参与填词的歌曲《原谅我》正式发行 <span class="selector-attr">[19]</span>  。<span class="number">1994</span>年创立刘德华慈善基金会 <span class="selector-attr">[20]</span>  。<span class="number">2000</span>年被评为世界十大杰出青年 <span class="selector-attr">[21]</span>  。<span class="number">2005</span>年发起亚洲新星导计划 <span class="selector-attr">[22]</span>  。<span class="number">2008</span>年被委任为香港非官守太平绅士 <span class="selector-attr">[23]</span>  。<span class="number">2016</span>年连任中国残疾人福利基金会副理事长。 <span class="selector-attr">[21]</span>   </span><br><span class="line">Please <span class="selector-tag">input</span> your question: </span><br><span class="line">刘德华出生地</span><br><span class="line">Result:  香港新界大埔镇泰亨村</span><br><span class="line">Please <span class="selector-tag">input</span> your question: </span><br><span class="line">七小福简介</span><br><span class="line">Result:   《七小福》（Painted Faces）是由罗启锐导演，洪金宝、郑佩佩、林正英、岑建勋、午马等领衔主演的喜剧电影。影片讲述京剧大师于占元当年创办的“中国戏剧研究学院”，名字虽然取得唬人，但要论规模在香港众多戏校中也只算得中等，而且校舍破败，条件简陋，所幸师傅并未误人子弟，教得认真。“七小福“戏班最终名扬天下的故事。 </span><br></pre></td></tr></table></figure>

<h1 id="四-基于ElasticSearch的简单语义搜索"><a href="#四-基于ElasticSearch的简单语义搜索" class="headerlink" title="四. 基于ElasticSearch的简单语义搜索"></a>四. 基于ElasticSearch的简单语义搜索</h1><p>ElasticSearch是一个基于<a href="https://baike.baidu.com/item/Lucene/6753302">Lucene</a>的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java语言开发的，并作为Apache许可条款下的开放源码发布，是一种流行的企业级搜索引擎。ElasticSearch用于<a href="https://baike.baidu.com/item/%E4%BA%91%E8%AE%A1%E7%AE%97/9969353">云计算</a>中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。根据DB-Engines的排名显示，Elasticsearch是最受欢迎的企业搜索引擎，其次是Apache Solr，也是基于Lucene。</p>
<h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p><a href="https://www.elastic.co/cn/downloads/elasticsearch">elasticsearch 官网</a>下载安装包，软件不需要安装，需要配置相应的Java环境。详细使用可阅读<a href="https://protegewiki.stanford.edu/wiki/Main_Page">官方教程</a>。</p>
<p>运行 <code>./bin/elasticsearch.bat</code>即可开启服务。</p>
<p>在开启服务后，您可以通过 <code>curl &#39;http://localhost:9200&#39;</code>来访问 elasticsearch。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;DESKTOP-3AFDEBF&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;elasticsearch&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;0HpHJxLAREq6SntFdfVSPQ&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;7.4.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_flavor&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;zip&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_hash&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;22e1767283e61a198cb4db791ea66e3f11ab9910&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_date&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2019-09-27T08:36:48.569419Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_snapshot&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lucene_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;8.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minimum_wire_compatibility_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;6.8.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minimum_index_compatibility_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tagline&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


<h2 id="2-修改代码"><a href="#2-修改代码" class="headerlink" title="2. 修改代码"></a>2. 修改代码</h2><p>项目<a href="https://github.com/Pelhans/Z_knowledge_graph">从零开始构建知识图谱项目链接</a>是python2编写的，在python3环境下运行需要修改代码</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#query</span>.py文件</span><br><span class="line">#原代码 <span class="built_in">raw_input</span>()</span><br><span class="line"><span class="selector-tag">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#get_json</span>.py文件</span><br><span class="line">#删除代码</span><br><span class="line">import sys</span><br><span class="line"><span class="function"><span class="title">reload</span><span class="params">(sys)</span></span></span><br><span class="line">sys<span class="selector-class">.setdefaultencoding</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#get_ac_attr</span>.py文件</span><br><span class="line">#ahocorasick要安装<span class="built_in">pyahocorasick</span>(pip install pyahocorasick)</span><br><span class="line">#原代码 cPickle</span><br><span class="line">pickle</span><br><span class="line">#原代码 <span class="built_in">open</span>(attr_mapping_file)</span><br><span class="line"><span class="function"><span class="title">open</span><span class="params">(attr_mapping_file,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;UTF-8&#x27;</span>)</span></span></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#get_total_val</span>.py文件</span><br><span class="line">#删除代码</span><br><span class="line">import sys</span><br><span class="line"><span class="function"><span class="title">reload</span><span class="params">(sys)</span></span></span><br><span class="line">sys<span class="selector-class">.setdefaultencoding</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">#原代码  <span class="built_in">open</span>(__package__ + <span class="string">&quot;/../data/&#123;&#125;.txt&quot;</span><span class="selector-class">.format</span>(cate), <span class="string">&quot;w+&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">open</span><span class="params">(<span class="string">&quot;../data/&#123;&#125;.txt&quot;</span>.format(cate)</span></span>, <span class="string">&quot;w+&quot;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="selector-id">#build_dict</span>.py文件</span><br><span class="line">#删除代码</span><br><span class="line">import sys</span><br><span class="line"><span class="function"><span class="title">reload</span><span class="params">(sys)</span></span></span><br><span class="line">sys<span class="selector-class">.setdefaultencoding</span>(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">#ahocorasick要安装<span class="built_in">pyahocorasick</span>(pip install pyahocorasick)</span><br><span class="line">#原代码 cPickle</span><br><span class="line">pickle</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#views</span>.py文件</span><br><span class="line">#原代码 cPickle</span><br><span class="line">pickle</span><br><span class="line">#原代码 from Queue import Queue</span><br><span class="line">from queue import Queue</span><br></pre></td></tr></table></figure>
<p><strong>可能出现的问题：</strong><br><a href="https://blog.csdn.net/weixin_40771521/article/details/89317180">python pyahocorasick包安装失败解决方法</a></p>
<h2 id="3-运行"><a href="#3-运行" class="headerlink" title="3. 运行"></a>3. 运行</h2><h3 id="1）数据库到JSON"><a href="#1）数据库到JSON" class="headerlink" title="1）数据库到JSON"></a>1）数据库到JSON</h3><p>运行get_json.py，生成actor.json和movie.json</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\my\Python\python.exe C:<span class="regexp">/d/mmm</span><span class="regexp">/pycharm/</span>elasticsearch<span class="regexp">/utils/g</span>et_json.py</span><br><span class="line">max_id:  <span class="number">13967</span></span><br><span class="line">max_id:  <span class="number">22219</span></span><br><span class="line">tuple index out of range</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="2）建立属性间映射"><a href="#2）建立属性间映射" class="headerlink" title="2）建立属性间映射"></a>2）建立属性间映射</h3><p>运行get_ac_attr.py，生成.&#x2F;data&#x2F;attr_ac.pkl</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\my\Python\python.exe C:<span class="regexp">/d/mmm</span><span class="regexp">/pycharm/</span>elasticsearch<span class="regexp">/utils/g</span>et_ac_attr.py</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="3）获取属性值和属性间的映射"><a href="#3）获取属性值和属性间的映射" class="headerlink" title="3）获取属性值和属性间的映射"></a>3）获取属性值和属性间的映射</h3><p>运行get_total_val.py，生成actor.txt和movie.txt</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\my\Python\python.exe C:<span class="regexp">/d/mmm</span><span class="regexp">/pycharm/</span>elasticsearch<span class="regexp">/utils/g</span>et_total_val.py</span><br><span class="line">max_id:  <span class="number">13967</span></span><br><span class="line">max_id:  <span class="number">22219</span></span><br><span class="line">tuple index out of range</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="4）在-elasticsearch-中新建-index-和-type"><a href="#4）在-elasticsearch-中新建-index-和-type" class="headerlink" title="4）在 elasticsearch 中新建 index 和 type"></a>4）在 elasticsearch 中新建 index 和 type</h3><p>可以用elasticsearch-head或CURL。</p>
<p>ealsticsearch只是后端提供各种api，那么怎么直观的使用它呢？elasticsearch-head将是一款专门针对于elasticsearch的客户端工具。elasticsearch-head配置包，下载地址：<a href="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head</a> 。安装可以参考文章<a href="https://www.cnblogs.com/hts-technology/p/8477258.html">windows下安装ElasticSearch的Head插件</a> 。</p>
<p>我们这里选择用CURL，去<a href="https://curl.haxx.se/download.html">curl官网</a>下载对应版本的包，解压后打开CMD切换到对应目录下运行CURL.exe文件，</p>
<p>如果把该CURL.exe文件复制到C:\Windows\System32目录下，则不需要切换目录，可以直接运行curl命令。</p>
<p>a. 用下列命令建立 index 和 type：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT <span class="string">&quot;localhost:9200/demo?pretty&quot;</span> -H <span class="string">&quot;Content-Type: application/json&quot;</span> -d<span class="string">&quot; &#123; <span class="subst">\&quot;</span>mappings<span class="subst">\&quot;</span>: &#123; <span class="subst">\&quot;</span>properties<span class="subst">\&quot;</span>: &#123; <span class="subst">\&quot;</span>subj<span class="subst">\&quot;</span>: &#123;<span class="subst">\&quot;</span>type<span class="subst">\&quot;</span>: <span class="subst">\&quot;</span>keyword<span class="subst">\&quot;</span>&#125;, <span class="subst">\&quot;</span>po<span class="subst">\&quot;</span>:&#123; <span class="subst">\&quot;</span>type<span class="subst">\&quot;</span>: <span class="subst">\&quot;</span>nested<span class="subst">\&quot;</span>, <span class="subst">\&quot;</span>properties<span class="subst">\&quot;</span>:&#123; <span class="subst">\&quot;</span>pred<span class="subst">\&quot;</span>:&#123;<span class="subst">\&quot;</span>type<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>keyword<span class="subst">\&quot;</span>&#125;, <span class="subst">\&quot;</span>obj<span class="subst">\&quot;</span>:&#123;<span class="subst">\&quot;</span>type<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>keyword<span class="subst">\&quot;</span>&#125; &#125; &#125; &#125; &#125; &#125; &quot;</span></span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\mmm<span class="operator">&gt;</span>curl <span class="operator">-</span>XPUT <span class="string">&quot;localhost:9200/demo?pretty&quot;</span> <span class="operator">-</span>H <span class="string">&quot;Content-Type: application/json&quot;</span> <span class="operator">-</span>d<span class="string">&quot; &#123; <span class="char escape_">\&quot;</span>mappings<span class="char escape_">\&quot;</span>: &#123; <span class="char escape_">\&quot;</span>properties<span class="char escape_">\&quot;</span>: &#123; <span class="char escape_">\&quot;</span>subj<span class="char escape_">\&quot;</span>: &#123;<span class="char escape_">\&quot;</span>type<span class="char escape_">\&quot;</span>: <span class="char escape_">\&quot;</span>keyword<span class="char escape_">\&quot;</span>&#125;, <span class="char escape_">\&quot;</span>po<span class="char escape_">\&quot;</span>:&#123; <span class="char escape_">\&quot;</span>type<span class="char escape_">\&quot;</span>: <span class="char escape_">\&quot;</span>nested<span class="char escape_">\&quot;</span>, <span class="char escape_">\&quot;</span>properties<span class="char escape_">\&quot;</span>:&#123; <span class="char escape_">\&quot;</span>pred<span class="char escape_">\&quot;</span>:&#123;<span class="char escape_">\&quot;</span>type<span class="char escape_">\&quot;</span>:<span class="char escape_">\&quot;</span>keyword<span class="char escape_">\&quot;</span>&#125;, <span class="char escape_">\&quot;</span>obj<span class="char escape_">\&quot;</span>:&#123;<span class="char escape_">\&quot;</span>type<span class="char escape_">\&quot;</span>:<span class="char escape_">\&quot;</span>keyword<span class="char escape_">\&quot;</span>&#125; &#125; &#125; &#125; &#125; &#125; &quot;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;acknowledged&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;shards_acknowledged&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;index&quot;</span> : <span class="string">&quot;demo&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：笔者使用的Elasticsearch&gt;7.0，Elasticsearch 7.0及以后版本移除映射类型</strong></p>
<p>b. 可用下列命令查询是否添加成功</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">curl</span> -XGET localhost:<span class="number">9200</span>/_search?pretty</span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\mmm&gt;curl -XGET localhost:<span class="number">9200</span>/_search?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span> : 3,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="type">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span> : 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span> : &quot;<span class="type">eq</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;</span>max_score<span class="string">&quot; : null,</span></span><br><span class="line"><span class="string">    &quot;</span>hits<span class="string">&quot; : [ ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>c. 如果创建错了，可用下列命令删除索引</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">curl</span> -XDELETE localhost:<span class="number">9200</span>/demo</span><br></pre></td></tr></table></figure>

<h3 id="5）数据导入"><a href="#5）数据导入" class="headerlink" title="5）数据导入"></a>5）数据导入</h3><p>Elastic search 7.0及以后版本移除映射类型，修改insert.py</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#原代码 <span class="built_in">begin_insert_job</span>(<span class="string">&quot;demo&quot;</span>, <span class="string">&quot;baidu_baike&quot;</span>, <span class="string">&quot;../data/baidu_baike.json&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">begin_insert_job</span><span class="params">(<span class="string">&quot;demo&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;../data/baidu_baike.json&quot;</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>为了测试简单，把actor.json文件改名为..&#x2F;data&#x2F;baidu_baike.json。</p>
<p>运行 insert.py</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">C:\my\Python\python.exe C:<span class="regexp">/d/mmm</span><span class="regexp">/pycharm/</span>elasticsearch<span class="regexp">/utils/i</span>nsert.py</span><br><span class="line"><span class="number">1000</span></span><br><span class="line"><span class="number">2000</span></span><br><span class="line"><span class="number">3000</span></span><br><span class="line"><span class="number">4000</span></span><br><span class="line"><span class="number">5000</span></span><br><span class="line"><span class="number">6000</span></span><br><span class="line"><span class="number">7000</span></span><br><span class="line"><span class="number">8000</span></span><br><span class="line"><span class="number">9000</span></span><br><span class="line"><span class="number">10000</span></span><br><span class="line"><span class="number">11000</span></span><br><span class="line"><span class="number">12000</span></span><br><span class="line"><span class="number">13000</span></span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="6）检索知识库"><a href="#6）检索知识库" class="headerlink" title="6）检索知识库"></a>6）检索知识库</h3><p>DOS默认的是（GB2312)，让cmd dos 支持utf-8方法<code>CHCP 65001</code>，关闭cmd，CHCP又还原成936。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">C</span>:\Users\mmm&gt;CHCP <span class="number">65001</span> </span><br><span class="line"><span class="attribute">Active</span> code page: <span class="number">65001</span></span><br></pre></td></tr></table></figure>

<p>curl方式检索知识库，可用下列命令，如检索：周星驰</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="operator">-</span>XGET <span class="string">&quot;localhost:9200/demo/_doc/_search?&amp;pretty&quot;</span> <span class="operator">-</span>H <span class="string">&quot;Content-Type:application/json&quot;</span> <span class="operator">-</span>d<span class="string">&quot; &#123; <span class="char escape_">\&quot;</span>query<span class="char escape_">\&quot;</span>:&#123; <span class="char escape_">\&quot;</span>bool<span class="char escape_">\&quot;</span>:&#123; <span class="char escape_">\&quot;</span>filter<span class="char escape_">\&quot;</span>:&#123; <span class="char escape_">\&quot;</span>term<span class="char escape_">\&quot;</span>:&#123;<span class="char escape_">\&quot;</span>subj<span class="char escape_">\&quot;</span>:<span class="char escape_">\&quot;</span><span class="char escape_">\u</span>5468<span class="char escape_">\u</span>661f<span class="char escape_">\u</span>9a70<span class="char escape_">\&quot;</span>&#125; &#125; &#125; &#125; &#125;</span></span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="operator">-</span>XGET <span class="string">&quot;localhost:9200/demo/_doc/_search?&amp;pretty&quot;</span> <span class="operator">-</span>H <span class="string">&quot;Content-Type:application/json&quot;</span> <span class="operator">-</span>d<span class="string">&quot; &#123; <span class="char escape_">\&quot;</span>query<span class="char escape_">\&quot;</span>:&#123; <span class="char escape_">\&quot;</span>bool<span class="char escape_">\&quot;</span>:&#123; <span class="char escape_">\&quot;</span>filter<span class="char escape_">\&quot;</span>:&#123; <span class="char escape_">\&quot;</span>term<span class="char escape_">\&quot;</span>:&#123;<span class="char escape_">\&quot;</span>subj<span class="char escape_">\&quot;</span>:<span class="char escape_">\&quot;</span><span class="char escape_">\u</span>5468<span class="char escape_">\u</span>661f<span class="char escape_">\u</span>9a70<span class="char escape_">\&quot;</span>&#125; &#125; &#125; &#125; &#125;&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span> : <span class="number">2</span>,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span> : <span class="number">0.0</span>,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;demo&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_score&quot;</span> : <span class="number">0.0</span>,</span><br><span class="line">        <span class="string">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;subj&quot;</span> : <span class="string">&quot;周星驰&quot;</span>,</span><br><span class="line">          <span class="string">&quot;po&quot;</span> : [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;pred&quot;</span> : <span class="string">&quot;actor_bio&quot;</span>,</span><br><span class="line">              <span class="string">&quot;obj&quot;</span> : <span class="string">&quot; 周星驰，1962年6月22日生于香港，祖籍浙江宁波，中国香港演员、导演、编剧、制作人、商人，毕业于无线电视艺员训练班。1980年成为丽的电视台的特约演员，从而进入演艺圈。1981年出演个人首部电视剧《IQ成熟时》。1988年将演艺事业的重心转向大银幕，并于同年出演电 影处女作《捕风汉子》。1990年凭借喜剧片《一本漫画闯天涯》确立其无厘头的表演风格 [1]  ；同年，因其主演的喜剧动作片《赌圣》打破香港地区票 房纪录而获得关注 [2]  。1991年主演喜剧片《逃学威龙》，并再次打破香港地区票房纪录 [3]  。1995年凭借喜剧爱情片《大话西游》奠定其在华语影 坛的地位。1999年自导自演的喜剧片《喜剧之王》获得香港电影年度票房冠军 [4]  。2002年凭借喜剧片《少林足球》获得第21届香港电影金像奖最佳男 主角奖以及最佳导演奖 [5]  。2003年成为美国《时代周刊》封面人物 [6]  。2005年凭借喜剧动作片《功夫》获得第42届台湾电影金马奖最佳导演奖 [7]  。2008年自导自演的科幻喜剧片《长江7号》获得香港电影年度票房冠军 [8]  。2013年执导古装喜剧片《西游·降魔篇》，该片以2.18亿美元的票房 成绩打破华语电影在全球的票房纪录 [9-10]  。2016年担任科幻喜剧片《美人鱼》的导演、编剧、制作人，该片以超过33亿元的票房创下中国内地电影票房纪录 [11-14]  。2017年1月28日，担任监制、编剧的古装喜剧片《西游伏妖篇》上映 [15]  。2018年执导《美人鱼2》 [16]  。演艺事业外，周星驰 还涉足商界。1989年成立星炜有限公司 [17]  。1996年成立星辉公司 [18]  。2010年出任比高集团有限公司执行董事 [19]  。 &quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;pred&quot;</span> : <span class="string">&quot;actor_foreName&quot;</span>,</span><br><span class="line">              <span class="string">&quot;obj&quot;</span> : <span class="string">&quot;Stephen Chow&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;pred&quot;</span> : <span class="string">&quot;actor_nationality&quot;</span>,</span><br><span class="line">              <span class="string">&quot;obj&quot;</span> : <span class="string">&quot;中国&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;pred&quot;</span> : <span class="string">&quot;actor_constellation&quot;</span>,</span><br><span class="line">              <span class="string">&quot;obj&quot;</span> : <span class="string">&quot;巨蟹座&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;pred&quot;</span> : <span class="string">&quot;actor_birthPlace&quot;</span>,</span><br><span class="line">              <span class="string">&quot;obj&quot;</span> : <span class="string">&quot;香港&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;pred&quot;</span> : <span class="string">&quot;actor_birthDay&quot;</span>,</span><br><span class="line">              <span class="string">&quot;obj&quot;</span> : <span class="string">&quot;1962年6月22日&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;pred&quot;</span> : <span class="string">&quot;actor_repWorks&quot;</span>,</span><br><span class="line">              <span class="string">&quot;obj&quot;</span> : <span class="string">&quot;赌圣、逃学威龙系列、唐伯虎点秋香、大话西游系列、喜剧之王、少林足球、功夫、长江七号&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;pred&quot;</span> : <span class="string">&quot;actor_achiem&quot;</span>,</span><br><span class="line">              <span class="string">&quot;obj&quot;</span> : <span class="string">&quot;获得两届香港电影金像奖最佳影片<span class="char escape_">\n</span>第21届香港电影金像奖最佳导演<span class="char escape_">\n</span>第21届香港电影金像奖最佳男主角<span class="char escape_">\n</span>第42届台湾电影金马奖最佳导演<span class="char escape_">\n</span>第42届台湾电影金马奖最佳剧情片<span class="char escape_">\n</span><span class="char escape_">\n</span>第25届台湾电影金马奖最佳男配角<span class="char escape_">\n</span>第28届大众电影百花奖优秀故事片<span class="char escape_">\n</span>第23届香港电影评论学会大 奖最佳导演<span class="char escape_">\n</span>第8届香港电影评论学会大奖最佳电影<span class="char escape_">\n</span>第2届香港电影评论学会大奖最佳男主角<span class="char escape_">\n</span>第37届亚太电影节最佳男主角<span class="char escape_">\n</span>第13届亚洲电影博览会最 佳导演<span class="char escape_">\n</span>获得两届香港电影金紫荆奖最佳影片<span class="char escape_">\n</span>第01届香港电影金紫荆奖最佳男主角<span class="char escape_">\n</span>国际杰人会港澳杰人之星等<span class="char escape_">\n</span>收起&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;pred&quot;</span> : <span class="string">&quot;actor_brokerage&quot;</span>,</span><br><span class="line">              <span class="string">&quot;obj&quot;</span> : <span class="string">&quot;星辉公司、比高集团&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="五-Deepdive抽取演员-电影间关系"><a href="#五-Deepdive抽取演员-电影间关系" class="headerlink" title="五. Deepdive抽取演员-电影间关系"></a>五. Deepdive抽取演员-电影间关系</h1><p>deepdive是由斯坦福大学InfoLab实验室开发的一个开源知识抽取系统。它通过弱监督学习，从非结构化的文本中抽取结构化的关系数据 。<a href="https://pan.baidu.com/s/1slLpYVz">本项目CNDeepdive</a>修改了自然语言处理的model包，使它支持中文，并提供中文tutorial。 DeepDive项目处于维护模式，并且不再处于主动开发状态。用户社区保持活跃，但是原始项目成员不能再承诺令人兴奋的新功能&#x2F;改进或响应请求。有关最新研究，请参阅<a href="https://hazyresearch.github.io/snorkel/">Snorkel项目</a>或<a href="https://ds3lab.org/~czhang/">Ce Zhang的项目</a>。 </p>
<p>DeepDive可在macOS，Linux和Docker容器中运行，install.sh脚本文件可以检测当前的安装系统环境，并可以一键式完成安装，安装可以参考文档<a href="https://github.com/theDoctor2013/DeepDive-tutorial/blob/master/Deepdive_new.md">Deepdive 实战-从下载到跑路</a>。</p>
<p>**deepdive在 Ubuntu 17.04下的支持并不好，虽然作者修改安装代码最终也装上了，但是不建议新手来处理。所以推荐Ubuntu 16.04的版本。 **<a href="http://old-releases.ubuntu.com/releases/xenial/">Ubuntu 16.04下载地址</a>，安装Ubuntu主机可参考文章<a href="100590.html">VirtualBox虚拟机安装Ubuntu</a>。</p>
<h2 id="1-安装JDK"><a href="#1-安装JDK" class="headerlink" title="1. 安装JDK"></a>1. 安装JDK</h2><ol>
<li>设置下载目录</li>
</ol>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@ubuntu</span>-mmm CNdeepdive]<span class="meta"># cd /usr/local/</span></span><br><span class="line">[root<span class="symbol">@ubuntu</span>-mmm <span class="keyword">local</span>]<span class="meta"># mkdir jdk/</span></span><br><span class="line">[root<span class="symbol">@ubuntu</span>-mmm <span class="keyword">local</span>]<span class="meta"># cd jdk/</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>下载JDK</li>
</ol>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu-mmm jdk]# wget https://download.oracle.com/otn/java/jdk/<span class="number">8</span>u221-b11/<span class="number">230d</span>eb18db3e4014bb8e3e<span class="number">8324f81b43</span>/jdk-<span class="number">8</span>u221-linux-x64.tar.gz?AuthParam=<span class="number">1570778301</span>_521350e291b71079469aa571d925a2ec</span><br><span class="line">--<span class="number">2019-10-11</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">37</span>--  https://download.oracle.com/otn/java/jdk/<span class="number">8</span>u221-b11/<span class="number">230d</span>eb18db3e4014bb8e3e<span class="number">8324f81b43</span>/jdk-<span class="number">8</span>u221-linux-x64.tar.gz?AuthParam=<span class="number">1570778301</span>_521350e291b71079469aa571d925a2ec</span><br><span class="line">正在解析主机 download.oracle.com (download.oracle.com)... <span class="number">23.195.255.150</span></span><br><span class="line">正在连接 download.oracle.com (download.oracle.com)|<span class="number">23.195.255.150</span>|:<span class="number">443</span>... 已连接。</span><br><span class="line">已发出 HTTP 请求，正在等待回应... <span class="number">200</span> OK</span><br><span class="line">长度：<span class="number">195094741</span> (<span class="number">186</span>M) [application/x-gzip]</span><br><span class="line">正在保存至: “jdk-<span class="number">8</span>u221-linux-x64.tar.gz?AuthParam=<span class="number">1570778301</span>_521350e291b71079469aa571d925a2ec”</span><br><span class="line"></span><br><span class="line">r.gz?AuthParam=<span class="number">1570778301</span>_521350e<span class="number">291b7107</span>   <span class="number">5</span>%[===&gt;  </span><br></pre></td></tr></table></figure>

<ol start="3">
<li>解压</li>
</ol>
<p>使用tar -zxvf 文件名进行解压。</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@ubuntu</span>-mmm jdk]<span class="meta"># tar -zxvf jdk-8u221-linux-x64.tar.gz</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>配置环境变量</li>
</ol>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@ubuntu</span>-mmm jdk]<span class="meta"># vi /etc/profile</span></span><br></pre></td></tr></table></figure>

<p>将如下配置添加至文件中，然后保存退出。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#java</span></span><br><span class="line"><span class="built_in">export</span> <span class="attribute">JAVA_HOME</span>=/usr/local/jdk/jdk1.8.0_221</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">PATH</span>=<span class="variable">$JAVA_HOME</span>/bin:$PATH</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">CLASSPATH</span>=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib</span><br></pre></td></tr></table></figure>
<p>执行命令，使文件修改后立即生效</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@ubuntu</span>-mmm jdk]<span class="meta"># source /etc/profile</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>验证</li>
</ol>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu-mmm <span class="keyword">jdk]# </span><span class="keyword">java </span>-version</span><br><span class="line"></span><br><span class="line"><span class="keyword">java </span>version <span class="string">&quot;1.8.0_221&quot;</span></span><br><span class="line"><span class="keyword">Java(TM) </span>SE Runtime Environment (<span class="keyword">build </span><span class="number">1</span>.<span class="number">8</span>.<span class="number">0</span>_221-<span class="keyword">b11)</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">Java </span>HotSpot(TM) <span class="number">64</span>-<span class="keyword">Bit </span>Server VM (<span class="keyword">build </span><span class="number">25</span>.<span class="number">221</span>-<span class="keyword">b11, </span>mixed mode)</span><br></pre></td></tr></table></figure>

<h2 id="2-安装Deepdive"><a href="#2-安装Deepdive" class="headerlink" title="2. 安装Deepdive"></a>2. 安装Deepdive</h2><p>修改install.sh，否则出现报错，无法安装</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 修改前 tar xzvf <span class="string">&quot;<span class="subst">$tarball</span>&quot;</span> -C <span class="string">&quot;<span class="subst">$PREFIX</span>&quot;</span></span><br><span class="line">tar zvf <span class="string">&quot;<span class="subst">$tarball</span>&quot;</span> -C <span class="string">&quot;<span class="subst">$PREFIX</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p>运行install.sh 选择【1 】安装deepdive，选择【6】 安装postgresql。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu-mmm CNdeepdive]# <span class="built_in">cd</span> /usr/local/CNdeepdive</span><br><span class="line">[root@ubuntu-mmm CNdeepdive]# bash install.sh</span><br><span class="line"><span class="comment">#运行install.sh 分别选择【1 】安装deepdive，选择【6】 安装postgresql。</span></span><br><span class="line">正在处理用于 dbus (1.10.6-1ubuntu3.3) 的触发器 ...</span><br><span class="line">正在处理用于 ca-certificates (20170717~16.04.1) 的触发器 ...</span><br><span class="line">Updating certificates <span class="keyword">in</span> /etc/ssl/certs...</span><br><span class="line">0 added, 0 removed; <span class="keyword">done</span>.</span><br><span class="line">Running hooks <span class="keyword">in</span> /etc/ca-certificates/update.d...</span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span>.</span><br><span class="line"><span class="keyword">done</span>.</span><br><span class="line">+ <span class="built_in">sudo</span> localedef -i en_US -f UTF-8 en_US.UTF-8</span><br><span class="line"><span class="comment">## Finished installation for _deepdive_runtime_deps</span></span><br><span class="line"><span class="comment">## Finished installation for deepdive</span></span><br><span class="line">......</span><br><span class="line">+ <span class="built_in">trap</span> <span class="string">&#x27;rm -f /tmp/pg_hba.conf.ixUUNdF&#x27;</span> EXIT</span><br><span class="line">+ <span class="built_in">echo</span> <span class="string">&#x27;host	all	all	127.0.0.1/32	trust&#x27;</span></span><br><span class="line">+ <span class="built_in">echo</span> <span class="string">&#x27;host	all	all	::1/128	trust&#x27;</span></span><br><span class="line">+ <span class="built_in">sudo</span> <span class="built_in">cat</span> /etc/postgresql/9.5/main/pg_hba.conf</span><br><span class="line">+ <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/postgresql/9.5/main/pg_hba.conf</span><br><span class="line">+ <span class="built_in">sudo</span> service postgresql restart</span><br><span class="line">++ <span class="built_in">rm</span> -f /tmp/pg_hba.conf.ixUUNdF</span><br><span class="line"><span class="comment">## Finished installation for postgres</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>配置环境变量，deepdive的可执⾏⽂件⼀般安装在<del>&#x2F;local&#x2F;bin⽂件夹下。 在</del>&#x2F;.bashrc 文件的末尾添加下面的内容： </p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@ubuntu</span>-mmm CNdeepdive]<span class="comment"># vi ~/.bashrc</span></span><br><span class="line"><span class="comment">#添加如下内容</span></span><br><span class="line"><span class="comment">#除了root,其他在/home/(username)/local/bin其中的(username)要替换成你当前登录的用户名</span></span><br><span class="line"><span class="keyword">export</span> PATH=<span class="string">&quot;/root/local/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#来使我们的修改生效。</span></span><br><span class="line">[root<span class="meta">@ubuntu</span>-mmm CNdeepdive]<span class="comment"># source ~/.bashrc</span></span><br></pre></td></tr></table></figure>

<p> 然后执行下面的命令，安装自然语言处理的部分 。</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive<span class="meta"># bash nlp_setup.sh</span></span><br><span class="line"></span><br><span class="line">Install Dependency.</span><br><span class="line">Denpendency Already Installed.</span><br></pre></td></tr></table></figure>

<p> 好的，到这里Deepdive就已经安装完成了 。</p>
<p> 打开终端执行<code>deepdive</code>我们可以看到Deepdive的版本信息和命令参数的Help。 </p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root<span class="meta">@ubuntu</span>-<span class="symbol">mmm</span><span class="punctuation">:</span>/usr/local/CNdeepdive<span class="comment"># deepdive</span></span><br><span class="line"><span class="comment"># DeepDive (v0.8.0-79-g28a58de)</span></span><br><span class="line"><span class="comment"># Usage: deepdive COMMAND [ARG]...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To enable bash completion for deepdive commands, run:</span></span><br><span class="line">source <span class="variable">$</span>(deepdive whereis installed etc/deepdive_bash_completion.sh<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">No COMMAND given</span><br><span class="line"></span><br><span class="line"><span class="comment"># Available COMMANDs are:</span></span><br><span class="line">deepdive  check    <span class="comment">#	Checks errors in compiled DeepDive app</span></span><br><span class="line">deepdive  compile  <span class="comment">#	Compiles DeepDive source code into executables under run/</span></span><br><span class="line">deepdive  compute  <span class="comment">#	Runs a UDF using a computer against the database</span></span><br><span class="line">deepdive  create   <span class="comment">#	Creates a table/view in the database</span></span><br><span class="line">deepdive  db       <span class="comment">#	Exposes lower level database operations provided by the driver</span></span><br><span class="line">deepdive  do       <span class="comment">#	Runs necessary processes to get something done</span></span><br><span class="line">deepdive  done     <span class="comment">#	Checks whether given targets are all done</span></span><br><span class="line">deepdive  env      <span class="comment">#	Runs commands inside DeepDive&#x27;s environment</span></span><br><span class="line">deepdive  help     <span class="comment">#	Shows help</span></span><br><span class="line">deepdive  initdb   <span class="comment">#	(DEPRECATED) Initializes the underlying database for the DeepDive application</span></span><br><span class="line">deepdive  load     <span class="comment">#	Loads a given relation&#x27;s data</span></span><br><span class="line">deepdive  mark     <span class="comment">#	Marks state of something to do</span></span><br><span class="line">deepdive  model    <span class="comment">#	Supports working with the statistical inference model</span></span><br><span class="line">deepdive  plan     <span class="comment">#	Shows execution plan for given targets</span></span><br><span class="line">deepdive  <span class="keyword">query</span>    <span class="comment">#	Runs a DDlog query against the database for the DeepDive application</span></span><br><span class="line">deepdive  redo     <span class="comment">#	Runs processes after marking them as &#x27;todo&#x27;</span></span><br><span class="line">deepdive  run      <span class="comment">#	Runs the current DeepDive app end-to-end</span></span><br><span class="line">deepdive  sql      <span class="comment">#	Runs a SQL query against the database for the DeepDive application</span></span><br><span class="line">deepdive  unload   <span class="comment">#	Unloads a given relation&#x27;s data</span></span><br><span class="line">deepdive  version  <span class="comment">#	show deepdive&#x27;s version and build information</span></span><br><span class="line">deepdive  whereis  <span class="comment">#	Finds absolute paths to files in the app or DeepDive installation</span></span><br></pre></td></tr></table></figure>
<h2 id="3-建立postgresql的数据库movie"><a href="#3-建立postgresql的数据库movie" class="headerlink" title="3. 建立postgresql的数据库movie"></a>3. 建立postgresql的数据库movie</h2><p><a href="https://www.navicat.com.cn/download/navicat-premium">Navicat Premium</a>，是一套数据库开发工具，让你从单一应用程序中同时连接 MySQL、MariaDB、MongoDB、SQL Server、Oracle、PostgreSQL 和 SQLite 数据库。Navicat系列破解工具链接：<a href="https://pan.baidu.com/s/1KmH2aaESpjozQaxr2C7D2A">https://pan.baidu.com/s/1KmH2aaESpjozQaxr2C7D2A</a></p>
<p>可以使用它来管理PostgreSQL数据库，Navicat连接PostgreSQL，PostgreSQL需要进行如下配置：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. 通过<span class="keyword">find</span> / -name  postgresql.<span class="keyword">conf</span> 和 <span class="keyword">find</span> / -name pg_hba.<span class="keyword">conf</span> 找到这两个文件</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. 设置外网访问：</span><br><span class="line"></span><br><span class="line">     <span class="number">1</span>）修改配置文件 postgresql.<span class="keyword">conf</span></span><br><span class="line">           listen_addresses = <span class="string">&#x27;*&#x27;</span></span><br><span class="line">     <span class="number">2</span>）修改pg_hba.<span class="keyword">conf</span>       在原来的host下面新加一行</span><br><span class="line">           # IPv4 local connections:</span><br><span class="line">           host    <span class="keyword">all</span>             <span class="keyword">all</span>             <span class="number">127.0</span>.<span class="number">0.1</span>/<span class="number">32</span>            trust</span><br><span class="line">           host    <span class="keyword">all</span>             <span class="keyword">all</span>             <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>               password</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. 重新启动服务：service postgresql restart</span><br></pre></td></tr></table></figure>

<p><strong>在这里我们不使用navicat，可以不安装。</strong></p>
<p>运行 <code>sudo -u postgres createdb</code> 建立数据库movie</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:CNdeepdive<span class="meta"># sudo -u postgres createdb movie</span></span><br></pre></td></tr></table></figure>

<p>如果要删除数据，可以使用下面命令</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:CNdeepdive<span class="meta"># sudo -u postgres dropdb movie</span></span><br></pre></td></tr></table></figure>
<p>验证数据库是否创建成功，首先运行sudo -i -u postgres 进入到postgresql账户</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive<span class="meta"># sudo -i -u postgres</span></span><br></pre></td></tr></table></figure>
<p> 输入psql进入到postgresql命令界面</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">postgres</span>@ubuntu-mmm:~$ psql</span><br><span class="line"><span class="attribute">psql</span> (<span class="number">9</span>.<span class="number">5</span>.<span class="number">19</span>)</span><br><span class="line"><span class="attribute">Type</span> <span class="string">&quot;help&quot;</span> for help.</span><br><span class="line"></span><br><span class="line"><span class="attribute">postgres</span>=#</span><br></pre></td></tr></table></figure>
<p> 修改PostgreSQL登录密码：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">postgres=# <span class="keyword">ALTER</span> <span class="keyword">USER</span> postgres <span class="keyword">WITH</span> <span class="keyword">PASSWORD</span> <span class="string">&#x27;postgres&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">ROLE</span></span><br></pre></td></tr></table></figure>

<p>查看数据库列表</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># \l</span></span><br><span class="line">                                  List of databases</span><br><span class="line">   Name    |<span class="string">  Owner   </span>|<span class="string"> Encoding </span>|<span class="string">   Collate   </span>|<span class="string">    Ctype    </span>|<span class="string">   Access privileges   </span></span><br><span class="line"><span class="string">-----------+----------+----------+-------------+-------------+-----------------------</span></span><br><span class="line"><span class="string"> movie     </span>|<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> </span></span><br><span class="line"><span class="string"> postgres  </span>|<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> </span></span><br><span class="line"><span class="string"> template0 </span>|<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> =c/postgres          +</span></span><br><span class="line"><span class="string">           </span>|<span class="string">          </span>|<span class="string">          </span>|<span class="string">             </span>|<span class="string">             </span>|<span class="string"> postgres=CTc/postgres</span></span><br><span class="line"><span class="string"> template1 </span>|<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> =c/postgres          +</span></span><br><span class="line"><span class="string">           </span>|<span class="string">          </span>|<span class="string">          </span>|<span class="string">             </span>|<span class="string">             </span>|<span class="string"> postgres=CTc/postgres</span></span><br><span class="line"><span class="string">(4 rows)</span></span><br></pre></td></tr></table></figure>

<p>输入\q退出psql。 </p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postgres<span class="punctuation">-</span><span class="meta"># \q</span></span><br></pre></td></tr></table></figure>
<p>运行’’’su yourusername’’’ 回到自己的程序目录。 </p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postgres<span class="variable">@ubuntu</span>-<span class="symbol">mmm:</span>~<span class="variable">$ </span>su root</span><br></pre></td></tr></table></figure>
<h2 id="4-项目框架搭建"><a href="#4-项目框架搭建" class="headerlink" title="4. 项目框架搭建"></a>4. 项目框架搭建</h2><p>这部分的数据和代码以及程序都在前面我们解压后的<em>CNdeepdive&#x2F;transaction</em>中，你可以把这个目录复制到你喜欢的地方（比如<em>~&#x2F;Projects&#x2F;transaction</em> 这个位置），然后再新建一个目录，可以叫做<em>transaction2</em> 我们后面的所有工作都是在这个<strong>transaction2</strong>目录中进行的，后面简称它为项目目录。 </p>
<p>建⽴⾃⼰的项⽬⽂件夹transaction2，之前已在postgresql中为项⽬建⽴数据库movie，现要在项⽬⽂件夹下建⽴数据库配置⽂件: </p>
<p>命令说明</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;postgresql://<span class="variable">$USER</span>@<span class="variable">$HOSTNAME</span>:5432/db_name&quot;</span> &gt;db.url</span><br><span class="line"><span class="comment">#$符号是shell中用来表示变量的，所以这个蓝色部分大概就是 用户名@主机名：。。。。</span></span><br><span class="line"><span class="comment">#db_name 我们这个项目的数据库名，也可以自定义。</span></span><br></pre></td></tr></table></figure>
<p>创建命令</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root<span class="meta">@ubuntu</span><span class="operator">-</span>mmm:<span class="regexp">/var/</span>lib<span class="regexp">/postgresql# cd /</span>usr<span class="regexp">/local/</span><span class="type">CNdeepdive</span></span><br><span class="line">root<span class="meta">@ubuntu</span><span class="operator">-</span>mmm:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive# mkdir transaction2/</span></span><br><span class="line">root<span class="meta">@ubuntu</span><span class="operator">-</span>mmm:<span class="regexp">/usr/</span>local<span class="operator">/</span><span class="type">CNdeepdive</span># cd transaction2</span><br><span class="line">root<span class="meta">@ubuntu</span><span class="operator">-</span>mmm:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2# echo <span class="string">&quot;postgresql://localhost:5432/movie&quot;</span> <span class="operator">&gt;</span>db.url</span><br></pre></td></tr></table></figure>

<p>在deepdive内建立输入数据文件夹 input，用户定义函数文件夹udf，用户配置文件app.ddlog，模型配置文件deepdive.conf。</p>
<p>为了调用 stanford_nlp 进行文本处理，将下载的CNdeepdive 文件夹中的transaction&#x2F;udf&#x2F;bazzar复制到自己的 udf 文件夹下，并在udf&#x2F;bazzar&#x2F;parser&#x2F; 目录下运行 sbt&#x2F;sbt stage 进行编译。编译完成后会在 target 中生成可执行文件。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2<span class="regexp">/udf/</span>bazaar<span class="regexp">/parser# chmod 777 sbt/</span>sbt</span><br><span class="line">#获得执行权限</span><br><span class="line">root@ubuntu-mmm:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2<span class="regexp">/udf/</span>bazaar<span class="regexp">/parser# sbt/</span>sbt stage</span><br><span class="line"></span><br><span class="line">Getting org.scala-sbt sbt <span class="number">0.13</span>.<span class="number">8</span> ...</span><br><span class="line">:: retrieving :: org.scala-sbt#boot-app</span><br><span class="line">	confs: [<span class="keyword">default</span>]</span><br><span class="line">	<span class="number">52</span> <span class="keyword">artifacts</span> copied, <span class="number">0</span> already retrieved (<span class="number">17674</span>kB/<span class="number">165</span>ms)</span><br><span class="line">Getting Scala <span class="number">2.10</span>.<span class="number">4</span> (<span class="keyword">for</span> sbt)...</span><br><span class="line">:: retrieving :: org.scala-sbt#boot-scala</span><br><span class="line">	confs: [<span class="keyword">default</span>]</span><br><span class="line">	<span class="number">5</span> <span class="keyword">artifacts</span> copied, <span class="number">0</span> already retrieved (<span class="number">24459</span>kB/<span class="number">108</span>ms)</span><br><span class="line">[info] Loading <span class="keyword">project</span> definition <span class="keyword">from</span> <span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2<span class="regexp">/udf/</span>bazaar<span class="regexp">/parser/</span><span class="keyword">project</span>/<span class="keyword">project</span></span><br><span class="line">[info] Updating &#123;<span class="keyword">file</span>:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2<span class="regexp">/udf/</span>bazaar<span class="regexp">/parser/</span><span class="keyword">project</span><span class="regexp">/project/</span>&#125;parser-build-build...</span><br><span class="line">[info] Resolving org.fusesource.jansi#jansi;<span class="number">1.4</span> ...</span><br><span class="line">[info] Done updating.</span><br><span class="line">[info] Loading <span class="keyword">project</span> definition <span class="keyword">from</span> <span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2<span class="regexp">/udf/</span>bazaar<span class="regexp">/parser/</span><span class="keyword">project</span></span><br><span class="line">[info] Updating &#123;<span class="keyword">file</span>:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2<span class="regexp">/udf/</span>bazaar<span class="regexp">/parser/</span><span class="keyword">project</span>/&#125;parser-build...</span><br><span class="line">[info] Resolving org.fusesource.jansi#jansi;<span class="number">1.4</span> ...</span><br><span class="line">[info] Done updating.</span><br><span class="line">[info] Set current <span class="keyword">project</span> to deepdive-nlp-parser (in build <span class="keyword">file</span>:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2<span class="regexp">/udf/</span>bazaar<span class="regexp">/parser/</span>)</span><br><span class="line">[info] Updating &#123;<span class="keyword">file</span>:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2<span class="regexp">/udf/</span>bazaar<span class="regexp">/parser/</span>&#125;parser...</span><br><span class="line">[info] Resolving org.fusesource.jansi#jansi;<span class="number">1.4</span> ...</span><br><span class="line">[info] Done updating.</span><br><span class="line">[warn] Scala version was updated by one of library <span class="keyword">dependencies</span>:</span><br><span class="line">[warn] 	* org.scala-lang:scala-library:(<span class="number">2.10</span>.<span class="number">3</span>, <span class="number">2.10</span>.<span class="number">4</span>, <span class="number">2.10</span>.<span class="number">2</span>, <span class="number">2.10</span>.<span class="number">0</span>) -&gt; <span class="number">2.10</span>.<span class="number">5</span></span><br><span class="line">[warn] To force scalaVersion, add the following:</span><br><span class="line">[warn] 	ivyScala := ivyScala.value map &#123; _.<span class="keyword">copy</span>(overrideScalaVersion = <span class="keyword">true</span>) &#125;</span><br><span class="line">[warn] Run <span class="string">&#x27;evicted&#x27;</span> to see detailed eviction warnings</span><br><span class="line">[info] Compiling <span class="number">6</span> Scala sources to <span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2<span class="regexp">/udf/</span>bazaar<span class="regexp">/parser/</span>target<span class="regexp">/scala-2.10/</span>classes...</span><br><span class="line">[info] Wrote start script <span class="keyword">for</span> mainClass := Some(com.clearcut.nlp.Main) to <span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2<span class="regexp">/udf/</span>bazaar<span class="regexp">/parser/</span>target/start</span><br><span class="line">[success] Total time: <span class="number">18</span> s, completed <span class="number">2019</span>-<span class="number">10</span>-<span class="number">15</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">54</span></span><br></pre></td></tr></table></figure>
<h2 id="5-修改代码"><a href="#5-修改代码" class="headerlink" title="5. 修改代码"></a>5. 修改代码</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#udf/get_actor_movie.py文件</span></span><br><span class="line">#删除代码</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">#原代码  <span class="keyword">open</span>(out_name,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="keyword">open</span>(out_name,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;UTF-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">#baidu_baike.py文件</span></span><br><span class="line">#修改前 urlparse.urljoin</span><br><span class="line">urllib.parse.urljoin</span><br><span class="line">#修改前 urlparse</span><br><span class="line">urllib</span><br><span class="line"></span><br><span class="line"><span class="meta">#pipelines.py文件</span></span><br><span class="line">#修改前 <span class="keyword">open</span>(&quot;articles.txt&quot;, &quot;a+&quot;)</span><br><span class="line"><span class="keyword">open</span>(&quot;articles.txt&quot;, &quot;a+&quot;,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">#修改# process <span class="keyword">info</span> <span class="keyword">for</span> actor后<span class="number">3</span>行代码为下面</span><br><span class="line">articles = bytes.decode(str(item[<span class="string">&#x27;articles&#x27;</span>]).encode(<span class="string">&#x27;utf-8&#x27;</span>)).replace(&quot;\n&quot;, &quot; &quot;)</span><br><span class="line">article_id = bytes.decode(str(item[<span class="string">&#x27;article_id&#x27;</span>]).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">self.article_file.<span class="keyword">write</span>(article_id + &quot;,&quot; + articles + &quot;\n&quot;)</span><br><span class="line">#修改前 .decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">#删除代码</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">#trans.py文件</span></span><br><span class="line">#修改前 <span class="keyword">open</span>(&quot;./articles.txt&quot;)</span><br><span class="line"><span class="keyword">open</span>(&quot;baidu_baike/articles.txt&quot;,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">#修改前 <span class="keyword">open</span>(&quot;./articles_new.csv&quot;, &quot;w+&quot;)</span><br><span class="line"><span class="keyword">open</span>(&quot;./articles_new.csv&quot;, &quot;w+&quot;,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="6-先验数据导入"><a href="#6-先验数据导入" class="headerlink" title="6. 先验数据导入"></a>6. 先验数据导入</h2><p>用mysql导出工具把actor_to_movie表的数据导出到actor_movie.txt文件，数据格式如下：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#actor_id movie_id</span></span><br><span class="line"><span class="attribute">900</span> <span class="number">1</span></span><br><span class="line"><span class="attribute">10426</span> <span class="number">9</span></span><br><span class="line"><span class="attribute">9412</span> <span class="number">11</span></span><br><span class="line"><span class="attribute">8792</span> <span class="number">25</span></span><br></pre></td></tr></table></figure>

<p> 运行udf&#x2F;get_actor_movie.py 获取 input&#x2F;actor_movie_dbdata.csv 文件 </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\my\Python\python.exe C:<span class="regexp">/d/mmm</span><span class="regexp">/pycharm/</span>deepdive<span class="regexp">/udf/g</span>et_actor_movie.py</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p> app.ddlog 中定义相应的数据表，文件内容如下: </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@source</span></span><br><span class="line"><span class="built_in">actor_movie_dbdata</span>(</span><br><span class="line">    <span class="variable">@key</span></span><br><span class="line">    actor_name text,</span><br><span class="line">    <span class="variable">@key</span></span><br><span class="line">    movie_name text</span><br><span class="line">).</span><br></pre></td></tr></table></figure>

<p>而后通过命令行生成 postgresql 数据表 </p>
<p> a. 行编译操作，也就是在项目目录执行下面的命令： </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">root</span>@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive compile</span><br><span class="line"></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">51</span>.<span class="number">779111</span> ‘run/LATEST.COMPILE’ -&gt; ‘<span class="number">20191016</span>/<span class="number">152551</span>.<span class="number">724661396</span>’</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">51</span>.<span class="number">784188</span> ‘run/RUNNING.COMPILE’ -&gt; ‘<span class="number">20191016</span>/<span class="number">152551</span>.<span class="number">724661396</span>’</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">51</span>.<span class="number">784488</span> Parsing DeepDive application (/usr/local/CNdeepdive/transaction2) to generate:</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">51</span>.<span class="number">784700</span>  run/compiled/schema.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">51</span>.<span class="number">784902</span>   from app.ddlog</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">52</span>.<span class="number">230712</span>  run/compiled/deepdive.conf</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">52</span>.<span class="number">230760</span>   from app.ddlog</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">52</span>.<span class="number">739134</span>   from deepdive.conf</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">52</span>.<span class="number">740832</span>  run/compiled/deepdive.conf.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">062665</span> Performing sanity checks <span class="literal">on</span> run/compiled/deepdive.conf.json:</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">090525</span>  checking if input_extractors_well_defined</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">090609</span>  checking if input_schema_wellformed</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">090621</span> Normalizing and adding built-in processes to the data flow to compile:</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">090631</span>  run/compiled/config-<span class="number">0</span>.<span class="number">00</span>-init_objects.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">101117</span>  run/compiled/config-<span class="number">0</span>.<span class="number">01</span>-parse_calibration.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">108870</span>  run/compiled/config-<span class="number">0</span>.<span class="number">01</span>-parse_schema.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">126399</span>  run/compiled/config-<span class="number">0</span>.<span class="number">51</span>-add_init_app.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">132111</span>  run/compiled/config-<span class="number">0</span>.<span class="number">52</span>-input_loader.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">144006</span>  run/compiled/config-<span class="number">1</span>.<span class="number">00</span>-qualified_names.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">158387</span>  run/compiled/config-<span class="number">1</span>.<span class="number">01</span>-parse_inference_rules.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">185708</span>  run/compiled/config-<span class="number">2</span>.<span class="number">01</span>-grounding.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">287285</span>  run/compiled/config-<span class="number">2</span>.<span class="number">02</span>-learning_inference.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">303617</span>  run/compiled/config-<span class="number">2</span>.<span class="number">03</span>-calibration_plots.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">314917</span>  run/compiled/config-<span class="number">9</span>.<span class="number">98</span>-ensure_init_app.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">324952</span>  run/compiled/config-<span class="number">9</span>.<span class="number">99</span>-dependencies.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">336073</span>  run/compiled/config.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">337028</span> Validating run/compiled/config.json:</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">382982</span>  checking if compiled_base_relations_have_input_data</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">383035</span>  checking if compiled_dependencies_correct</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">383047</span>  checking if compiled_input_output_well_defined</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">383056</span>  checking if compiled_output_uniquely_defined</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">383064</span> Compiling executable code into:</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">383073</span>  run/compiled/code-cmd_extractor.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">401750</span>  run/compiled/code-dataflow_dot.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">417009</span>  run/compiled/code-Makefile.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">435906</span>  run/compiled/code-sql_extractor.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">447180</span>  run/compiled/code-tsv_extractor.json</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">461059</span> Generating files:</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">471287</span>  run/process/init/app/run.sh</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">478829</span>  run/process/init/relation/actor_movie_dbdata/run.sh</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">482429</span>  run/dataflow.dot</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">484349</span>  run/Makefile</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">541030</span>  run/dataflow.svg</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">543347</span>   (file:///usr/local/CNdeepdive/transaction2/run/dataflow.svg)</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">10</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">53</span>.<span class="number">544398</span> ‘run/compiled’ -&gt; ‘<span class="number">20191016</span>/<span class="number">152551</span>.<span class="number">724661396</span>’</span><br></pre></td></tr></table></figure>

<p> 编译完成后，我们要执行</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive do actor_movie_dbdata</span><br><span class="line"></span><br><span class="line"># on ubuntu-mmm: deepdive do actor_movie_dbdata</span><br><span class="line"># run/<span class="number">20191016</span>/<span class="number">152600.104675031</span>/plan.sh</span><br><span class="line"># execution plan for data/actor_movie_dbdata</span><br><span class="line"></span><br><span class="line">## process/init/app ##########################################################</span><br><span class="line"># Done: N/A</span><br><span class="line">process/init/app/run.sh</span><br><span class="line">mark_done process/init/app</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## process/init/relation/actor_movie_dbdata ##################################</span><br><span class="line"># Done: N/A</span><br><span class="line">process/init/relation/actor_movie_dbdata/run.sh</span><br><span class="line">mark_done process/init/relation/actor_movie_dbdata</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## data/actor_movie_dbdata ###################################################</span><br><span class="line"># Done: N/A</span><br><span class="line"># no-op</span><br><span class="line">mark_done data/actor_movie_dbdata</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里<code>do</code> 后面应该和我们<code>app.ddlog</code> 中的名字相同，和<code>input</code> 文件夹中的文件名也相同，他们三个应该都是一致的。他会把input文件中的对应的文件导入postgresql数据库中。注意这个语句执行后，他会进入一个类似vi的界面让你审查他自动生成的处理代码是不是正确，这时候输入<code>：wq</code> 就可以保存并退出，继续执行后面的步骤。运行结果 如下：</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.793180</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.793341</span> : ## process/init/app ##########################################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.793549</span> : # Done: <span class="number">2019</span><span class="number">-10</span><span class="number">-16</span>T15:<span class="number">31</span>:<span class="number">00</span>+<span class="number">0800</span> (<span class="number">5</span>m <span class="number">42</span>s ago)</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.793734</span> : process/init/app/run.sh</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.793938</span> : mark_done process/init/app</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.795712</span> : ##############################################################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.795906</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.796165</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.796308</span> ## process/init/relation/actor_movie_dbdata ##################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.796550</span> # Done: N/A</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.796758</span> process/init/relation/actor_movie_dbdata/run.sh</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.797006</span> ++ dirname process/init/relation/actor_movie_dbdata/run.sh</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.797202</span> + cd process/init/relation/actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.797407</span> + <span class="keyword">export</span> DEEPDIVE_CURRENT_PROCESS_NAME=process/init/relation/actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.797677</span> + DEEPDIVE_CURRENT_PROCESS_NAME=process/init/relation/actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.797987</span> + deepdive create table actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.885518</span> CREATE TABLE</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.886898</span> + deepdive load actor_movie_dbdata</span><br><span class="line">loading actor_movie_dbdata: <span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">179</span>KiB [ <span class="number">816</span>MiB/s] ([ <span class="number">816</span>MiB/s])r_movie_dbdata.csv (csv format)</span><br><span class="line">loading actor_movie_dbdata: <span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">5.94</span>k [ <span class="number">123</span>k/s] ([ <span class="number">123</span>k/s])</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.996248</span> COPY <span class="number">5943</span></span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.998965</span> mark_done process/init/relation/actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003297</span> ##############################################################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003373</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003386</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003397</span> ## data/actor_movie_dbdata ###################################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003408</span> # Done: N/A</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003436</span> # no-op</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003467</span> mark_done data/actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.006529</span> ##############################################################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.006568</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.006580</span> </span><br><span class="line">‘run/FINISHED’ -&gt; ‘<span class="number">20191016</span>/<span class="number">153642.492053809</span>’</span><br></pre></td></tr></table></figure>

<p> 执行完成后，可以执行下面代码在数据库中查询，看看是不是成功导入了 </p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive query <span class="emphasis">&#x27;?- actor_movie_dbdata(actor_name, _).&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="section">                                actor_name                                </span></span><br><span class="line"><span class="section">--------------------------------------------------------------------------</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> 车保罗</span></span><br><span class="line"><span class="code"> 车保罗</span></span><br><span class="line"><span class="code"> Paul Che</span></span><br><span class="line"><span class="code"> Paul Che</span></span><br><span class="line"><span class="code"> 张学友</span></span><br><span class="line"><span class="code"> 张学友</span></span><br><span class="line"><span class="code"> Jacky Cheung</span></span><br><span class="line"><span class="code"> Jacky Cheung</span></span><br><span class="line"><span class="code"> 章子怡</span></span><br><span class="line"><span class="code"> Zhang Ziyi</span></span><br><span class="line"><span class="code"> 章子怡</span></span><br><span class="line"><span class="code"> Zhang Ziyi</span></span><br><span class="line"><span class="code"> 章子怡</span></span><br></pre></td></tr></table></figure>

<h2 id="7-待抽取文章的导入"><a href="#7-待抽取文章的导入" class="headerlink" title="7. 待抽取文章的导入"></a>7. 待抽取文章的导入</h2><p> 为了获取到大量的电影和演员相关文章，我们直接套用之前的半结构化数据爬虫来获取非结构文本。 </p>
<p>cmd中执行命令：scrapy crawl 项目名</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS C:\d\mmm\pycharm\deepdive\udf\baidu_baike\baidu_baike&gt; scrapy crawl baidu</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">16</span>:<span class="number">06</span>:<span class="number">06</span> [scrapy.utils.<span class="keyword">log</span>] <span class="keyword">INFO</span>: Scrapy <span class="number">1.7</span><span class="number">.3</span> started (bot: baidu_baike)</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">16</span>:<span class="number">06</span>:<span class="number">06</span> [scrapy.utils.<span class="keyword">log</span>] <span class="keyword">INFO</span>: Versions: lxml <span class="number">4.4</span><span class="number">.1</span><span class="number">.0</span>, libxml2 <span class="number">2.9</span><span class="number">.5</span>, cssselect <span class="number">1.1</span><span class="number">.0</span>, parsel <span class="number">1.5</span><span class="number">.2</span>, w3lib <span class="number">1.21</span><span class="number">.0</span>, Twisted <span class="number">19.7</span><span class="number">.0</span>, Python <span class="number">3.7</span><span class="number">.4</span> (tags/v3<span class="number">.7</span><span class="number">.4</span>:e09359112e, Jul  <span class="number">8</span> <span class="number">2019</span>, <span class="number">20</span>:<span class="number">34</span>:<span class="number">20</span>) [MSC v<span class="number">.1916</span> <span class="number">64</span> <span class="type">bit</span> (AMD64)], pyOpenSSL <span class="number">19.0</span><span class="number">.0</span> (OpenSSL <span class="number">1.1</span><span class="number">.1</span>c  <span class="number">28</span> May <span class="number">2019</span>), cryptography <span class="number">2.7</span>, Platform Windows<span class="number">-10</span><span class="number">-10.0</span><span class="number">.18362</span>-SP0</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">16</span>:<span class="number">06</span>:<span class="number">06</span> [scrapy.crawler] <span class="keyword">INFO</span>: Overridden settings: &#123;<span class="string">&#x27;BOT_NAME&#x27;</span>: <span class="string">&#x27;baidu_baike&#x27;</span>, <span class="string">&#x27;NEWSPIDER_MODULE&#x27;</span>: <span class="string">&#x27;baidu_baike.spiders&#x27;</span>, <span class="string">&#x27;SPIDER_MODULES&#x27;</span>: [<span class="string">&#x27;baidu_baike.spiders&#x27;</span>], <span class="string">&#x27;USER_AGENT&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p> 接下来为了将其导入到数据库中，需要将其转换为csv格式，这里可以使用程序 udf&#x2F;trans.py 进行转换。再更改名字即可。 </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\my\Python\python.exe C:<span class="regexp">/d/mmm</span><span class="regexp">/pycharm/</span>deepdive<span class="regexp">/udf/</span>trans.py</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p> 在 app.ddlog 中建立相应的 articles 表： </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="selector-tag">source</span></span><br><span class="line"><span class="built_in">articles</span>(</span><br><span class="line">        id <span class="selector-tag">text</span>,</span><br><span class="line">        <span class="attribute">content</span> text</span><br><span class="line">).</span><br></pre></td></tr></table></figure>
<p>因为下面的 stanford_nlp 进行句法分析时速度特别的慢，因此我抽取出 articles.csv 的头10 行进行实验。<br>执行 ‘’’ deepdive do articles ‘’’ 将文章导入到 postgresql中</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root<span class="meta">@ubuntu</span><span class="operator">-</span>mmm:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2# deepdive compile</span><br><span class="line">root<span class="meta">@ubuntu</span><span class="operator">-</span>mmm:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2# deepdive <span class="keyword">do</span> articles</span><br></pre></td></tr></table></figure>

<p>验证是否成功</p>
 <figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive query <span class="emphasis">&#x27;?- articles(id, _).&#x27;</span></span><br><span class="line"><span class="section"> id </span></span><br><span class="line"><span class="section">----</span></span><br><span class="line"><span class="code"> 0</span></span><br><span class="line"><span class="code"> 1</span></span><br><span class="line"><span class="code"> 2</span></span><br><span class="line"><span class="code"> 3</span></span><br><span class="line"><span class="code"> 4</span></span><br><span class="line"><span class="code"> 5</span></span><br><span class="line"><span class="code"> 6</span></span><br><span class="line"><span class="code"> 7</span></span><br><span class="line"><span class="code"> 8</span></span><br><span class="line"><span class="code"> 9</span></span><br><span class="line"><span class="code"> 10</span></span><br><span class="line">(11 rows)</span><br></pre></td></tr></table></figure>
<h2 id="8-用-stanford-nlp-模块进行文本处理"><a href="#8-用-stanford-nlp-模块进行文本处理" class="headerlink" title="8. 用 stanford_nlp 模块进行文本处理"></a>8. 用 stanford_nlp 模块进行文本处理</h2><p>deepdive 默认采⽤standfor nlp进⾏⽂本处理。输⼊⽂本数据，nlp模块将以句子为单位，返回每句的分词、lemma、pos、NER和句法分析的结果，为后续特征抽取做准备。我们将这些结果存入sentences表中。</p>
<p>首先在 app.ddlog 中建立 sentences 表：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@<span class="selector-tag">source</span></span><br><span class="line"><span class="built_in">sentences</span>(</span><br><span class="line">        doc_id <span class="selector-tag">text</span>,</span><br><span class="line">        sentence_index int,</span><br><span class="line">        sentences_text <span class="selector-tag">text</span>,</span><br><span class="line">        tokens <span class="selector-tag">text</span><span class="selector-attr">[]</span>,</span><br><span class="line">        lemmas <span class="selector-tag">text</span><span class="selector-attr">[]</span>,</span><br><span class="line">        pos_tags <span class="selector-tag">text</span><span class="selector-attr">[]</span>,</span><br><span class="line">        ner_tags <span class="selector-tag">text</span><span class="selector-attr">[]</span>,</span><br><span class="line">        doc_offsets int<span class="selector-attr">[]</span>,</span><br><span class="line">        dep_types <span class="selector-tag">text</span><span class="selector-attr">[]</span>,</span><br><span class="line">        dep_tokens int<span class="selector-attr">[]</span></span><br><span class="line">).</span><br></pre></td></tr></table></figure>

<p> 而后定义NLP 处理的函数 nlp_markup 来调用自定义的脚本 udf&#x2F;nlp_markup.sh 进行文本处理。  我们需要对数据处理的方法，deepdive只是个框架，具体要怎么处理需要我们告诉他。所以我们要定义函数来处理articles让他变成sentences。 </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> nlp_markup <span class="keyword">over</span> (</span><br><span class="line">            doc_id <span class="type">text</span>,</span><br><span class="line">            content <span class="type">text</span>,</span><br><span class="line">    ) <span class="keyword">returns</span> <span class="keyword">rows</span> <span class="keyword">like</span> sentences</span><br><span class="line">    implementation &quot;udf/nlp_markup.sh&quot; handles tsv lines.</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>​     function用来定义函数，后面<code>nlp_markup</code> 是函数名 over后面接的是参数表。</p>
<p>​     returns 说明了函数返回的形式，返回就像我们前面定义的sentences那样的一行。</p>
<p>​     最后一句说明了我们这个程序文件是<code>udf/nlp_markup.sh</code> ,输入是tsv的一行。</p>
<p> 使用如下语法调用 nlp_markup 函数，将函数的输出存储到sentences 表中： </p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sentences += nlp<span class="number">_m</span>arkup(<span class="meta">doc</span><span class="number">_</span>id, content) :-</span><br><span class="line">    articles(<span class="meta">doc</span><span class="number">_</span>id, content).</span><br></pre></td></tr></table></figure>

<p>说明：上面的<code>+=</code> 其实和其他语言差不多，就是对于来源是articles中的每一行的<code>doc_id</code> 和<code>content</code> 我们都调用<code>nlp_markup</code> 然后结果添加到sentences表中。 </p>
<p>编写 udf&#x2F;nlp_markup.sh，代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="comment"># A shell script that runs Bazaar/Parser over documents passed as input TSV lines</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># $ deepdive env udf/nlp_markup.sh doc_id _ _ content _</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="built_in">set</span> -euo pipefail</span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(dirname <span class="string">&quot;<span class="variable">$0</span>&quot;</span>)</span>&quot;</span></span><br><span class="line"></span><br><span class="line">: <span class="variable">$&#123;BAZAAR_HOME:=$PWD/bazaar&#125;</span></span><br><span class="line">[[ -x <span class="string">&quot;<span class="variable">$BAZAAR_HOME</span>&quot;</span>/parser/target/start ]] || &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;No Bazaar/Parser set up at: <span class="variable">$BAZAAR_HOME</span>/parser&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line">&#125; &gt;&amp;2</span><br><span class="line"></span><br><span class="line">[[ <span class="variable">$#</span> -gt 0 ]] ||</span><br><span class="line">    <span class="comment"># default column order of input TSV</span></span><br><span class="line">    <span class="built_in">set</span> -- doc_id content</span><br><span class="line"></span><br><span class="line"><span class="comment"># convert input tsv lines into JSON lines for Bazaar/Parser</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># start Bazaar/Parser to emit sentences TSV</span></span><br><span class="line">tsv2json <span class="string">&quot;<span class="variable">$@</span>&quot;</span> |</span><br><span class="line"><span class="string">&quot;<span class="variable">$BAZAAR_HOME</span>&quot;</span>/parser/run.sh -i json -k doc_id -v content</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>所有#开头的（除了#！）都是普通注释</p>
<p>参数的用法(</p>
<ul>
<li>$0：调用文件使用的文件名，带有前面的路径,</li>
<li>$1-∞：传给脚本的各个参数,</li>
<li>$@,$*：这两个都表示传入的所有参数,</li>
<li>$#：表示传入参数的个数)</li>
</ul>
<p>第一行指定了脚本的执行程序</p>
<p>第六行指定了一些程序的错误处理方式等（详见Shell相关文档）</p>
<p>第七行改变当前目录到<code>nlp_markup.py</code> 所在目录，也就是<code>udf</code> 目录</p>
<p>第九行设置了一个变量<code>BAZZER_HOME</code> 他的值是<code>bazaar</code> 的路径</p>
<p>第10-13行执行<code>/parser/target/start</code> 文件，如果有错会不正常退出，并提示</p>
<p>第15-17行检查输入参数的正确性，看参数个数是不是大于0个，如果没有参数，自己设定参数名</p>
<p>第23-24行把全部输入的参数用<code>tsv2json</code> 工具转换成<code>json</code> 格式，然后在执行<code>parser/run.sh</code> 并以刚才的<code>json</code> 作为参数输入。</p>
<p>编译并执行<code>deepdive compile &amp;&amp; deepdive do sentences</code> 生成 sentences 表。 </p>
<p>预告：运行很慢，耐心等待……</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# <span class="built_in">chmod</span> 777 udf/bazaar/parser/run.sh</span><br><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# <span class="built_in">chmod</span> 777 udf/nlp_markup.sh</span><br><span class="line"></span><br><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive compile &amp;&amp; deepdive <span class="keyword">do</span> sentences</span><br><span class="line"></span><br><span class="line">loading dd_tmp_sentences: 0:00:31    0 B [   0 B/s] ([   0 B/s])2019-10-17 10:01:41.117623 Reading POS tagger model from edu/stanford/nlp/models/pos-tagger/chinese-distsim/chinese-distsim.tagger ... <span class="keyword">done</span> [2.1 sec].</span><br><span class="line">2019-10-17 10:01:41.118162 Adding annotator lemma</span><br><span class="line">loading dd_tmp_sentences: 0:00:42    0 B [   0 B/s] ([   0 B/s])2019-10-17 10:01:52.480759 Loading classifier from edu/stanford/nlp/models/ner/chinese.misc.distsim.crf.ser.gz ... <span class="keyword">done</span> [11.3 sec].</span><br><span class="line">loading dd_tmp_sentences: 0:00:43    0 B [   0 B/s] ([   0 B/s])2019-10-17 10:01:53.716363 Loading parser from serialized file edu/stanford/nlp/models/lexparser/chineseloading dd_tmp_sentences: 0:00:44    0 B [   0 B/s] ([   0 B/s])2019-10-17 10:01:53.943866 Parsing document 0...</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p> 您可以通过以下命令来查询生成的结果： </p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">root</span><span class="operator">@</span><span class="variable">ubuntu</span><span class="operator">-</span><span class="variable">mmm</span><span class="operator">:/</span><span class="variable">usr</span><span class="operator">/</span><span class="variable">local</span><span class="operator">/</span><span class="variable">CNdeepdive</span><span class="operator">/</span><span class="variable">transaction2</span><span class="type">#</span> <span class="variable">deepdive</span> <span class="variable">query</span> <span class="operator">&#x27;</span></span><br><span class="line"><span class="type">doc_id</span><span class="operator">,</span> <span class="variable">index</span><span class="operator">,</span> <span class="variable">tokens</span><span class="operator">,</span> <span class="type">ner_tags</span> <span class="operator">|</span> <span class="number">5</span></span><br><span class="line"><span class="operator">?-</span> <span class="variable">sentences</span><span class="punctuation">(</span><span class="type">doc_id</span><span class="operator">,</span> <span class="variable">index</span><span class="operator">,</span> <span class="variable">text</span><span class="operator">,</span> <span class="variable">tokens</span><span class="operator">,</span> <span class="variable">lemmas</span><span class="operator">,</span> <span class="type">pos_tags</span><span class="operator">,</span> <span class="type">ner_tags</span><span class="operator">,</span> <span class="type">_</span><span class="operator">,</span> <span class="type">_</span><span class="operator">,</span> <span class="type">_</span><span class="punctuation">)</span><span class="operator">.</span></span><br><span class="line"><span class="operator">&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="type">doc_id</span> <span class="operator">|</span> <span class="variable">index</span> <span class="operator">|</span>                                                                                  <span class="variable">tokens</span>                                                                                   <span class="operator">|</span>                                                 <span class="type">ner_tags</span>                                                  </span><br><span class="line"><span class="operator">--------+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------</span></span><br><span class="line"> <span class="number">0</span>      <span class="operator">|</span>     <span class="number">1</span> <span class="operator">|</span> <span class="punctuation">&#123;</span>周星驰<span class="operator">,</span>，<span class="operator">,</span><span class="number">1962</span>年<span class="operator">,</span><span class="number">6</span>月<span class="operator">,</span><span class="number">22</span>日<span class="operator">,</span>生<span class="operator">,</span>于<span class="operator">,</span>香港<span class="operator">,</span>，<span class="operator">,</span>祖籍<span class="operator">,</span>浙江<span class="operator">,</span>宁波<span class="operator">,</span>，<span class="operator">,</span>中国<span class="operator">,</span>香港<span class="operator">,</span>演员<span class="operator">,</span>、<span class="operator">,</span>导演<span class="operator">,</span>、<span class="operator">,</span>编剧<span class="operator">,</span>、<span class="operator">,</span>制作人<span class="operator">,</span>、<span class="operator">,</span>商人<span class="operator">,</span>，<span class="operator">,</span>毕业于<span class="operator">,</span>无线<span class="operator">,</span>电视<span class="operator">,</span>艺员<span class="operator">,</span>训练班<span class="operator">,</span>。<span class="punctuation">&#125;</span>                           <span class="operator">|</span> <span class="punctuation">&#123;</span><span class="variable">PERSON</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="variable">GPE</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="variable">GPE</span><span class="operator">,</span><span class="variable">GPE</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="variable">GPE</span><span class="operator">,</span><span class="variable">GPE</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="punctuation">&#125;</span></span><br><span class="line"> <span class="number">0</span>      <span class="operator">|</span>     <span class="number">2</span> <span class="operator">|</span> <span class="punctuation">&#123;</span><span class="number">1980</span>年<span class="operator">,</span>成为<span class="operator">,</span>丽的<span class="operator">,</span>电视台<span class="operator">,</span>的<span class="operator">,</span>特约<span class="operator">,</span>演员<span class="operator">,</span>，<span class="operator">,</span>从而<span class="operator">,</span>进入<span class="operator">,</span>演艺圈<span class="operator">,</span>。<span class="punctuation">&#125;</span>                                                                                                             <span class="operator">|</span> <span class="punctuation">&#123;</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="punctuation">&#125;</span></span><br><span class="line"> <span class="number">0</span>      <span class="operator">|</span>     <span class="number">3</span> <span class="operator">|</span> <span class="punctuation">&#123;</span><span class="number">1981</span>年<span class="operator">,</span>出演<span class="operator">,</span>个人<span class="operator">,</span>首部<span class="operator">,</span>电视剧<span class="operator">,</span>《<span class="operator">,</span><span class="variable">IQ</span><span class="operator">,</span>成熟<span class="operator">,</span>时<span class="operator">,</span>》<span class="operator">,</span>。<span class="punctuation">&#125;</span>                                                                                                                          <span class="operator">|</span> <span class="punctuation">&#123;</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="punctuation">&#125;</span></span><br><span class="line"> <span class="number">0</span>      <span class="operator">|</span>     <span class="number">4</span> <span class="operator">|</span> <span class="punctuation">&#123;</span><span class="number">1988</span>年<span class="operator">,</span>将<span class="operator">,</span>演艺<span class="operator">,</span>事业<span class="operator">,</span>的<span class="operator">,</span>重心<span class="operator">,</span>转向<span class="operator">,</span>大<span class="operator">,</span>银幕<span class="operator">,</span>，<span class="operator">,</span>并<span class="operator">,</span>于<span class="operator">,</span>同<span class="operator">,</span>年<span class="operator">,</span>出演<span class="operator">,</span>电影<span class="operator">,</span>处女<span class="operator">,</span>作<span class="operator">,</span>《<span class="operator">,</span>捕<span class="operator">,</span>风<span class="operator">,</span>汉子<span class="operator">,</span>》<span class="operator">,</span>。<span class="punctuation">&#125;</span>                                                                             <span class="operator">|</span> <span class="punctuation">&#123;</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="punctuation">&#125;</span></span><br><span class="line"> <span class="number">0</span>      <span class="operator">|</span>     <span class="number">5</span> <span class="operator">|</span> <span class="punctuation">&#123;</span><span class="number">1990</span>年<span class="operator">,</span>凭借<span class="operator">,</span>喜剧片<span class="operator">,</span>《<span class="operator">,</span>一<span class="operator">,</span>本<span class="operator">,</span>漫画<span class="operator">,</span>闯<span class="operator">,</span>天涯<span class="operator">,</span>》<span class="operator">,</span>确立<span class="operator">,</span>其<span class="operator">,</span>无厘头<span class="operator">,</span>的<span class="operator">,</span>表演<span class="operator">,</span>风格<span class="operator">,</span><span class="punctuation">(</span><span class="operator">,</span><span class="number">1</span><span class="operator">,</span><span class="punctuation">)</span><span class="operator">,</span>；<span class="operator">,</span>同年<span class="operator">,</span>，<span class="operator">,</span>因其<span class="operator">,</span>主演<span class="operator">,</span>的<span class="operator">,</span>喜剧<span class="operator">,</span>动作片<span class="operator">,</span>《<span class="operator">,</span>赌圣<span class="operator">,</span>》<span class="operator">,</span>打破<span class="operator">,</span>香港<span class="operator">,</span>地区<span class="operator">,</span>票房<span class="operator">,</span>纪录<span class="operator">,</span>而<span class="operator">,</span>获得<span class="operator">,</span>关注<span class="operator">,</span><span class="punctuation">(</span><span class="operator">,</span><span class="number">2</span><span class="operator">,</span><span class="punctuation">)</span><span class="operator">,</span>。<span class="punctuation">&#125;</span> <span class="operator">|</span> <span class="punctuation">&#123;</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="variable">MISC</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="variable">GPE</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="operator">,</span><span class="built_in">O</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">(</span><span class="number">5</span> <span class="variable">rows</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h2 id="9-候选实体的生成"><a href="#9-候选实体的生成" class="headerlink" title="9.候选实体的生成"></a>9.候选实体的生成</h2><p> 首先介绍演员候选实体的生成。首先我们在app.ddlog 中定义实体数据表： </p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@extraction</span><br><span class="line">actor_mention(</span><br><span class="line">        mention_id <span class="keyword">text</span>,</span><br><span class="line">        mention_text <span class="keyword">text</span>,</span><br><span class="line">        doc_id <span class="keyword">text</span>,</span><br><span class="line">        sentences_index <span class="keyword">int</span>,</span><br><span class="line">        begin_index <span class="keyword">int</span>,</span><br><span class="line">        end_index <span class="keyword">int</span></span><br><span class="line">).</span><br></pre></td></tr></table></figure>

<p>该表包含了实体的id、内容、所在文本的id、所在句子的索引、起始和终止位置索引。</p>
<p>而后继续定义实体抽取函数：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> map_actor_mention <span class="keyword">over</span>(</span><br><span class="line">        doc_id <span class="type">text</span>,</span><br><span class="line">        sentence_index <span class="type">int</span>,</span><br><span class="line">        tokens <span class="type">text</span>[],</span><br><span class="line">        pos_tags <span class="type">text</span>[],</span><br><span class="line">        ner_tags <span class="type">text</span>[]</span><br><span class="line">    ) <span class="keyword">returns</span> <span class="keyword">rows</span> <span class="keyword">like</span> actor_mention</span><br><span class="line">implementation &quot;udf/map_actor_mention.py&quot; handles tsv lines.</span><br></pre></td></tr></table></figure>

<p>其中 udf&#x2F;map_actor_mention.py 脚本遍历数据库中的句子，找到连续的NER标记为PERSON 且 POS 标记为NR的序列，再对其做过滤整合处理，返回候选实体。</p>
<p>最后我们在 app.ddlog 中调用函数，将 函数的输出存储到 actor_mention 表中。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">actor_mention += map_actor_mention(</span><br><span class="line">    doc_id, sentence_index, <span class="built_in">tokens</span>, pos_tags, ner_tags</span><br><span class="line">    ) :-                   </span><br><span class="line">    sentences(doc_id, sentence_index, <span class="symbol">_</span>, <span class="built_in">tokens</span>, <span class="symbol">_</span>, pos_tags, ner_tags, <span class="symbol">_</span>, <span class="symbol">_</span>, <span class="symbol">_</span>).</span><br></pre></td></tr></table></figure>

<p> 现在我们可以编译并执行得到 actor_mention 表了。 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# <span class="built_in">chmod</span> 777 udf/map_actor_mention.py</span><br><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive compile &amp;&amp; deepdive <span class="keyword">do</span> actor_mention</span><br></pre></td></tr></table></figure>

<p> 同理可以得到 电影类的实体表 movie_mention ： </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@extraction</span><br><span class="line">movie_mention(</span><br><span class="line">        mention_id <span class="type">text</span>,  </span><br><span class="line">        mention_text <span class="type">text</span>,</span><br><span class="line">        doc_id <span class="type">text</span>,      </span><br><span class="line">        sentences_index <span class="type">int</span>,</span><br><span class="line">        begin_index <span class="type">int</span>,</span><br><span class="line">        end_index <span class="type">int</span></span><br><span class="line">    ).</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> map_movie_mention <span class="keyword">over</span>(</span><br><span class="line">    doc_id <span class="type">text</span>,</span><br><span class="line">    sentence_index <span class="type">int</span>,</span><br><span class="line">    tokens <span class="type">text</span>[],</span><br><span class="line">    pos_tags <span class="type">text</span>[],</span><br><span class="line">    ner_tags <span class="type">text</span>[]</span><br><span class="line">) <span class="keyword">returns</span> <span class="keyword">rows</span> <span class="keyword">like</span> movie_mention</span><br><span class="line">implementation &quot;udf/map_movie_mention.py&quot; handles tsv lines.</span><br><span class="line">                </span><br><span class="line">movie_mention += map_movie_mention(</span><br><span class="line">doc_id, sentence_index, tokens, pos_tags, ner_tags</span><br><span class="line">) :-            </span><br><span class="line">    sentences(doc_id, sentence_index, _, tokens, _, pos_tags, ner_tags, _, _, _).</span><br></pre></td></tr></table></figure>
<p>编译并执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# <span class="built_in">chmod</span> 777 udf/map_movie_mention.py</span><br><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive compile &amp;&amp; deepdive <span class="keyword">do</span> movie_mention</span><br></pre></td></tr></table></figure>

<p>查询看一下得到的实体： </p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root<span class="meta">@ubuntu-mmm:/usr/local/CNdeepdive/transaction2#</span> deepdive query &#x27;</span><br><span class="line">mention_id, mention_text, doc_id |<span class="string"> 5</span></span><br><span class="line"><span class="string">?- movie_mention(mention_id, mention_text, doc_id, _, _, _).</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> mention_id </span>|<span class="string"> mention_text </span>|<span class="string"> doc_id </span></span><br><span class="line"><span class="string">------------+--------------+--------</span></span><br><span class="line"><span class="string"> 0_5_28_28  </span>|<span class="string"> 赌圣         </span>|<span class="string"> 0</span></span><br><span class="line"><span class="string"> 0_7_6_6    </span>|<span class="string"> 大话西游     </span>|<span class="string"> 0</span></span><br><span class="line"><span class="string"> 0_7_11_11  </span>|<span class="string"> 华语         </span>|<span class="string"> 0</span></span><br><span class="line"><span class="string"> 0_8_6_6    </span>|<span class="string"> 喜剧         </span>|<span class="string"> 0</span></span><br><span class="line"><span class="string"> 0_9_4_4    </span>|<span class="string"> 少林足球     </span>|<span class="string"> 0</span></span><br><span class="line"><span class="string">(5 rows)</span></span><br></pre></td></tr></table></figure>

<h2 id="10-生成候选实体对"><a href="#10-生成候选实体对" class="headerlink" title="10. 生成候选实体对"></a>10. 生成候选实体对</h2><p> 这一步我们要生成候选实体对，首先定义数据表如下： </p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@extraction</span><br><span class="line">play_candidate(</span><br><span class="line">    p1_id <span class="keyword">text</span>,</span><br><span class="line">    p1_name <span class="keyword">text</span>,</span><br><span class="line">    p2_id <span class="keyword">text</span>,</span><br><span class="line">    p2_name <span class="keyword">text</span></span><br><span class="line">).</span><br></pre></td></tr></table></figure>

<p> 包含实体1&#x2F;2 的id 和内容。接下来统计每个句子的实体数量以限制同一句内出现过多实体： </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">num_entity</span><span class="params">(doc_id, sentence_index, COUNT(p)</span></span> + <span class="built_in">COUNT</span>(q)) :-</span><br><span class="line">	<span class="built_in">actor_mention</span>(<span class="selector-tag">p</span>, _, doc_id, sentence_index, _, _),</span><br><span class="line">	<span class="built_in">movie_mention</span>(<span class="selector-tag">q</span>, _, doc_id, sentence_index, _, _).</span><br></pre></td></tr></table></figure>

<p> 而后定义过滤函数： </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> map_play_candidate <span class="keyword">over</span> (</span><br><span class="line">    p1_id <span class="type">text</span>,</span><br><span class="line">    p1_name <span class="type">text</span>,</span><br><span class="line">    p2_id <span class="type">text</span>,</span><br><span class="line">    p2_name <span class="type">text</span></span><br><span class="line">) <span class="keyword">returns</span> <span class="keyword">rows</span> <span class="keyword">like</span> play_candidate</span><br><span class="line">implementation &quot;udf/map_play_candidate.py&quot; handles tsv lines.</span><br></pre></td></tr></table></figure>

<p>该函数内您可以定义一些规则对候选实体对进行筛选。</p>
<p>接下来调用上述函数并结合一些规则对实体对进行进一步的筛选，将筛选结果存储到 play_candidate 数据表中：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">play_candidate += map_play_candidate(p1, p1_name, p2, p2_name)<span class="keyword"> :</span>-</span><br><span class="line">    num_entity(same_doc, same_sentence, num_e),</span><br><span class="line">    actor_mention(p1, p1_name, same_doc, same_sentence, p1_begin, _),</span><br><span class="line">    movie_mention(p2, p2_name, same_doc, same_sentence, p2_begin, _),</span><br><span class="line">    num_e &lt; 5,  </span><br><span class="line">    p1_name != p2_name,</span><br><span class="line">    p1_begin != p2_begin.</span><br></pre></td></tr></table></figure>

<p> 编译并执行得到候选实体对表： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# <span class="built_in">chmod</span> 777 udf/map_play_candidate.py</span><br><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive compile &amp;&amp; deepdive <span class="keyword">do</span> play_candidate</span><br></pre></td></tr></table></figure>

<p> 查询一下看看结果： </p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive query &#x27;</span><br><span class="line">p1<span class="emphasis">_text, p2_text | 5</span></span><br><span class="line"><span class="emphasis">?- play_candidate(_, p1_text, _, p2_</span>text).</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line"><span class="section">   p1_text    | p2_text  </span></span><br><span class="line"><span class="section">--------------+----------</span></span><br><span class="line"><span class="code"> 周星驰       | 滕王阁序</span></span><br><span class="line"><span class="code"> 周星驰       | 北斗</span></span><br><span class="line"><span class="code"> 龙炳基       | 北斗</span></span><br><span class="line"><span class="code"> 赵子龙       | 生命</span></span><br><span class="line"><span class="code"> 郑佩佩       | 审死官</span></span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure>

<h2 id="11-特征抽取"><a href="#11-特征抽取" class="headerlink" title="11. 特征抽取"></a>11. 特征抽取</h2><p>现在我们要用deeodive自带的 ddlib 库抽选实体对的文本特征。</p>
<p>首先定义特征表：</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@extraction</span><br><span class="line">play_feature(                 </span><br><span class="line">    p1_id <span class="built_in">text</span>,               </span><br><span class="line">    p2_id <span class="built_in">text</span>,               </span><br><span class="line">    <span class="built_in">feature</span> <span class="built_in">text</span>              </span><br><span class="line">). </span><br></pre></td></tr></table></figure>

<p>该特征是实体对间一系列文本特征的集合。</p>
<p>而后我们定义特征提取函数得到各种 POS&#x2F;NER&#x2F;次序列的窗口特征等。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> extract_play_features <span class="keyword">over</span> (</span><br><span class="line">    p1_id          <span class="type">text</span>,     </span><br><span class="line">    p2_id          <span class="type">text</span>,     </span><br><span class="line">    p1_begin_index <span class="type">int</span>,      </span><br><span class="line">    p1_end_index   <span class="type">int</span>,      </span><br><span class="line">    p2_begin_index <span class="type">int</span>,      </span><br><span class="line">    p2_end_index   <span class="type">int</span>,      </span><br><span class="line">    doc_id         <span class="type">text</span>,     </span><br><span class="line">    sent_index     <span class="type">int</span>,    </span><br><span class="line">    tokens         <span class="type">text</span>[],   </span><br><span class="line">    lemmas         <span class="type">text</span>[],   </span><br><span class="line">    pos_tags       <span class="type">text</span>[], </span><br><span class="line">    ner_tags       <span class="type">text</span>[], </span><br><span class="line">    dep_types      <span class="type">text</span>[], </span><br><span class="line">    dep_tokens     <span class="type">int</span>[]   </span><br><span class="line">) <span class="keyword">returns</span> <span class="keyword">rows</span> <span class="keyword">like</span> play_feature</span><br><span class="line">implementation &quot;udf/extract_play_features.py&quot; handles tsv lines.</span><br></pre></td></tr></table></figure>

<p>而后调用该函数：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">play_feature += extract_play_features(</span><br><span class="line">p1_id, p2_id, p1_begin_index, p1_end_index, p2_begin_index, p2_end_index,</span><br><span class="line">doc_id, sent_index, tokens, lemmas, pos_tags, ner_tags, dep_types, dep_tokens</span><br><span class="line">)<span class="keyword"> :</span>-                       </span><br><span class="line">    actor_mention(p1_id, _, doc_id, sent_index, p1_begin_index, p1_end_index),</span><br><span class="line">    movie_mention(p2_id, _, doc_id, sent_index, p2_begin_index, p2_end_index),</span><br><span class="line">    sentences(doc_id, sent_index, _, tokens, lemmas, pos_tags, ner_tags, _, dep_types, dep_tokens).</span><br></pre></td></tr></table></figure>

<p>编译并执行：</p>
<p>预告：运行很慢，耐心等待……</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# <span class="built_in">chmod</span> 777 udf/extract_play_features.py</span><br><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive compile &amp;&amp; deepdive <span class="keyword">do</span> play_feature</span><br></pre></td></tr></table></figure>

<p>查询看一下特征：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">root</span><span class="operator">@</span><span class="variable">ubuntu</span><span class="operator">-</span><span class="variable">mmm</span><span class="operator">:/</span><span class="variable">usr</span><span class="operator">/</span><span class="variable">local</span><span class="operator">/</span><span class="variable">CNdeepdive</span><span class="operator">/</span><span class="variable">transaction2</span><span class="type">#</span> <span class="variable">deepdive</span> <span class="variable">query</span> <span class="operator">&#x27;|</span> <span class="number">5</span> <span class="operator">?-</span> <span class="type">play_feature</span><span class="punctuation">(</span><span class="type">_</span><span class="operator">,</span> <span class="type">_</span><span class="operator">,</span> <span class="variable">feature</span><span class="punctuation">)</span><span class="operator">.&#x27;</span></span><br><span class="line"></span><br><span class="line"> <span class="type">IS_INVERTED</span></span><br><span class="line"> <span class="type">INV_WORD</span><span class="type">_SEQ</span><span class="type">_</span><span class="punctuation">[</span>》 是 <span class="number">2006</span>年 上映 的 一 部 宫廷 悲剧 电影 ， 该 片 根据 莎士比亚 名剧 《 哈姆雷特 》 改编 ， 由 冯小刚 导演 ， 主要 演员 有 章子怡 、 葛优 、 吴彦祖 、<span class="punctuation">]</span></span><br><span class="line"> <span class="type">INV_LEMMA</span><span class="type">_SEQ</span><span class="type">_</span><span class="punctuation">[</span>》 是 <span class="number">2006</span>年 上映 的 一 部 宫廷 悲剧 电影 ， 该 片 根据 莎士比亚 名剧 《 哈姆雷特 》 改编 ， 由 冯小刚 导演 ， 主要 演员 有 章子怡 、 葛优 、 吴彦祖 、<span class="punctuation">]</span></span><br><span class="line"> <span class="type">INV_NER</span><span class="type">_SEQ</span><span class="type">_</span><span class="punctuation">[</span><span class="built_in">O</span> <span class="built_in">O</span> <span class="variable">MISC</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="variable">MISC</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="variable">PERSON</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="built_in">O</span> <span class="variable">PERSON</span> <span class="built_in">O</span> <span class="variable">PERSON</span> <span class="built_in">O</span> <span class="variable">PERSON</span> <span class="built_in">O</span><span class="punctuation">]</span></span><br><span class="line"> <span class="type">INV_POS</span><span class="type">_SEQ</span><span class="type">_</span><span class="punctuation">[</span><span class="variable">PU</span> <span class="variable">VC</span> <span class="variable">NT</span> <span class="variable">VV</span> <span class="variable">DEC</span> <span class="variable">CD</span> <span class="variable">M</span> <span class="variable">NN</span> <span class="variable">NN</span> <span class="variable">NN</span> <span class="variable">PU</span> <span class="variable">DT</span> <span class="variable">NN</span> <span class="variable">P</span> <span class="variable">NR</span> <span class="variable">NN</span> <span class="variable">PU</span> <span class="variable">NR</span> <span class="variable">PU</span> <span class="variable">VV</span> <span class="variable">PU</span> <span class="variable">P</span> <span class="variable">NR</span> <span class="variable">NN</span> <span class="variable">PU</span> <span class="variable">JJ</span> <span class="variable">NN</span> <span class="variable">VE</span> <span class="variable">NR</span> <span class="variable">PU</span> <span class="variable">NR</span> <span class="variable">PU</span> <span class="variable">NR</span> <span class="variable">PU</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">(</span><span class="number">5</span> <span class="variable">rows</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h2 id="12-有监督数据处理"><a href="#12-有监督数据处理" class="headerlink" title="12. 有监督数据处理"></a>12. 有监督数据处理</h2><p> 首先在 app.ddlog 中定义 play_label 表存放有监督数据： </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@extraction</span>             </span><br><span class="line"><span class="built_in">play_label</span>(             </span><br><span class="line">    <span class="variable">@key</span>                </span><br><span class="line">    <span class="variable">@references</span>(relation=<span class="string">&quot;has_play&quot;</span>, column=<span class="string">&quot;p1_id&quot;</span>, alias=<span class="string">&quot;has_play&quot;</span>)</span><br><span class="line">    p1_id text,         </span><br><span class="line">    <span class="variable">@key</span>                </span><br><span class="line">    <span class="variable">@references</span>(relation=<span class="string">&quot;has_play&quot;</span>, column=<span class="string">&quot;p2_id&quot;</span>, alias=<span class="string">&quot;has_play&quot;</span>)</span><br><span class="line">    p2_id text,         </span><br><span class="line">    <span class="variable">@navigable</span>          </span><br><span class="line">    label int,          </span><br><span class="line">    <span class="variable">@navigable</span>          </span><br><span class="line">    rule_id text        </span><br><span class="line">). </span><br></pre></td></tr></table></figure>

<p>rule_id 表示相关性的规则名称，label 为正值表示正相关，负值表示负相关。绝对值越大，相关性越大。</p>
<p>初始化定义，复制 play_candidate 表，label 初始化为0，rule_id 为 NULL：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">paly_label</span>(<span class="built_in">p1</span>, <span class="built_in">p2</span>, <span class="number">0</span>, NULL) :- play_candidate(<span class="built_in">p1</span>, _, <span class="built_in">p2</span>, _).</span><br></pre></td></tr></table></figure>

<p>接下来将最开始导入的有监督数据表 actor_movie_dbdata 导入到 play_label 中，并赋予权重3：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">play_label</span>(p1, p2, <span class="number">3</span>, &quot;from_dbdata&quot;) :-</span><br><span class="line">    <span class="built_in">play_candidate</span>(p1, p1_name, p2, p2_name),</span><br><span class="line">    <span class="built_in">actor_movie_dbdata</span>(n1, n2),</span><br><span class="line">    [<span class="built_in">lower</span>(n1) = <span class="built_in">lower</span>(p1_name), <span class="built_in">lower</span>(n2) = <span class="built_in">lower</span>(p2_name)].</span><br></pre></td></tr></table></figure>

<h2 id="13-预标记"><a href="#13-预标记" class="headerlink" title="13. 预标记"></a>13. 预标记</h2><p>接下来定义一些逻辑规则对文本进行预标记：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> supervise <span class="keyword">over</span> (      </span><br><span class="line">    p1_id <span class="type">text</span>, p1_begin <span class="type">int</span>, p1_end <span class="type">int</span>,</span><br><span class="line">    p2_id <span class="type">text</span>, p2_begin <span class="type">int</span>, p2_end <span class="type">int</span>,</span><br><span class="line">    doc_id <span class="type">text</span>,               </span><br><span class="line">    doc_id <span class="type">text</span>,               </span><br><span class="line">    sentence_index <span class="type">int</span>,        </span><br><span class="line">    sentence_text <span class="type">text</span>,        </span><br><span class="line">    tokens <span class="type">text</span>[],             </span><br><span class="line">    lemmas <span class="type">text</span>[],             </span><br><span class="line">    pos_tags <span class="type">text</span>[],           </span><br><span class="line">    ner_tags <span class="type">text</span>[],           </span><br><span class="line">    dep_types <span class="type">text</span>[],          </span><br><span class="line">    dep_tokens <span class="type">int</span>[]           </span><br><span class="line">) <span class="keyword">returns</span> (p1_id <span class="type">text</span>, p2_id <span class="type">text</span>, label <span class="type">int</span>, rule_id <span class="type">text</span>)</span><br><span class="line">implementation &quot;udf/supervise_play.py&quot; handles tsv lines.</span><br></pre></td></tr></table></figure>

<p>程序 udf&#x2F;supervise_play.py 里通过一些指定的规则如 出演这种特征来进行预标记。给出label和rule_id的值。</p>
<p>接下来调用标记函数，将规则抽到的数据写到play_label 表中：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">play_label += supervise(</span><br><span class="line">    p1_id, p1_begin, p1_end,</span><br><span class="line">    p2_id, p2_begin, p2_end,</span><br><span class="line">    doc_id, sentence_index, sentence_text,</span><br><span class="line">    tokens, lemmas, pos_tags, ner_tags, dep_types, dep_tokens_indexes</span><br><span class="line">    )<span class="keyword"> :</span>-</span><br><span class="line">    play_candidate(p1_id, _, p2_id, _),</span><br><span class="line">    actor_mention(p1_id, p1_text, doc_id, sentence_index, p1_begin, p1_end),</span><br><span class="line">    movie_mention(p2_id, p2_text, _, _, p2_begin, p2_end),</span><br><span class="line">    sentences(  doc_id, sentence_index, sentence_text,</span><br><span class="line">                tokens, lemmas, pos_tags, ner_tags, _, dep_types, dep_tokens_indexes</span><br><span class="line">    ).</span><br></pre></td></tr></table></figure>

<p>由于不同的规则可能覆盖了相同的实体对，因此利用 vote方法进行综合给出最终标记：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">play_label_resolved(p1_id, p2_id, SUM(vote))<span class="keyword"> :</span>-</span><br><span class="line">    play_label(p1_id, p2_id, vote, rule_id).</span><br></pre></td></tr></table></figure>

<p>最后编译并执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# <span class="built_in">chmod</span> 777 udf/supervise_play.py</span><br><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive compile &amp;&amp; deepdive <span class="keyword">do</span> play_label_resolved</span><br></pre></td></tr></table></figure>

<h2 id="14-变量表定义"><a href="#14-变量表定义" class="headerlink" title="14. 变量表定义"></a>14. 变量表定义</h2><p>首先定义最终存储的表格，[?]表示此表是用户模式下的变量表，即需要推到关系的表。这里我们需要推到的是演员和电影间是否存在演出关系。</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@extraction</span><br><span class="line">has_play?(</span><br><span class="line">    p1_id <span class="keyword">text</span>,</span><br><span class="line">    p2_id <span class="keyword">text</span></span><br><span class="line">). </span><br></pre></td></tr></table></figure>

<p>根据打标结果，写入已知的变量：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">has_play(p1_id, p2_id) = <span class="keyword">if</span> l &gt; <span class="number">0</span> <span class="keyword">then</span> <span class="literal">TRUE</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> l &lt; <span class="number">0</span> <span class="keyword">then</span> <span class="literal">FALSE</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="literal">NULL</span> <span class="function"><span class="keyword">end</span> :-</span></span><br><span class="line">                    play_label_resolved(p1_id, p2_id, l).</span><br></pre></td></tr></table></figure>

<p>此时表中部分变量的label 已知，成为了先验变量。编译并执行：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2# deepdive <span class="keyword">compile</span> &amp;&amp; deepdive <span class="keyword">do</span> has_play</span><br></pre></td></tr></table></figure>

<h2 id="15-构建因子图"><a href="#15-构建因子图" class="headerlink" title="15. 构建因子图"></a>15. 构建因子图</h2><p>指定特征：</p>
<p>将每一对 has_play 中的实体对和特征表连接起来，通过特征因子连接，全局学习这些特征的权重 f</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@weight(f)</span><br><span class="line">has_play(p1_id, p2_id)<span class="keyword"> :</span>-</span><br><span class="line">    play_candidate(p1_id, _, p2_id, _),</span><br><span class="line">    play_feature(p1_id, p2_id, f).</span><br></pre></td></tr></table></figure>

<p>编译并生成最终的概率模型：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:<span class="regexp">/usr/</span>local<span class="regexp">/CNdeepdive/</span>transaction2# deepdive <span class="keyword">compile</span> &amp;&amp; deepdive <span class="keyword">do</span> probabilities</span><br></pre></td></tr></table></figure>

<p>就完成了我们的推断，现在查询我们预测的演员-电影间的交易关系概率：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root<span class="meta">@ubuntu-mmm:/usr/local/CNdeepdive/transaction2#</span> deepdive sql <span class="string">&quot;SELECT p1_id, p2_id, expectation FROM has_play_label_inference ORDER BY random() LIMIT 5&quot;</span></span><br><span class="line"> </span><br><span class="line">   p1_id    |<span class="string">   p2_id    </span>|<span class="string"> expectation </span></span><br><span class="line"><span class="string">------------+------------+-------------</span></span><br><span class="line"><span class="string"> 6_38_20_20 </span>|<span class="string"> 6_38_44_44 </span>|<span class="string">       0.926</span></span><br><span class="line"><span class="string"> 0_30_36_36 </span>|<span class="string"> 0_30_57_57 </span>|<span class="string">       0.082</span></span><br><span class="line"><span class="string"> 0_39_83_83 </span>|<span class="string"> 0_39_94_95 </span>|<span class="string">       0.214</span></span><br><span class="line"><span class="string"> 6_21_7_8   </span>|<span class="string"> 6_21_43_43 </span>|<span class="string">       0.003</span></span><br><span class="line"><span class="string"> 5_66_0_0   </span>|<span class="string"> 5_66_20_21 </span>|<span class="string">       0.008</span></span><br><span class="line"><span class="string">(5 rows)</span></span><br></pre></td></tr></table></figure>

<p>至此，使用deepdive 抽取非结构文本的演员-电影关系实战完成。</p>
<p>待续……</p>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2019/10/100604.html" class="pre-post btn btn-default" title='windows系统安装JDK'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">windows系统安装JDK</span>
        </a>
    
    
        <a href="/archives/2019/09/100587.html" class="next-post btn btn-default" title='百度文库文档免费下载（原文档下载,可编辑）'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">百度文库文档免费下载（原文档下载,可编辑）</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>


    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E5%8D%8A%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-text">一. 半结构化数据的获取</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-mysql"><span class="toc-text">1. mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Python"><span class="toc-text">2. Python</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-IDE%EF%BC%88PyCharm%EF%BC%89"><span class="toc-text">3. IDE（PyCharm）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Scrapy"><span class="toc-text">4. Scrapy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85wheel"><span class="toc-text">安装wheel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E9%80%94%EF%BC%9A"><span class="toc-text">用途：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-text">安装命令：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85lxml"><span class="toc-text">安装lxml</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E9%80%94%EF%BC%9A-1"><span class="toc-text">用途：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4%EF%BC%9A-1"><span class="toc-text">安装命令：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E4%B8%80-%E5%9C%A8%E7%BA%BF-%EF%BC%9A"><span class="toc-text">安装方式一(在线)：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%88%E7%A6%BB%E7%BA%BF-%EF%BC%9A"><span class="toc-text">安装方式二（离线)：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85zope-interface"><span class="toc-text">安装zope.interface</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E9%80%94%EF%BC%9A-2"><span class="toc-text">用途：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4%EF%BC%9A-2"><span class="toc-text">安装命令：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85pyOpenSSL"><span class="toc-text">安装pyOpenSSL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E9%80%94%EF%BC%9A-3"><span class="toc-text">用途：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4%EF%BC%9A-3"><span class="toc-text">安装命令：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Twisted"><span class="toc-text">安装Twisted</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E9%80%94%EF%BC%9A-4"><span class="toc-text">用途：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4%EF%BC%9A-4"><span class="toc-text">安装命令：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85pywin32"><span class="toc-text">安装pywin32</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E9%80%94%EF%BC%9A-5"><span class="toc-text">用途：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4%EF%BC%9A-5"><span class="toc-text">安装命令：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Scrapy"><span class="toc-text">安装Scrapy</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4%EF%BC%9A-6"><span class="toc-text">安装命令：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">可能出现的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7%EF%BC%8C%E5%BF%AB%E9%80%9F%E8%A7%A3%E5%86%B3%E7%B3%BB%E5%88%97%EF%BC%9AAnaconda"><span class="toc-text">使用工具，快速解决系列：Anaconda</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F"><span class="toc-text">验证安装是否成功</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A"><span class="toc-text">方法一：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A"><span class="toc-text">方法二：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-text">文件的功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">基本使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%B0-NTriples-%E4%BB%A5%E5%8F%8A%E9%80%9A%E8%BF%87Apache-jena-%E8%AE%BF%E9%97%AENT"><span class="toc-text">二. 数据库到 NTriples 以及通过Apache jena 访问NT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Protege"><span class="toc-text">1. Protege</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-d2rq"><span class="toc-text">2. d2rq</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Apache-jena"><span class="toc-text">3. Apache jena</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-1"><span class="toc-text">基本使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-%E5%9F%BA%E4%BA%8EREfO%E7%9A%84%E7%AE%80%E5%8D%95%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94"><span class="toc-text">三. 基于REfO的简单知识问答</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B-%E5%9F%BA%E4%BA%8EElasticSearch%E7%9A%84%E7%AE%80%E5%8D%95%E8%AF%AD%E4%B9%89%E6%90%9C%E7%B4%A2"><span class="toc-text">四. 基于ElasticSearch的简单语义搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85"><span class="toc-text">1. 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81"><span class="toc-text">2. 修改代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%BF%90%E8%A1%8C"><span class="toc-text">3. 运行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%B0JSON"><span class="toc-text">1）数据库到JSON</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%BB%BA%E7%AB%8B%E5%B1%9E%E6%80%A7%E9%97%B4%E6%98%A0%E5%B0%84"><span class="toc-text">2）建立属性间映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E8%8E%B7%E5%8F%96%E5%B1%9E%E6%80%A7%E5%80%BC%E5%92%8C%E5%B1%9E%E6%80%A7%E9%97%B4%E7%9A%84%E6%98%A0%E5%B0%84"><span class="toc-text">3）获取属性值和属性间的映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E5%9C%A8-elasticsearch-%E4%B8%AD%E6%96%B0%E5%BB%BA-index-%E5%92%8C-type"><span class="toc-text">4）在 elasticsearch 中新建 index 和 type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%89%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5"><span class="toc-text">5）数据导入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%89%E6%A3%80%E7%B4%A2%E7%9F%A5%E8%AF%86%E5%BA%93"><span class="toc-text">6）检索知识库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94-Deepdive%E6%8A%BD%E5%8F%96%E6%BC%94%E5%91%98-%E7%94%B5%E5%BD%B1%E9%97%B4%E5%85%B3%E7%B3%BB"><span class="toc-text">五. Deepdive抽取演员-电影间关系</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85JDK"><span class="toc-text">1. 安装JDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85Deepdive"><span class="toc-text">2. 安装Deepdive</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%BB%BA%E7%AB%8Bpostgresql%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93movie"><span class="toc-text">3. 建立postgresql的数据库movie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA"><span class="toc-text">4. 项目框架搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81"><span class="toc-text">5. 修改代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%85%88%E9%AA%8C%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5"><span class="toc-text">6. 先验数据导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%BE%85%E6%8A%BD%E5%8F%96%E6%96%87%E7%AB%A0%E7%9A%84%E5%AF%BC%E5%85%A5"><span class="toc-text">7. 待抽取文章的导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E7%94%A8-stanford-nlp-%E6%A8%A1%E5%9D%97%E8%BF%9B%E8%A1%8C%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86"><span class="toc-text">8. 用 stanford_nlp 模块进行文本处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%80%99%E9%80%89%E5%AE%9E%E4%BD%93%E7%9A%84%E7%94%9F%E6%88%90"><span class="toc-text">9.候选实体的生成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E7%94%9F%E6%88%90%E5%80%99%E9%80%89%E5%AE%9E%E4%BD%93%E5%AF%B9"><span class="toc-text">10. 生成候选实体对</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E7%89%B9%E5%BE%81%E6%8A%BD%E5%8F%96"><span class="toc-text">11. 特征抽取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E6%9C%89%E7%9B%91%E7%9D%A3%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-text">12. 有监督数据处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E9%A2%84%E6%A0%87%E8%AE%B0"><span class="toc-text">13. 预标记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E5%8F%98%E9%87%8F%E8%A1%A8%E5%AE%9A%E4%B9%89"><span class="toc-text">14. 变量表定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E6%9E%84%E5%BB%BA%E5%9B%A0%E5%AD%90%E5%9B%BE"><span class="toc-text">15. 构建因子图</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2025&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>








<script src="/js/app.js?rev=@@hash.js"></script>


</body>
</html>