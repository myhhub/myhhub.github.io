<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="hadoop,scala">


    <meta name="description" content="一、隐式转换1.1 使用隐式转换隐式转换指的是以implicit关键字声明带有单个参数的转换函数，它将值从一种类型转换为另一种类型，以便使用之前类型所没有的功能。示例如下：
1234567891...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>Scala隐式转换和隐式参数 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Scala隐式转换和隐式参数">
            
	            Scala隐式转换和隐式参数
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/back/">后端</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/hadoop/">hadoop</a> <a class="tag-link" href="/tags/scala/">scala</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/07/18</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1679</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <h2 id="一、隐式转换"><a href="#一、隐式转换" class="headerlink" title="一、隐式转换"></a>一、隐式转换</h2><h3 id="1-1-使用隐式转换"><a href="#1-1-使用隐式转换" class="headerlink" title="1.1 使用隐式转换"></a>1.1 使用隐式转换</h3><p>隐式转换指的是以<code>implicit</code>关键字声明带有单个参数的转换函数，它将值从一种类型转换为另一种类型，以便使用之前类型所没有的功能。示例如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通人</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">val name: <span class="type">String</span></span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">//</span> <span class="title">雷神</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">Thor</span>(<span class="params">val name: <span class="type">String</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 正常情况下只有雷神才能举起雷神之锤</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">hammer</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(name + <span class="string">"举起雷神之锤"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Thor</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 定义隐式转换方法 将普通人转换为雷神 通常建议方法名使用source2Target,即：被转换对象To转换对象</span></span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">person2Thor</span></span>(p: <span class="type">Person</span>): <span class="type">Thor</span> = <span class="keyword">new</span> <span class="type">Thor</span>(p.name)</span><br><span class="line">  <span class="comment">// 这样普通人也能举起雷神之锤</span></span><br><span class="line">  <span class="keyword">new</span> <span class="type">Person</span>(<span class="string">"普通人"</span>).hammer()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出： 普通人举起雷神之锤</span><br></pre></td></tr></table></figure>
<h3 id="1-2-隐式转换规则"><a href="#1-2-隐式转换规则" class="headerlink" title="1.2 隐式转换规则"></a>1.2 隐式转换规则</h3><p>并不是你使用<code>implicit</code>转换后，隐式转换就一定会发生，比如上面如果不调用<code>hammer()</code>方法的时候，普通人就还是普通人。通常程序会在以下情况下尝试执行隐式转换：</p>
<ul>
<li>当对象访问一个不存在的成员时，即调用的方法不存在或者访问的成员变量不存在；</li>
<li>当对象调用某个方法，该方法存在，但是方法的声明参数与传入参数不匹配时。</li>
</ul>
<p>而在以下三种情况下编译器不会尝试执行隐式转换：</p>
<ul>
<li>如果代码能够在不使用隐式转换的前提下通过编译，则不会使用隐式转换；</li>
<li>编译器不会尝试同时执行多个转换，比如<code>convert1(convert2(a))*b</code>；</li>
<li>转换存在二义性，也不会发生转换。</li>
</ul>
<p>这里首先解释一下二义性，上面的代码进行如下修改，由于两个隐式转换都是生效的，所以就存在了二义性：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//两个隐式转换都是有效的</span></span><br><span class="line"><span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">person2Thor</span></span>(p: <span class="type">Person</span>): <span class="type">Thor</span> = <span class="keyword">new</span> <span class="type">Thor</span>(p.name)</span><br><span class="line"><span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">person2Thor2</span></span>(p: <span class="type">Person</span>): <span class="type">Thor</span> = <span class="keyword">new</span> <span class="type">Thor</span>(p.name)</span><br><span class="line"><span class="comment">// 此时下面这段语句无法通过编译</span></span><br><span class="line"><span class="keyword">new</span> <span class="type">Person</span>(<span class="string">"普通人"</span>).hammer()</span><br></pre></td></tr></table></figure>
<p>其次再解释一下多个转换的问题：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassA</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">toString</span> </span>= <span class="string">"This is Class A"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassB</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">toString</span> </span>= <span class="string">"This is Class B"</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">printB</span></span>(b: <span class="type">ClassB</span>): <span class="type">Unit</span> = println(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassC</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">ClassD</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">object</span> <span class="title">ImplicitTest</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">A2B</span></span>(a: <span class="type">ClassA</span>): <span class="type">ClassB</span> = &#123;</span><br><span class="line">    println(<span class="string">"A2B"</span>)</span><br><span class="line">    <span class="keyword">new</span> <span class="type">ClassB</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">C2B</span></span>(c: <span class="type">ClassC</span>): <span class="type">ClassB</span> = &#123;</span><br><span class="line">    println(<span class="string">"C2B"</span>)</span><br><span class="line">    <span class="keyword">new</span> <span class="type">ClassB</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">D2C</span></span>(d: <span class="type">ClassD</span>): <span class="type">ClassC</span> = &#123;</span><br><span class="line">    println(<span class="string">"D2C"</span>)</span><br><span class="line">    <span class="keyword">new</span> <span class="type">ClassC</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这行代码无法通过编译，因为要调用到printB方法，需要执行两次转换C2B(D2C(ClassD))</span></span><br><span class="line">  <span class="keyword">new</span> <span class="type">ClassD</span>().printB(<span class="keyword">new</span> <span class="type">ClassA</span>)</span><br><span class="line">    </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   *  下面的这一行代码虽然也进行了两次隐式转换，但是两次的转换对象并不是一个对象,所以它是生效的:</span></span><br><span class="line"><span class="comment">   *  转换流程如下:</span></span><br><span class="line"><span class="comment">   *  1. ClassC中并没有printB方法,因此隐式转换为ClassB,然后调用printB方法;</span></span><br><span class="line"><span class="comment">   *  2. 但是printB参数类型为ClassB,然而传入的参数类型是ClassA,所以需要将参数ClassA转换为ClassB,这是第二次;</span></span><br><span class="line"><span class="comment">   *  即: C2B(ClassC) -&gt; ClassB.printB(ClassA) -&gt; ClassB.printB(A2B(ClassA)) -&gt; ClassB.printB(ClassB)</span></span><br><span class="line"><span class="comment">   *  转换过程1的对象是ClassC,而转换过程2的转换对象是ClassA,所以虽然是一行代码两次转换，但是仍然是有效转换</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">new</span> <span class="type">ClassC</span>().printB(<span class="keyword">new</span> <span class="type">ClassA</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="type">C2B</span></span><br><span class="line"><span class="type">A2B</span></span><br><span class="line"><span class="type">This</span> is <span class="type">Class</span> <span class="type">B</span></span><br></pre></td></tr></table></figure>
<h3 id="1-3-引入隐式转换"><a href="#1-3-引入隐式转换" class="headerlink" title="1.3 引入隐式转换"></a>1.3 引入隐式转换</h3><p>隐式转换的可以定义在以下三个地方：</p>
<ul>
<li>定义在原类型的伴生对象中；</li>
<li>直接定义在执行代码的上下文作用域中；</li>
<li>统一定义在一个文件中，在使用时候导入。</li>
</ul>
<p>上面我们使用的方法相当于直接定义在执行代码的作用域中，下面分别给出其他两种定义的代码示例：</p>
<p><strong>定义在原类型的伴生对象中</strong>：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">val name: <span class="type">String</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">//</span> <span class="title">在伴生对象中定义隐式转换函数</span></span></span><br><span class="line"><span class="class"><span class="title">object</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">person2Thor</span></span>(p: <span class="type">Person</span>): <span class="type">Thor</span> = <span class="keyword">new</span> <span class="type">Thor</span>(p.name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thor</span>(<span class="params">val name: <span class="type">String</span></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">hammer</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(name + <span class="string">"举起雷神之锤"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ScalaApp</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  <span class="keyword">new</span> <span class="type">Person</span>(<span class="string">"普通人"</span>).hammer()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>定义在一个公共的对象中</strong>：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Convert</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">person2Thor</span></span>(p: <span class="type">Person</span>): <span class="type">Thor</span> = <span class="keyword">new</span> <span class="type">Thor</span>(p.name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入Convert下所有的隐式转换函数</span></span><br><span class="line"><span class="keyword">import</span> com.myhhub.<span class="type">Convert</span>._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ScalaApp</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  <span class="keyword">new</span> <span class="type">Person</span>(<span class="string">"普通人"</span>).hammer()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：Scala自身的隐式转换函数大部分定义在<code>Predef.scala</code>中，你可以打开源文件查看，也可以在Scala交互式命令行中采用<code>:implicit -v</code>查看全部隐式转换函数。</p>
</blockquote>
<p><br></p>
<h2 id="二、隐式参数"><a href="#二、隐式参数" class="headerlink" title="二、隐式参数"></a>二、隐式参数</h2><h3 id="2-1-使用隐式参数"><a href="#2-1-使用隐式参数" class="headerlink" title="2.1 使用隐式参数"></a>2.1 使用隐式参数</h3><p>在定义函数或方法时可以使用标记为<code>implicit</code>的参数，这种情况下，编译器将会查找默认值，提供给函数调用。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义分隔符类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Delimiters</span>(<span class="params">val left: <span class="type">String</span>, val right: <span class="type">String</span></span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">object</span> <span class="title">ScalaApp</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 进行格式化输出</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">formatted</span></span>(context: <span class="type">String</span>)(<span class="keyword">implicit</span> deli: <span class="type">Delimiters</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(deli.left + context + deli.right)</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 定义一个隐式默认值 使用左右中括号作为分隔符</span></span><br><span class="line">  <span class="keyword">implicit</span> <span class="keyword">val</span> bracket = <span class="keyword">new</span> <span class="type">Delimiters</span>(<span class="string">"("</span>, <span class="string">")"</span>)</span><br><span class="line">  formatted(<span class="string">"this is context"</span>) <span class="comment">// 输出: (this is context)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于隐式参数，有两点需要注意：</p>
<p>1.我们上面定义<code>formatted</code>函数的时候使用了柯里化，如果你不使用柯里化表达式，按照通常习惯只有下面两种写法：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这种写法没有语法错误，但是无法通过编译</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">formatted</span></span>(<span class="keyword">implicit</span> context: <span class="type">String</span>, deli: <span class="type">Delimiters</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">  println(deli.left + context + deli.right)</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 不存在这种写法，IDEA直接会直接提示语法错误</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">formatted</span></span>( context: <span class="type">String</span>,  <span class="keyword">implicit</span> deli: <span class="type">Delimiters</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">  println(deli.left + context + deli.right)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面第一种写法编译的时候会出现下面所示<code>error</code>信息,从中也可以看出<code>implicit</code>是作用于参数列表中每个参数的，这显然不是我们想要到达的效果，所以上面的写法采用了柯里化。</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">not enough arguments for method <span class="keyword">formatted</span>: </span><br><span class="line">(<span class="keyword">implicit</span> context: String, <span class="keyword">implicit</span> deli: com.myhhub.Delimiters)</span><br></pre></td></tr></table></figure>
<p>2.第二个问题和隐式函数一样，隐式默认值不能存在二义性，否则无法通过编译，示例如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">implicit</span> <span class="keyword">val</span> bracket = <span class="keyword">new</span> <span class="type">Delimiters</span>(<span class="string">"("</span>, <span class="string">")"</span>)</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">val</span> brace = <span class="keyword">new</span> <span class="type">Delimiters</span>(<span class="string">"&#123;"</span>, <span class="string">"&#125;"</span>)</span><br><span class="line">formatted(<span class="string">"this is context"</span>)</span><br></pre></td></tr></table></figure>
<p>上面代码无法通过编译，出现错误提示<code>ambiguous implicit values</code>，即隐式值存在冲突。</p>
<h3 id="2-2-引入隐式参数"><a href="#2-2-引入隐式参数" class="headerlink" title="2.2 引入隐式参数"></a>2.2 引入隐式参数</h3><p>引入隐式参数和引入隐式转换函数方法是一样的，有以下三种方式：</p>
<ul>
<li>定义在隐式参数对应类的伴生对象中；</li>
<li>直接定义在执行代码的上下文作用域中；</li>
<li>统一定义在一个文件中，在使用时候导入。</li>
</ul>
<p>我们上面示例程序相当于直接定义执行代码的上下文作用域中，下面给出其他两种方式的示例：</p>
<p><strong>定义在隐式参数对应类的伴生对象中</strong>；</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Delimiters</span>(<span class="params">val left: <span class="type">String</span>, val right: <span class="type">String</span></span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">object</span> <span class="title">Delimiters</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="keyword">val</span> bracket = <span class="keyword">new</span> <span class="type">Delimiters</span>(<span class="string">"("</span>, <span class="string">")"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此时执行代码的上下文中不用定义</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ScalaApp</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">formatted</span></span>(context: <span class="type">String</span>)(<span class="keyword">implicit</span> deli: <span class="type">Delimiters</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(deli.left + context + deli.right)</span><br><span class="line">  &#125;</span><br><span class="line">  formatted(<span class="string">"this is context"</span>) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>统一定义在一个文件中，在使用时候导入</strong>：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Convert</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="keyword">val</span> bracket = <span class="keyword">new</span> <span class="type">Delimiters</span>(<span class="string">"("</span>, <span class="string">")"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在使用的时候导入</span></span><br><span class="line"><span class="keyword">import</span> com.myhhub.<span class="type">Convert</span>.bracket</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ScalaApp</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">formatted</span></span>(context: <span class="type">String</span>)(<span class="keyword">implicit</span> deli: <span class="type">Delimiters</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(deli.left + context + deli.right)</span><br><span class="line">  &#125;</span><br><span class="line">  formatted(<span class="string">"this is context"</span>) <span class="comment">// 输出: (this is context)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-利用隐式参数进行隐式转换"><a href="#2-3-利用隐式参数进行隐式转换" class="headerlink" title="2.3 利用隐式参数进行隐式转换"></a>2.3 利用隐式参数进行隐式转换</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">smaller</span></span>[<span class="type">T</span>] (a: <span class="type">T</span>, b: <span class="type">T</span>) = <span class="keyword">if</span> (a &lt; b) a <span class="keyword">else</span> b</span><br></pre></td></tr></table></figure>
<p>在Scala中如果定义了一个如上所示的比较对象大小的泛型方法，你会发现无法通过编译。对于对象之间进行大小比较，Scala和Java一样，都要求被比较的对象需要实现java.lang.Comparable接口。在Scala中，直接继承Java中Comparable接口的是特质Ordered，它在继承compareTo方法的基础上，额外定义了关系符方法，源码如下:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Ordered</span>[<span class="type">A</span>] <span class="keyword">extends</span> <span class="title">Any</span> <span class="keyword">with</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Comparable</span>[<span class="type">A</span>] </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">compare</span></span>(that: <span class="type">A</span>): <span class="type">Int</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">&lt;</span>  </span>(that: <span class="type">A</span>): <span class="type">Boolean</span> = (<span class="keyword">this</span> compare that) &lt;  <span class="number">0</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">&gt;</span>  </span>(that: <span class="type">A</span>): <span class="type">Boolean</span> = (<span class="keyword">this</span> compare that) &gt;  <span class="number">0</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">&lt;=</span> </span>(that: <span class="type">A</span>): <span class="type">Boolean</span> = (<span class="keyword">this</span> compare that) &lt;= <span class="number">0</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">&gt;=</span> </span>(that: <span class="type">A</span>): <span class="type">Boolean</span> = (<span class="keyword">this</span> compare that) &gt;= <span class="number">0</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">compareTo</span></span>(that: <span class="type">A</span>): <span class="type">Int</span> = compare(that)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以要想在泛型中解决这个问题，有两种方法：</p>
<h4 id="1-使用视图界定"><a href="#1-使用视图界定" class="headerlink" title="1. 使用视图界定"></a>1. 使用视图界定</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Pair</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 视图界定</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">smaller</span></span>[<span class="type">T</span>&lt;% <span class="type">Ordered</span>[<span class="type">T</span>]](a: <span class="type">T</span>, b: <span class="type">T</span>) = <span class="keyword">if</span> (a &lt; b) a <span class="keyword">else</span> b</span><br><span class="line"> </span><br><span class="line">  println(smaller(<span class="number">1</span>,<span class="number">2</span>)) <span class="comment">//输出 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>视图限定限制了T可以通过隐式转换<code>Ordered[T]</code>，即对象一定可以进行大小比较。在上面的代码中<code>smaller(1,2)</code>中参数<code>1</code>和<code>2</code>实际上是通过定义在<code>Predef</code>中的隐式转换方法<code>intWrapper</code>转换为<code>RichInt</code>。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Predef.scala</span></span><br><span class="line"><span class="meta">@inline</span> <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">intWrapper</span></span>(x: <span class="type">Int</span>)   = <span class="keyword">new</span> runtime.<span class="type">RichInt</span>(x)</span><br></pre></td></tr></table></figure>
<p>为什么要这么麻烦执行隐式转换，原因是Scala中的Int类型并不能直接进行比较，因为其没有实现<code>Ordered</code>特质，真正实现<code>Ordered</code>特质的是<code>RichInt</code>。</p>
<div align="center"> <img src="/img/bigdata/scala-richInt.png"> </div>



<h4 id="2-利用隐式参数进行隐式转换"><a href="#2-利用隐式参数进行隐式转换" class="headerlink" title="2. 利用隐式参数进行隐式转换"></a>2. 利用隐式参数进行隐式转换</h4><p>Scala2.11+后，视图界定被标识为废弃，官方推荐使用类型限定来解决上面的问题，本质上就是使用隐式参数进行隐式转换。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Pair</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// order既是一个隐式参数也是一个隐式转换，即如果a不存在 &lt; 方法，则转换为order(a)&lt;b</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">smaller</span></span>[<span class="type">T</span>](a: <span class="type">T</span>, b: <span class="type">T</span>)(<span class="keyword">implicit</span> order: <span class="type">T</span> =&gt; <span class="type">Ordered</span>[<span class="type">T</span>]) = <span class="keyword">if</span> (a &lt; b) a <span class="keyword">else</span> b</span><br><span class="line"></span><br><span class="line">  println(smaller(<span class="number">1</span>,<span class="number">2</span>)) <span class="comment">//输出 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>Martin Odersky . Scala编程(第3版)[M] . 电子工业出版社 . 2018-1-1  </li>
<li>凯.S.霍斯特曼  . 快学Scala(第2版)[M] . 电子工业出版社 . 2017-7</li>
</ol>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2019/07/100457.html" class="pre-post btn btn-default" title='大数据hadoop应用常用打包方式'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">大数据hadoop应用常用打包方式</span>
        </a>
    
    
        <a href="/archives/2019/07/100455.html" class="next-post btn btn-default" title='Scala类型参数'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">Scala类型参数</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、隐式转换"><span class="toc-text">一、隐式转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-使用隐式转换"><span class="toc-text">1.1 使用隐式转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-隐式转换规则"><span class="toc-text">1.2 隐式转换规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-引入隐式转换"><span class="toc-text">1.3 引入隐式转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、隐式参数"><span class="toc-text">二、隐式参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-使用隐式参数"><span class="toc-text">2.1 使用隐式参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-引入隐式参数"><span class="toc-text">2.2 引入隐式参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-利用隐式参数进行隐式转换"><span class="toc-text">2.3 利用隐式参数进行隐式转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-使用视图界定"><span class="toc-text">1. 使用视图界定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-利用隐式参数进行隐式转换"><span class="toc-text">2. 利用隐式参数进行隐式转换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2024&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>