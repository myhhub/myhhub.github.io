<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="hadoop,cdh">


    <meta name="description" content="在安装一系列的安装包之前，首先要解决的是ubuntu14.04的无密码传输的root用户的权限问题。
一. 修改 root 密码1sudo passwd root
1. 如果使用普通用户安装时，...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>大数据hadoop之 五十.ubuntu下离线安装CDH | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="大数据hadoop之 五十.ubuntu下离线安装CDH">
            
	            大数据hadoop之 五十.ubuntu下离线安装CDH
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/cloud/">云计算</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/cdh/">cdh</a> <a class="tag-link" href="/tags/hadoop/">hadoop</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/07/02</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1694</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p>在安装一系列的安装包之前，首先要解决的是ubuntu14.04的无密码传输的root用户的权限问题。</p>
<h2 id="一-修改-root-密码"><a href="#一-修改-root-密码" class="headerlink" title="一. 修改 root 密码"></a>一. 修改 root 密码</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo passwd root</span></span><br></pre></td></tr></table></figure>
<h3 id="1-如果使用普通用户安装时，首先创建用户和用户组："><a href="#1-如果使用普通用户安装时，首先创建用户和用户组：" class="headerlink" title="1. 如果使用普通用户安装时，首先创建用户和用户组："></a>1. 如果使用普通用户安装时，首先创建用户和用户组：</h3><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo addgroup <span class="number">cdh</span></span><br><span class="line">sudo adduser -ingroup <span class="number">cdh</span> <span class="number">cdh</span></span><br></pre></td></tr></table></figure>
<p>赋予用户sudo权限：<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$</span> sudo nano /etc/sudoers  #也可以使用visudo编辑</span><br><span class="line"># User privilege specification</span><br><span class="line">rootALL=(<span class="keyword">ALL</span>:<span class="keyword">ALL</span>) <span class="keyword">ALL</span></span><br><span class="line">cdh <span class="keyword">ALL</span>=(<span class="keyword">ALL</span>:<span class="keyword">ALL</span>) <span class="keyword">ALL</span></span><br></pre></td></tr></table></figure></p>
<h2 id="二-以其他账户登录，通过-sudo-vim-修改-etc-ssh-sshd-config"><a href="#二-以其他账户登录，通过-sudo-vim-修改-etc-ssh-sshd-config" class="headerlink" title="二. 以其他账户登录，通过 sudo vim 修改 /etc/ssh/sshd_config :"></a>二. 以其他账户登录，通过 sudo vim 修改 /etc/ssh/sshd_config :</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxx<span class="variable">@ubuntu14</span><span class="symbol">:~</span><span class="variable">$ </span>su - root</span><br><span class="line"></span><br><span class="line"><span class="symbol">Password:</span></span><br><span class="line">root<span class="variable">@ubuntu14</span><span class="symbol">:~</span><span class="comment"># vi /etc/ssh/sshd_config</span></span><br></pre></td></tr></table></figure>
<h2 id="三-注释掉-PermitRootLogin-without-password，添加-PermitRootLogin-yes"><a href="#三-注释掉-PermitRootLogin-without-password，添加-PermitRootLogin-yes" class="headerlink" title="三. 注释掉 #PermitRootLogin without-password，添加 PermitRootLogin yes"></a>三. 注释掉 #PermitRootLogin without-password，添加 PermitRootLogin yes</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Authentication:</span></span><br><span class="line"><span class="string">LoginGraceTime</span> <span class="number">120</span></span><br><span class="line"><span class="comment">#PermitRootLogin without-password</span></span><br><span class="line"><span class="string">PermitRootLogin</span> <span class="literal">yes</span></span><br><span class="line"><span class="string">StrictModes</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<h2 id="四-重启-ssh-服务"><a href="#四-重启-ssh-服务" class="headerlink" title="四. 重启 ssh  服务"></a>四. 重启 ssh  服务</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu14:~# sudo<span class="built_in"> service </span>ssh restart</span><br><span class="line">ssh stop/waiting</span><br><span class="line">ssh start/running, process 1499</span><br><span class="line">root@ubuntu14:~#</span><br></pre></td></tr></table></figure>
<p>然后切换至root用户下：</p>
<h3 id="1-设置Host-所有节点"><a href="#1-设置Host-所有节点" class="headerlink" title="1.设置Host(所有节点)"></a>1.设置Host(所有节点)</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span>   <span class="selector-tag">localhost</span></span><br><span class="line"><span class="selector-id">#127</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.1</span>  <span class="selector-tag">ubuntu1</span></span><br><span class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.190</span>   <span class="selector-tag">ubuntu1</span><span class="selector-class">.cdh</span></span><br><span class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.135</span>   <span class="selector-tag">ubuntu2</span><span class="selector-class">.cdh</span></span><br><span class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.145</span>   <span class="selector-tag">ubuntu3</span><span class="selector-class">.cdh</span></span><br><span class="line"></span><br><span class="line"># <span class="selector-tag">The</span> <span class="selector-tag">following</span> <span class="selector-tag">lines</span> <span class="selector-tag">are</span> <span class="selector-tag">desirable</span> <span class="selector-tag">for</span> <span class="selector-tag">IPv6</span> <span class="selector-tag">capable</span> <span class="selector-tag">hosts</span></span><br><span class="line"><span class="selector-pseudo">::1</span> <span class="selector-tag">localhost</span> <span class="selector-tag">ip6-localhost</span> <span class="selector-tag">ip6-loopback</span></span><br><span class="line"><span class="selector-tag">fe00</span><span class="selector-pseudo">::0</span> <span class="selector-tag">ip6-localnet</span></span><br><span class="line"><span class="selector-tag">ff00</span><span class="selector-pseudo">::0</span> <span class="selector-tag">ip6-mcastprefix</span></span><br><span class="line"><span class="selector-tag">ff02</span><span class="selector-pseudo">::1</span> <span class="selector-tag">ip6-allnodes</span></span><br><span class="line"><span class="selector-tag">ff02</span><span class="selector-pseudo">::2</span> <span class="selector-tag">ip6-allrouters</span></span><br></pre></td></tr></table></figure>
<p>执行命令<code>sudo vi /etc/hostname</code><br>在文件里写入自己修改后的名字，与上一步ip对应的名字一样。</p>
<p>执行命令   <code>shutdown -r now</code> 使配置生效。</p>
<h2 id="五-打通SSH，设置ssh无密码登陆（所有节点）"><a href="#五-打通SSH，设置ssh无密码登陆（所有节点）" class="headerlink" title="五. 打通SSH，设置ssh无密码登陆（所有节点）"></a>五. 打通SSH，设置ssh无密码登陆（所有节点）</h2><p>注意如果是以普通用户安装，配置的SSH免密码登录的对象是普通用户而不是root。<br>在主节点上执行 <code>ssh-keygen -t rsa</code> 一路回车，生成无密码的密钥对。<br>将公钥添加到认证文件中： <code>cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</code> ，并设置<br>authorized_keys的访问权限：<code>chmod 600 ~/.ssh/authorized_keys</code> 。<br>在每个节点上都执行以上命令，然后scp文件到所有datenode节点：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp ~<span class="regexp">/.ssh/id</span>_rsa.pub root@ubuntu2<span class="symbol">:/usr/local</span></span><br><span class="line">cat /usr/local/id_rsa.pub<span class="meta">&gt;&gt;</span>~<span class="regexp">/.ssh/authorized</span>_keys</span><br><span class="line">chmod <span class="number">600</span> ~<span class="regexp">/.ssh/authorized</span>_keys</span><br></pre></td></tr></table></figure></p>
<p>测试： 在主节点上ssh ubuntu2.cdh，正常情况下，不需要密码就能直接登陆进去了。</p>
<h2 id="六-关闭防火墙"><a href="#六-关闭防火墙" class="headerlink" title="六. 关闭防火墙"></a>六. 关闭防火墙</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@m1</span><span class="symbol">:~</span><span class="comment"># ufw disable</span></span><br></pre></td></tr></table></figure>
<h2 id="七-安装jdk"><a href="#七-安装jdk" class="headerlink" title="七. 安装jdk"></a>七. 安装jdk</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp hadoop<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">110</span><span class="symbol">:/home/hadoop/Hadoop/</span></span><br><span class="line">CDH/CDHUbuntu14.<span class="number">04</span>/jdk-<span class="number">7</span>u79-linux-x64.gz /usr/</span><br><span class="line">local</span><br></pre></td></tr></table></figure>
<p>执行上述命令，获取jdk安装包<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk<span class="number">-7</span>u79-linux-x64.gz</span><br><span class="line"></span><br><span class="line">mv jdk1<span class="number">.7</span><span class="number">.0</span>_79/ jdk</span><br></pre></td></tr></table></figure></p>
<p>解压jdk压缩包并改名（注意如果是普通用户安装的话不要改名了，而且最好安装路径为/usr/java/jdk1.7.0_79,而且配置环境变量要在此用户的.bashrc文件里配一下，应为即使使用sudo他也是先到.bashrc找环境配置）<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim  ~<span class="string">/.bashrc</span></span><br></pre></td></tr></table></figure></p>
<p>在打开的文件的末尾添加<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=<span class="regexp">/usr/local</span><span class="regexp">/jdk</span></span><br><span class="line"><span class="regexp">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span> </span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/<span class="class"><span class="keyword">lib</span>:</span></span><br><span class="line">$&#123;JRE_HOME&#125;/<span class="class"><span class="keyword">lib</span></span></span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/<span class="symbol">bin:</span>$PATH</span><br></pre></td></tr></table></figure></p>
<p>保存退出，然后输入下面的命令来使之生效<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<h2 id="八-安装配置MySql（主节点）"><a href="#八-安装配置MySql（主节点）" class="headerlink" title="八. 安装配置MySql（主节点）"></a>八. 安装配置MySql（主节点）</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp hadoop<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">110</span><span class="symbol">:/home/hadoop/Hadoop/CDH/CDHUbuntu14</span>.<span class="number">04</span>/mysql-server_5.<span class="number">7.12</span>-<span class="number">1</span>ubuntu14.<span class="number">04_</span>amd64.deb-bundle.tar /usr/local/</span><br><span class="line"></span><br><span class="line">scp hadoop<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">110</span><span class="symbol">:/home/hadoop/Hadoop/CDH/CDHCentOS6/mysql-connector-java-</span><span class="number">5.1</span>.<span class="number">36</span>.tar.gz /usr/local/</span><br></pre></td></tr></table></figure>
<p>执行上述两行命令，分别获取MySQL安装包和MySQL的连接jar包，并且存放在/usr/local目录下<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp hadoop<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">110</span><span class="symbol">:/home/hadoop/Hadoop/CDH/CDHUbuntu14</span>.<span class="number">04</span>/libaio1_<span class="number">0</span>.<span class="number">3.107</span>-<span class="number">3</span>ubuntu2_amd64.deb/usr/local/</span><br><span class="line">scp hadoop<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">110</span><span class="symbol">:/home/hadoop/Hadoop/CDH/CDHUbuntu14</span>.<span class="number">04</span>/libmecab2_<span class="number">0</span>.<span class="number">996</span>-<span class="number">1.1_</span>amd64.deb/usr/local/</span><br></pre></td></tr></table></figure></p>
<p>上述两条命令分别获取后面安装数据库需要用到的libaio1包和libmecab2包<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-xvf</span> <span class="selector-tag">mysql-server_5</span><span class="selector-class">.7</span><span class="selector-class">.12-1ubuntu14</span><span class="selector-class">.04_amd64</span><span class="selector-class">.deb-bundle</span><span class="selector-class">.tar</span></span><br></pre></td></tr></table></figure></p>
<p>执行上述命令解压缩包</p>
<p>解压开来后，一共有11个deb包，用sudo dpkg -i [包名]命令逐个安装，因为包与包中间存在依赖关系，这里安装有个先后顺序。<br>我的安装的顺序是：</p>
<ol>
<li><p>mysql-common_5.7.12-1ubuntu14.04_amd64.deb</p>
</li>
<li><p>libmysqlclient20_5.7.12-1ubuntu14.04_amd64.deb</p>
</li>
<li><p>libmysqlclient-dev_5.7.12-1ubuntu14.04_amd64.deb</p>
</li>
<li><p>libmysqld-dev_5.7.12-1ubuntu14.04_amd64.deb</p>
</li>
<li><p>而后需要安装依赖包libaio1,即  libaio1_0.3.107-3ubuntu2_amd64.deb</p>
<p>而后继续：</p>
</li>
<li><p>mysql-community-client_5.7.12-1ubuntu14.04_amd64.deb</p>
</li>
<li><p>mysql-client_5.7.12-1ubuntu14.04_amd64.deb</p>
</li>
<li><p>mysql-community-source_5.7.12-1ubuntu14.04_amd64.deb</p>
</li>
<li><p>这里需要再安装一个依赖包叫libmecab2,即libmecab2_0.996-1.1_amd64.deb</p>
<p>安装好后，继续安装最后一个：</p>
</li>
<li><p>mysql-community-server_5.7.12-1ubuntu14.04_amd64.deb</p>
<p>安装过程中需要设置数据库密码。</p>
</li>
</ol>
<p>使用命令：<code>mysql -uroot -p123456</code> 登录mysql，进入mysql命令行，创建以下数据库：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#hive</span></span><br><span class="line">create database hive<span class="built_in"> DEFAULT </span>CHARSET utf8 COLLATE utf8_general_ci;</span><br><span class="line"><span class="comment">#activity monitor</span></span><br><span class="line">create database amon<span class="built_in"> DEFAULT </span>CHARSET utf8 COLLATE utf8_general_ci;</span><br></pre></td></tr></table></figure></p>
<p>设置root授权访问以上所有的数据库：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#授权root用户在主节点拥有所有数据库的访问权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">'root'</span>@<span class="string">'ubuntu1.cdh'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span> <span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<h3 id="配置MySql的监听地址"><a href="#配置MySql的监听地址" class="headerlink" title="配置MySql的监听地址"></a>配置MySql的监听地址</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@m1</span><span class="symbol">:~</span><span class="comment"># cp /etc/mysql/my.cnf /etc/mysql/my.cnf.bak </span></span><br><span class="line">root<span class="variable">@m1</span><span class="symbol">:~</span><span class="comment"># vi /etc/mysql/my.cnf </span></span><br><span class="line"><span class="comment">#bind-address = 127.0.0.1 </span></span><br><span class="line">bind-address = <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>这一步是必须的，如果不配置，后面再web上面安装的时候将会连接不到数据库</p>
<p>然后执行命令<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="built_in"> service </span>mysql restart</span><br></pre></td></tr></table></figure></p>
<p>关闭防火墙<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw <span class="built_in">disable</span></span><br></pre></td></tr></table></figure></p>
<p>设置每台机器时间与主节点相同，即执行以下命令<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> -s <span class="string">"2019-07-02 12:15:00"</span>  <span class="comment">#主节点时间</span></span><br></pre></td></tr></table></figure></p>
<h2 id="九-安装-Cloudera-Manager-Server-和-Agents"><a href="#九-安装-Cloudera-Manager-Server-和-Agents" class="headerlink" title="九. 安装 Cloudera Manager Server 和 Agents"></a>九. 安装 Cloudera Manager Server 和 Agents</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp hadoop<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">110</span><span class="symbol">:/home/hadoop/Hadoop/CDH/cloudera-manager-trusty-cm5</span>.<span class="number">3.9_</span>amd64.tar.gz /opt/</span><br></pre></td></tr></table></figure>
<p>将cloudera-manager的安装包放在/opt </p>
<h3 id="进入-opt目录下，对cloudera-manager安装包进行解压，使用命令："><a href="#进入-opt目录下，对cloudera-manager安装包进行解压，使用命令：" class="headerlink" title="进入/opt目录下，对cloudera-manager安装包进行解压，使用命令："></a>进入/opt目录下，对cloudera-manager安装包进行解压，使用命令：</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-zxvf</span> <span class="selector-tag">cloudera-manager-trusty-cm5</span><span class="selector-class">.3</span><span class="selector-class">.9_amd64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure>
<p>解压完成之后会出现一个目录 cm-5.3.9</p>
<p>在所有节点创建cloudera-scm用户<br><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">useradd </span><span class="built_in">--system</span> <span class="built_in">--home=/opt/cm-5.3.9/run/cloudera-scm-server/</span> <span class="built_in">--no-create-home</span> <span class="built_in">--shell=/bin/false</span> <span class="built_in">--comment</span> <span class="string">"Clousera SCM User"</span> <span class="string">cloudera-scm</span></span><br></pre></td></tr></table></figure></p>
<h3 id="为Cloudera-Manager-5建立数据库"><a href="#为Cloudera-Manager-5建立数据库" class="headerlink" title="为Cloudera Manager 5建立数据库"></a>为Cloudera Manager 5建立数据库</h3><p>将刚才下载的MySQL的连接jar包进行解压，文件位置是在：/usr/local,解压完成之后，使用命令：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/local/mysql-connector-java-<span class="number">5.1</span>.<span class="number">36</span>/mysql-connector-java-<span class="number">5.1</span>.<span class="number">36</span>-bin.jar /opt/cm-<span class="number">5.3</span>.<span class="number">9</span>/share/cmf/<span class="class"><span class="keyword">lib</span>/</span></span><br></pre></td></tr></table></figure></p>
<p>将jar包放在/opt/cm-5.3.9/share/cmf/lib/目录下</p>
<p>在主节点初始化CM5的数据库：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">opt</span>/<span class="keyword">cm</span>-<span class="number">5.3</span>.<span class="number">9</span>/share/cmf/schema/scm_prepare_database.<span class="keyword">sh</span> mysql <span class="keyword">cm</span> -hlocalhost -uroot -p123456 --scm-host localhost scm scm scm</span><br></pre></td></tr></table></figure></p>
<h3 id="修改-opt-cm-5-3-9-etc-cloudera-scm-agent-config-ini中的server-host为主节点的主机名，例如本机主机名为server-host-ubuntu1-cdh"><a href="#修改-opt-cm-5-3-9-etc-cloudera-scm-agent-config-ini中的server-host为主节点的主机名，例如本机主机名为server-host-ubuntu1-cdh" class="headerlink" title="修改/opt/cm-5.3.9/etc/cloudera-scm-agent/config.ini中的server_host为主节点的主机名，例如本机主机名为server-host=ubuntu1.cdh"></a>修改/opt/cm-5.3.9/etc/cloudera-scm-agent/config.ini中的server_host为主节点的主机名，例如本机主机名为server-host=ubuntu1.cdh</h3><p>执行以下命令，把cm-5.3.9拷贝到其他机器的/opt文件夹<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r <span class="regexp">/opt/</span>cm<span class="number">-5.3</span><span class="number">.9</span> root<span class="meta">@ubuntu</span>2.<span class="string">cdh:</span><span class="regexp">/opt/</span></span><br></pre></td></tr></table></figure></p>
<h2 id="十-准备Parcels，用以安装CDH5"><a href="#十-准备Parcels，用以安装CDH5" class="headerlink" title="十. 准备Parcels，用以安装CDH5"></a>十. 准备Parcels，用以安装CDH5</h2><p>将CHD5相关的Parcel包放到主节点的/opt/cloudera/parcel-repo/目录中（cloudera/parcel-repo需要手动创建）。</p>
<p>CDH-5.3.9-1.cdh5.3.9.p0.8-trusty.parcel<br>CDH-5.3.9-1.cdh5.3.9.p0.8-trusty.parcel.sha1<br>manifest.json<br>使用命令：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp hadoop<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">110</span><span class="symbol">:/home/hadoop/Hadoop/CDH/CDH-</span><span class="number">5.3</span>.<span class="number">9</span>-<span class="number">1</span>.cdh5.<span class="number">3.9</span>.p<span class="number">0</span>.<span class="number">8</span>-trusty.parcel /opt/cloudera/parcel-repo/</span><br></pre></td></tr></table></figure></p>
<p>将ftp服务器中的CDH-5.3.9-1.cdh5.3.9.p0.8-trusty.parcel放到/opt/cloudera/parcel-repo/ 目录下。然后执行以下命令把CDH-5.3.9-1.cdh5.3.9.p0.8-trusty.parcel.改名<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">mv</span> <span class="selector-tag">CDH-5</span><span class="selector-class">.3</span><span class="selector-class">.9-1</span><span class="selector-class">.cdh5</span><span class="selector-class">.3</span><span class="selector-class">.9</span><span class="selector-class">.p0</span><span class="selector-class">.8-trusty</span><span class="selector-class">.parcel</span><span class="selector-class">.sha1</span> <span class="selector-tag">CDH-5</span><span class="selector-class">.3</span><span class="selector-class">.9-1</span><span class="selector-class">.cdh5</span><span class="selector-class">.3</span><span class="selector-class">.9</span><span class="selector-class">.p0</span><span class="selector-class">.8-trusty</span><span class="selector-class">.parcel</span><span class="selector-class">.sha</span></span><br></pre></td></tr></table></figure></p>
<p>相关启动脚本</p>
<p>通过 <code>/opt/cm-5.3.9/etc/init.d/cloudera-scm-server start</code> 启动服务端。</p>
<p>通过 <code>/opt/cm-5.3.9/etc/init.d/cloudera-scm-agent start</code> 启动Agent服务。（注意普通用户安装时，从机上的Agent服务要用root用户启动，不然会有一个incepter的服务起不了，用sudo也不好使的，主机的要用cdh用户启动，因为之前配置的ssh配的就是cdh的不然又找不到其它主机）</p>
<h3 id="1-第一步"><a href="#1-第一步" class="headerlink" title="1. 第一步"></a>1. 第一步</h3><p>输入<a href="http://192.168.1.190:7180" target="_blank" rel="noopener">http://192.168.1.190:7180</a> (ip为自己的主机ip)<br><img src="/img/hadoop/15/GAFgmdv.png" alt></p>
<h3 id="2-第二步"><a href="#2-第二步" class="headerlink" title="2. 第二步"></a>2. 第二步</h3><p><img src="/img/hadoop/15/I66Lln5.png" alt></p>
<h3 id="3-第三步"><a href="#3-第三步" class="headerlink" title="3. 第三步"></a>3. 第三步</h3><p><img src="/img/hadoop/15/LgtbwCB.png" alt></p>
<h3 id="4-第四步"><a href="#4-第四步" class="headerlink" title="4. 第四步"></a>4. 第四步</h3><p><img src="/img/hadoop/15/ns7hiso.png" alt></p>
<h3 id="5-第五步"><a href="#5-第五步" class="headerlink" title="5. 第五步"></a>5. 第五步</h3><p>这个是检查主机是的常见错误，我们只需要执行以下命令<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="number">0</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/vm/</span>swappiness</span><br></pre></td></tr></table></figure></p>
<p>#貌似这句只能由root执行<br><img src="/img/hadoop/15/gXyx2OY.png" alt></p>
<h3 id="6-第六步"><a href="#6-第六步" class="headerlink" title="6. 第六步"></a>6. 第六步</h3><p><img src="/img/hadoop/15/g8J9Gl7.png" alt></p>
<h3 id="7-第七步"><a href="#7-第七步" class="headerlink" title="7. 第七步"></a>7. 第七步</h3><p><img src="/img/hadoop/15/SO3eyhs.png" alt></p>
<h3 id="8-第八步"><a href="#8-第八步" class="headerlink" title="8. 第八步"></a>8. 第八步</h3><p><img src="/img/hadoop/15/3cH4Ze5.png" alt></p>
<h3 id="9-第九步"><a href="#9-第九步" class="headerlink" title="9. 第九步"></a>9. 第九步</h3><p><img src="/img/hadoop/15/ge9ufkA.png" alt></p>
<h3 id="10-第十步"><a href="#10-第十步" class="headerlink" title="10. 第十步"></a>10. 第十步</h3><p>终于到安装各个服务的地方了，注意，这里安装Hive的时候可能会报错，因为我们使用了MySql作为hive的元数据存储，hive默认没有带mysql的驱动，通过以下命令拷贝一个就行了：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /opt/cm-<span class="number">5.3</span>.<span class="number">9</span>/share/cmf/<span class="class"><span class="keyword">lib</span>/<span class="title">mysql</span>-<span class="title">connector</span>-<span class="title">java</span>-5.1.36-<span class="title">bin</span>.<span class="title">jar</span> /<span class="title">opt</span>/<span class="title">cloudera</span>/<span class="title">parcels</span>/<span class="title">CDH</span>-5.3.9-1.<span class="title">cdh5</span>.3.9.<span class="title">p0</span>.8/<span class="title">lib</span>/<span class="title">hive</span>/<span class="title">lib</span>/</span></span><br></pre></td></tr></table></figure></p>
<p>另外hue数据库server启动会失败，查看日志是因为snappy导入失败造成的，这是因为snappy是用Python写成的，我们这里缺少了一个Python-libxslt1包，逐步执行以下命令即可<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aptitude <span class="keyword">install</span> python</span><br><span class="line"></span><br><span class="line">aptitude <span class="keyword">update</span></span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> Python-libxslt1</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/hadoop/15/LRCDMln.png" alt></p>
<h3 id="11-第十一步"><a href="#11-第十一步" class="headerlink" title="11. 第十一步"></a>11. 第十一步</h3><p><img src="/img/hadoop/15/MYFGblV.png" alt></p>
<h3 id="12-第十二步"><a href="#12-第十二步" class="headerlink" title="12. 第十二步"></a>12. 第十二步</h3><p>如果hdfs上有感叹好，提示运行不良有不足的块，可在主机上执行：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">sudo</span> -u oozie <span class="keyword">bash</span></span><br><span class="line"><span class="keyword">hadoop </span>fs -setrep -R <span class="number">1</span> /</span><br></pre></td></tr></table></figure></p>
<p>执行完稍等一会就好了。</p>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2019/07/100357.html" class="pre-post btn btn-default" title='大数据hadoop之 五十一.Hadoop的TDH发行版本'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">大数据hadoop之 五十一.Hadoop的TDH发行版本</span>
        </a>
    
    
        <a href="/archives/2019/07/100355.html" class="next-post btn btn-default" title='大数据hadoop之 四十九.CentOS下离线安装Cloudera Manager和CDH'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">大数据hadoop之 四十九.CentOS下离线安装Cloudera Manager和CDH</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一-修改-root-密码"><span class="toc-text">一. 修改 root 密码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-如果使用普通用户安装时，首先创建用户和用户组："><span class="toc-text">1. 如果使用普通用户安装时，首先创建用户和用户组：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二-以其他账户登录，通过-sudo-vim-修改-etc-ssh-sshd-config"><span class="toc-text">二. 以其他账户登录，通过 sudo vim 修改 /etc/ssh/sshd_config :</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三-注释掉-PermitRootLogin-without-password，添加-PermitRootLogin-yes"><span class="toc-text">三. 注释掉 #PermitRootLogin without-password，添加 PermitRootLogin yes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四-重启-ssh-服务"><span class="toc-text">四. 重启 ssh  服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-设置Host-所有节点"><span class="toc-text">1.设置Host(所有节点)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五-打通SSH，设置ssh无密码登陆（所有节点）"><span class="toc-text">五. 打通SSH，设置ssh无密码登陆（所有节点）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六-关闭防火墙"><span class="toc-text">六. 关闭防火墙</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七-安装jdk"><span class="toc-text">七. 安装jdk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八-安装配置MySql（主节点）"><span class="toc-text">八. 安装配置MySql（主节点）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置MySql的监听地址"><span class="toc-text">配置MySql的监听地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#九-安装-Cloudera-Manager-Server-和-Agents"><span class="toc-text">九. 安装 Cloudera Manager Server 和 Agents</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#进入-opt目录下，对cloudera-manager安装包进行解压，使用命令："><span class="toc-text">进入/opt目录下，对cloudera-manager安装包进行解压，使用命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#为Cloudera-Manager-5建立数据库"><span class="toc-text">为Cloudera Manager 5建立数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改-opt-cm-5-3-9-etc-cloudera-scm-agent-config-ini中的server-host为主节点的主机名，例如本机主机名为server-host-ubuntu1-cdh"><span class="toc-text">修改/opt/cm-5.3.9/etc/cloudera-scm-agent/config.ini中的server_host为主节点的主机名，例如本机主机名为server-host=ubuntu1.cdh</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十-准备Parcels，用以安装CDH5"><span class="toc-text">十. 准备Parcels，用以安装CDH5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-第一步"><span class="toc-text">1. 第一步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-第二步"><span class="toc-text">2. 第二步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-第三步"><span class="toc-text">3. 第三步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-第四步"><span class="toc-text">4. 第四步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-第五步"><span class="toc-text">5. 第五步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-第六步"><span class="toc-text">6. 第六步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-第七步"><span class="toc-text">7. 第七步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-第八步"><span class="toc-text">8. 第八步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-第九步"><span class="toc-text">9. 第九步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-第十步"><span class="toc-text">10. 第十步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-第十一步"><span class="toc-text">11. 第十一步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-第十二步"><span class="toc-text">12. 第十二步</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2024&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>