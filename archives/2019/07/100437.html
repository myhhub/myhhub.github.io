<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="hadoop,flume">


    <meta name="description" content="一、Flume简介Apache Flume是一个分布式，高可用的数据收集系统。它可以从不同的数据源收集数据，经过聚合后发送到存储系统中，通常用于日志数据的收集。Flume 分为 NG 和 OG ...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>Flume简介及基本使用 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Flume简介及基本使用">
            
	            Flume简介及基本使用
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/cloud/">云计算</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/flume/">flume</a> <a class="tag-link" href="/tags/hadoop/">hadoop</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/07/15</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1364</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <h2 id="一、Flume简介"><a href="#一、Flume简介" class="headerlink" title="一、Flume简介"></a>一、Flume简介</h2><p>Apache Flume是一个分布式，高可用的数据收集系统。它可以从不同的数据源收集数据，经过聚合后发送到存储系统中，通常用于日志数据的收集。Flume 分为 NG 和 OG (1.0 之前)两个版本，NG在OG的基础上进行了完全的重构，是目前使用最为广泛的版本。下面的介绍均以NG为基础。</p>
<h2 id="二、Flume架构和基本概念"><a href="#二、Flume架构和基本概念" class="headerlink" title="二、Flume架构和基本概念"></a>二、Flume架构和基本概念</h2><p>下图为Flume的基本架构图：</p>
<div align="center"> <img src="/img/bigdata/flume-architecture.png"> </div>

<h3 id="2-1-基本架构"><a href="#2-1-基本架构" class="headerlink" title="2.1 基本架构"></a>2.1 基本架构</h3><p>外部数据源以特定格式向Flume发送<code>events</code> (事件)，当<code>source</code>接收到<code>events</code>时，它将其存储到一个或多个<code>channel</code>，<code>channe</code>会一直保存<code>events</code>直到它被<code>sink</code>所消费。<code>sink</code>的主要功能从<code>channel</code>中读取<code>events</code>，并将其存入外部存储系统或转发到下一个<code>source</code>，成功后再从<code>channel</code>中移除<code>events</code>。</p>
<h3 id="2-2-基本概念"><a href="#2-2-基本概念" class="headerlink" title="2.2 基本概念"></a>2.2 基本概念</h3><p><strong>1. Event</strong></p>
<p><code>Evnet</code>是Flume NG数据传输的基本单元。类似于JMS和消息系统中的消息。一个<code>Evnet</code>由标题和正文组成：前者是键/值映射，后者是任意字节数组。</p>
<p><strong>2. Source</strong> </p>
<p>数据收集组件，从外部数据源收集数据，并存储到Channel中。</p>
<p><strong>3. Channel</strong></p>
<p><code>Channel</code>是源和接收器之间的管道，用于临时存储数据。可以是内存或持久化的文件系统：</p>
<ul>
<li><code>Memory Channel</code> : 使用内存，优点是速度快，但数据可能会丢失(如突然宕机)；</li>
<li><code>File Channel</code> : 使用持久化的文件系统，优点是能保证数据不丢失，但是速度慢。</li>
</ul>
<p><strong>4. Sink</strong></p>
<p><code>Sink</code>的主要功能从<code>Channel</code>中读取<code>Evnet</code>，并将其存入外部存储系统或将其转发到下一个<code>Source</code>，成功后再从<code>Channel</code>中移除<code>Event</code>。</p>
<p><strong>5. Agent</strong></p>
<p>是一个独立的(JVM)进程，包含<code>Source</code>、 <code>Channel</code>、 <code>Sink</code>等组件。</p>
<h3 id="2-3-组件种类"><a href="#2-3-组件种类" class="headerlink" title="2.3 组件种类"></a>2.3 组件种类</h3><p>Flume中的每一个组件都提供了丰富的类型，适用于不同场景：</p>
<ul>
<li><p>Source类型 ：内置了几十种类型，如<code>Avro Source</code>，<code>Thrift Source</code>，<code>Kafka Source</code>，<code>JMS Source</code>；</p>
</li>
<li><p>Sink类型 ：<code>HDFS Sink</code>，<code>Hive Sink</code>，<code>HBaseSinks</code>，<code>Avro Sink</code>等；</p>
</li>
<li><p>Channel类型 ：<code>Memory Channel</code>，<code>JDBC Channel</code>，<code>Kafka Channel</code>，<code>File Channel</code>等。</p>
</li>
</ul>
<p>对于Flume的使用，除非有特别的需求，否则通过组合内置的各种类型的Source，Sink和Channel就能满足大多数的需求。在 <a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html" target="_blank" rel="noopener">Flume官网</a>上对所有类型组件的配置参数均以表格的方式做了详尽的介绍，并附有配置样例；同时不同版本的参数可能略有所不同，所以使用时建议选取官网对应版本的User Guide作为主要参考资料。</p>
<h2 id="三、Flume架构模式"><a href="#三、Flume架构模式" class="headerlink" title="三、Flume架构模式"></a>三、Flume架构模式</h2><p>Flume 支持多种架构模式，分别介绍如下</p>
<h3 id="3-1-multi-agent-flow"><a href="#3-1-multi-agent-flow" class="headerlink" title="3.1 multi-agent flow"></a>3.1 multi-agent flow</h3><div align="center"> <img src="/img/bigdata/flume-multi-agent-flow.png"> </div>

<p><br></p>
<p>Flume支持跨越多个Agent的数据传递，这要求前一个Agent的Sink和下一个Agent的Source都必须是<code>Avro</code>类型，Sink指向Source所在主机名(或IP地址)和端口（详细配置见下文案例三）。</p>
<h3 id="3-2-Consolidation"><a href="#3-2-Consolidation" class="headerlink" title="3.2 Consolidation"></a>3.2 Consolidation</h3><div align="center"> <img src="/img/bigdata/flume-consolidation.png"> </div>



<p><br></p>
<p>日志收集中常常存在大量的客户端（比如分布式web服务），Flume支持使用多个Agent分别收集日志，然后通过一个或者多个Agent聚合后再存储到文件系统中。</p>
<h3 id="3-3-Multiplexing-the-flow"><a href="#3-3-Multiplexing-the-flow" class="headerlink" title="3.3 Multiplexing the flow"></a>3.3 Multiplexing the flow</h3><div align="center"> <img src="/img/bigdata/flume-multiplexing-the-flow.png"> </div>

<p>Flume支持从一个Source向多个Channel，也就是向多个Sink传递事件，这个操作称之为<code>Fan Out</code>(扇出)。默认情况下<code>Fan Out</code>是向所有的Channel复制<code>Event</code>，即所有Channel收到的数据都是相同的。同时Flume也支持在<code>Source</code>上自定义一个复用选择器(multiplexing selector) 来实现自定义的路由规则。</p>
<h2 id="四、Flume配置格式"><a href="#四、Flume配置格式" class="headerlink" title="四、Flume配置格式"></a>四、Flume配置格式</h2><p>Flume配置通常需要以下两个步骤：</p>
<ol>
<li>分别定义好Agent的Sources，Sinks，Channels，然后将Sources和Sinks与通道进行绑定。需要注意的是一个Source可以配置多个Channel，但一个Sink只能配置一个Channel。基本格式如下：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Agent&gt;.sources = &lt;Source&gt;</span><br><span class="line">&lt;Agent&gt;.sinks = &lt;Sink&gt;</span><br><span class="line">&lt;Agent&gt;.channels = &lt;Channel1&gt; &lt;Channel2&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> channel <span class="keyword">for</span> <span class="built_in">source</span></span></span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source&gt;.channels = &lt;Channel1&gt; &lt;Channel2&gt; ...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> channel <span class="keyword">for</span> sink</span></span><br><span class="line">&lt;Agent&gt;.sinks.&lt;Sink&gt;.channel = &lt;Channel1&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>分别定义Source，Sink，Channel的具体属性。基本格式如下：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source&gt;.&lt;someProperty&gt; = &lt;someValue&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> properties <span class="keyword">for</span> channels</span></span><br><span class="line">&lt;Agent&gt;.channel.&lt;Channel&gt;.&lt;someProperty&gt; = &lt;someValue&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> properties <span class="keyword">for</span> sinks</span></span><br><span class="line">&lt;Agent&gt;.sources.&lt;Sink&gt;.&lt;someProperty&gt; = &lt;someValue&gt;</span><br></pre></td></tr></table></figure>
<h2 id="五、Flume的安装部署"><a href="#五、Flume的安装部署" class="headerlink" title="五、Flume的安装部署"></a>五、Flume的安装部署</h2><p>为方便大家后期查阅，本仓库中所有软件的安装均单独成篇，Flume的安装见：</p>
<p><a href="100383.html">Linux环境下Flume的安装部署</a></p>
<h2 id="六、Flume使用案例"><a href="#六、Flume使用案例" class="headerlink" title="六、Flume使用案例"></a>六、Flume使用案例</h2><p>介绍几个Flume的使用案例：</p>
<ul>
<li>案例一：使用Flume监听文件内容变动，将新增加的内容输出到控制台。</li>
<li>案例二：使用Flume监听指定目录，将目录下新增加的文件存储到HDFS。</li>
<li>案例三：使用Avro将本服务器收集到的日志数据发送到另外一台服务器。</li>
</ul>
<h3 id="6-1-案例一"><a href="#6-1-案例一" class="headerlink" title="6.1 案例一"></a>6.1 案例一</h3><p>需求： 监听文件内容变动，将新增加的内容输出到控制台。</p>
<p>实现： 主要使用<code>Exec Source</code>配合<code>tail</code>命令实现。</p>
<h4 id="1-配置"><a href="#1-配置" class="headerlink" title="1. 配置"></a>1. 配置</h4><p>新建配置文件<code>exec-memory-logger.properties</code>,其内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#指定agent的sources,sinks,channels</span><br><span class="line">a1.sources = s1  </span><br><span class="line">a1.sinks = k1  </span><br><span class="line">a1.channels = c1  </span><br><span class="line">   </span><br><span class="line">#配置sources属性</span><br><span class="line">a1.sources.s1.type = exec</span><br><span class="line">a1.sources.s1.command = tail -F /tmp/log.txt</span><br><span class="line">a1.sources.s1.shell = /bin/bash -c</span><br><span class="line"></span><br><span class="line">#将sources与channels进行绑定</span><br><span class="line">a1.sources.s1.channels = c1</span><br><span class="line">   </span><br><span class="line">#配置sink </span><br><span class="line">a1.sinks.k1.type = logger</span><br><span class="line"></span><br><span class="line">#将sinks与channels进行绑定  </span><br><span class="line">a1.sinks.k1.channel = c1  </span><br><span class="line">   </span><br><span class="line">#配置channel类型</span><br><span class="line">a1.channels.c1.type = memory</span><br></pre></td></tr></table></figure>
<h4 id="2-启动"><a href="#2-启动" class="headerlink" title="2. 启动　"></a>2. 启动　</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flume-ng agent \</span><br><span class="line">--conf conf \</span><br><span class="line">--conf-file /usr/app/apache-flume-1.6.0-cdh5.15.2-bin/examples/exec-memory-logger.properties \</span><br><span class="line">--name a1 \</span><br><span class="line">-Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>
<h4 id="3-测试"><a href="#3-测试" class="headerlink" title="3. 测试"></a>3. 测试</h4><p>向文件中追加数据：</p>
<div align="center"> <img src="/img/bigdata/flume-example-1.png"> </div>

<p>控制台的显示：</p>
<div align="center"> <img src="/img/bigdata/flume-example-2.png"> </div>



<h3 id="6-2-案例二"><a href="#6-2-案例二" class="headerlink" title="6.2 案例二"></a>6.2 案例二</h3><p>需求： 监听指定目录，将目录下新增加的文件存储到HDFS。</p>
<p>实现：使用<code>Spooling Directory Source</code>和<code>HDFS Sink</code>。</p>
<h4 id="1-配置-1"><a href="#1-配置-1" class="headerlink" title="1. 配置"></a>1. 配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#指定agent的sources,sinks,channels</span><br><span class="line">a1.sources = s1  </span><br><span class="line">a1.sinks = k1  </span><br><span class="line">a1.channels = c1  </span><br><span class="line">   </span><br><span class="line">#配置sources属性</span><br><span class="line">a1.sources.s1.type =spooldir  </span><br><span class="line">a1.sources.s1.spoolDir =/tmp/logs</span><br><span class="line">a1.sources.s1.basenameHeader = true</span><br><span class="line">a1.sources.s1.basenameHeaderKey = fileName </span><br><span class="line">#将sources与channels进行绑定  </span><br><span class="line">a1.sources.s1.channels =c1 </span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">#配置sink </span><br><span class="line">a1.sinks.k1.type = hdfs</span><br><span class="line">a1.sinks.k1.hdfs.path = /flume/events/%y-%m-%d/%H/</span><br><span class="line">a1.sinks.k1.hdfs.filePrefix = %&#123;fileName&#125;</span><br><span class="line">#生成的文件类型，默认是Sequencefile，可用DataStream，则为普通文本</span><br><span class="line">a1.sinks.k1.hdfs.fileType = DataStream  </span><br><span class="line">a1.sinks.k1.hdfs.useLocalTimeStamp = true</span><br><span class="line">#将sinks与channels进行绑定  </span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line">   </span><br><span class="line">#配置channel类型</span><br><span class="line">a1.channels.c1.type = memory</span><br></pre></td></tr></table></figure>
<h4 id="2-启动-1"><a href="#2-启动-1" class="headerlink" title="2. 启动"></a>2. 启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flume-ng agent \</span><br><span class="line">--conf conf \</span><br><span class="line">--conf-file /usr/app/apache-flume-1.6.0-cdh5.15.2-bin/examples/spooling-memory-hdfs.properties \</span><br><span class="line">--name a1 -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>
<h4 id="3-测试-1"><a href="#3-测试-1" class="headerlink" title="3. 测试"></a>3. 测试</h4><p>拷贝任意文件到监听目录下，可以从日志看到文件上传到HDFS的路径：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> cp log.txt logs/</span></span><br></pre></td></tr></table></figure>
<div align="center"> <img src="/img/bigdata/flume-example-3.png"> </div>

<p>查看上传到HDFS上的文件内容与本地是否一致：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> hdfs dfs -cat /flume/events/19-04-09/13/log.txt.1554788567801</span></span><br></pre></td></tr></table></figure>
<div align="center"> <img src="/img/bigdata/flume-example-4.png"> </div>



<h3 id="6-3-案例三"><a href="#6-3-案例三" class="headerlink" title="6.3 案例三"></a>6.3 案例三</h3><p>需求： 将本服务器收集到的数据发送到另外一台服务器。</p>
<p>实现：使用<code>avro sources</code>和<code>avro Sink</code>实现。</p>
<h4 id="1-配置日志收集Flume"><a href="#1-配置日志收集Flume" class="headerlink" title="1. 配置日志收集Flume"></a>1. 配置日志收集Flume</h4><p>新建配置<code>netcat-memory-avro.properties</code>，监听文件内容变化，然后将新的文件内容通过<code>avro sink</code>发送到hadoop001这台服务器的8888端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#指定agent的sources,sinks,channels</span><br><span class="line">a1.sources = s1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">#配置sources属性</span><br><span class="line">a1.sources.s1.type = exec</span><br><span class="line">a1.sources.s1.command = tail -F /tmp/log.txt</span><br><span class="line">a1.sources.s1.shell = /bin/bash -c</span><br><span class="line">a1.sources.s1.channels = c1</span><br><span class="line"></span><br><span class="line">#配置sink</span><br><span class="line">a1.sinks.k1.type = avro</span><br><span class="line">a1.sinks.k1.hostname = hadoop001</span><br><span class="line">a1.sinks.k1.port = 8888</span><br><span class="line">a1.sinks.k1.batch-size = 1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line">#配置channel类型</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br></pre></td></tr></table></figure>
<h4 id="2-配置日志聚合Flume"><a href="#2-配置日志聚合Flume" class="headerlink" title="2. 配置日志聚合Flume"></a>2. 配置日志聚合Flume</h4><p>使用 <code>avro source</code>监听hadoop001服务器的8888端口，将获取到内容输出到控制台：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#指定agent的sources,sinks,channels</span><br><span class="line">a2.sources = s2</span><br><span class="line">a2.sinks = k2</span><br><span class="line">a2.channels = c2</span><br><span class="line"></span><br><span class="line">#配置sources属性</span><br><span class="line">a2.sources.s2.type = avro</span><br><span class="line">a2.sources.s2.bind = hadoop001</span><br><span class="line">a2.sources.s2.port = 8888</span><br><span class="line"></span><br><span class="line">#将sources与channels进行绑定</span><br><span class="line">a2.sources.s2.channels = c2</span><br><span class="line"></span><br><span class="line">#配置sink</span><br><span class="line">a2.sinks.k2.type = logger</span><br><span class="line"></span><br><span class="line">#将sinks与channels进行绑定</span><br><span class="line">a2.sinks.k2.channel = c2</span><br><span class="line"></span><br><span class="line">#配置channel类型</span><br><span class="line">a2.channels.c2.type = memory</span><br><span class="line">a2.channels.c2.capacity = 1000</span><br><span class="line">a2.channels.c2.transactionCapacity = 100</span><br></pre></td></tr></table></figure>
<h4 id="3-启动"><a href="#3-启动" class="headerlink" title="3. 启动"></a>3. 启动</h4><p>启动日志聚集Flume：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flume-ng agent \</span><br><span class="line">--conf conf \</span><br><span class="line">--conf-file /usr/app/apache-flume-1.6.0-cdh5.15.2-bin/examples/avro-memory-logger.properties \</span><br><span class="line">--name a2 -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>
<p>在启动日志收集Flume:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flume-ng agent \</span><br><span class="line">--conf conf \</span><br><span class="line">--conf-file /usr/app/apache-flume-1.6.0-cdh5.15.2-bin/examples/netcat-memory-avro.properties \</span><br><span class="line">--name a1 -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>
<p>这里建议按以上顺序启动，原因是<code>avro.source</code>会先与端口进行绑定，这样<code>avro sink</code>连接时才不会报无法连接的异常。但是即使不按顺序启动也是没关系的，<code>sink</code>会一直重试，直至建立好连接。</p>
<div align="center"> <img src="/img/bigdata/flume-retry.png"> </div>

<h4 id="4-测试"><a href="#4-测试" class="headerlink" title="4.测试"></a>4.测试</h4><p>向文件<code>tmp/log.txt</code>中追加内容：</p>
<div align="center"> <img src="/img/bigdata/flume-example-8.png"> </div>

<p>可以看到已经从8888端口监听到内容，并成功输出到控制台：</p>
<div align="center"> <img src="/img/bigdata/flume-example-9.png"> </div>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2019/07/100438.html" class="pre-post btn btn-default" title='Flume整合Kafka'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">Flume整合Kafka</span>
        </a>
    
    
        <a href="/archives/2019/07/100436.html" class="next-post btn btn-default" title='Zookeeper ACL权限控制'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">Zookeeper ACL权限控制</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、Flume简介"><span class="toc-text">一、Flume简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、Flume架构和基本概念"><span class="toc-text">二、Flume架构和基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-基本架构"><span class="toc-text">2.1 基本架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-基本概念"><span class="toc-text">2.2 基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-组件种类"><span class="toc-text">2.3 组件种类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、Flume架构模式"><span class="toc-text">三、Flume架构模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-multi-agent-flow"><span class="toc-text">3.1 multi-agent flow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Consolidation"><span class="toc-text">3.2 Consolidation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Multiplexing-the-flow"><span class="toc-text">3.3 Multiplexing the flow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、Flume配置格式"><span class="toc-text">四、Flume配置格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、Flume的安装部署"><span class="toc-text">五、Flume的安装部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、Flume使用案例"><span class="toc-text">六、Flume使用案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-案例一"><span class="toc-text">6.1 案例一</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-配置"><span class="toc-text">1. 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-启动"><span class="toc-text">2. 启动　</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-测试"><span class="toc-text">3. 测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-案例二"><span class="toc-text">6.2 案例二</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-配置-1"><span class="toc-text">1. 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-启动-1"><span class="toc-text">2. 启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-测试-1"><span class="toc-text">3. 测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-案例三"><span class="toc-text">6.3 案例三</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-配置日志收集Flume"><span class="toc-text">1. 配置日志收集Flume</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-配置日志聚合Flume"><span class="toc-text">2. 配置日志聚合Flume</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-启动"><span class="toc-text">3. 启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-测试"><span class="toc-text">4.测试</span></a></li></ol></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2023&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>