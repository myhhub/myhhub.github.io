<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="hadoop,tdh,inceptor">


    <meta name="description" content="简介Inceptor是一种交互式分析引擎，本质是一种SQL翻译器。Inceptor中一共可以操作五种类型的表结构：
1. 普通文本表（TXT表） 
2. 分区表（分单值分区和范围分区）
3. 分...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>大数据hadoop之 五十三.TDH Inceptor-SQL使用 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="大数据hadoop之 五十三.TDH Inceptor-SQL使用">
            
	            大数据hadoop之 五十三.TDH Inceptor-SQL使用
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/cloud/">云计算</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/hadoop/">hadoop</a> <a class="tag-link" href="/tags/inceptor/">inceptor</a> <a class="tag-link" href="/tags/tdh/">tdh</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/07/03</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1839</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Inceptor是一种交互式分析引擎，本质是一种SQL翻译器。Inceptor中一共可以操作五种类型的表结构：</p>
<p><strong>1. 普通文本表（TXT表）</strong> </p>
<p><strong>2. 分区表（分单值分区和范围分区）</strong></p>
<p><strong>3. 分桶表</strong></p>
<p><strong>4. ORC表（Hive ORC格式）</strong></p>
<p><strong>5. ORC事务表（可进行增删改查操作，必须建立分桶表和外表，且两个表的表格式要和源数据字段一一对应起来）</strong></p>
<p>注意：一般来说分区和分桶是结合来使用的，例如先将一个大表按照时间进行分区，再对每个分区进行分桶。</p>
<h2 id="一、普通表导入数据"><a href="#一、普通表导入数据" class="headerlink" title="一、普通表导入数据"></a>一、普通表导入数据</h2><h3 id="1-从HDFS导入数据"><a href="#1-从HDFS导入数据" class="headerlink" title="1) 从HDFS导入数据"></a>1) 从HDFS导入数据</h3><ol>
<li>创建HDFS数据目录，在本地创建一个存放数据的文件夹，为了区分不同用户和不同数据源，建立以下两个目录</li>
</ol>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop <span class="built_in">fs</span> -<span class="built_in">mkdir</span> -p /user/user1/data／inceptor</span><br><span class="line">hadoop <span class="built_in">fs</span> -<span class="built_in">mkdir</span> -p /user/user1/data／hyperbase</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>首先将本地path存放的数据文件put到HDFS目录中，数据可以存放在集群中的任意一台机器中（注意本步操作可能会报load数据没有权限，HDFS上的数据和表的权限不一致<br>使用：（sudo -u hdfs hadoop fs -chown -R hive /user/＊）命令进行owner的修改，hive为owner名字）或者使用sudo -u hdfs hadoop fs -chmod -R 777 /user/*</li>
</ol>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -put <span class="params">&lt;path&gt;</span>/data.txt <span class="meta-keyword">/user/</span>user1<span class="meta-keyword">/data/</span>inceptor</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>将上传进HDFS的文件load到Inceptor事先建立好的s3表中,在Inceptor中输入如下命令：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath ‘/<span class="keyword">user</span>/user1/<span class="keyword">data</span>/inceptor/data.txt’ <span class="keyword">into</span> <span class="keyword">table</span> s3;</span><br></pre></td></tr></table></figure>
<h3 id="2-从其他表导入"><a href="#2-从其他表导入" class="headerlink" title="2) 从其他表导入"></a>2) 从其他表导入</h3><ol>
<li>将t3的表结构复制给t4，注意不复制数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t4 <span class="keyword">like</span> t3;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>查看</li>
</ol>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t4;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>将t3表中的数据插入到t4表中</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> t4 <span class="keyword">select</span> * <span class="keyword">from</span> t3;</span><br></pre></td></tr></table></figure>
<h2 id="二、分区表"><a href="#二、分区表" class="headerlink" title="二、分区表"></a>二、分区表</h2><h3 id="1-创建单值分区"><a href="#1-创建单值分区" class="headerlink" title="1) 创建单值分区"></a>1) 创建单值分区</h3><ol>
<li>创建单值分区表（每创建一个单值分区表就会产生一个小文件，这里只有一个name值）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> single_tbl(<span class="keyword">name</span> <span class="keyword">string</span>) partitioned <span class="keyword">by</span>(<span class="keyword">level</span> <span class="keyword">string</span>);</span><br></pre></td></tr></table></figure>
<p>(注意后面的partition分区键和文本是无关的！文本只导入name！分区键是通过load语句中的level具体标识来指定的)</p>
<ol start="2">
<li>把本地包含单列数据的txt文件put到HDFS中的/user/datadir目录中</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -put /tmp/<span class="selector-tag">a</span><span class="selector-class">.txt</span> /user/datadir</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>将HDFS中的a.txt文件load到single_tbl单值分区表，即将a这个文档都设置成A标签</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath ‘<span class="keyword">user</span>/datadir/a.txt’ single_tbl <span class="keyword">partition</span>(<span class="keyword">level</span>=<span class="string">'A'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="2-创建范围分区表"><a href="#2-创建范围分区表" class="headerlink" title="2) 创建范围分区表"></a>2) 创建范围分区表</h3><p>（用于避免全表扫描，快速检索，导入数据的方法也很少，只能通过从另一个表插入到范围表中，其产生原因是为了规避单值分区每创建一个表就会产生一个小文件，而范围分区则是每个分区存储一个文件）</p>
<ol>
<li>创建范围分区表rangepart</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> rangepart(<span class="keyword">name</span> <span class="keyword">string</span>)partitioned <span class="keyword">by</span> <span class="keyword">range</span>(age <span class="built_in">int</span>)(</span><br><span class="line">            <span class="keyword">partition</span> <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span>(<span class="number">30</span>),</span><br><span class="line">            <span class="keyword">partition</span> <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span>(<span class="number">40</span>),</span><br><span class="line">            <span class="keyword">partition</span> <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span>(<span class="number">50</span>),</span><br><span class="line">            <span class="keyword">partition</span> <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span>(MAXVALUE)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>（注意分区表为左闭右开区间）</strong></p>
<ol start="2">
<li>将本地文件或文件夹put到HDFS的user/datadir的目录中</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -put /tmp/<span class="selector-tag">b</span><span class="selector-class">.txt</span> user/datadir</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>创建外表，来将HDFS中的文件进行导入进来(外表是用来指定导入数据格式的，且drop外表时，HDFS上的数据还存在)</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> userinfo(<span class="keyword">name</span> <span class="keyword">string</span>,age <span class="built_in">int</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> location <span class="string">'user/datadir'</span>;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>将外表的数据插入到建立好的rangepart表中</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> rangepart <span class="keyword">select</span> * <span class="keyword">from</span> userinfo;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>查看插入分区表里的数据分布</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">partitions</span> rangepart;</span><br></pre></td></tr></table></figure>
<h2 id="三、分桶表"><a href="#三、分桶表" class="headerlink" title="三、分桶表"></a>三、分桶表</h2><p>（必须创建外表，只支持从外表导入数据，在分桶表中经常做聚合和join操作，速度非常快。另外分桶规则主要分为1、int型，按照数值取模，分几个桶就模几2、string型，按照hash表来分桶）</p>
<ol>
<li>创建分桶表bucket_tbl(这里分桶的大小是用表的总数据大小除以200M，经实际优化测试，每个桶的数据为200M处理速度最优)</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> bucket_tbl(<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">string</span>) clustered <span class="keyword">by</span> (<span class="keyword">id</span>) <span class="keyword">into</span> <span class="number">3</span> buckets;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>创建外表bucket_info,bucket_info表会自动将HDFS目录/user/datadir中的数据自动load进表里，这和普通表需要手动进行load不一样</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> bucket_info(<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">string</span>)<span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> location <span class="string">'/user/datadir'</span>;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>将从本地txt文件put到HDFS中的表（如普通表），再load进外表中</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath <span class="string">'/user/tdh/data/bucket-data'</span> <span class="keyword">into</span> <span class="keyword">table</span> bucket_info;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>设置分桶开关</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> hive.enforce.<span class="attribute">bucketing</span>=<span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>插入数据（按照取模大小顺序排列）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> bucket_tbl <span class="keyword">select</span> *<span class="keyword">from</span> bucket_info;</span><br></pre></td></tr></table></figure>
<h2 id="四、holodesk表"><a href="#四、holodesk表" class="headerlink" title="四、holodesk表"></a>四、holodesk表</h2><p>（holodesk表既可以基于内存也可以基于ssd存储和查询，holodesk会存两份，一份存在内存或者ssd中，一份存在HDFS中，这样可能在查询的性能上有所延迟）holodesk最擅长处理groupby的SQL查询语句</p>
<p>说明：建立holodesk表之前最好先建立cube，cube一般为3-5列，表很小，在Inceptor中建立cube内表，取的速度很快，遍历会很快，cube不能将所有的数据都放入内存，所以建内表时，将部分需要的数据放在内存中，因为cube只有3-4列，大大简化了原ssd中的大数据集，查询速度会很快，所以说一般holodesk是和cube配合使用的。内存表创建有两种方式：第一种通过CTAS建表，建表时数据即填入，这种情况下，内存表不能分区或者分桶。第二种通过创建空表，此时内存表可以分区或者分桶，之后可以通过Insert into select插入数据。</p>
<p>（1）通过CTAS（create table…as select）建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> table_name tblproperties(<span class="string">"cache"</span>=<span class="string">"cache_medium"</span>,<span class="string">"cache.checkpoint"</span>=<span class="string">"true|false"</span>,[<span class="string">"filters"</span>=<span class="string">"filter_type"</span>]) <span class="keyword">as</span> <span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,sex,<span class="built_in">date</span> <span class="keyword">from</span> user_info;</span><br></pre></td></tr></table></figure>
<p>（2）通过创建空表建表，再插入数据</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name (<span class="name">column_name</span> data_type, column_name data_type...) PARTITIONED BY (<span class="name">partition_key</span> data_type, partition_key data_type) CLUSTERED BY (<span class="name">cluster_key</span>,</span><br><span class="line">cluster_key, ...) INTO n BUCKETS TBLPROPERTIES (<span class="string">"cache"</span> = <span class="string">"cache_medium"</span>, <span class="string">"cache.checkpoint"</span>=<span class="string">"true|false"</span>, [<span class="string">"filters"</span>=<span class="string">"filter_type"</span>])</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<p>“cache”=”cache_medium”指定计算缓存的介质。可以选择ram,SSD和memeory三种。只有当服务器上配置有SSD时,才可以选择SSD作为缓存,Inceptor会自动利用SSD为计算加速。”</p>
<p>cache.checkpoint”=”true|false”指定是否设置checkpoint。如果设置checkpoint,查询 结果会被同步放入HDFS中,在存储了内存表的机器当机时,内存表中的数据可以从HDFS中 直接读取恢复而不需要重新进行查询计算。<br>“filters”=”filter_type”为可选项,它指定一个过滤器。利用过滤器可以为某些查询进行优化</p>
<h2 id="五、建立ORC格式表，如下三种方式"><a href="#五、建立ORC格式表，如下三种方式" class="headerlink" title="五、建立ORC格式表，如下三种方式"></a>五、建立ORC格式表，如下三种方式</h2><p>（1）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> country（<span class="keyword">id</span> <span class="built_in">int</span>，country <span class="keyword">string</span>）<span class="keyword">stored</span> <span class="keyword">as</span> orc;</span><br></pre></td></tr></table></figure>
<p>（2）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> ex_tbl(<span class="keyword">id</span> <span class="built_in">int</span>,country <span class="keyword">string</span>)</span><br><span class="line">        <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">        <span class="keyword">stored</span> <span class="keyword">as</span> textfile</span><br><span class="line">        location <span class="string">'/user/tdh/externaltbl'</span>;</span><br></pre></td></tr></table></figure>
<p>（3）</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> country <span class="keyword">select</span> * <span class="keyword">from</span> ex_tbl;</span><br></pre></td></tr></table></figure>
<h2 id="六、建立ORC格式事务表"><a href="#六、建立ORC格式事务表" class="headerlink" title="六、建立ORC格式事务表"></a>六、建立ORC格式事务表</h2><p>（必须要分桶，既可以单值插入，又可以通过外表插入）<br>（1）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> orc_tbl(<span class="keyword">id</span> <span class="built_in">int</span>, country <span class="keyword">string</span>) clustered <span class="keyword">by</span> (<span class="keyword">id</span>) <span class="keyword">into</span> <span class="number">3</span> buckets <span class="keyword">stored</span> <span class="keyword">as</span> orc tblproperties(<span class="string">"transactional"</span> = <span class="string">"true"</span>);</span><br></pre></td></tr></table></figure>
<p>（2）(创建外表需要注意的是，一定要指定分隔符，不然当external表自动加载HDFS中的/user/datadir时不知道以什么分隔数据，造成查询出的数据全部都是null值)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> external_tbl(<span class="keyword">id</span> <span class="built_in">int</span>,country <span class="keyword">string</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> location <span class="string">'/user/datadir'</span>;</span><br></pre></td></tr></table></figure>
<p>（3）设置分桶开关</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> hive.enforce.<span class="attribute">bucketing</span>=<span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<p>（4）</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> orc_tbl <span class="keyword">select</span> * <span class="keyword">from</span> external_tbl;</span><br></pre></td></tr></table></figure>
<p>（注意：ORC只是一种表的格式类型，建表时指定了transactional” = “true”，则表明这是一个事务表，必须要分桶，若没有指定则只是普通的ORC表，不需要进行分桶操作）</p>
<h2 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h2><ul>
<li><p>HDFS不能直接load到Inceptor中的ORC事务表中，(只能load到普通表和ORC表中)要想在ORC事务表里插入数据有两种方法：a.建立一张外表，再将HDFS load进外表上，再insert into select * from external table    b.由于ORC事务表支持增删改查，也可以使用单值插入语句insert into table country values(101,japan)</p>
</li>
<li><p>查看分区表的命令是show partitions [table名] </p>
</li>
<li><p>查看每个表的创建时语句命令是show create table [table名]</p>
</li>
<li><p>使用命令hdfs dfs -ls /user/country（或者使用hadoop fs -ls /user/country命令）</p>
</li>
<li><p>默认数据库存放位置<br>hdfs：//nameservice/inceptorsql1/user/hive/warehouse/<br>在Inceptor创建数据库时一般使用它的default默认数据库，若自己建立数据库请不要指定location，还有自己建立的数据库可能会因为权限不够而造成一些操作失败报错。可以使用hadoop fs -ls /inceptorsql1/user/hive/warehouse查看默认目录下存储的数据<br>，eg：</p>
</li>
</ul>
<p>（1）</p>
<pre><code>    create database ccc location &apos;/user/ccc&apos;；

    create table ccc1;

上述语句建立的数据库位置为user/ccc/hive/ccc1
</code></pre><p>（2）</p>
<pre><code>    create table ccc2(a int) location &apos;user/ccc2&apos;;
上述语句建立表的位置在user/ccc2
</code></pre><ul>
<li><p>外表的作用是load导数据使用的，起到的是媒介作用，而ORC表则是做具体的操作的，外表一般是和ORC事务表配合使用的</p>
</li>
<li><p>分区表中的单值插入数据必须指定level</p>
</li>
<li><p>分桶中的桶大小，即一个文件大小一般为200M，处理效率最优，拿总文件大小除以200M就大概预估出分几个桶了</p>
</li>
<li><p>从HDFS中向Mysql中导入数据规定必须先在Mysql中创建临时表，先从HDFS的location目录下导入到tmp表中，再从tmp表导入到Mysql真正的表中</p>
</li>
<li><p>Flume需要先使用yum install flume命令安装，Flume的默认存放位置为/user/lib/flume/conf/flume.conf，vi进去后进行相应的修改，有两个位置需要注意，第一个是spoolDir后跟log所在HDFS中的文件夹名！切记，不是跟具体的log文件或者txt文件！（如：spoolDir=/tmp/flume/），第二个是path后面是Active NameNode的HDFS路径<br>（如：path=hdfs://172.16.2.77:8020/user/datadir），在flume.conf配置中默认指定缓冲区积攒到1k就写入HDFS中</p>
</li>
<li><p>养成在Inceptor中使用命令desc formatted &lt;table名&gt;;来查看各个表的底层结构和属性</p>
</li>
<li><p>hadoop fs：命令使用面最广，可以操作任何文件系统。</p>
<p>hdfs dfs：命令只能操作HDFS文件系统相关。</p>
</li>
</ul>
<h2 id="附录（示例代码）"><a href="#附录（示例代码）" class="headerlink" title="附录（示例代码）"></a>附录（示例代码）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--登录Inceptor server节点</span></span><br><span class="line">beeline -u jdbc:hive2://172.16.2.75:10000/</span><br><span class="line"></span><br><span class="line"><span class="comment">--DDL</span></span><br><span class="line"><span class="comment">--创建数据库(location 中文件的权限需和数据库owner一致)</span></span><br><span class="line"><span class="comment">--没有指定location，则数据库放在默认位置</span></span><br><span class="line"><span class="comment">--额外属性</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> db4</span><br><span class="line"><span class="keyword">comment</span> <span class="string">'this is a database'</span></span><br><span class="line">location <span class="string">'/user/test/'</span></span><br><span class="line"><span class="keyword">with</span> dbproperties(<span class="string">'owener'</span> = <span class="string">'transwarp'</span>,<span class="string">'time'</span>=<span class="string">'2016'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--在默认位置创建数据库，使用desc 查看数据库 </span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> db2;</span><br><span class="line"> </span><br><span class="line"><span class="comment">--删除数据库(数据库需为空)</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> dbname</span><br><span class="line"></span><br><span class="line"><span class="comment">--描述数据库</span></span><br><span class="line"><span class="keyword">describe</span> <span class="keyword">database</span> dbname;</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改数据库</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> db1 <span class="keyword">set</span> dbproperties(<span class="string">'owener'</span>=<span class="string">'hehe'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">----------------------------创建简单text表--------------------------</span></span><br><span class="line"><span class="comment">--创建普通text表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1(col1 <span class="keyword">string</span>, col2 <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t3(col1 <span class="built_in">int</span>, col2 <span class="keyword">string</span>)<span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> location <span class="string">'/user/datadir'</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t2 <span class="keyword">like</span> t1;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t4 <span class="keyword">as</span> <span class="keyword">select</span> col1 <span class="keyword">from</span> t3;</span><br><span class="line"></span><br><span class="line"><span class="comment">--导入数据</span></span><br><span class="line"><span class="comment">--从hdfs导入数据(注意owner)</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath <span class="string">'/user/datadir/data'</span> <span class="keyword">into</span> <span class="keyword">table</span> t3;</span><br><span class="line"></span><br><span class="line"><span class="comment">--从其他表中插入</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> t4 <span class="keyword">select</span> * <span class="keyword">from</span> t3;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建分区表</span></span><br><span class="line"><span class="comment">--单值分区</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> part_t6(<span class="keyword">name</span> <span class="keyword">string</span>) partitioned <span class="keyword">by</span> (<span class="keyword">level</span> <span class="keyword">string</span>);</span><br><span class="line"><span class="comment">--分区表导入数据，一次导入一个分区。分区键是从sql语句中定义，并不是从文件中导入。</span></span><br><span class="line"><span class="comment">--在本句中，如果文件有两列数据，则第二列是无效的。</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath <span class="string">'/user/datadir/part-data1'</span> <span class="keyword">into</span> <span class="keyword">table</span> part_t6 <span class="keyword">partition</span>(<span class="keyword">level</span>=<span class="string">'A'</span>)//<span class="keyword">level</span>变成A</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建范围分区表(不支持从文件导入分区表，支持insert into select from)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> rangepart_t7 (<span class="keyword">name</span> <span class="keyword">string</span>)partitioned <span class="keyword">by</span> <span class="keyword">range</span>(age <span class="built_in">int</span>)(</span><br><span class="line"><span class="keyword">partition</span> <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span>(<span class="number">30</span>),</span><br><span class="line"><span class="keyword">partition</span> <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span>(<span class="number">40</span>),</span><br><span class="line"><span class="keyword">partition</span> <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span>(<span class="number">50</span>),</span><br><span class="line"><span class="keyword">partition</span> <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span>(MAXVALUE)</span><br><span class="line">);</span><br><span class="line"><span class="comment">--普通数据表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> user_info(<span class="keyword">name</span> <span class="keyword">string</span>, age <span class="built_in">int</span>)<span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> location <span class="string">'/user/datadir'</span>;</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath <span class="string">'/user/tdh/data/range-part1'</span> <span class="keyword">into</span> <span class="keyword">table</span> user_info;</span><br><span class="line"><span class="comment">--通过普通数据表向范围分区表插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> rangepart_t7 <span class="keyword">select</span> * <span class="keyword">from</span> user_info;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> range_part_t6;</span><br><span class="line"><span class="comment">--查看分区信息</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">partitions</span> rangepart_t7;</span><br><span class="line"><span class="comment">--查看底层文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--分桶表创建(数据只能通过insert插入，load无效)</span></span><br><span class="line"><span class="comment">--创建分桶表</span></span><br><span class="line"><span class="comment">--在windows下创建的文本文件是一\r\n换行，在unix下以\n换行，</span></span><br><span class="line"><span class="comment">--导入数据应该是unix格式的。</span></span><br><span class="line"><span class="comment">---以数字为bucket id</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> bucket_tbl;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> bucket_tbl(<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">string</span>)clustered <span class="keyword">by</span> (<span class="keyword">id</span>) <span class="keyword">into</span> <span class="number">3</span> buckets;</span><br><span class="line"><span class="comment">--创建普通数据表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> bucket_info;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> bucket_info(<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">string</span>)<span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> location <span class="string">'/user/datadir'</span>;</span><br><span class="line"><span class="comment">--导入数据到数据表中</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath <span class="string">'/user/tdh/data/bucket-data'</span> <span class="keyword">into</span> <span class="keyword">table</span> bucket_info;</span><br><span class="line"><span class="comment">--插入数据到分桶表中</span></span><br><span class="line"><span class="keyword">set</span> hive.enforce.bucketing = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> bucket_tbl <span class="keyword">select</span> *<span class="keyword">from</span> bucket_info; </span><br><span class="line"></span><br><span class="line"><span class="comment">---以字符串为bucket id,</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> bucket_tbl;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> bucket_tbl(<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">string</span>)clustered <span class="keyword">by</span> (<span class="keyword">name</span>) <span class="keyword">into</span> <span class="number">3</span> buckets;</span><br><span class="line"><span class="comment">--创建普通数据表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> bucket_info;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> bucket_info(<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">string</span>)<span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> location <span class="string">'/user/datadir'</span>;</span><br><span class="line"><span class="comment">--导入数据到数据表中</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath <span class="string">'/user/tdh/data/bucket-data'</span> <span class="keyword">into</span> <span class="keyword">table</span> bucket_info;</span><br><span class="line"><span class="comment">--插入数据到分桶表中</span></span><br><span class="line"><span class="keyword">set</span> hive.enforce.bucketing = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> bucket_tbl <span class="keyword">select</span> *<span class="keyword">from</span> bucket_info;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">----创建外表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> ;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> ex_tbl(<span class="keyword">id</span> <span class="built_in">int</span>,country <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line"><span class="keyword">stored</span> <span class="keyword">as</span> textfile</span><br><span class="line">location <span class="string">'/user/tdh/externaltbl'</span>;</span><br><span class="line"><span class="comment">----------------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">----建立ORC表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> country;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> country (<span class="keyword">id</span> <span class="built_in">int</span>, country <span class="keyword">string</span>)<span class="keyword">stored</span> <span class="keyword">as</span> orc;</span><br><span class="line"></span><br><span class="line"><span class="comment">----建立ORC事务表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> country;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span>  country(<span class="keyword">id</span> <span class="built_in">int</span>, country <span class="keyword">string</span>) clustered <span class="keyword">by</span> (<span class="keyword">id</span>)<span class="keyword">into</span> <span class="number">3</span> buckets <span class="keyword">stored</span> <span class="keyword">as</span> orc tblproperties(<span class="string">"transactional"</span> = <span class="string">"true"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> country <span class="keyword">select</span> * <span class="keyword">from</span> ex_tbl;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> country <span class="keyword">values</span>(<span class="number">100</span>,<span class="string">'japan'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> country <span class="keyword">values</span>(<span class="number">101</span>,<span class="string">'isis'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建分区分桶ORC表，分区字段不能用date类型，</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> country;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> country (<span class="keyword">id</span> <span class="built_in">int</span>, country <span class="keyword">string</span>) partitioned <span class="keyword">by</span>(<span class="keyword">level</span> <span class="keyword">string</span>) clustered <span class="keyword">by</span> (<span class="keyword">id</span>)<span class="keyword">into</span> <span class="number">3</span> buckets <span class="keyword">stored</span> <span class="keyword">as</span> orc tblproperties(<span class="string">"transactional"</span> = <span class="string">"true"</span>);</span><br><span class="line"><span class="comment">--从外表插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> country <span class="keyword">partition</span> (<span class="keyword">level</span>=<span class="string">'A'</span>) <span class="keyword">select</span> * <span class="keyword">from</span> ex_tbl <span class="keyword">where</span> <span class="keyword">id</span>&lt;<span class="number">5</span>;</span><br><span class="line"><span class="comment">--单条插入</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> country <span class="keyword">partition</span> (<span class="keyword">level</span>=<span class="string">'C'</span>) <span class="keyword">values</span>(<span class="number">101</span>,<span class="string">'isis'</span>);</span><br></pre></td></tr></table></figure>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2019/07/100360.html" class="pre-post btn btn-default" title='大数据hadoop之 五十四.TDH使用JDBC、ODBC工具连接Inceptor'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">大数据hadoop之 五十四.TDH使用JDBC、ODBC工具连接Inceptor</span>
        </a>
    
    
        <a href="/archives/2019/07/100358.html" class="next-post btn btn-default" title='大数据hadoop之 五十二.TDH Transwarp Manager的安装'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">大数据hadoop之 五十二.TDH Transwarp Manager的安装</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一、普通表导入数据"><span class="toc-text">一、普通表导入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-从HDFS导入数据"><span class="toc-text">1) 从HDFS导入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-从其他表导入"><span class="toc-text">2) 从其他表导入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、分区表"><span class="toc-text">二、分区表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-创建单值分区"><span class="toc-text">1) 创建单值分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-创建范围分区表"><span class="toc-text">2) 创建范围分区表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、分桶表"><span class="toc-text">三、分桶表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、holodesk表"><span class="toc-text">四、holodesk表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、建立ORC格式表，如下三种方式"><span class="toc-text">五、建立ORC格式表，如下三种方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、建立ORC格式事务表"><span class="toc-text">六、建立ORC格式事务表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意事项："><span class="toc-text">注意事项：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附录（示例代码）"><span class="toc-text">附录（示例代码）</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2024&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>