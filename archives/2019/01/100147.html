<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="逆向,汇编,ios" />


    <meta name="description" content="前言网上已经有很多基于CydiaSubstrate的越狱开发教程，使用theos、MonkeyDev进行开发非常方便、高效，而本文则是脱离CydiaSubstrate，以非Unity游戏《干掉月..." />



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />

    <!--Title-->


<title>iOS破解入门教程 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    




<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">





    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx" />


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

<meta name="generator" content="Hexo 7.3.0"></head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="iOS破解入门教程">
            
	            iOS破解入门教程
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/crack/">破解</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-none-link" href="/tags/ios/" rel="tag">ios</a> <a class="tag-none-link" href="/tags/assemble/" rel="tag">汇编</a> <a class="tag-none-link" href="/tags/reverse/" rel="tag">逆向</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/01/02</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>2266</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>网上已经有很多基于CydiaSubstrate的越狱开发教程，使用theos、MonkeyDev进行开发非常方便、高效，而本文则是脱离CydiaSubstrate，以非Unity游戏《干掉月亮》(Shoot The Moon)为例，纯手工打造动态库，注入到游戏中实现破解，虽说效率不比使用CydiaSubstrate来的高，但是能学到很多基本的知识，非常适合新手入门。</p>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="设备"><a href="#设备" class="headerlink" title="设备"></a>设备</h2><ul>
<li>一部越狱的iPhone手机(iOS 11.0~11.1.2)</li>
<li>一台Mac机</li>
</ul>
<h2 id="macOS上的工具"><a href="#macOS上的工具" class="headerlink" title="macOS上的工具"></a>macOS上的工具</h2><ul>
<li>Xcode</li>
<li>Terminal</li>
<li>Console</li>
<li>ssh</li>
<li>scp</li>
<li>Homebrew</li>
<li>usbmuxd</li>
<li>macho_edit</li>
<li>Hopper Disassembler</li>
<li>Impactor</li>
</ul>
<h2 id="iOS上的工具"><a href="#iOS上的工具" class="headerlink" title="iOS上的工具"></a>iOS上的工具</h2><ul>
<li>bfinject</li>
<li>applst</li>
</ul>
<h2 id="App"><a href="#App" class="headerlink" title="App"></a>App</h2><ul>
<li>《干掉月亮》(Shoot The Moon)</li>
</ul>
<h1 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h1><h2 id="Xcode"><a href="#Xcode" class="headerlink" title="Xcode"></a>Xcode</h2><p>从App Store下载，或者从苹果开发者页面下载都可以，下载最新版即可。</p>
<h2 id="Terminal"><a href="#Terminal" class="headerlink" title="Terminal"></a>Terminal</h2><p>macOS自带。许多命令需要在终端上执行。</p>
<h2 id="Console"><a href="#Console" class="headerlink" title="Console"></a>Console</h2><p>macOS自带。查看手机日志。</p>
<h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><p>macOS自带。通过电脑登录手机。</p>
<h2 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h2><p>macOS自带。在手机和电脑间互传文件。</p>
<h2 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h2><p>从<a href="https://brew.sh/">Homebrew官网（brew.sh）</a>下载安装。<br>用于安装各种命令行工具。</p>
<h2 id="usbmuxd"><a href="#usbmuxd" class="headerlink" title="usbmuxd"></a>usbmuxd</h2><p>打开Terminal，使用Homebrew安装。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`$ brew install usbmuxd`</span><span class="string">`# 或者`</span><span class="string">`$ brew install libidevicemobile`</span></span><br></pre></td></tr></table></figure>

<p>将iPhone上的端口通过usb线映射到电脑上的端口。</p>
<h2 id="macho-edit"><a href="#macho-edit" class="headerlink" title="macho_edit"></a>macho_edit</h2><p>从<a href="https://github.com/Tyilo/macho_edit">https://github.com/Tyilo/macho_edit</a>下载源码。<br>编译后可以得到macho_edit可执行文件。<br>用于编辑App的可执行文件。</p>
<h2 id="Hopper-Disassembler"><a href="#Hopper-Disassembler" class="headerlink" title="Hopper Disassembler"></a>Hopper Disassembler</h2><p>请自行搜索下载安装。<br>用于反编译App。</p>
<h2 id="Impactor"><a href="#Impactor" class="headerlink" title="Impactor"></a>Impactor</h2><p>从<a href="http://www.cydiaimpactor.com/">Cydia Impactor官网（www.cydiaimpactor.com）</a>下载。<br>用于安装ipa到手机。</p>
<h2 id="bfinject"><a href="#bfinject" class="headerlink" title="bfinject"></a>bfinject</h2><p>从<a href="https://github.com/BishopFox/bfinject">https://github.com/BishopFox/bfinject</a>下载。<br>根据说明文档，将bfinject放到iPhone中。<br>用来砸壳、动态库注入等。</p>
<h2 id="applst"><a href="#applst" class="headerlink" title="applst"></a>applst</h2><p>从<a href="https://github.com/DeviLeo/AppList">https://github.com/DeviLeo/AppList</a>下载。<br>根据说明文档，将命令行版的applst放到iPhone中。<br>用于列出手机上安装的App及文档目录。</p>
<h2 id="《干掉月亮》-Shoot-The-Moon"><a href="#《干掉月亮》-Shoot-The-Moon" class="headerlink" title="《干掉月亮》(Shoot The Moon)"></a>《干掉月亮》(Shoot The Moon)</h2><p>从<a href="https://itunes.apple.com/cn/app/id809390893">App Store</a>下载。<br>这是一款有趣好玩的游戏。</p>
<h1 id="破解"><a href="#破解" class="headerlink" title="破解"></a>破解</h1><p>开局一台机，过程全靠猜。<br>下面正式进入破解阶段，我会非常啰嗦地写下所有的步骤。<br>如果您有一定地开发经验，尽情跳过所有已会的步骤。</p>
<h2 id="砸壳"><a href="#砸壳" class="headerlink" title="砸壳"></a>砸壳</h2><p>从App Store下载下来的App都是加密的，直接复制出来是无法使用Hopper Disassembler看到任何代码的，所以我们需要砸壳解密。</p>
<h3 id="使用usbmuxd"><a href="#使用usbmuxd" class="headerlink" title="使用usbmuxd"></a>使用usbmuxd</h3><p>如果你的Wifi环境不是很理想，可以使用usbmuxd映射端口走usb线。<br>此处我们映射iPhone上的ssh端口22到macOS上的2222端口，输入以下命令。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$ iproxy ``<span class="number">2222</span>` `22`</span><br></pre></td></tr></table></figure>

<h3 id="ssh登录iPhone"><a href="#ssh登录iPhone" class="headerlink" title="ssh登录iPhone"></a>ssh登录iPhone</h3><p>默认密码是 <strong>alpine</strong>。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`# -p 后面跟端口，默认是22`</span><span class="string">`$ ssh root@localhost `</span><span class="string">`-`</span><span class="string">`p `</span><span class="string">`2222`</span><span class="string">`root@localhost&#x27;s password: `</span><span class="string">`# 输入密码，默认密码是alpine`</span></span><br></pre></td></tr></table></figure>

<h3 id="查询名称及进程ID"><a href="#查询名称及进程ID" class="headerlink" title="查询名称及进程ID"></a>查询名称及进程ID</h3><p>启动《干掉月亮》，查询App名称和进程ID。<br>因为《干掉月亮》的英文名是《Shoot The Moon》，所以我们在搜索进程的时候使用grep来筛选出带有moon的输出行。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$ ps ``-``e | grep moon``<span class="number">1975</span>` `??         ``<span class="number">0</span>``:``<span class="number">59.42</span>` `/``var``/``containers``/``Bundle``/``Application``/``<span class="number">24546</span>F40``-``<span class="number">53</span>DA``-``<span class="number">4</span>C49``-``<span class="number">81</span>C0``-``DED0C13DB814``/``shootthemoon.app``/``shootthemoon`</span><br></pre></td></tr></table></figure>

<h3 id="砸壳-1"><a href="#砸壳-1" class="headerlink" title="砸壳"></a>砸壳</h3><p>有了App名称和进程ID，我们就可以使用bfinject来砸壳了。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`# 以下两条命令二选一，推荐使用App名称` `# 使用App名称``$ bash bfinject ``-``P shootthemoon ``-``L decrypt` `# 使用进程ID``$ bash bfinject ``-``p ``<span class="number">1975</span>` `-``L decrypt` `# 输出结果``[``+``] Liberios detected``[``+``] Injecting into ``&#x27;/var/containers/Bundle/Application/<span class="number">24546</span>F40-<span class="number">53</span>DA-<span class="number">4</span>C49-<span class="number">81</span>C0-DED0C13DB814/shootthemoon.app/shootthemoon&#x27;``[``+``] Getting Team ``ID` `from` `target application...``[``+``] Thinning dylib into non``-``fat arm64 image``[``+``] Signing injectable .dylib with Team ``ID` `A6DVR4V967 ``<span class="literal">and</span>` `platform entitlements...``[bfinject4realz] Calling task_for_pid() ``for` `PID ``<span class="number">1975</span>.``[bfinject4realz] Calling thread_create() on PID ``<span class="number">1975</span>``[bfinject4realz] Looking ``for` `ROP gadget... found at ``<span class="number">0</span>x1826574e0``[bfinject4realz] Fake stack frame at ``<span class="number">0</span>x10b624000``[bfinject4realz] Calling _pthread_set_self() at ``<span class="number">0</span>x182897804``...``[bfinject4realz] Returned ``from` `&#x27;_pthread_set_self&#x27;``[bfinject4realz] Calling dlopen() at ``<span class="number">0</span>x182657460``...``[bfinject4realz] Returned ``from` `&#x27;dlopen&#x27;``[bfinject4realz] Success! Library was loaded at ``<span class="number">0</span>x1c41e2d00``[``+``] So ``long` `and` `thanks ``for` `all` `the fish.`</span><br></pre></td></tr></table></figure>

<p>命令执行完成并不表示砸壳已经完成，需要以App界面的提示为准。<br>下图为砸壳中，务�保持屏幕常亮。</p>
<div align="center">![img](/img/posts/320395_25GJHW5W5CG8RTX.png)</div>

 

<p>下图为砸壳完成。</p>
<div align="center">![img](/img/posts/320395_CBK6RCGN8E78AFW.png)</div>

<p>如果你会使用NetCat，选择YES，将砸壳后的App传到电脑上。否则选择No，稍后使用scp来传输文件。<br>砸壳后的文件在App的文档目录下，名字为decrypted.ipa。</p>
<p><strong>注意</strong>：<br>1、bfinject命令必须在bfinject目录下执行，在其它目录下执行会出错。<br>2、如果砸壳过程中出现闪退，按Ctrl+C退出，重启App，再执行一遍砸壳命令即可。</p>
<h3 id="找到《干掉月亮》的App文档目录"><a href="#找到《干掉月亮》的App文档目录" class="headerlink" title="找到《干掉月亮》的App文档目录"></a>找到《干掉月亮》的App文档目录</h3><p>此处使用工具applst查询App的文档目录。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`# applst默认会列出所有用户安装的App以及BundleID，``# 使用grep过滤只显示《干掉月亮》的BundleID``$ applst | grep shoot``$ applst com.pipsqueakgames.shootmoon``# 此处会显示《干掉月亮》的相关信息``localizedName:``Shoot Moon` `shortVersionString:``<span class="number">1.6</span>` `vendorName:``Shaun Coleman` `applicationIdentifier:``com.pipsqueakgames.shootmoon` `itemID:``<span class="number">809390893</span>` `itemName:``Shoot The Moon` `teamID:``A6DVR4V967` `bundleURL:``file``:``/``/``/``private``/``var``/``containers``/``Bundle``/``Application``/``<span class="number">24546</span>F40``-``<span class="number">53</span>DA``-``<span class="number">4</span>C49``-``<span class="number">81</span>C0``-``DED0C13DB814``/``shootthemoon.app` `dataContainerURL:``file``:``/``/``/``private``/``var``/``mobile``/``Containers``/``Data``/``Application``/``<span class="number">99</span>B25BD3``-``<span class="number">77</span>BA``-``<span class="number">47</span>F0``-``<span class="number">9503</span>``-``<span class="number">46</span>F912C5A2E4` `applicationType:``User`</span><br></pre></td></tr></table></figure>

<p>其中 <strong>bundleURL</strong> 就是App的目录，<strong>dataContainerURL</strong> 是App的文档目录，数据、缓存、临时文件都存储在这个目录。<br><strong>注意</strong>：少数情况下，一个App可能拥有 <strong>多个dataContainerURL</strong>，applst只能列出其中一个。</p>
<h3 id="传输砸壳后的文件"><a href="#传输砸壳后的文件" class="headerlink" title="传输砸壳后的文件"></a>传输砸壳后的文件</h3><p>电脑上输入以下命令，将Documents目录下的decrypted-app.ipa传到电脑上。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`# -P 后面跟端口，默认是<span class="number">22</span>``$ scp ``-``P ``<span class="number">2222</span>` `root@localhost:``/``private``/``var``/``mobile``/``Containers``/``Data``/``Application``/``<span class="number">99</span>B25BD3``-``<span class="number">77</span>BA``-``<span class="number">47</span>F0``-``<span class="number">9503</span>``-``<span class="number">46</span>F912C5A2E4``/``Documents``/``decrypted``-``app.ipa .``/``root@localhost&#x27;s password: ``# 输入密码，与ssh登录时的密码相同`</span><br></pre></td></tr></table></figure>

<h2 id="破解-1"><a href="#破解-1" class="headerlink" title="破解"></a>破解</h2><h3 id="解压砸壳后的ipa"><a href="#解压砸壳后的ipa" class="headerlink" title="解压砸壳后的ipa"></a>解压砸壳后的ipa</h3><p>如下图，选中ipa文件，右键选择解压工具解压，使用系统默认的解压工具即可。</p>
<div align="center">![img](/img/posts/320395_42V4GCJ676QNF4K.png)</div>

<h3 id="备份可执行文件"><a href="#备份可执行文件" class="headerlink" title="备份可执行文件"></a>备份可执行文件</h3><p>解压后得到一个文件夹叫Payload，里面有shootthemoon.app，其实是一个文件夹。<br>如下图，选中后右键选择显示包内容。</p>
<div align="center">![img](/img/posts/320395_94EMFQHAZ8DCG7V.png)</div>

<p>找到 <strong>shootthemoon</strong> 没有后缀名的文件，这是一个砸壳后的Mach-O格式的可执行文件。<br>复制一份到其它目录，准备拿它开刀。</p>
<h3 id="使用Hopper-Disassembler"><a href="#使用Hopper-Disassembler" class="headerlink" title="使用Hopper Disassembler"></a>使用Hopper Disassembler</h3><p>启动Hopper Disassembler，菜单栏中选择File-&gt;Read Executable to Disassembler…，或者按下快捷键Command+Shift+O，弹出的对话框中选择 <strong>shootthemoon</strong> 文件，再点击OK。<br>紧接着会弹出如下图所示的对话框，保持默认选项，点击OK。</p>
<div align="center">![img](/img/posts/320395_MNJZYT6JAUFVJ9M.png)</div>

<p>等待解析完成后，File-&gt;Save或Command+S保存一下，以免闪退后又要重新解析。</p>
<h3 id="猜猜猜"><a href="#猜猜猜" class="headerlink" title="猜猜猜"></a>猜猜猜</h3><p>虽然Hopper Disassembler已经为我们解析出来大部分的方法名，但是我们不知道该从何下手。<br>与其瞎忙活，不如先玩一盘再说。</p>
<div align="center">![img](/img/posts/320395_X2SP8Q25RQC8Z58.png)</div>

<p>哇哦，10分！在游戏中靠近顶部的地方有一条隐隐约约的横线，当目标正好压在这根线上时，击中会得到10分，连着击中3次10分可以获得双倍分数的加成，而在那根线下面击中时分数会递减，加成也会消失，那就有思路了，我们把那根线移到最下面，这样我们就可以不管目标在哪个位置时，击中都能获得10分。<br>让我们回到Hopper Disassembler，在左侧列表中输入“ten”，看看能不能搜索到有关设置10分线位置的方法。</p>
<div align="center">![img](/img/posts/320395_W5NC6ASKD7B9RYK.png)</div>

<p>哇哦，运气太好了，这么容易就找到了，<strong>MainEnemy</strong> 类里面有一个方法名叫做 <strong>tenPointLineY</strong> 的方法，看名字应该是10分线的Y坐标，如果能将Y坐标改为屏幕最底部就能达到目的了。<br>嗯？你想直接改汇编代码？这对于新手来说太难了，我们用高级语言来实现我们想法。</p>
<h3 id="编写动态库"><a href="#编写动态库" class="headerlink" title="编写动态库"></a>编写动态库</h3><p>打开Xcode，创建一个Project，选择Cocoa Touch Framework，名字就叫ShootMoonHacker。<br>首先新建文件，选择Cocoa Touch Class，名字叫HackerLoader，继承NSObject类，动态库加载时初始化的代码写在这个类中。<br>再新建一个文件，选择Objective-C File，文件类型选择Category，类选择NSObject，名字叫Hacker，所有的破解代码都写在这个分类中。<br>工程目录结构如下图。</p>
<div align="center">![img](/img/posts/320395_UDTKYWYRJYFGU6M.png)</div>3

<h4 id="ShootMoonHacker-h"><a href="#ShootMoonHacker-h" class="headerlink" title="ShootMoonHacker.h"></a>ShootMoonHacker.h</h4><p>这个文件是创建工程时自动创建的，我们将需要公开的类全部写在这个文件里即可。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`#import &lt;UIKit/UIKit.h&gt;`</span> <span class="string">`/`</span><span class="string">`/`</span><span class="string">`! Project version number `</span><span class="string">`for`</span> <span class="string">`ShootMoonHacker.`</span><span class="string">`FOUNDATION_EXPORT double ShootMoonHackerVersionNumber;`</span> <span class="string">`/`</span><span class="string">`/`</span><span class="string">`! Project version string `</span><span class="string">`for`</span> <span class="string">`ShootMoonHacker.`</span><span class="string">`FOUNDATION_EXPORT const unsigned char ShootMoonHackerVersionString[];`</span> <span class="string">`/`</span><span class="string">`/`</span> <span class="string">`In this header, you should `</span><span class="string">`import`</span> <span class="string">`all`</span> <span class="string">`the public headers of your framework using statements like `</span><span class="string">`#import &lt;ShootMoonHacker/PublicHeader.h&gt;`</span><span class="string">`#import &lt;HackerLoader.h&gt;`</span><span class="string">`#import &lt;NSObject+Hacker.h&gt;`</span></span><br></pre></td></tr></table></figure>

<p>我们在文件的最后追加我们之前创建的类和分类。<br>import时记得使用尖括号，而不是双引号。</p>
<h4 id="NSObject-Hacker-h"><a href="#NSObject-Hacker-h" class="headerlink" title="NSObject+Hacker.h"></a>NSObject+Hacker.h</h4><p>我们在分类头文件中声明一个方法，叫hack，提供给HackerLoader类调用，执行破解代码。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`#import &lt;Foundation/Foundation.h&gt;` `@interface` `NSObject (Hacker)` `-` `(void)hack<span class="comment">;` `@end`</span></span><br></pre></td></tr></table></figure>

<h4 id="NSObject-Hacker-m"><a href="#NSObject-Hacker-m" class="headerlink" title="NSObject+Hacker.m"></a>NSObject+Hacker.m</h4><p>现在我们开始改写 <strong>tenPointLineY</strong> 方法。<br>我们可以使用Objective-C运行时的方法交换来达到我们的目的。<br>此处我事先封装了交换方法的代码，参数是原始方法名、原始类名、新方法、新类、是否为类方法。<br>虽然我们目前只需要交换 <strong>tenPointLineY</strong> 这一个方法，但是考虑到以后可能需要交换多个方法，为了避免出现大量重复的代码，所以封装一下，同时也能让代码看起来整洁一点。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`-`</span> <span class="string">`(void)exchangeMethod:(NSString `</span><span class="string">`*`</span><span class="string">`)methodName ofClass:(NSString `</span><span class="string">`*`</span><span class="string">`)className toMethod:(SEL)method ofClass:(Class)`</span><span class="string">`class`</span> <span class="string">`isInstanceMethod:(`</span><span class="string">`BOOL`</span><span class="string">`)isInstanceMethod &#123;`</span><span class="string">`    `</span><span class="string">`Class c `</span><span class="string">`=`</span> <span class="string">`NSClassFromString(className);`</span><span class="string">`    `</span><span class="string">`SEL sel `</span><span class="string">`=`</span> <span class="string">`NSSelectorFromString(methodName);`</span><span class="string">`    `</span><span class="string">`Method om `</span><span class="string">`=`</span> <span class="string">`isInstanceMethod ? class_getInstanceMethod(c, sel) : class_getClassMethod(c, sel);`</span><span class="string">`    `</span><span class="string">`Method nm `</span><span class="string">`=`</span> <span class="string">`isInstanceMethod ? class_getInstanceMethod(`</span><span class="string">`class`</span><span class="string">`, method) : class_getClassMethod(`</span><span class="string">`class`</span><span class="string">`, method);`</span><span class="string">`    `</span><span class="string">`method_exchangeImplementations(om, nm);`</span><span class="string">`&#125;`</span></span><br></pre></td></tr></table></figure>

<p><strong>注</strong>：使用方法交换需要导入<code>&lt;objc/runtime.h&gt;</code>头文件。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`<span class="meta">#import <span class="string">&lt;objc/runtime.h&gt;</span>`</span></span><br></pre></td></tr></table></figure>

<p>接下来编写我们自己的 <strong>tenPointLineY</strong> 方法，名字就叫 <strong>my_tenPointLineY</strong>。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`-`</span> <span class="string">`(`</span><span class="string">`float`</span><span class="string">`)my_tenPointLineY &#123;`</span><span class="string">`    `</span><span class="string">`NSLog(@`</span><span class="string">`&quot;&gt;&gt;&gt;&gt;&gt; my_tenPointLineY&quot;`</span><span class="string">`);`</span><span class="string">`    `</span><span class="string">`float`</span> <span class="string">`ret `</span><span class="string">`=`</span> <span class="string">`[`</span><span class="string">`self`</span> <span class="string">`my_tenPointLineY];`</span><span class="string">`    `</span><span class="string">`NSLog(@`</span><span class="string">`&quot;&gt;&gt;&gt;&gt;&gt; my_tenPointLineY ret: %f&quot;`</span><span class="string">`, ret);`</span><span class="string">`    `</span><span class="string">`ret `</span><span class="string">`=`</span> <span class="string">`200`</span><span class="string">`;`</span><span class="string">`    `</span><span class="string">`NSLog(@`</span><span class="string">`&quot;&gt;&gt;&gt;&gt;&gt; change tenPointLineY ret to: %f&quot;`</span><span class="string">`, ret);`</span><span class="string">`    `</span><span class="string">`return`</span> <span class="string">`ret;`</span><span class="string">`&#125;`</span></span><br></pre></td></tr></table></figure>

<p><strong>[self my_tenPointLineY]</strong> 这一句，其实调用的是原始的 <strong>tenPointLineY</strong> 方法，因为在交换方法后，原始的 <strong>tenPointLineY</strong> 方法名对应的是 <strong>my_tenPointLineY</strong> 方法的代码段，而 <strong>my_tenPointLineY</strong> 方法名对应的是 <strong>tenPointLineY</strong> 方法的代码段。<br>具体可以搜索 <strong>Method Swizzling</strong> 来了解方法交换的细节。<br>我们不知道把10分线的Y坐标改为多少才是我们想要的效果，先改个200试试看。<br>添加NSLog打印日志是为了确定代码是否按我们预期的那样执行了。</p>
<p>写完 <strong>my_tenPointLineY</strong>，开始交换方法，也就是实现我们最开始声明的hack方法。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`-`</span> <span class="string">`(void)hack &#123;`</span><span class="string">`    `</span><span class="string">`NSString `</span><span class="string">`*`</span><span class="string">`className `</span><span class="string">`=`</span> <span class="string">`@`</span><span class="string">`&quot;MainEnemy&quot;`</span><span class="string">`;`</span><span class="string">`    `</span><span class="string">`Class selfClass `</span><span class="string">`=`</span> <span class="string">`[`</span><span class="string">`self`</span> <span class="string">`class`</span><span class="string">`];`</span> <span class="string">`    `</span><span class="string">`/`</span><span class="string">`/`</span> <span class="string">`TenPointLineY`</span><span class="string">`    `</span><span class="string">`[`</span><span class="string">`self`</span> <span class="string">`exchangeMethod:@`</span><span class="string">`&quot;tenPointLineY&quot;`</span> <span class="string">`ofClass:className`</span><span class="string">`                `</span><span class="string">`toMethod:@selector(my_tenPointLineY) ofClass:selfClass`</span><span class="string">`        `</span><span class="string">`isInstanceMethod:YES];`</span><span class="string">`&#125;`</span></span><br></pre></td></tr></table></figure>

<p>原始的 <strong>tenPointLineY</strong> 是属于 <strong>MainEnemy</strong> 类的，<strong>my_tenPointLineY</strong> 是属于 <strong>NSObject</strong> 类的，是实例方法。</p>
<h4 id="HackerLoader-m"><a href="#HackerLoader-m" class="headerlink" title="HackerLoader.m"></a>HackerLoader.m</h4><p>我们希望在动态库加载时自动执行破解代码的话，需要这么写。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`static void __attribute__((constructor)) entry(void) &#123;`</span><span class="string">`    `</span><span class="string">`NSLog(@`</span><span class="string">`&quot;&gt;&gt;&gt;&gt;&gt; Code Injected &lt;&lt;&lt;&lt;&lt;&quot;`</span><span class="string">`);`</span><span class="string">`    `</span><span class="string">`NSObject `</span><span class="string">`*`</span><span class="string">`obj `</span><span class="string">`=`</span> <span class="string">`[[NSObject alloc] init];`</span><span class="string">`    `</span><span class="string">`[obj hack];`</span><span class="string">`&#125;`</span></span><br></pre></td></tr></table></figure>

<p>不要忘记导入头文件 <strong>NSObject+Hacker.h</strong>。</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`#<span class="keyword">import</span> <span class="string">&quot;NSObject+Hacker.h&quot;</span>`</span><br></pre></td></tr></table></figure>

<p>方法 <strong>entry</strong> 的名字不是固定的，可以是你想要的任何符合命名规则的名字。<br>关键的是 <strong><strong>attribute</strong>((constructor))</strong> ，当动态库被加载的时候，会自动执行拥有此属性的方法。</p>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><p>在编译之前，有些工程配置需要修改。</p>
<h4 id="修改运行所需的最低系统版本"><a href="#修改运行所需的最低系统版本" class="headerlink" title="修改运行所需的最低系统版本"></a>修改运行所需的最低系统版本</h4><p>如下图，<strong>iOS Deployment Target</strong> 改为 <strong>iOS 11.0</strong>。</p>
<div align="center">![img](/img/posts/320395_GB46239AESWDJ6Q.png)</div>

<h4 id="修改签名"><a href="#修改签名" class="headerlink" title="修改签名"></a>修改签名</h4><p>如下图，<strong>签名</strong> 改为 <strong>None</strong>。</p>
<div align="center">![img](/img/posts/320395_H3FJYJF4P7ZUSAF.png)</div>

<h4 id="修改编译目标"><a href="#修改编译目标" class="headerlink" title="修改编译目标"></a>修改编译目标</h4><p>如下图，<strong>编译目标</strong> 改为 <strong>Generic iOS Device</strong>。</p>
<div align="center">![img](/img/posts/320395_BZWJE8M389JD5Z2.png)</div>

 

<p>配置修改完成后，按下Command+B编译。<br>编译成功后，就能得到ShootMoonHacker.framework。</p>
<h3 id="动态库注入"><a href="#动态库注入" class="headerlink" title="动态库注入"></a>动态库注入</h3><p>展开Products目录，右键ShootMoonHacker.framework，选择Show in Finder。</p>
<div align="center">![img](/img/posts/320395_HCDKRMAG4EJUR2R.png)</div>

 

<p>新开一个Terminal窗口，输入 <strong>cd空格</strong>，然后把 <strong>ShootMoonHacker.framework</strong> 目录拖到Terminal窗口上，如下图。</p>
<div align="center">![img](/img/posts/320395_5KFXAD2WSGF55VM.png)</div>

 

<p>松开后，效果如下图。</p>
<div align="center">![img](/img/posts/320395_BXUHUVVWZU6BXG3.png)</div>

 

<p>按下回车键后，我们需要将 <strong>ShootMoonHacker</strong> 文件传到iPhone上，命令如下。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`<span class="variable">$ </span>scp ``-``P ``<span class="number">2222</span>` `<span class="title class_">ShootMoonHacker</span> root<span class="variable">@localhost</span><span class="symbol">:~``/``root</span><span class="variable">@localhost</span><span class="string">&#x27;s password: ``# 输入密码`</span></span><br></pre></td></tr></table></figure>

<p>我猜测 <strong>tenPointLineY</strong> 这个方法会在开始游戏时调用，所以先将游戏退到初始界面，然后回到通过电脑ssh登录到iPhone上的Terminal窗口，进入到bfinject目录，输入如下命令注入我们的动态库。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`# 注入动态库``$ bash bfinject ``-``P shootthemoon ``-``l ~``/``ShootMoonHacker` `# 输出结果``[``+``] Liberios detected``[``+``] Injecting into ``&#x27;/var/containers/Bundle/Application/<span class="number">24546</span>F40-<span class="number">53</span>DA-<span class="number">4</span>C49-<span class="number">81</span>C0-DED0C13DB814/shootthemoon.app/shootthemoon&#x27;``[``+``] Getting Team ``ID` `from` `target application...``[``+``] Thinning dylib into non``-``fat arm64 image``[``+``] Signing injectable .dylib with Team ``ID` `A6DVR4V967 ``<span class="literal">and</span>` `platform entitlements...``[bfinject4realz] Calling task_for_pid() ``for` `PID ``<span class="number">3593</span>.``[bfinject4realz] Calling thread_create() on PID ``<span class="number">3593</span>``[bfinject4realz] Looking ``for` `ROP gadget... found at ``<span class="number">0</span>x1826574e0``[bfinject4realz] Fake stack frame at ``<span class="number">0</span>x10b3c8000``[bfinject4realz] Calling _pthread_set_self() at ``<span class="number">0</span>x182897804``...``[bfinject4realz] Returned ``from` `&#x27;_pthread_set_self&#x27;``[bfinject4realz] Calling dlopen() at ``<span class="number">0</span>x182657460``...``[bfinject4realz] Returned ``from` `&#x27;dlopen&#x27;``[bfinject4realz] Success! Library was loaded at ``<span class="number">0</span>x1c0151b40``[``+``] So ``long` `and` `thanks ``for` `all` `the fish.`</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：<br>1、bfinject命令必须在bfinject目录下执行，在其它目录下执行会出错。<br>2、如果注入过程中出现闪退，按Ctrl+C退出，重启App，再执行一遍注入命令即可。</p>
<p>注入成功后，我们开始游戏看一下效果。</p>
<div align="center">![img](/img/posts/320395_XS2PR9XR5ZKJDXG.png)</div>2

 

<p>就像游戏中的肥蜜蜂一样，我皱起了眉头。<br>怎么没有任何效果，是不是动态库没有执行？</p>
<h3 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h3><p>让我们在电脑上打开Console，选择iPhone，重启游戏再执行一遍注入。</p>
<div align="center">![img](/img/posts/320395_WP79TAK6BF4NZ58.png)</div>

<p>由于日志太多，我们在搜索栏输入“&gt;&gt;&gt;”，按下回车，可以在列表中看到我们注入成功的代码。右键选择我们动态库输出的那行日志，选择Show Process ‘shootthemoon’，这样列表就会隐藏其它和我们App无关的日志了。</p>
<div align="center">![img](/img/posts/320395_C8T9MNV4PWUGYJW.png)</div>

<p>日志告诉我们，注入成功了，但是10分线的位置为什么没有改变呢？开始游戏的时候似乎也没有调用我们的代码。难道10分线的位置是启动游戏时候调用的？抱着试试看的想法，我们在游戏启动的瞬间执行注入命令，不过这么做会导致游戏卡住然后闪退，只能换一种方式了。</p>
<h3 id="换个姿势插入动态库"><a href="#换个姿势插入动态库" class="headerlink" title="换个姿势插入动态库"></a>换个姿势插入动态库</h3><p>还记得我们的 <strong>shootthemoon.app</strong> 目录吗？把我们的动态库文件 <strong>ShootMoonHacker</strong> 复制到这个目录下。<br>接下来我们要使用 <strong>macho_edit</strong> 工具来修改 <strong>shootthemoon</strong> 可执行文件的动态库列表。<br>还记得我们备份出来的那个 <strong>shootthemoon</strong> 文件吗？我们对它下手。<br>执行如下命令。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$ macho_edit shootthemoon``# 输出内容``Thin mach``-``o binary:``    ``arm64 arch (offset ``<span class="number">0</span>x0``)` `1` `Fat mach``-``o configuration``<span class="number">2</span>` `Load command edit``<span class="number">3</span>` `Exit` `Select an option: ``<span class="number">2</span>`</span><br></pre></td></tr></table></figure>

<p>选择 <strong>2 Load command edit</strong>，编辑列表。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`1` `List` `load commands``<span class="number">2</span>` `Remove load command``<span class="number">3</span>` `Insert load command``<span class="number">4</span>` `Move load command``<span class="number">5</span>` `Remove code signature``<span class="number">6</span>` `Cancel` `Select an option: ``<span class="number">1</span>`</span><br></pre></td></tr></table></figure>

<p>选择 <strong>1 List load commands</strong>，看看原始的列表有哪些内容。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`arm64 arch (offset ``<span class="number">0</span>x0``):``    ``<span class="number">0</span>``: LC_SEGMENT_64: __PAGEZERO``    ``<span class="number">1</span>``: LC_SEGMENT_64: __TEXT``    ``<span class="number">2</span>``: LC_SEGMENT_64: __DATA``    ``<span class="number">3</span>``: LC_SEGMENT_64: __LINKEDIT``    ``<span class="number">4</span>``: LC_DYLD_INFO_ONLY``    ``<span class="number">5</span>``: LC_SYMTAB``    ``<span class="number">6</span>``: LC_DYSYMTAB``    ``<span class="number">7</span>``: LC_LOAD_DYLINKER: ``/``usr``/``lib``/``dyld``    ``<span class="number">8</span>``: LC_UUID: ``<span class="number">6</span>f33289b``-``<span class="number">6</span>f33``-``<span class="number">3328</span>``-``<span class="number">9</span>b6d``-``<span class="number">3</span>c3a847d7f7f``    ``<span class="number">9</span>``: LC_VERSION_MIN_IPHONEOS: ``<span class="number">0.0</span>``.``<span class="number">0</span>``    ``<span class="number">10</span>``: LC_SOURCE_VERSION``    ``<span class="number">11</span>``: LC_MAIN: ``<span class="number">0</span>x242d8``    ``<span class="number">12</span>``: LC_ENCRYPTION_INFO_64``    ``<span class="number">13</span>``: LC_LOAD_DYLIB: ``/``usr``/``lib``/``libz.``<span class="number">1</span>.dylib``    ``<span class="number">14</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``CoreText.framework``/``CoreText``    ``<span class="number">15</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``EventKit.framework``/``EventKit``    ``<span class="number">16</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``EventKitUI.framework``/``EventKitUI``    ``<span class="number">17</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``WebKit.framework``/``WebKit``    ``<span class="number">18</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``Social.framework``/``Social``    ``<span class="number">19</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``Security.framework``/``Security``    ``<span class="number">20</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``CoreTelephony.framework``/``CoreTelephony``    ``<span class="number">21</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``MessageUI.framework``/``MessageUI``    ``<span class="number">22</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``CoreData.framework``/``CoreData``    ``<span class="number">23</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``CoreMedia.framework``/``CoreMedia``    ``<span class="number">24</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``StoreKit.framework``/``StoreKit``    ``<span class="number">25</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``AdSupport.framework``/``AdSupport``    ``<span class="number">26</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``SystemConfiguration.framework``/``SystemConfiguration``    ``<span class="number">27</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``GameKit.framework``/``GameKit``    ``<span class="number">28</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``OpenAL.framework``/``OpenAL``    ``<span class="number">29</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``UIKit.framework``/``UIKit``    ``<span class="number">30</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``QuartzCore.framework``/``QuartzCore``    ``<span class="number">31</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``AVFoundation.framework``/``AVFoundation``    ``<span class="number">32</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``CoreGraphics.framework``/``CoreGraphics``    ``<span class="number">33</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``OpenGLES.framework``/``OpenGLES``    ``<span class="number">34</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``Foundation.framework``/``Foundation``    ``<span class="number">35</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``AudioToolbox.framework``/``AudioToolbox``    ``<span class="number">36</span>``: LC_LOAD_DYLIB: ``/``usr``/``lib``/``libobjc.A.dylib``    ``<span class="number">37</span>``: LC_LOAD_DYLIB: ``/``usr``/``lib``/``libc``+``+``.``<span class="number">1</span>.dylib``    ``<span class="number">38</span>``: LC_LOAD_DYLIB: ``/``usr``/``lib``/``libSystem.B.dylib``    ``<span class="number">39</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``CFNetwork.framework``/``CFNetwork``    ``<span class="number">40</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``CoreFoundation.framework``/``CoreFoundation``    ``<span class="number">41</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``CoreMotion.framework``/``CoreMotion``    ``<span class="number">42</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``CoreVideo.framework``/``CoreVideo``    ``<span class="number">43</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``GLKit.framework``/``GLKit``    ``<span class="number">44</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``MediaPlayer.framework``/``MediaPlayer``    ``<span class="number">45</span>``: LC_LOAD_DYLIB: ``/``System``/``Library``/``Frameworks``/``MobileCoreServices.framework``/``MobileCoreServices``    ``<span class="number">46</span>``: LC_FUNCTION_STARTS``    ``<span class="number">47</span>``: LC_DAT<span class="built_in">A_IN</span>_CODE``    ``<span class="number">48</span>``: LC_CODE_SIGNATURE` `1` `List` `load commands``<span class="number">2</span>` `Remove load command``<span class="number">3</span>` `Insert load command``<span class="number">4</span>` `Move load command``<span class="number">5</span>` `Remove code signature``<span class="number">6</span>` `Cancel` `Select an option: ``<span class="number">3</span>`</span><br></pre></td></tr></table></figure>

<p>能看到加载了很多系统的动态库。<br>选择 <strong>3 Insert load command</strong>，将我们的动态库注入到文件中。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`Select the cmd you want to insert:``<span class="number">1</span>` `LC_LOAD_DYLIB``<span class="number">2</span>` `LC_LOAD_WEAK_DYLIB``<span class="number">3</span>` `LC_RPATH``<span class="number">4</span>` `Cancel` `Select an option: ``<span class="number">1</span>`</span><br></pre></td></tr></table></figure>

<p>选择 <strong>1 LC_LOAD_DYLIB</strong>，注入动态库。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`Dylib path: @executable_path`</span><span class="string">`/`</span><span class="string">`ShootMoonHacker`</span></span><br></pre></td></tr></table></figure>

<p>输入 <strong>@executable_path&#x2F;ShootMoonHacker</strong>，按下回车。<br><strong>@executable_path</strong> 指的是 <strong>shootthemoon</strong> 这个可执行文件所在的目录，也就是 <strong>shootthemoon.app</strong> 这个目录。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`1` `List` `load commands``<span class="number">2</span>` `Remove load command``<span class="number">3</span>` `Insert load command``<span class="number">4</span>` `Move load command``<span class="number">5</span>` `Remove code signature``<span class="number">6</span>` `Cancel` `Select an option: ``<span class="number">1</span>`</span><br></pre></td></tr></table></figure>

<p>选择 <strong>1 List load commands</strong>，看看编辑是否成功。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`49`</span><span class="string">`: LC_LOAD_DYLIB: @executable_path`</span><span class="string">`/`</span><span class="string">`ShootMoonHackers`</span><span class="string">`/`</span><span class="string">`MediaP`</span></span><br></pre></td></tr></table></figure>

<p>如果列表中最后一项不是输入的那样，如上结果后面跟着其它字符，说明编辑出现了bug，需要退出 <strong>macho_edit</strong>，删除错误内容，再重新插入。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`# 此处已省略无关内容``<span class="number">49</span>``: LC_LOAD_DYLIB: @executable_path``/``ShootMoonHackers``/``MediaP` `1` `List` `load commands``<span class="number">2</span>` `Remove load command``<span class="number">3</span>` `Insert load command``<span class="number">4</span>` `Move load command``<span class="number">5</span>` `Remove code signature``<span class="number">6</span>` `Cancel` `Select an option: ``<span class="number">6</span>`</span><br></pre></td></tr></table></figure>

<p>选择6，取消编辑。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`1` `Fat mach``-``o configuration``<span class="number">2</span>` `Load command edit``<span class="number">3</span>` `Exit` `Select an option: ``<span class="number">3</span>`</span><br></pre></td></tr></table></figure>

<p>选择3，退出。重新再次编辑。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$ macho_edit shootthemoon``# 输出内容``Thin mach``-``o binary:``    ``arm64 arch (offset ``<span class="number">0</span>x0``)` `1` `Fat mach``-``o configuration``<span class="number">2</span>` `Load command edit``<span class="number">3</span>` `Exit` `Select an option: ``<span class="number">2</span>`</span><br></pre></td></tr></table></figure>

<p>选择2，编辑。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`1` `List` `load commands``<span class="number">2</span>` `Remove load command``<span class="number">3</span>` `Insert load command``<span class="number">4</span>` `Move load command``<span class="number">5</span>` `Remove code signature``<span class="number">6</span>` `Cancel` `Select an option: ``<span class="number">2</span>`</span><br></pre></td></tr></table></figure>

<p>选择2，删除。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`Select a load command to remove:` `# 此处已省略无关内容``<span class="number">50</span>` `LC_LOAD_DYLIB: @executable_path``/``ShootMoonHackers``/``MediaP``<span class="number">51</span>` `Cancel` `Select an option: ``<span class="number">50</span>`</span><br></pre></td></tr></table></figure>

<p>选择50，删除bug导致的错误的动态库路径。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`1` `List` `load commands``<span class="number">2</span>` `Remove load command``<span class="number">3</span>` `Insert load command``<span class="number">4</span>` `Move load command``<span class="number">5</span>` `Remove code signature``<span class="number">6</span>` `Cancel` `Select an option: ``<span class="number">3</span>`</span><br></pre></td></tr></table></figure>

<p>选择3，删除后重新插入动态库。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`Select the cmd you want to insert:``<span class="number">1</span>` `LC_LOAD_DYLIB``<span class="number">2</span>` `LC_LOAD_WEAK_DYLIB``<span class="number">3</span>` `LC_RPATH``<span class="number">4</span>` `Cancel` `Select an option: ``<span class="number">1</span>`</span><br></pre></td></tr></table></figure>

<p>选择1，动态库。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`Dylib path: @executable_path`</span><span class="string">`/`</span><span class="string">`ShootMoonHacker`</span></span><br></pre></td></tr></table></figure>

<p>输入动态库路径 <strong>@executable_path&#x2F;ShootMoonHacker</strong>。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`1` `List` `load commands``<span class="number">2</span>` `Remove load command``<span class="number">3</span>` `Insert load command``<span class="number">4</span>` `Move load command``<span class="number">5</span>` `Remove code signature``<span class="number">6</span>` `Cancel` `Select an option: ``<span class="number">1</span>`</span><br></pre></td></tr></table></figure>

<p>选择1，确认插入的动态库路径是否正确。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`arm64 arch (offset ``<span class="number">0</span>x0``):``    ``# 此处已省略无关内容``    ``<span class="number">49</span>``: LC_LOAD_DYLIB: @executable_path``/``ShootMoonHacker` `1` `List` `load commands``<span class="number">2</span>` `Remove load command``<span class="number">3</span>` `Insert load command``<span class="number">4</span>` `Move load command``<span class="number">5</span>` `Remove code signature``<span class="number">6</span>` `Cancel` `Select an option: ``<span class="number">6</span>`</span><br></pre></td></tr></table></figure>

<p>选择6，动态库路径插入正确，可以退出编辑。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`1` `Fat mach``-``o configuration``<span class="number">2</span>` `Load command edit``<span class="number">3</span>` `Exit` `Select an option: ``<span class="number">3</span>`</span><br></pre></td></tr></table></figure>

<p>选择3，退出。</p>
<h3 id="打包安装"><a href="#打包安装" class="headerlink" title="打包安装"></a>打包安装</h3><p>把编辑好的 <strong>shootthemoon</strong> 文件覆盖掉 <strong>shootthemoon.app</strong> 目录下的原始文件。<br>然后在Finder中，右键 <strong>Payload</strong> 文件夹，选择 <strong>压缩”Payload”</strong>，得到 <strong>Payload.zip</strong> 压缩包，将其重命名为 <strong>shootthemoon_hacked.ipa</strong>。<br>打开 <strong>Impactor</strong> 工具，将 <strong>shootthemoon_hacked.ipa</strong> 文件拖到 <strong>Impactor</strong> 的 <strong>install Cydia Extender</strong> 的位置上。</p>
<div align="center">![img](/img/posts/320395_CMXF5WQW3ZF7VA6.png)</div>

<p>松开后，会要求输入你的 <strong>Apple ID</strong> 和 <strong>密码</strong>，然后会将ipa安装到手机上。<br><strong>注意</strong>：<br>1、Apple账号需要关闭二次验证功能，否则Impactor会安装失败。<br>2、安装前务必先卸载原来的App，因为从App Store下载的App签名与Impactor安装的App签名不同，所以无法覆盖安装。<br><strong>推荐</strong>：申请一个新的Apple账号，专门用于Impactor安装ipa。</p>
<h3 id="胜败乃兵家常事"><a href="#胜败乃兵家常事" class="headerlink" title="胜败乃兵家常事"></a>胜败乃兵家常事</h3><p>安装完成后，赶紧启动游戏看一下效果。</p>
<div align="center">![img](/img/posts/320395_ZGEFB9669ACAQ27.png)</div>

 

<p>好尴尬啊～虽然10分线出现在了底部，但是分数还是没变。看来 <strong>tenPointLineY</strong> 只是修改位置，并不会影响到分数。</p>
<h3 id="大侠请重新来过"><a href="#大侠请重新来过" class="headerlink" title="大侠请重新来过"></a>大侠请重新来过</h3><p>既然改10分线没有用，那就简单粗暴点，直接改分数吧。<br>让我们回到Hopper Disassembler，在左侧列表中输入“point”，看看能不能搜索到和分数相关的方法，貌似没有，换个词试试，搜索“score”看看。</p>
<div align="center">![img](/img/posts/320395_CY4MND79KHKQF2J.png)</div>

<p>第一条 <strong>-[GamePlay updateScore:]</strong> 貌似看上去可能或许大概应该好像就是修改分数的方法，尝试一下？尝试一下！<br>回到Xcode，在 <strong>NSObject+Hacker.m</strong> 文件中添加以下代码。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`-`</span> <span class="string">`(void)my_updateScore:(`</span><span class="string">`int`</span><span class="string">`)score &#123;`</span><span class="string">`    `</span><span class="string">`NSLog(@`</span><span class="string">`&quot;&gt;&gt;&gt;&gt;&gt; my_updateScore: %d&quot;`</span><span class="string">`, score);`</span><span class="string">`    `</span><span class="string">`score `</span><span class="string">`=`</span> <span class="string">`10000`</span><span class="string">`;`</span><span class="string">`    `</span><span class="string">`NSLog(@`</span><span class="string">`&quot;&gt;&gt;&gt;&gt;&gt; my_updateScore change score to: %d&quot;`</span><span class="string">`, score);`</span><span class="string">`    `</span><span class="string">`[`</span><span class="string">`self`</span> <span class="string">`my_updateScore:score];`</span><span class="string">`    `</span><span class="string">`NSLog(@`</span><span class="string">`&quot;&gt;&gt;&gt;&gt;&gt; my_updateScore done&quot;`</span><span class="string">`);`</span><span class="string">`&#125;`</span></span><br></pre></td></tr></table></figure>

<p>我们把分数固定在10000分，先看看效果如何。<br>然后修改hack方法，如下。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`-`</span> <span class="string">`(void)hack &#123;`</span><span class="string">`    `</span><span class="string">`NSString `</span><span class="string">`*`</span><span class="string">`className `</span><span class="string">`=`</span> <span class="string">`@`</span><span class="string">`&quot;GamePlay&quot;`</span><span class="string">`;`</span><span class="string">`    `</span><span class="string">`Class selfClass `</span><span class="string">`=`</span> <span class="string">`[`</span><span class="string">`self`</span> <span class="string">`class`</span><span class="string">`];`</span> <span class="string">`    `</span><span class="string">`/`</span><span class="string">`/`</span> <span class="string">`UpdateScore`</span><span class="string">`    `</span><span class="string">`[`</span><span class="string">`self`</span> <span class="string">`exchangeMethod:@`</span><span class="string">`&quot;updateScore:&quot;`</span> <span class="string">`ofClass:className`</span><span class="string">`                `</span><span class="string">`toMethod:@selector(my_updateScore:) ofClass:selfClass`</span><span class="string">`        `</span><span class="string">`isInstanceMethod:YES];`</span><span class="string">`&#125;`</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：updateScore是带参数的，对应的字符串后面要有冒号。<br><strong>例子</strong>：<strong>- (NSInteger)plus:(NSInteger)a and:(NSInteger)b;</strong> 方法对应的字符串就是”<strong>plus:and:</strong>“。</p>
<p>编译通过后，将动态库传到iPhone上，用bfinject注入，玩一下看看。</p>
<div align="center">![img](/img/posts/320395_HUQZVGHYMAY6ZS5.png)</div>

 

<p>哈哈哈哈哈，这个貌似有点过分了。虽然和预期想的不太一样，以为updateScore修改的是左下角的总分数，阴差阳错地修改了击中时获得的分数，既然如此我们把分数固定在10分就可以了。<br>修改代码后，重新编译，再次注入，看看效果。</p>
<div align="center">![img](/img/posts/320395_R6TZ8VWXZM9UZVQ.png)</div>

 

<p>完美。我们有了如此完美的动态库，可以有两种选择。<br>1、针对越狱机器，我们保留从App Store下载的版本，需要时通过bfinject注入即可。<br>2、针对非越狱机器，我们用macho_edit插入动态库，重新打包安装。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="基本知识点"><a href="#基本知识点" class="headerlink" title="基本知识点"></a>基本知识点</h2><p>1、usbmuxd的使用<br>2、ssh与scp的使用<br>3、使用bfinject砸壳<br>4、Hopper Disassembler的使用<br>5、Method Swizzling，方法交换<br>6、动态库的编写<br>7、使用bfinject实时注入动态库<br>8、使用macho_edit插入动态库<br>9、重新打包ipa<br>10、Impactor的使用</p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><p>1、如果有苹果开发者账号，可以使用 <strong>iOS App Signer</strong> 对ipa重签名，然后使用Xcode安装即可。<br>2、少许的汇编知识有助于使用Hopper Disassembler理解方法的实现逻辑，便于更快地找到破解的入口。<br>3、避免重复造轮子，做一名调包侠没什么不对。当好奇轮子是怎么造出来的时候，再去深入研究它。<br>4、基础一定要打好，但不是等基础打好了再去干活，而是边干活边打基础。<br>5、阅读他人代码的最佳方式就是帮他改Bug。<br>6、走弯路是必然的，但也是值得的，你接触到了走直路接触不到的东西。</p>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2019/01/100148.html" class="pre-post btn btn-default" title='关于内网安全检查/渗透的方法'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">关于内网安全检查/渗透的方法</span>
        </a>
    
    
        <a href="/archives/2019/01/100141.html" class="next-post btn btn-default" title='软件脱壳后的优化'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">软件脱壳后的优化</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>


    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87"><span class="toc-text">设备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#macOS%E4%B8%8A%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-text">macOS上的工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS%E4%B8%8A%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-text">iOS上的工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#App"><span class="toc-text">App</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="toc-text">下载安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Xcode"><span class="toc-text">Xcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Terminal"><span class="toc-text">Terminal</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Console"><span class="toc-text">Console</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ssh"><span class="toc-text">ssh</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#scp"><span class="toc-text">scp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Homebrew"><span class="toc-text">Homebrew</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#usbmuxd"><span class="toc-text">usbmuxd</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#macho-edit"><span class="toc-text">macho_edit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hopper-Disassembler"><span class="toc-text">Hopper Disassembler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impactor"><span class="toc-text">Impactor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bfinject"><span class="toc-text">bfinject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#applst"><span class="toc-text">applst</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%8A%E5%B9%B2%E6%8E%89%E6%9C%88%E4%BA%AE%E3%80%8B-Shoot-The-Moon"><span class="toc-text">《干掉月亮》(Shoot The Moon)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3"><span class="toc-text">破解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A0%B8%E5%A3%B3"><span class="toc-text">砸壳</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8usbmuxd"><span class="toc-text">使用usbmuxd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh%E7%99%BB%E5%BD%95iPhone"><span class="toc-text">ssh登录iPhone</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%90%8D%E7%A7%B0%E5%8F%8A%E8%BF%9B%E7%A8%8BID"><span class="toc-text">查询名称及进程ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%B8%E5%A3%B3-1"><span class="toc-text">砸壳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BE%E5%88%B0%E3%80%8A%E5%B9%B2%E6%8E%89%E6%9C%88%E4%BA%AE%E3%80%8B%E7%9A%84App%E6%96%87%E6%A1%A3%E7%9B%AE%E5%BD%95"><span class="toc-text">找到《干掉月亮》的App文档目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E7%A0%B8%E5%A3%B3%E5%90%8E%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-text">传输砸壳后的文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3-1"><span class="toc-text">破解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%8E%8B%E7%A0%B8%E5%A3%B3%E5%90%8E%E7%9A%84ipa"><span class="toc-text">解压砸壳后的ipa</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="toc-text">备份可执行文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Hopper-Disassembler"><span class="toc-text">使用Hopper Disassembler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8C%9C%E7%8C%9C%E7%8C%9C"><span class="toc-text">猜猜猜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%8A%A8%E6%80%81%E5%BA%93"><span class="toc-text">编写动态库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ShootMoonHacker-h"><span class="toc-text">ShootMoonHacker.h</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NSObject-Hacker-h"><span class="toc-text">NSObject+Hacker.h</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NSObject-Hacker-m"><span class="toc-text">NSObject+Hacker.m</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HackerLoader-m"><span class="toc-text">HackerLoader.m</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91"><span class="toc-text">编译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%BF%90%E8%A1%8C%E6%89%80%E9%9C%80%E7%9A%84%E6%9C%80%E4%BD%8E%E7%B3%BB%E7%BB%9F%E7%89%88%E6%9C%AC"><span class="toc-text">修改运行所需的最低系统版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%AD%BE%E5%90%8D"><span class="toc-text">修改签名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%BC%96%E8%AF%91%E7%9B%AE%E6%A0%87"><span class="toc-text">修改编译目标</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%BA%93%E6%B3%A8%E5%85%A5"><span class="toc-text">动态库注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="toc-text">查看日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8D%A2%E4%B8%AA%E5%A7%BF%E5%8A%BF%E6%8F%92%E5%85%A5%E5%8A%A8%E6%80%81%E5%BA%93"><span class="toc-text">换个姿势插入动态库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E5%AE%89%E8%A3%85"><span class="toc-text">打包安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%9C%E8%B4%A5%E4%B9%83%E5%85%B5%E5%AE%B6%E5%B8%B8%E4%BA%8B"><span class="toc-text">胜败乃兵家常事</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E4%BE%A0%E8%AF%B7%E9%87%8D%E6%96%B0%E6%9D%A5%E8%BF%87"><span class="toc-text">大侠请重新来过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-text">基本知识点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83"><span class="toc-text">其它</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2025&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>








<script src="/js/app.js?rev=@@hash.js"></script>


</body>
</html>