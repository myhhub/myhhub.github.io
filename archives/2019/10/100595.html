<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="知识图谱,deepdive">


    <meta name="description" content="一. 简介前面完成了针对结构化数据和半结构化数据的知识抽取工作，本节我们进行基于Deepdive框架的非结构化文本关系抽取。所采用的文本来自于百度百科的人物介绍。本次实战基于OpenKG上的支持...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>从零开始学习知识图谱 之 五.电影知识图谱构建 5.基于Deepdive非结构化文本关系抽取 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="从零开始学习知识图谱 之 五.电影知识图谱构建 5.基于Deepdive非结构化文本关系抽取">
            
	            从零开始学习知识图谱 之 五.电影知识图谱构建 5.基于Deepdive非结构化文本关系抽取
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/cloud/">云计算</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/deepdive/">deepdive</a> <a class="tag-link" href="/tags/knowledgegraph/">知识图谱</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/10/18</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1266</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <h1 id="一-简介"><a href="#一-简介" class="headerlink" title="一. 简介"></a>一. 简介</h1><p>前面完成了针对结构化数据和半结构化数据的知识抽取工作，本节我们进行基于Deepdive框架的非结构化文本关系抽取。所采用的文本来自于百度百科的人物介绍。本次实战基于OpenKG上的<a href="http://www.openkg.cn/dataset/cn-deepdive" target="_blank" rel="noopener">支持中文的deepdive：斯坦福大学的开源知识抽取工具（三元组抽取）</a>，我们基于此，抽取电影领域的演员-电影关系。 </p>
<p>deepdive是由斯坦福大学InfoLab实验室开发的一个开源知识抽取系统。它通过弱监督学习，从非结构化的文本中抽取结构化的关系数据 。<a href="https://pan.baidu.com/s/1slLpYVz" target="_blank" rel="noopener">本项目CNDeepdive</a>修改了自然语言处理的model包，使它支持中文，并提供中文tutorial。 </p>
<p>DeepDive项目处于维护模式，并且不再处于主动开发状态。用户社区保持活跃，但是原始项目成员不能再承诺令人兴奋的新功能/改进或响应请求。有关最新研究，请参阅<a href="https://hazyresearch.github.io/snorkel/" target="_blank" rel="noopener">Snorkel项目</a>或<a href="https://ds3lab.org/~czhang/" target="_blank" rel="noopener">Ce Zhang的项目</a>。 </p>
<p>本教程的项目代码放在github上，下载地址为<a href="https://github.com/myhhub/zero_knowledge_graph" target="_blank" rel="noopener">《从零开始学习知识图谱》项目源代码</a> 。</p>
<h1 id="二-环境准备"><a href="#二-环境准备" class="headerlink" title="二. 环境准备"></a>二. 环境准备</h1><h2 id="1-操作系统"><a href="#1-操作系统" class="headerlink" title="1. 操作系统"></a>1. 操作系统</h2><p>支持操作系统：macOS、Linux、Docker容器。Linux安装可以参考<a href="100590.html">VirtualBox虚拟机安装Ubuntu</a>或<a href="100589.html">VirtualBox虚拟机安装CentOS8</a>进行安装。</p>
<p><strong>deepdive在高版本Linux下的支持并不好，虽然笔者修改安装代码最终也装上了，但是不建议新手来处理。所以推荐Ubuntu 16.04的版本。 </strong><a href="http://old-releases.ubuntu.com/releases/xenial/" target="_blank" rel="noopener">Ubuntu 16.04下载地址</a>，安装Ubuntu主机可参考文章<a href="100590.html">VirtualBox虚拟机安装Ubuntu</a>，<strong>注意不要安装python3，使用Ubuntu自带的</strong>。</p>
<h2 id="2-安装JDK"><a href="#2-安装JDK" class="headerlink" title="2. 安装JDK"></a>2. 安装JDK</h2><p>1) 设置下载目录</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@ubuntu</span>-mmm CNdeepdive]<span class="meta"># cd /usr/local/</span></span><br><span class="line">[root<span class="symbol">@ubuntu</span>-mmm <span class="keyword">local</span>]<span class="meta"># mkdir jdk/</span></span><br><span class="line">[root<span class="symbol">@ubuntu</span>-mmm <span class="keyword">local</span>]<span class="meta"># cd jdk/</span></span><br></pre></td></tr></table></figure>
<p>2) 下载JDK</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu-mmm jdk]# wget https://download.oracle.com/otn/java/jdk/<span class="number">8</span>u221-b11/<span class="number">230d</span>eb18db3e4014bb8e3e<span class="number">8324f81b43</span>/jdk-<span class="number">8</span>u221-linux-x64.tar.gz?AuthParam=<span class="number">1570778301</span>_521350e291b71079469aa571d925a2ec</span><br><span class="line">--<span class="number">2019-10-11</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">37</span>--  https://download.oracle.com/otn/java/jdk/<span class="number">8</span>u221-b11/<span class="number">230d</span>eb18db3e4014bb8e3e<span class="number">8324f81b43</span>/jdk-<span class="number">8</span>u221-linux-x64.tar.gz?AuthParam=<span class="number">1570778301</span>_521350e291b71079469aa571d925a2ec</span><br><span class="line">正在解析主机 download.oracle.com (download.oracle.com)... <span class="number">23.195.255.150</span></span><br><span class="line">正在连接 download.oracle.com (download.oracle.com)|<span class="number">23.195.255.150</span>|:<span class="number">443</span>... 已连接。</span><br><span class="line">已发出 HTTP 请求，正在等待回应... <span class="number">200</span> OK</span><br><span class="line">长度：<span class="number">195094741</span> (<span class="number">186</span>M) [application/x-gzip]</span><br><span class="line">正在保存至: “jdk-<span class="number">8</span>u221-linux-x64.tar.gz?AuthParam=<span class="number">1570778301</span>_521350e291b71079469aa571d925a2ec”</span><br><span class="line"></span><br><span class="line">r.gz?AuthParam=<span class="number">1570778301</span>_521350e<span class="number">291b7107</span>   <span class="number">5</span>%[===&gt;</span><br></pre></td></tr></table></figure>
<p>3) 解压</p>
<p>使用tar -zxvf 文件名进行解压。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@ubuntu-mmm jdk]</span># <span class="selector-tag">tar</span> <span class="selector-tag">-zxvf</span> <span class="selector-tag">jdk-8u221-linux-x64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure>
<p>4) 配置环境变量</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@ubuntu</span>-mmm jdk]<span class="meta"># vi /etc/profile</span></span><br></pre></td></tr></table></figure>
<p>将如下配置添加至文件中，然后保存退出。</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#java</span></span><br><span class="line">export JAVA_HOME=<span class="regexp">/usr/local</span><span class="regexp">/jdk/jdk</span>1.<span class="number">8.0_221</span></span><br><span class="line">export PATH=$JAVA_HOME/<span class="symbol">bin:</span>$PATH</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/<span class="class"><span class="keyword">lib</span>/<span class="title">dt</span>.<span class="title">jar</span>:$<span class="title">JAVA_HOME</span>/<span class="title">lib</span></span></span><br></pre></td></tr></table></figure>
<p>执行命令，使文件修改后立即生效<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@ubuntu</span>-mmm jdk]<span class="meta"># source /etc/profile</span></span><br></pre></td></tr></table></figure></p>
<p>5) 验证</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu-mmm <span class="keyword">jdk]# </span><span class="keyword">java </span>-version</span><br><span class="line"></span><br><span class="line"><span class="keyword">java </span>version <span class="string">"1.8.0_221"</span></span><br><span class="line"><span class="keyword">Java(TM) </span>SE Runtime Environment (<span class="keyword">build </span><span class="number">1</span>.<span class="number">8</span>.<span class="number">0</span>_221-<span class="keyword">b11)</span></span><br><span class="line"><span class="keyword">Java </span>HotSpot(TM) <span class="number">64</span>-<span class="keyword">Bit </span>Server VM (<span class="keyword">build </span><span class="number">25</span>.<span class="number">221</span>-<span class="keyword">b11, </span>mixed mode)</span><br></pre></td></tr></table></figure>
<h2 id="3-安装Deepdive"><a href="#3-安装Deepdive" class="headerlink" title="3. 安装Deepdive"></a>3. 安装Deepdive</h2><p>1）下载Deepdive安装包 <a href="https://pan.baidu.com/s/1slLpYVz" target="_blank" rel="noopener">CNDeepdive</a>。</p>
<p>2）修改install.sh，否则出现报错，无法安装</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 修改前 tar xzvf <span class="string">"<span class="subst">$tarball</span>"</span> -C <span class="string">"<span class="subst">$PREFIX</span>"</span></span><br><span class="line">tar zvf <span class="string">"<span class="subst">$tarball</span>"</span> -C <span class="string">"<span class="subst">$PREFIX</span>"</span></span><br></pre></td></tr></table></figure>
<p>3）运行install.sh，先选择【1 】安装deepdive，然后选择【6】 安装postgresql。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu-mmm CNdeepdive]# <span class="keyword">cd</span> /usr/<span class="keyword">local</span>/CNdeepdive</span><br><span class="line">[root@ubuntu-mmm CNdeepdive]# bash install.<span class="keyword">sh</span></span><br><span class="line">#运行install.<span class="keyword">sh</span> 分别选择【1 】安装deepdive，选择【6】 安装postgresql。</span><br><span class="line">正在处理用于 dbus (1.10.6-1ubuntu3.3) 的触发器 ...</span><br><span class="line">正在处理用于 <span class="keyword">ca</span>-certificates (20170717~16.04.1) 的触发器 ...</span><br><span class="line">Updating certificates <span class="keyword">in</span> /etc/ssl/certs...</span><br><span class="line">0 added, 0 removed; done.</span><br><span class="line">Running hooks <span class="keyword">in</span> /etc/<span class="keyword">ca</span>-certificates/<span class="keyword">update</span>.<span class="keyword">d</span>...</span><br><span class="line"></span><br><span class="line">done.</span><br><span class="line">done.</span><br><span class="line">+ sudo localedef -i en_US -f UTF-8 en_US.UTF-8</span><br><span class="line">## Finished installation <span class="keyword">for</span> _deepdive_runtime_deps</span><br><span class="line">## Finished installation <span class="keyword">for</span> deepdive</span><br><span class="line">......</span><br><span class="line">+ trap '<span class="keyword">rm</span> -f /tmp/pg_hba.<span class="keyword">conf</span>.ixUUNdF' <span class="keyword">EXIT</span></span><br><span class="line">+ echo 'host	all	all	127.0.0.1/32	trust'</span><br><span class="line">+ echo 'host	all	all	::1/128	trust'</span><br><span class="line">+ sudo <span class="keyword">cat</span> /etc/postgresql/9.5/main/pg_hba.<span class="keyword">conf</span></span><br><span class="line">+ sudo tee /etc/postgresql/9.5/main/pg_hba.<span class="keyword">conf</span></span><br><span class="line">+ sudo service postgresql restart</span><br><span class="line">++ <span class="keyword">rm</span> -f /tmp/pg_hba.<span class="keyword">conf</span>.ixUUNdF</span><br><span class="line">## Finished installation <span class="keyword">for</span> postgres</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>4）配置环境变量，deepdive的可执⾏⽂件⼀般安装在~/local/bin⽂件夹下。 在~/.bashrc 文件的末尾添加下面的内容： </p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@ubuntu</span>-mmm CNdeepdive]<span class="comment"># vi ~/.bashrc</span></span><br><span class="line"><span class="comment">#添加如下内容</span></span><br><span class="line"><span class="comment">#除了root,其他在/home/(username)/local/bin其中的(username)要替换成你当前登录的用户名</span></span><br><span class="line"><span class="keyword">export</span> PATH=<span class="string">"/root/local/bin:<span class="variable">$PATH</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#来使我们的修改生效。</span></span><br><span class="line">[root<span class="meta">@ubuntu</span>-mmm CNdeepdive]<span class="comment"># source ~/.bashrc</span></span><br></pre></td></tr></table></figure>
<p>5）然后执行下面的命令，安装自然语言处理的部分 。</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive<span class="meta"># bash nlp_setup.sh</span></span><br><span class="line"></span><br><span class="line">Install Dependency.</span><br><span class="line">Denpendency Already Installed.</span><br></pre></td></tr></table></figure>
<p> 好的，到这里Deepdive就已经安装完成了 。</p>
<p>6）打开终端执行<code>deepdive</code>我们可以看到Deepdive的版本信息和命令参数的Help。 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive<span class="comment"># deepdive</span></span><br><span class="line"><span class="comment"># DeepDive (v0.8.0-79-g28a58de)</span></span><br><span class="line"><span class="comment"># Usage: deepdive COMMAND [ARG]...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To enable bash completion for deepdive commands, run:</span></span><br><span class="line">source $(deepdive whereis installed etc/deepdive_bash_completion.sh)</span><br><span class="line"></span><br><span class="line">No COMMAND given</span><br><span class="line"></span><br><span class="line"><span class="comment"># Available COMMANDs are:</span></span><br><span class="line">deepdive  <span class="keyword">check</span>    <span class="comment">#	Checks errors in compiled DeepDive app</span></span><br><span class="line">deepdive  compile  <span class="comment">#	Compiles DeepDive source code into executables under run/</span></span><br><span class="line">deepdive  <span class="keyword">compute</span>  <span class="comment">#	Runs a UDF using a computer against the database</span></span><br><span class="line">deepdive  <span class="keyword">create</span>   <span class="comment">#	Creates a table/view in the database</span></span><br><span class="line">deepdive  db       <span class="comment">#	Exposes lower level database operations provided by the driver</span></span><br><span class="line">deepdive  <span class="keyword">do</span>       <span class="comment">#	Runs necessary processes to get something done</span></span><br><span class="line">deepdive  done     <span class="comment">#	Checks whether given targets are all done</span></span><br><span class="line">deepdive  env      <span class="comment">#	Runs commands inside DeepDive's environment</span></span><br><span class="line">deepdive  <span class="keyword">help</span>     <span class="comment">#	Shows help</span></span><br><span class="line">deepdive  initdb   <span class="comment">#	(DEPRECATED) Initializes the underlying database for the DeepDive application</span></span><br><span class="line">deepdive  <span class="keyword">load</span>     <span class="comment">#	Loads a given relation's data</span></span><br><span class="line">deepdive  mark     <span class="comment">#	Marks state of something to do</span></span><br><span class="line">deepdive  <span class="keyword">model</span>    <span class="comment">#	Supports working with the statistical inference model</span></span><br><span class="line">deepdive  plan     <span class="comment">#	Shows execution plan for given targets</span></span><br><span class="line">deepdive  <span class="keyword">query</span>    <span class="comment">#	Runs a DDlog query against the database for the DeepDive application</span></span><br><span class="line">deepdive  <span class="keyword">redo</span>     <span class="comment">#	Runs processes after marking them as 'todo'</span></span><br><span class="line">deepdive  run      <span class="comment">#	Runs the current DeepDive app end-to-end</span></span><br><span class="line">deepdive  <span class="keyword">sql</span>      <span class="comment">#	Runs a SQL query against the database for the DeepDive application</span></span><br><span class="line">deepdive  unload   <span class="comment">#	Unloads a given relation's data</span></span><br><span class="line">deepdive  <span class="keyword">version</span>  <span class="comment">#	show deepdive's version and build information</span></span><br><span class="line">deepdive  whereis  <span class="comment">#	Finds absolute paths to files in the app or DeepDive installation</span></span><br></pre></td></tr></table></figure>
<p>安装也可以参考文档<a href="https://github.com/theDoctor2013/DeepDive-tutorial/blob/master/Deepdive_new.md" target="_blank" rel="noopener">Deepdive 实战-从下载到跑路</a>。</p>
<h1 id="三-项目框架搭建"><a href="#三-项目框架搭建" class="headerlink" title="三. 项目框架搭建"></a>三. 项目框架搭建</h1><h2 id="1-建立postgresql的数据库movie"><a href="#1-建立postgresql的数据库movie" class="headerlink" title="1. 建立postgresql的数据库movie"></a>1. 建立postgresql的数据库movie</h2><h3 id="数据库管理工具推荐"><a href="#数据库管理工具推荐" class="headerlink" title="数据库管理工具推荐"></a>数据库管理工具推荐</h3><p><a href="https://www.navicat.com.cn/download/navicat-premium" target="_blank" rel="noopener">Navicat Premium</a>，是一套数据库开发工具，让你从单一应用程序中同时连接 MySQL、MariaDB、MongoDB、SQL Server、Oracle、PostgreSQL 和 SQLite 数据库。Navicat系列破解工具链接：<a href="https://pan.baidu.com/s/1KmH2aaESpjozQaxr2C7D2A" target="_blank" rel="noopener">https://pan.baidu.com/s/1KmH2aaESpjozQaxr2C7D2A</a></p>
<p>可以使用它来管理PostgreSQL数据库，Navicat连接PostgreSQL，PostgreSQL需要进行如下配置：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. 通过<span class="keyword">find</span> / -name  postgresql.<span class="keyword">conf</span> 和 <span class="keyword">find</span> / -name pg_hba.<span class="keyword">conf</span> 找到这两个文件</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. 设置外网访问：</span><br><span class="line"></span><br><span class="line">     <span class="number">1</span>）修改配置文件 postgresql.<span class="keyword">conf</span></span><br><span class="line">           listen_addresses = <span class="string">'*'</span></span><br><span class="line">     <span class="number">2</span>）修改pg_hba.<span class="keyword">conf</span>       在原来的host下面新加一行</span><br><span class="line">           # IPv4 local connection<span class="variable">s:</span></span><br><span class="line">           host    <span class="keyword">all</span>             <span class="keyword">all</span>             <span class="number">127.0</span>.<span class="number">0.1</span>/<span class="number">32</span>            trust</span><br><span class="line">           host    <span class="keyword">all</span>             <span class="keyword">all</span>             <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>               password</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. 重新启动服务：service postgresql restart</span><br></pre></td></tr></table></figure>
<p><strong>在这里我们不使用navicat，可以不安装。</strong></p>
<h3 id="1-创建数据库movie"><a href="#1-创建数据库movie" class="headerlink" title="1) 创建数据库movie"></a>1) 创建数据库movie</h3><p>运行 <code>sudo -u postgres createdb</code> 建立数据库movie</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:CNdeepdive<span class="meta"># sudo -u postgres createdb movie</span></span><br></pre></td></tr></table></figure>
<p>如果要删除数据，可以使用下面命令</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:CNdeepdive<span class="meta"># sudo -u postgres dropdb movie</span></span><br></pre></td></tr></table></figure>
<h3 id="2-验证数据库是否创建成功"><a href="#2-验证数据库是否创建成功" class="headerlink" title="2) 验证数据库是否创建成功"></a>2) 验证数据库是否创建成功</h3><p>首先运行sudo -i -u postgres 进入到postgresql账户</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive<span class="meta"># sudo -i -u postgres</span></span><br></pre></td></tr></table></figure>
<p> 输入psql进入到postgresql命令界面</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">postgres@ubuntu-mmm:~$ psql</span><br><span class="line">psql (9.5.19)</span><br><span class="line">Type <span class="string">"help"</span> <span class="keyword">for</span> help.</span><br><span class="line"></span><br><span class="line"><span class="attribute">postgres</span>=#</span><br></pre></td></tr></table></figure>
<p>查看数据库列表</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># \l</span></span><br><span class="line">                                  List of databases</span><br><span class="line">   Name    |<span class="string">  Owner   </span>|<span class="string"> Encoding </span>|<span class="string">   Collate   </span>|<span class="string">    Ctype    </span>|<span class="string">   Access privileges   </span></span><br><span class="line"><span class="string">-----------+----------+----------+-------------+-------------+-----------------------</span></span><br><span class="line"><span class="string"> movie     </span>|<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> </span></span><br><span class="line"><span class="string"> postgres  </span>|<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> </span></span><br><span class="line"><span class="string"> template0 </span>|<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> =c/postgres          +</span></span><br><span class="line"><span class="string">           </span>|<span class="string">          </span>|<span class="string">          </span>|<span class="string">             </span>|<span class="string">             </span>|<span class="string"> postgres=CTc/postgres</span></span><br><span class="line"><span class="string"> template1 </span>|<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> =c/postgres          +</span></span><br><span class="line"><span class="string">           </span>|<span class="string">          </span>|<span class="string">          </span>|<span class="string">             </span>|<span class="string">             </span>|<span class="string"> postgres=CTc/postgres</span></span><br><span class="line"><span class="string">(4 rows)</span></span><br></pre></td></tr></table></figure>
<p>修改PostgreSQL登录密码：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">postgres</span>=# ALTER USER postgres WITH PASSWORD <span class="string">'postgres'</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">ALTER ROLE</span></span><br></pre></td></tr></table></figure>
<p>输入\q退出psql。 </p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postgres-<span class="meta"># \q</span></span><br></pre></td></tr></table></figure>
<h3 id="3-返回自己的程序目录"><a href="#3-返回自己的程序目录" class="headerlink" title="3) 返回自己的程序目录"></a>3) 返回自己的程序目录</h3><p>运行’’’su yourusername’’’ 回到自己的程序目录。 </p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postgres<span class="variable">@ubuntu</span>-<span class="symbol">mmm:</span>~<span class="variable">$ </span>su root</span><br></pre></td></tr></table></figure>
<h2 id="2-项目框架搭建"><a href="#2-项目框架搭建" class="headerlink" title="2. 项目框架搭建"></a>2. 项目框架搭建</h2><h3 id="1）创建项⽬⽂件夹"><a href="#1）创建项⽬⽂件夹" class="headerlink" title="1）创建项⽬⽂件夹"></a>1）创建项⽬⽂件夹</h3><p>这部分的数据和代码以及程序都在前面我们解压后的<em>CNdeepdive/transaction</em>中，你可以把这个目录复制到你喜欢的地方（比如<em>~/Projects/transaction</em> 这个位置），然后再新建一个目录，可以叫做<em>transaction2</em> 我们后面的所有工作都是在这个<strong>transaction2</strong>目录中进行的，后面简称它为项目目录。</p>
<p>运行命令：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-<span class="symbol">mmm:</span>/var/<span class="class"><span class="keyword">lib</span>/<span class="title">postgresql</span><span class="comment"># cd /usr/local/CNdeepdive</span></span></span><br><span class="line">root@ubuntu-<span class="symbol">mmm:</span>/usr/local/CNdeepdive<span class="comment"># mkdir transaction2/</span></span><br><span class="line">root@ubuntu-<span class="symbol">mmm:</span>/usr/local/CNdeepdive<span class="comment"># cd transaction2</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2）建⽴数据库配置⽂件db-url"><a href="#2）建⽴数据库配置⽂件db-url" class="headerlink" title="2）建⽴数据库配置⽂件db.url"></a>2）建⽴数据库配置⽂件db.url</h3><p>建⽴⾃⼰的项⽬⽂件夹transaction2，之前已在postgresql中为项⽬建⽴数据库movie，现要在项⽬⽂件夹下建⽴数据库配置⽂件:<br>运行命令：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># echo <span class="string">"postgresql://localhost:5432/movie"</span> &gt;db.url</span></span><br></pre></td></tr></table></figure></p>
<p>命令说明：</p>
<blockquote>
<p>echo “postgresql://$USER@$HOSTNAME:5432/db_name” &gt;db.url</p>
<p>#$符号是shell中用来表示变量的，所以这个蓝色部分大概就是 用户名@主机名：。。。。</p>
<p>#db_name 我们这个项目的数据库名，也可以自定义。</p>
</blockquote>
<h3 id="3）创建项⽬⽂件"><a href="#3）创建项⽬⽂件" class="headerlink" title="3）创建项⽬⽂件"></a>3）创建项⽬⽂件</h3><p>在deepdive内建立输入数据文件夹 input，用户定义函数文件夹udf，用户配置文件app.ddlog，模型配置文件deepdive.conf。</p>
<p>为了调用 stanford_nlp 进行文本处理，将下载的CNdeepdive 文件夹中的transaction/udf/bazzar复制到自己的 udf 文件夹下，并在udf/bazzar/parser/ 目录下运行 sbt/sbt stage 进行编译。编译完成后会在 target 中生成可执行文件。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2/udf/bazaar/parser# chmod 777 sbt/sbt</span><br><span class="line">#获得执行权限</span><br><span class="line">root@ubuntu-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2/udf/bazaar/parser# sbt/sbt stage</span><br><span class="line"></span><br><span class="line">Getting org.<span class="keyword">scala</span>-sbt sbt 0.13.8 ...</span><br><span class="line">:: retrieving :: org.<span class="keyword">scala</span>-sbt#<span class="keyword">boot</span>-<span class="keyword">app</span></span><br><span class="line">	confs: [default]</span><br><span class="line">	52 artifacts copied, 0 already retrieved (17674kB/165ms)</span><br><span class="line">Getting <span class="keyword">Scala</span> 2.10.4 (<span class="keyword">for</span> sbt)...</span><br><span class="line">:: retrieving :: org.<span class="keyword">scala</span>-sbt#<span class="keyword">boot</span>-<span class="keyword">scala</span></span><br><span class="line">	confs: [default]</span><br><span class="line">	5 artifacts copied, 0 already retrieved (24459kB/108ms)</span><br><span class="line">[info] Loading project definition from /usr/<span class="keyword">local</span>/CNdeepdive/transaction2/udf/bazaar/parser/project/project</span><br><span class="line">[info] Updating &#123;<span class="keyword">file</span>:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2/udf/bazaar/parser/project/project/&#125;parser-build-build...</span><br><span class="line">[info] Resolving org.fusesource.jansi#jansi;1.4 ...</span><br><span class="line">[info] Done updating.</span><br><span class="line">[info] Loading project definition from /usr/<span class="keyword">local</span>/CNdeepdive/transaction2/udf/bazaar/parser/project</span><br><span class="line">[info] Updating &#123;<span class="keyword">file</span>:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2/udf/bazaar/parser/project/&#125;parser-build...</span><br><span class="line">[info] Resolving org.fusesource.jansi#jansi;1.4 ...</span><br><span class="line">[info] Done updating.</span><br><span class="line">[info] <span class="keyword">Set</span> current project to deepdive-nlp-parser (<span class="keyword">in</span> build <span class="keyword">file</span>:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2/udf/bazaar/parser/)</span><br><span class="line">[info] Updating &#123;<span class="keyword">file</span>:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2/udf/bazaar/parser/&#125;parser...</span><br><span class="line">[info] Resolving org.fusesource.jansi#jansi;1.4 ...</span><br><span class="line">[info] Done updating.</span><br><span class="line">[warn] <span class="keyword">Scala</span> <span class="keyword">version</span> was updated <span class="keyword">by</span> <span class="keyword">one</span> of library dependencies:</span><br><span class="line">[warn] 	* org.<span class="keyword">scala</span>-lang:<span class="keyword">scala</span>-library:(2.10.3, 2.10.4, 2.10.2, 2.10.0) -&gt; 2.10.5</span><br><span class="line">[warn] To force scalaVersion, add the following:</span><br><span class="line">[warn] 	ivyScala := ivyScala.value map &#123; _.<span class="keyword">copy</span>(overrideScalaVersion = true) &#125;</span><br><span class="line">[warn] <span class="keyword">Run</span> 'evicted' to see detailed eviction warnings</span><br><span class="line">[info] Compiling 6 <span class="keyword">Scala</span> sources to /usr/<span class="keyword">local</span>/CNdeepdive/transaction2/udf/bazaar/parser/target/<span class="keyword">scala</span>-2.10/classes...</span><br><span class="line">[info] Wrote start script <span class="keyword">for</span> mainClass := Some(com.clearcut.nlp.Main) to /usr/<span class="keyword">local</span>/CNdeepdive/transaction2/udf/bazaar/parser/target/start</span><br><span class="line">[success] <span class="keyword">Total</span> time: 18 s, completed 2019-10-15 16:10:54</span><br></pre></td></tr></table></figure>
<h1 id="三-数据准备"><a href="#三-数据准备" class="headerlink" title="三. 数据准备"></a>三. 数据准备</h1><h2 id="1-先验数据导入"><a href="#1-先验数据导入" class="headerlink" title="1. 先验数据导入"></a>1. 先验数据导入</h2><p>为了对样本进行打标，我们需要一定的先验数据，它包含确定的演员-电影关系对。我们直接从结构化数据的数据库中抽取出演员和对应的代表作作为先验数据。</p>
<h3 id="1-actor-movie-txt文件"><a href="#1-actor-movie-txt文件" class="headerlink" title="1) actor_movie.txt文件"></a>1) actor_movie.txt文件</h3><p>用MySQL Workbench导出工具把actor_to_movie表的数据导出到actor_movie.txt文件，也可以通过<a href="https://pan.baidu.com/s/1akBtV35kLQg4xKpO0xvHbA" target="_blank" rel="noopener">百度云</a>(提取码：xgof)直接下载该文件。<strong>这一步在先前的windows环境下完成</strong>。数据格式如下：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#actor_id movie_id</span><br><span class="line"><span class="number">900</span> <span class="number">1</span></span><br><span class="line"><span class="number">10426</span> <span class="number">9</span></span><br><span class="line"><span class="number">9412</span> <span class="number">11</span></span><br><span class="line"><span class="number">8792</span> <span class="number">25</span></span><br></pre></td></tr></table></figure>
<h3 id="2-获取-actor-movie-dbdata-csv-文件"><a href="#2-获取-actor-movie-dbdata-csv-文件" class="headerlink" title="2) 获取 actor_movie_dbdata.csv 文件"></a>2) 获取 actor_movie_dbdata.csv 文件</h3><p>您可以通过脚本 udf/get_actor_movie.py 获取 input/actor_movie_dbdata.csv 文件，也可以通过<a href="https://pan.baidu.com/s/1ovqEytKLWCr6cjOBjTqOJg" target="_blank" rel="noopener">百度云</a>(提取码：jyxo)直接下载该文件。<strong>这一步在先前的windows环境下完成</strong>。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\my\Python\python.exe C:<span class="regexp">/d/mmm</span><span class="regexp">/pycharm/</span>deepdive<span class="regexp">/udf/g</span>et_actor_movie.py</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="3-app-ddlog-中定义相应的数据表"><a href="#3-app-ddlog-中定义相应的数据表" class="headerlink" title="3)  app.ddlog 中定义相应的数据表"></a>3)  app.ddlog 中定义相应的数据表</h3><p>获取该文件后，我们需要将其导入到数据库中以进行处理。首先我们在app.ddlog 中定义相应的数据表，文件内容如下: </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@source</span></span><br><span class="line">actor_movie_dbdata(</span><br><span class="line">    <span class="variable">@key</span></span><br><span class="line">    actor_name text,</span><br><span class="line">    <span class="variable">@key</span></span><br><span class="line">    movie_name text</span><br><span class="line">).</span><br></pre></td></tr></table></figure>
<h3 id="4-编译及生成数据表"><a href="#4-编译及生成数据表" class="headerlink" title="4)  编译及生成数据表"></a>4)  编译及生成数据表</h3><p>而后通过命令行编译及生成数据表 </p>
<p> a. 行编译操作，也就是在项目目录执行下面的命令： </p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive compile</span><br><span class="line"></span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:51.779111 ‘run/LATEST.COMPILE’ -&gt; ‘20191016/152551.724661396’</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:51.784188 ‘run/RUNNING.COMPILE’ -&gt; ‘20191016/152551.724661396’</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:51.784488 Parsing DeepDive application (/usr/local/CNdeepdive/transaction2) to generate:</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:51.784700  run/compiled/schema.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:51.784902   from app.ddlog</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:52.230712  run/compiled/deepdive.conf</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:52.230760   from app.ddlog</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:52.739134   from deepdive.conf</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:52.740832  run/compiled/deepdive.conf.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.062665 Performing sanity checks on run/compiled/deepdive.conf.json:</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.090525  checking if input_extractors_well_defined</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.090609  checking if input_schema_wellformed</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.090621 Normalizing and adding built-in processes to the data flow to compile:</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.090631  run/compiled/config<span class="string">-0</span>.00-init_objects.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.101117  run/compiled/config<span class="string">-0</span>.01-parse_calibration.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.108870  run/compiled/config<span class="string">-0</span>.01-parse_schema.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.126399  run/compiled/config<span class="string">-0</span>.51-add_init_app.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.132111  run/compiled/config<span class="string">-0</span>.52-input_loader.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.144006  run/compiled/config<span class="string">-1</span>.00-qualified_names.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.158387  run/compiled/config<span class="string">-1</span>.01-parse_inference_rules.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.185708  run/compiled/config<span class="string">-2</span>.01-grounding.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.287285  run/compiled/config<span class="string">-2</span>.02-learning_inference.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.303617  run/compiled/config<span class="string">-2</span>.03-calibration_plots.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.314917  run/compiled/config<span class="string">-9</span>.98-ensure_init_app.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.324952  run/compiled/config<span class="string">-9</span>.99-dependencies.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.336073  run/compiled/config.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.337028 Validating run/compiled/config.json:</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.382982  checking if compiled_base_relations_have_input_data</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.383035  checking if compiled_dependencies_correct</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.383047  checking if compiled_input_output_well_defined</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.383056  checking if compiled_output_uniquely_defined</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.383064 Compiling executable code into:</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.383073  run/compiled/code-cmd_extractor.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.401750  run/compiled/code-dataflow_dot.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.417009  run/compiled/code-Makefile.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.435906  run/compiled/code-sql_extractor.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.447180  run/compiled/code-tsv_extractor.json</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.461059 Generating files:</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.471287  run/process/init/app/run.sh</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.478829  run/process/init/relation/actor_movie_dbdata/run.sh</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.482429  run/dataflow.dot</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.484349  run/Makefile</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.541030  run/dataflow.svg</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.543347   (file:///usr/local/CNdeepdive/transaction2/run/dataflow.svg)</span><br><span class="line">2019<span class="string">-10</span><span class="string">-16</span> 15:25:53.544398 ‘run/compiled’ -&gt; ‘20191016/152551.724661396’</span><br></pre></td></tr></table></figure>
<p> b. 编译完成后，我们要执行<code>deepdive do db</code></p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive do actor_movie_dbdata</span><br><span class="line"></span><br><span class="line"># on ubuntu-mmm: deepdive do actor_movie_dbdata</span><br><span class="line"># run/<span class="number">20191016</span>/<span class="number">152600.104675031</span>/plan.sh</span><br><span class="line"># execution plan for data/actor_movie_dbdata</span><br><span class="line"></span><br><span class="line">## process/init/app ##########################################################</span><br><span class="line"># Done: N/A</span><br><span class="line">process/init/app/run.sh</span><br><span class="line">mark_done process/init/app</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## process/init/relation/actor_movie_dbdata ##################################</span><br><span class="line"># Done: N/A</span><br><span class="line">process/init/relation/actor_movie_dbdata/run.sh</span><br><span class="line">mark_done process/init/relation/actor_movie_dbdata</span><br><span class="line">##############################################################################</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## data/actor_movie_dbdata ###################################################</span><br><span class="line"># Done: N/A</span><br><span class="line"># no-op</span><br><span class="line">mark_done data/actor_movie_dbdata</span><br><span class="line">##############################################################################</span><br></pre></td></tr></table></figure>
<p>这里<code>do</code> 后面应该和我们<code>app.ddlog</code> 中的名字相同，和<code>input</code> 文件夹中的文件名也相同，他们三个应该都是一致的。他会把input文件中的对应的文件导入postgresql数据库中。注意这个语句执行后，他会进入一个类似vi的界面让你审查他自动生成的处理代码是不是正确，这时候输入<code>：wq</code> 就可以保存并退出，继续执行后面的步骤。运行结果如下：</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.793180</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.793341</span> : ## process/init/app ##########################################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.793549</span> : # Done: <span class="number">2019</span><span class="number">-10</span><span class="number">-16</span>T15:<span class="number">31</span>:<span class="number">00</span>+<span class="number">0800</span> (<span class="number">5</span>m <span class="number">42</span>s ago)</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.793734</span> : process/init/app/run.sh</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.793938</span> : mark_done process/init/app</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.795712</span> : ##############################################################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.795906</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.796165</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.796308</span> ## process/init/relation/actor_movie_dbdata ##################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.796550</span> # Done: N/A</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.796758</span> process/init/relation/actor_movie_dbdata/run.sh</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.797006</span> ++ dirname process/init/relation/actor_movie_dbdata/run.sh</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.797202</span> + cd process/init/relation/actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.797407</span> + <span class="keyword">export</span> DEEPDIVE_CURRENT_PROCESS_NAME=process/init/relation/actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.797677</span> + DEEPDIVE_CURRENT_PROCESS_NAME=process/init/relation/actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.797987</span> + deepdive create table actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.885518</span> CREATE TABLE</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.886898</span> + deepdive load actor_movie_dbdata</span><br><span class="line">loading actor_movie_dbdata: <span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">179</span>KiB [ <span class="number">816</span>MiB/s] ([ <span class="number">816</span>MiB/s])r_movie_dbdata.csv (csv format)</span><br><span class="line">loading actor_movie_dbdata: <span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">5.94</span>k [ <span class="number">123</span>k/s] ([ <span class="number">123</span>k/s])</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.996248</span> COPY <span class="number">5943</span></span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">50.998965</span> mark_done process/init/relation/actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003297</span> ##############################################################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003373</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003386</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003397</span> ## data/actor_movie_dbdata ###################################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003408</span> # Done: N/A</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003436</span> # no-op</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.003467</span> mark_done data/actor_movie_dbdata</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.006529</span> ##############################################################################</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.006568</span> </span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">51.006580</span> </span><br><span class="line">‘run/FINISHED’ -&gt; ‘<span class="number">20191016</span>/<span class="number">153642.492053809</span>’</span><br></pre></td></tr></table></figure>
<p> c. 执行完成后，可以执行下面代码在数据库中查询，看看是不是成功导入了 </p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive query <span class="emphasis">'?- actor_movie_dbdata(actor_name, _).'</span></span><br><span class="line"></span><br><span class="line"><span class="code">                                actor_name                                </span></span><br><span class="line">--------------------------------------------------------------------------</span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> 周星驰</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> Stephen Chow</span></span><br><span class="line"><span class="code"> 车保罗</span></span><br><span class="line"><span class="code"> 车保罗</span></span><br><span class="line"><span class="code"> Paul Che</span></span><br><span class="line"><span class="code"> Paul Che</span></span><br><span class="line"><span class="code"> 张学友</span></span><br><span class="line"><span class="code"> 张学友</span></span><br><span class="line"><span class="code"> Jacky Cheung</span></span><br><span class="line"><span class="code"> Jacky Cheung</span></span><br><span class="line"><span class="code"> 章子怡</span></span><br><span class="line"><span class="code"> Zhang Ziyi</span></span><br><span class="line"><span class="code"> 章子怡</span></span><br><span class="line"><span class="code"> Zhang Ziyi</span></span><br><span class="line"><span class="code"> 章子怡</span></span><br></pre></td></tr></table></figure>
<h2 id="2-待抽取文章的导入"><a href="#2-待抽取文章的导入" class="headerlink" title="2. 待抽取文章的导入"></a>2. 待抽取文章的导入</h2><h3 id="1-爬取数据"><a href="#1-爬取数据" class="headerlink" title="1) 爬取数据"></a>1) 爬取数据</h3><p>为了获取到大量的电影和演员相关文章，我们直接套用之前的半结构化数据爬虫来获取非结构文本articles.txt。 <strong>这一步在先前的windows环境下完成</strong>。</p>
<p>cmd中执行命令：scrapy crawl 项目名</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS <span class="string">C:</span>\d\mmm\pycharm\deepdive\udf\baidu_baike\baidu_baike&gt; scrapy crawl baidu</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">16</span>:<span class="number">06</span>:<span class="number">06</span> [scrapy.utils.log] <span class="string">INFO:</span> Scrapy <span class="number">1.7</span><span class="number">.3</span> started (<span class="string">bot:</span> baidu_baike)</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">16</span>:<span class="number">06</span>:<span class="number">06</span> [scrapy.utils.log] <span class="string">INFO:</span> <span class="string">Versions:</span> lxml <span class="number">4.4</span><span class="number">.1</span><span class="number">.0</span>, libxml2 <span class="number">2.9</span><span class="number">.5</span>, cssselect <span class="number">1.1</span><span class="number">.0</span>, parsel <span class="number">1.5</span><span class="number">.2</span>, w3lib <span class="number">1.21</span><span class="number">.0</span>, Twisted <span class="number">19.7</span><span class="number">.0</span>, Python <span class="number">3.7</span><span class="number">.4</span> (tags/v3<span class="number">.7</span><span class="number">.4</span>:e09359112e, Jul  <span class="number">8</span> <span class="number">2019</span>, <span class="number">20</span>:<span class="number">34</span>:<span class="number">20</span>) [MSC v<span class="number">.1916</span> <span class="number">64</span> bit (AMD64)], pyOpenSSL <span class="number">19.0</span><span class="number">.0</span> (OpenSSL <span class="number">1.1</span><span class="number">.1</span>c  <span class="number">28</span> May <span class="number">2019</span>), cryptography <span class="number">2.7</span>, Platform Windows<span class="number">-10</span><span class="number">-10.0</span><span class="number">.18362</span>-SP0</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-16</span> <span class="number">16</span>:<span class="number">06</span>:<span class="number">06</span> [scrapy.crawler] <span class="string">INFO:</span> Overridden <span class="string">settings:</span> &#123;<span class="string">'BOT_NAME'</span>: <span class="string">'baidu_baike'</span>, <span class="string">'NEWSPIDER_MODULE'</span>: <span class="string">'baidu_baike.spiders'</span>, <span class="string">'SPIDER_MODULES'</span>: [<span class="string">'baidu_baike.spiders'</span>], <span class="string">'USER_AGENT'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36'</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-数据转换"><a href="#2-数据转换" class="headerlink" title="2) 数据转换"></a>2) 数据转换</h3><p>接下来为了将其导入到数据库中，需要将其转换为csv格式，这里可以使用程序 udf/trans.py 进行转换。再更改名成input/articles.csv即可。 <strong>这一步在先前的windows环境下完成</strong>。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\my\Python\python.exe C:<span class="regexp">/d/mmm</span><span class="regexp">/pycharm/</span>deepdive<span class="regexp">/udf/</span>trans.py</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="3-app-ddlog-中定义相应的数据表-1"><a href="#3-app-ddlog-中定义相应的数据表-1" class="headerlink" title="3)  app.ddlog 中定义相应的数据表"></a>3)  app.ddlog 中定义相应的数据表</h3><p>在 app.ddlog 中建立相应的 articles 表： </p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@source</span><br><span class="line">articles(</span><br><span class="line">        <span class="built_in">id</span> <span class="built_in">text</span>,</span><br><span class="line">        content <span class="built_in">text</span></span><br><span class="line">).</span><br></pre></td></tr></table></figure>
<h3 id="4-编译及生成数据表-1"><a href="#4-编译及生成数据表-1" class="headerlink" title="4)  编译及生成数据表"></a>4)  编译及生成数据表</h3><p>因为下面的 stanford_nlp 进行句法分析时速度特别的慢，因此我抽取出 articles.csv 的头10 行进行实验。<br>a. 执行 ‘’’ deepdive do articles ‘’’ 将文章导入到 postgresql中</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># deepdive <span class="meta-keyword">compile</span> &amp;&amp; deepdive do articles</span></span><br></pre></td></tr></table></figure>
<p>b. 验证是否成功</p>
 <figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive query <span class="emphasis">'?- articles(id, _).'</span></span><br><span class="line"><span class="code"> id </span></span><br><span class="line">----</span><br><span class="line"><span class="code"> 0</span></span><br><span class="line"><span class="code"> 1</span></span><br><span class="line"><span class="code"> 2</span></span><br><span class="line"><span class="code"> 3</span></span><br><span class="line"><span class="code"> 4</span></span><br><span class="line"><span class="code"> 5</span></span><br><span class="line"><span class="code"> 6</span></span><br><span class="line"><span class="code"> 7</span></span><br><span class="line"><span class="code"> 8</span></span><br><span class="line"><span class="code"> 9</span></span><br><span class="line"><span class="code"> 10</span></span><br><span class="line">(11 rows)</span><br></pre></td></tr></table></figure>
<h1 id="四-文本处理"><a href="#四-文本处理" class="headerlink" title="四. 文本处理"></a>四. 文本处理</h1><h2 id="1-用-stanford-nlp-模块进行文本处理"><a href="#1-用-stanford-nlp-模块进行文本处理" class="headerlink" title="1. 用 stanford_nlp 模块进行文本处理"></a>1. 用 stanford_nlp 模块进行文本处理</h2><p>deepdive 默认采⽤standfor nlp进⾏⽂本处理。输⼊⽂本数据，nlp模块将以句子为单位，返回每句的分词、lemma、pos、NER和句法分析的结果，为后续特征抽取做准备。我们将这些结果存入sentences表中。</p>
<h3 id="1-app-ddlog-中定义相应的数据表"><a href="#1-app-ddlog-中定义相应的数据表" class="headerlink" title="1)  app.ddlog 中定义相应的数据表"></a>1)  app.ddlog 中定义相应的数据表</h3><p>首先在 app.ddlog 中建立 sentences 表：</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@source</span><br><span class="line">sentences(</span><br><span class="line">        doc_id <span class="keyword">text</span>,</span><br><span class="line">        sentence_index <span class="keyword">int</span>,</span><br><span class="line">        sentences_text <span class="keyword">text</span>,</span><br><span class="line">        tokens <span class="keyword">text</span>[],</span><br><span class="line">        lemmas <span class="keyword">text</span>[],</span><br><span class="line">        pos_tags <span class="keyword">text</span>[],</span><br><span class="line">        ner_tags <span class="keyword">text</span>[],</span><br><span class="line">        doc_offsets <span class="keyword">int</span>[],</span><br><span class="line">        dep_types <span class="keyword">text</span>[],</span><br><span class="line">        dep_tokens <span class="keyword">int</span>[]</span><br><span class="line">).</span><br></pre></td></tr></table></figure>
<h3 id="2-app-ddlog-中定义相应的函数"><a href="#2-app-ddlog-中定义相应的函数" class="headerlink" title="2)  app.ddlog 中定义相应的函数"></a>2)  app.ddlog 中定义相应的函数</h3><p>而后定义NLP 处理的函数 nlp_markup 来调用自定义的脚本 udf/nlp_markup.sh 进行文本处理。  我们需要对数据处理的方法，deepdive只是个框架，具体要怎么处理需要我们告诉他。所以我们要定义函数来处理articles让他变成sentences。 </p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nlp_markup</span> <span class="title">over</span> (</span></span><br><span class="line">            doc_id <span class="keyword">text</span>,</span><br><span class="line">            content <span class="keyword">text</span>,</span><br><span class="line">    ) returns rows like <span class="keyword">sentences</span></span><br><span class="line">    implementation <span class="string">"udf/nlp_markup.sh"</span> handles tsv <span class="keyword">lines</span>.</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<blockquote>
<p>function用来定义函数，后面<code>nlp_markup</code> 是函数名 over后面接的是参数表。<br>returns 说明了函数返回的形式，返回就像我们前面定义的sentences那样的一行。<br>最后一句说明了我们这个程序文件是<code>udf/nlp_markup.sh</code> ,输入是tsv的一行。</p>
</blockquote>
<h3 id="3-app-ddlog-中定义相应的函数调用"><a href="#3-app-ddlog-中定义相应的函数调用" class="headerlink" title="3)  app.ddlog 中定义相应的函数调用"></a>3)  app.ddlog 中定义相应的函数调用</h3><p> 使用如下语法调用 nlp_markup 函数，将函数的输出存储到sentences 表中： </p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sentences += nlp<span class="number">_m</span>arkup(<span class="meta">doc</span><span class="number">_</span>id, content) :-</span><br><span class="line">    articles(<span class="meta">doc</span><span class="number">_</span>id, content).</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：上面的<code>+=</code> 其实和其他语言差不多，就是对于来源是articles中的每一行的<code>doc_id</code> 和<code>content</code> 我们都调用<code>nlp_markup</code> 然后结果添加到sentences表中。 </p>
</blockquote>
<h3 id="4-编写-nlp-markup-sh"><a href="#4-编写-nlp-markup-sh" class="headerlink" title="4)  编写 nlp_markup.sh"></a>4)  编写 nlp_markup.sh</h3><p>udf/nlp_markup.sh 代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="comment"># A shell script that runs Bazaar/Parser over documents passed as input TSV lines</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># $ deepdive env udf/nlp_markup.sh doc_id _ _ content _</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="built_in">set</span> -euo pipefail</span><br><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(dirname "$0")</span>"</span></span><br><span class="line"></span><br><span class="line">: <span class="variable">$&#123;BAZAAR_HOME:=$PWD/bazaar&#125;</span></span><br><span class="line">[[ -x <span class="string">"<span class="variable">$BAZAAR_HOME</span>"</span>/parser/target/start ]] || &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"No Bazaar/Parser set up at: <span class="variable">$BAZAAR_HOME</span>/parser"</span></span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line">&#125; &gt;&amp;2</span><br><span class="line"></span><br><span class="line">[[ <span class="variable">$#</span> -gt 0 ]] ||</span><br><span class="line">    <span class="comment"># default column order of input TSV</span></span><br><span class="line">    <span class="built_in">set</span> -- doc_id content</span><br><span class="line"></span><br><span class="line"><span class="comment"># convert input tsv lines into JSON lines for Bazaar/Parser</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># start Bazaar/Parser to emit sentences TSV</span></span><br><span class="line">tsv2json <span class="string">"<span class="variable">$@</span>"</span> |</span><br><span class="line"><span class="string">"<span class="variable">$BAZAAR_HOME</span>"</span>/parser/run.sh -i json -k doc_id -v content</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<blockquote>
<p>所有#开头的（除了#！）都是普通注释<br>参数的用法(</p>
<ul>
<li>$0：调用文件使用的文件名，带有前面的路径,</li>
<li>$1-∞：传给脚本的各个参数,</li>
<li>$@,$*：这两个都表示传入的所有参数,</li>
<li>$#：表示传入参数的个数)<br>第一行指定了脚本的执行程序<br>第六行指定了一些程序的错误处理方式等（详见Shell相关文档）<br>第七行改变当前目录到<code>nlp_markup.py</code> 所在目录，也就是<code>udf</code> 目录<br>第九行设置了一个变量<code>BAZZER_HOME</code> 他的值是<code>bazaar</code> 的路径<br>第10-13行执行<code>/parser/target/start</code> 文件，如果有错会不正常退出，并提示<br>第15-17行检查输入参数的正确性，看参数个数是不是大于0个，如果没有参数，自己设定参数名<br>第23-24行把全部输入的参数用<code>tsv2json</code> 工具转换成<code>json</code> 格式，然后在执行<code>parser/run.sh</code> 并以刚才的<code>json</code> 作为参数输入。</li>
</ul>
</blockquote>
<h3 id="4-编译及生成数据表-2"><a href="#4-编译及生成数据表-2" class="headerlink" title="4)  编译及生成数据表"></a>4)  编译及生成数据表</h3><p>a. 编译并执行<code>deepdive compile &amp;&amp; deepdive do sentences</code> 生成 sentences 表。<br><strong>预告：运行很慢，耐心等待</strong></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">root</span>@<span class="selector-tag">ubuntu-mmm</span>:/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">CNdeepdive</span>/<span class="selector-tag">transaction2</span># <span class="selector-tag">chmod</span> <span class="selector-tag">777</span> <span class="selector-tag">udf</span>/<span class="selector-tag">bazaar</span>/<span class="selector-tag">parser</span>/<span class="selector-tag">run</span><span class="selector-class">.sh</span></span><br><span class="line"><span class="selector-tag">root</span>@<span class="selector-tag">ubuntu-mmm</span>:/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">CNdeepdive</span>/<span class="selector-tag">transaction2</span># <span class="selector-tag">chmod</span> <span class="selector-tag">777</span> <span class="selector-tag">udf</span>/<span class="selector-tag">nlp_markup</span><span class="selector-class">.sh</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">root</span>@<span class="selector-tag">ubuntu-mmm</span>:/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">CNdeepdive</span>/<span class="selector-tag">transaction2</span># <span class="selector-tag">deepdive</span> <span class="selector-tag">compile</span> <span class="selector-tag">&amp;</span><span class="selector-tag">&amp;</span> <span class="selector-tag">deepdive</span> <span class="selector-tag">do</span> <span class="selector-tag">sentences</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">loading</span> <span class="selector-tag">dd_tmp_sentences</span>: <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:31</span>    <span class="selector-tag">0</span> <span class="selector-tag">B</span> <span class="selector-attr">[   0 B/s]</span> ([   <span class="number">0</span> B/s])<span class="selector-tag">2019-10-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:01</span><span class="selector-pseudo">:41.117623</span> <span class="selector-tag">Reading</span> <span class="selector-tag">POS</span> <span class="selector-tag">tagger</span> <span class="selector-tag">model</span> <span class="selector-tag">from</span> <span class="selector-tag">edu</span>/<span class="selector-tag">stanford</span>/<span class="selector-tag">nlp</span>/<span class="selector-tag">models</span>/<span class="selector-tag">pos-tagger</span>/<span class="selector-tag">chinese-distsim</span>/<span class="selector-tag">chinese-distsim</span><span class="selector-class">.tagger</span> ... <span class="selector-tag">done</span> <span class="selector-attr">[2.1 sec]</span>.</span><br><span class="line"><span class="selector-tag">2019-10-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:01</span><span class="selector-pseudo">:41.118162</span> <span class="selector-tag">Adding</span> <span class="selector-tag">annotator</span> <span class="selector-tag">lemma</span></span><br><span class="line"><span class="selector-tag">loading</span> <span class="selector-tag">dd_tmp_sentences</span>: <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:42</span>    <span class="selector-tag">0</span> <span class="selector-tag">B</span> <span class="selector-attr">[   0 B/s]</span> ([   <span class="number">0</span> B/s])<span class="selector-tag">2019-10-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:01</span><span class="selector-pseudo">:52.480759</span> <span class="selector-tag">Loading</span> <span class="selector-tag">classifier</span> <span class="selector-tag">from</span> <span class="selector-tag">edu</span>/<span class="selector-tag">stanford</span>/<span class="selector-tag">nlp</span>/<span class="selector-tag">models</span>/<span class="selector-tag">ner</span>/<span class="selector-tag">chinese</span><span class="selector-class">.misc</span><span class="selector-class">.distsim</span><span class="selector-class">.crf</span><span class="selector-class">.ser</span><span class="selector-class">.gz</span> ... <span class="selector-tag">done</span> <span class="selector-attr">[11.3 sec]</span>.</span><br><span class="line"><span class="selector-tag">loading</span> <span class="selector-tag">dd_tmp_sentences</span>: <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:43</span>    <span class="selector-tag">0</span> <span class="selector-tag">B</span> <span class="selector-attr">[   0 B/s]</span> ([   <span class="number">0</span> B/s])<span class="selector-tag">2019-10-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:01</span><span class="selector-pseudo">:53.716363</span> <span class="selector-tag">Loading</span> <span class="selector-tag">parser</span> <span class="selector-tag">from</span> <span class="selector-tag">serialized</span> <span class="selector-tag">file</span> <span class="selector-tag">edu</span>/<span class="selector-tag">stanford</span>/<span class="selector-tag">nlp</span>/<span class="selector-tag">models</span>/<span class="selector-tag">lexparser</span>/<span class="selector-tag">chineseloading</span> <span class="selector-tag">dd_tmp_sentences</span>: <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:44</span>    <span class="selector-tag">0</span> <span class="selector-tag">B</span> <span class="selector-attr">[   0 B/s]</span> ([   <span class="number">0</span> B/s])<span class="selector-tag">2019-10-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:01</span><span class="selector-pseudo">:53.943866</span> <span class="selector-tag">Parsing</span> <span class="selector-tag">document</span> <span class="selector-tag">0</span>...</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>b. 您可以通过以下命令来查询生成的结果： </p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive query '</span><br><span class="line">doc_id, index, tokens, ner_tags | <span class="type">5</span></span><br><span class="line">?- sentences(doc_id, index, text, tokens, lemmas, pos_tags, ner_tags, <span class="keyword">_</span>, <span class="keyword">_</span>, <span class="keyword">_</span>).</span><br><span class="line">'</span><br><span class="line"></span><br><span class="line">doc_id | <span class="type">index</span> |                                                                                  <span class="type">tokens</span>                                                                                   |                                                 <span class="type">ner_tags</span>                                                  </span><br><span class="line">--------+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------</span><br><span class="line"> <span class="number">0</span>      |     <span class="type">1</span> | <span class="type">&#123;周星驰,，,1962</span>年,<span class="number">6</span>月,<span class="number">22</span>日,生,于,香港,，,祖籍,浙江,宁波,，,中国,香港,演员,、,导演,、,编剧,、,制作人,、,商人,，,毕业于,无线,电视,艺员,训练班,。&#125;                           | <span class="type">&#123;PERSON</span>,O,MISC,MISC,MISC,O,O,GPE,O,O,GPE,GPE,O,GPE,GPE,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O&#125;</span><br><span class="line"> <span class="number">0</span>      |     <span class="type">2</span> | <span class="type">&#123;1980</span>年,成为,丽的,电视台,的,特约,演员,，,从而,进入,演艺圈,。&#125;                                                                                                             | <span class="type">&#123;O</span>,O,O,O,O,O,O,O,O,O,O,O&#125;</span><br><span class="line"> <span class="number">0</span>      |     <span class="type">3</span> | <span class="type">&#123;1981</span>年,出演,个人,首部,电视剧,《,IQ,成熟,时,》,。&#125;                                                                                                                          | <span class="type">&#123;O</span>,O,O,O,O,O,MISC,MISC,MISC,O,O&#125;</span><br><span class="line"> <span class="number">0</span>      |     <span class="type">4</span> | <span class="type">&#123;1988</span>年,将,演艺,事业,的,重心,转向,大,银幕,，,并,于,同,年,出演,电影,处女,作,《,捕,风,汉子,》,。&#125;                                                                             | <span class="type">&#123;O</span>,O,O,O,O,O,O,O,O,O,O,O,MISC,MISC,O,O,O,O,O,MISC,MISC,MISC,O,O&#125;</span><br><span class="line"> <span class="number">0</span>      |     <span class="type">5</span> | <span class="type">&#123;1990</span>年,凭借,喜剧片,《,一,本,漫画,闯,天涯,》,确立,其,无厘头,的,表演,风格,(,<span class="number">1</span>,),；,同年,，,因其,主演,的,喜剧,动作片,《,赌圣,》,打破,香港,地区,票房,纪录,而,获得,关注,(,<span class="number">2</span>,),。&#125; | <span class="type">&#123;O</span>,O,O,O,MISC,MISC,MISC,MISC,MISC,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,MISC,O,O,GPE,O,O,O,O,O,O,O,O,O,O&#125;</span><br><span class="line">(<span class="number">5</span> rows)</span><br></pre></td></tr></table></figure>
<h1 id="五-实体抽取及候选实体对的生成"><a href="#五-实体抽取及候选实体对的生成" class="headerlink" title="五. 实体抽取及候选实体对的生成"></a>五. 实体抽取及候选实体对的生成</h1><p>本部分包含两步：</p>
<ul>
<li>获取候选实体<ul>
<li>获取演员候选实体</li>
<li>获取电影候选实体</li>
</ul>
</li>
<li>生成候选实体对，即演员-电影实体对</li>
</ul>
<h2 id="1-候选实体的生成"><a href="#1-候选实体的生成" class="headerlink" title="1.候选实体的生成"></a>1.候选实体的生成</h2><h3 id="1-app-ddlog-中定义相应的数据表-1"><a href="#1-app-ddlog-中定义相应的数据表-1" class="headerlink" title="1)  app.ddlog 中定义相应的数据表"></a>1)  app.ddlog 中定义相应的数据表</h3><p> 首先介绍演员候选实体的生成。首先我们在app.ddlog 中定义实体数据表： </p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@extraction</span><br><span class="line">actor_mention(</span><br><span class="line">        mention_id <span class="keyword">text</span>,</span><br><span class="line">        mention_text <span class="keyword">text</span>,</span><br><span class="line">        doc_id <span class="keyword">text</span>,</span><br><span class="line">        sentences_index <span class="keyword">int</span>,</span><br><span class="line">        begin_index <span class="keyword">int</span>,</span><br><span class="line">        end_index <span class="keyword">int</span></span><br><span class="line">).</span><br></pre></td></tr></table></figure>
<p>该表包含了实体的id、内容、所在文本的id、所在句子的索引、起始和终止位置索引。</p>
<h3 id="2-app-ddlog-中定义相应的函数-1"><a href="#2-app-ddlog-中定义相应的函数-1" class="headerlink" title="2)  app.ddlog 中定义相应的函数"></a>2)  app.ddlog 中定义相应的函数</h3><p>而后继续定义实体抽取函数：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">map_actor_mention</span> <span class="title">over</span>(</span></span><br><span class="line">        doc_id <span class="keyword">text</span>,</span><br><span class="line">        sentence_index int,</span><br><span class="line">        tokens <span class="keyword">text</span>[],</span><br><span class="line">        pos_tags <span class="keyword">text</span>[],</span><br><span class="line">        ner_tags <span class="keyword">text</span>[]</span><br><span class="line">    ) returns rows like actor_mention</span><br><span class="line">implementation <span class="string">"udf/map_actor_mention.py"</span> handles tsv <span class="keyword">lines</span>.</span><br></pre></td></tr></table></figure>
<p>其中 udf/map_actor_mention.py 脚本遍历数据库中的句子，找到连续的NER标记为PERSON 且 POS 标记为NR的序列，再对其做过滤整合处理，返回候选实体。</p>
<h3 id="3-app-ddlog-中定义相应的函数调用-1"><a href="#3-app-ddlog-中定义相应的函数调用-1" class="headerlink" title="3)  app.ddlog 中定义相应的函数调用"></a>3)  app.ddlog 中定义相应的函数调用</h3><p>最后我们在 app.ddlog 中调用函数，将 函数的输出存储到 actor_mention 表中。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">actor_mention += map_actor_mention(</span><br><span class="line">    doc_id, sentence_index, <span class="built_in">tokens</span>, pos_tags, ner_tags</span><br><span class="line">    ) :-                   </span><br><span class="line">    sentences(doc_id, sentence_index, <span class="symbol">_</span>, <span class="built_in">tokens</span>, <span class="symbol">_</span>, pos_tags, ner_tags, <span class="symbol">_</span>, <span class="symbol">_</span>, <span class="symbol">_</span>).</span><br></pre></td></tr></table></figure>
<h3 id="4-编译及生成数据表-3"><a href="#4-编译及生成数据表-3" class="headerlink" title="4)  编译及生成数据表"></a>4)  编译及生成数据表</h3><p>现在我们可以编译并执行得到 actor_mention 表了。 </p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># chmod 777 udf/map_actor_mention.py</span></span><br><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># deepdive <span class="meta-keyword">compile</span> &amp;&amp; deepdive do actor_mention</span></span><br></pre></td></tr></table></figure>
<h3 id="5-生成电影类的实体表"><a href="#5-生成电影类的实体表" class="headerlink" title="5)  生成电影类的实体表"></a>5)  生成电影类的实体表</h3><p>同理可以得到电影类的实体表 movie_mention ： </p>
<p>a. 在app.ddlog 中定义相应的内容</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@extraction</span><br><span class="line">movie_mention(</span><br><span class="line">        mention_id <span class="built_in">text</span>,  </span><br><span class="line">        mention_text <span class="built_in">text</span>,</span><br><span class="line">        doc_id <span class="built_in">text</span>,      </span><br><span class="line">        sentences_index <span class="built_in">int</span>,</span><br><span class="line">        begin_index <span class="built_in">int</span>,</span><br><span class="line">        end_index <span class="built_in">int</span></span><br><span class="line">    ).</span><br><span class="line"></span><br><span class="line">function map_movie_mention over(</span><br><span class="line">    doc_id <span class="built_in">text</span>,</span><br><span class="line">    sentence_index <span class="built_in">int</span>,</span><br><span class="line">    tokens <span class="built_in">text</span>[],</span><br><span class="line">    pos_tags <span class="built_in">text</span>[],</span><br><span class="line">    ner_tags <span class="built_in">text</span>[]</span><br><span class="line">) returns <span class="built_in">rows</span> like movie_mention</span><br><span class="line">implementation <span class="string">"udf/map_movie_mention.py"</span> handles tsv lines.</span><br><span class="line">                </span><br><span class="line">movie_mention += map_movie_mention(</span><br><span class="line">doc_id, sentence_index, tokens, pos_tags, ner_tags</span><br><span class="line">) <span class="symbol">:</span>-            </span><br><span class="line">    sentences(doc_id, sentence_index, _, tokens, _, pos_tags, ner_tags, _, _, _).</span><br></pre></td></tr></table></figure>
<p>b. 编译并执行<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># chmod 777 udf/map_movie_mention.py</span></span><br><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># deepdive <span class="meta-keyword">compile</span> &amp;&amp; deepdive do movie_mention</span></span><br></pre></td></tr></table></figure></p>
<p>c. 查询看一下得到的实体： </p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root<span class="meta">@ubuntu-mmm:/usr/local/CNdeepdive/transaction2#</span> deepdive query '</span><br><span class="line">mention_id, mention_text, doc_id |<span class="string"> 5</span></span><br><span class="line"><span class="string">?- movie_mention(mention_id, mention_text, doc_id, _, _, _).</span></span><br><span class="line"><span class="string">'</span></span><br><span class="line"></span><br><span class="line"><span class="string"> mention_id </span>|<span class="string"> mention_text </span>|<span class="string"> doc_id </span></span><br><span class="line"><span class="string">------------+--------------+--------</span></span><br><span class="line"><span class="string"> 0_5_28_28  </span>|<span class="string"> 赌圣         </span>|<span class="string"> 0</span></span><br><span class="line"><span class="string"> 0_7_6_6    </span>|<span class="string"> 大话西游     </span>|<span class="string"> 0</span></span><br><span class="line"><span class="string"> 0_7_11_11  </span>|<span class="string"> 华语         </span>|<span class="string"> 0</span></span><br><span class="line"><span class="string"> 0_8_6_6    </span>|<span class="string"> 喜剧         </span>|<span class="string"> 0</span></span><br><span class="line"><span class="string"> 0_9_4_4    </span>|<span class="string"> 少林足球     </span>|<span class="string"> 0</span></span><br><span class="line"><span class="string">(5 rows)</span></span><br></pre></td></tr></table></figure>
<h2 id="2-生成候选实体对"><a href="#2-生成候选实体对" class="headerlink" title="2. 生成候选实体对"></a>2. 生成候选实体对</h2><h3 id="1-app-ddlog-中定义相应的数据表-2"><a href="#1-app-ddlog-中定义相应的数据表-2" class="headerlink" title="1)  app.ddlog 中定义相应的数据表"></a>1)  app.ddlog 中定义相应的数据表</h3><p>这一步我们要生成候选实体对，首先定义数据表如下： </p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@extraction</span><br><span class="line">play_candidate(</span><br><span class="line">    p1_id <span class="keyword">text</span>,</span><br><span class="line">    p1_name <span class="keyword">text</span>,</span><br><span class="line">    p2_id <span class="keyword">text</span>,</span><br><span class="line">    p2_name <span class="keyword">text</span></span><br><span class="line">).</span><br></pre></td></tr></table></figure>
<h3 id="2-app-ddlog-中定义相应的统计每个句⼦的实体数"><a href="#2-app-ddlog-中定义相应的统计每个句⼦的实体数" class="headerlink" title="2)  app.ddlog 中定义相应的统计每个句⼦的实体数"></a>2)  app.ddlog 中定义相应的统计每个句⼦的实体数</h3><p>包含实体1/2 的id 和内容。接下来统计每个句子的实体数量以限制同一句内出现过多实体： </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">num_entity</span><span class="params">(doc_id, sentence_index, COUNT(p)</span></span> + COUNT(q)) :-</span><br><span class="line">	actor_mention(<span class="selector-tag">p</span>, _, doc_id, sentence_index, _, _),</span><br><span class="line">	movie_mention(<span class="selector-tag">q</span>, _, doc_id, sentence_index, _, _).</span><br></pre></td></tr></table></figure>
<h3 id="3-app-ddlog-中定义相应的函数"><a href="#3-app-ddlog-中定义相应的函数" class="headerlink" title="3)  app.ddlog 中定义相应的函数"></a>3)  app.ddlog 中定义相应的函数</h3><p>而后定义过滤函数： </p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">map_play_candidate</span> <span class="title">over</span> (</span></span><br><span class="line">    p1_id <span class="keyword">text</span>,</span><br><span class="line">    p1_name <span class="keyword">text</span>,</span><br><span class="line">    p2_id <span class="keyword">text</span>,</span><br><span class="line">    p2_name <span class="keyword">text</span></span><br><span class="line">) returns rows like play_candidate</span><br><span class="line">implementation <span class="string">"udf/map_play_candidate.py"</span> handles tsv <span class="keyword">lines</span>.</span><br></pre></td></tr></table></figure>
<p>该函数内您可以定义一些规则对候选实体对进行筛选。</p>
<h3 id="4-app-ddlog-中定义相应的函数调用"><a href="#4-app-ddlog-中定义相应的函数调用" class="headerlink" title="4)  app.ddlog 中定义相应的函数调用"></a>4)  app.ddlog 中定义相应的函数调用</h3><p>接下来调用上述函数并结合一些规则对实体对进行进一步的筛选，将筛选结果存储到 play_candidate 数据表中：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">play_candidate += map_play_candidate(p1, p1_name, p2, p2_name)<span class="keyword"> :</span>-</span><br><span class="line">    num_entity(same_doc, same_sentence, num_e),</span><br><span class="line">    actor_mention(p1, p1_name, same_doc, same_sentence, p1_begin, _),</span><br><span class="line">    movie_mention(p2, p2_name, same_doc, same_sentence, p2_begin, _),</span><br><span class="line">    num_e &lt; 5,  </span><br><span class="line">    p1_name != p2_name,</span><br><span class="line">    p1_begin != p2_begin.</span><br></pre></td></tr></table></figure>
<h3 id="5-编译及生成数据表"><a href="#5-编译及生成数据表" class="headerlink" title="5)  编译及生成数据表"></a>5)  编译及生成数据表</h3><p>a. 编译并执行得到候选实体对表： </p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># chmod 777 udf/map_play_candidate.py</span></span><br><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># deepdive <span class="meta-keyword">compile</span> &amp;&amp; deepdive do play_candidate</span></span><br></pre></td></tr></table></figure>
<p> b. 查询一下看看结果： </p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive query <span class="emphasis">'</span></span><br><span class="line"><span class="emphasis">p1_text, p2_text | 5</span></span><br><span class="line"><span class="emphasis">?- play_candidate(_, p1_text, _, p2_text).</span></span><br><span class="line"><span class="emphasis">'</span></span><br><span class="line"></span><br><span class="line"><span class="code">   p1_text    | p2_text  </span></span><br><span class="line">--------------+----------</span><br><span class="line"><span class="code"> 周星驰       | 滕王阁序</span></span><br><span class="line"><span class="code"> 周星驰       | 北斗</span></span><br><span class="line"><span class="code"> 龙炳基       | 北斗</span></span><br><span class="line"><span class="code"> 赵子龙       | 生命</span></span><br><span class="line"><span class="code"> 郑佩佩       | 审死官</span></span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure>
<h1 id="六-数据处理"><a href="#六-数据处理" class="headerlink" title="六. 数据处理"></a>六. 数据处理</h1><h2 id="1-特征抽取"><a href="#1-特征抽取" class="headerlink" title="1. 特征抽取"></a>1. 特征抽取</h2><p>现在我们要用deeodive自带的 ddlib 库抽选实体对的文本特征。</p>
<h3 id="1-app-ddlog-中定义相应的数据表-3"><a href="#1-app-ddlog-中定义相应的数据表-3" class="headerlink" title="1)  app.ddlog 中定义相应的数据表"></a>1)  app.ddlog 中定义相应的数据表</h3><p>首先定义特征表：</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@extraction</span><br><span class="line">play_feature(                 </span><br><span class="line">    p1_id <span class="keyword">text</span>,               </span><br><span class="line">    p2_id <span class="keyword">text</span>,               </span><br><span class="line">    feature <span class="keyword">text</span>              </span><br><span class="line">).</span><br></pre></td></tr></table></figure>
<p>该特征是实体对间一系列文本特征的集合。</p>
<h3 id="2-app-ddlog-中定义相应的函数-2"><a href="#2-app-ddlog-中定义相应的函数-2" class="headerlink" title="2)  app.ddlog 中定义相应的函数"></a>2)  app.ddlog 中定义相应的函数</h3><p>而后我们定义特征提取函数得到各种 POS/NER/次序列的窗口特征等。</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function extract_play_features over (</span><br><span class="line">    p1_id          <span class="built_in">text</span>,     </span><br><span class="line">    p2_id          <span class="built_in">text</span>,     </span><br><span class="line">    p1_begin_index <span class="built_in">int</span>,      </span><br><span class="line">    p1_end_index   <span class="built_in">int</span>,      </span><br><span class="line">    p2_begin_index <span class="built_in">int</span>,      </span><br><span class="line">    p2_end_index   <span class="built_in">int</span>,      </span><br><span class="line">    doc_id         <span class="built_in">text</span>,     </span><br><span class="line">    sent_index     <span class="built_in">int</span>,    </span><br><span class="line">    tokens         <span class="built_in">text</span>[],   </span><br><span class="line">    lemmas         <span class="built_in">text</span>[],   </span><br><span class="line">    pos_tags       <span class="built_in">text</span>[], </span><br><span class="line">    ner_tags       <span class="built_in">text</span>[], </span><br><span class="line">    dep_types      <span class="built_in">text</span>[], </span><br><span class="line">    dep_tokens     <span class="built_in">int</span>[]   </span><br><span class="line">) returns <span class="built_in">rows</span> like play_feature</span><br><span class="line">implementation <span class="string">"udf/extract_play_features.py"</span> handles tsv lines.</span><br></pre></td></tr></table></figure>
<h3 id="3-app-ddlog-中定义相应的函数调用-2"><a href="#3-app-ddlog-中定义相应的函数调用-2" class="headerlink" title="3)  app.ddlog 中定义相应的函数调用"></a>3)  app.ddlog 中定义相应的函数调用</h3><p>而后调用该函数：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">play_feature += extract_play_features(</span><br><span class="line">p1_id, p2_id, p1_begin_index, p1_end_index, p2_begin_index, p2_end_index,</span><br><span class="line">doc_id, sent_index, tokens, lemmas, pos_tags, ner_tags, dep_types, dep_tokens</span><br><span class="line">)<span class="keyword"> :</span>-                       </span><br><span class="line">    actor_mention(p1_id, _, doc_id, sent_index, p1_begin_index, p1_end_index),</span><br><span class="line">    movie_mention(p2_id, _, doc_id, sent_index, p2_begin_index, p2_end_index),</span><br><span class="line">    sentences(doc_id, sent_index, _, tokens, lemmas, pos_tags, ner_tags, _, dep_types, dep_tokens).</span><br></pre></td></tr></table></figure>
<h3 id="4-编译及生成数据表-4"><a href="#4-编译及生成数据表-4" class="headerlink" title="4)  编译及生成数据表"></a>4)  编译及生成数据表</h3><p>a. 编译并执行：</p>
<p>预告：运行很慢，耐心等待……</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># chmod 777 udf/extract_play_features.py</span></span><br><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># deepdive <span class="meta-keyword">compile</span> &amp;&amp; deepdive do play_feature</span></span><br></pre></td></tr></table></figure>
<p>b. 查询看一下特征：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-mmm:/usr/local/CNdeepdive/transaction2# deepdive query <span class="string">'| 5 ?- play_feature(_, _, feature).'</span></span><br><span class="line"></span><br><span class="line"> IS_INVERTED</span><br><span class="line"> INV_WORD_SEQ_[》 是 <span class="number">2006</span>年 上映 的 一 部 宫廷 悲剧 电影 ， 该 片 根据 莎士比亚 名剧 《 哈姆雷特 》 改编 ， 由 冯小刚 导演 ， 主要 演员 有 章子怡 、 葛优 、 吴彦祖 、]</span><br><span class="line"> INV_LEMMA_SEQ_[》 是 <span class="number">2006</span>年 上映 的 一 部 宫廷 悲剧 电影 ， 该 片 根据 莎士比亚 名剧 《 哈姆雷特 》 改编 ， 由 冯小刚 导演 ， 主要 演员 有 章子怡 、 葛优 、 吴彦祖 、]</span><br><span class="line"> INV_NER_SEQ_[<span class="keyword">O</span> <span class="keyword">O</span> MISC <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> MISC <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> PERSON <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> <span class="keyword">O</span> PERSON <span class="keyword">O</span> PERSON <span class="keyword">O</span> PERSON <span class="keyword">O</span>]</span><br><span class="line"> INV_POS_SEQ_[PU VC NT VV DEC CD M NN NN NN PU DT NN P NR NN PU NR PU VV PU P NR NN PU JJ NN VE NR PU NR PU NR PU]</span><br><span class="line">(<span class="number">5</span> rows)</span><br></pre></td></tr></table></figure>
<h2 id="2-有监督数据处理"><a href="#2-有监督数据处理" class="headerlink" title="2. 有监督数据处理"></a>2. 有监督数据处理</h2><h3 id="1-app-ddlog-中定义相应的数据表-4"><a href="#1-app-ddlog-中定义相应的数据表-4" class="headerlink" title="1)  app.ddlog 中定义相应的数据表"></a>1)  app.ddlog 中定义相应的数据表</h3><p>首先在 app.ddlog 中定义 play_label 表存放有监督数据： </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@extraction</span>             </span><br><span class="line">play_label(             </span><br><span class="line">    <span class="variable">@key</span>                </span><br><span class="line">    <span class="variable">@references</span>(relation=<span class="string">"has_play"</span>, column=<span class="string">"p1_id"</span>, alias=<span class="string">"has_play"</span>)</span><br><span class="line">    p1_id text,         </span><br><span class="line">    <span class="variable">@key</span>                </span><br><span class="line">    <span class="variable">@references</span>(relation=<span class="string">"has_play"</span>, column=<span class="string">"p2_id"</span>, alias=<span class="string">"has_play"</span>)</span><br><span class="line">    p2_id text,         </span><br><span class="line">    <span class="variable">@navigable</span>          </span><br><span class="line">    label int,          </span><br><span class="line">    <span class="variable">@navigable</span>          </span><br><span class="line">    rule_id text        </span><br><span class="line">).</span><br></pre></td></tr></table></figure>
<p>rule_id 表示相关性的规则名称，label 为正值表示正相关，负值表示负相关。绝对值越大，相关性越大。</p>
<h3 id="2-app-ddlog-中定义，初始化定义"><a href="#2-app-ddlog-中定义，初始化定义" class="headerlink" title="2)  app.ddlog 中定义，初始化定义"></a>2)  app.ddlog 中定义，初始化定义</h3><p>初始化定义，复制 play_candidate 表，label 初始化为0，rule_id 为 NULL：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">paly_label</span>(<span class="built_in">p1</span>, <span class="built_in">p2</span>, <span class="number">0</span>, NULL) :- play_candidate(<span class="built_in">p1</span>, _, <span class="built_in">p2</span>, _).</span><br></pre></td></tr></table></figure>
<h3 id="2-app-ddlog-中定义，导入"><a href="#2-app-ddlog-中定义，导入" class="headerlink" title="2)  app.ddlog 中定义，导入"></a>2)  app.ddlog 中定义，导入</h3><p>接下来将最开始导入的有监督数据表 actor_movie_dbdata 导入到 play_label 中，并赋予权重3：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">play_label(p1, p2, 3, <span class="string">"from_dbdata"</span>)<span class="keyword"> :</span>-</span><br><span class="line">    play_candidate(p1, p1_name, p2, p2_name),</span><br><span class="line">    actor_movie_dbdata(n1, n2),</span><br><span class="line">    [lower(n1) = lower(p1_name), lower(n2) = lower(p2_name)].</span><br></pre></td></tr></table></figure>
<h2 id="3-预标记"><a href="#3-预标记" class="headerlink" title="3. 预标记"></a>3. 预标记</h2><p>接下来定义一些逻辑规则对文本进行预标记</p>
<h3 id="1-app-ddlog-中定义相应的数据表-5"><a href="#1-app-ddlog-中定义相应的数据表-5" class="headerlink" title="1)  app.ddlog 中定义相应的数据表"></a>1)  app.ddlog 中定义相应的数据表</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function supervise over (      </span><br><span class="line">    p1_id <span class="built_in">text</span>, p1_begin <span class="keyword">int</span>, p1_end <span class="keyword">int</span>,</span><br><span class="line">    p2_id <span class="built_in">text</span>, p2_begin <span class="keyword">int</span>, p2_end <span class="keyword">int</span>,</span><br><span class="line">    doc_id <span class="built_in">text</span>,               </span><br><span class="line">    doc_id <span class="built_in">text</span>,               </span><br><span class="line">    sentence_index <span class="keyword">int</span>,        </span><br><span class="line">    sentence_text <span class="built_in">text</span>,        </span><br><span class="line">    tokens <span class="built_in">text</span>[],             </span><br><span class="line">    lemmas <span class="built_in">text</span>[],             </span><br><span class="line">    pos_tags <span class="built_in">text</span>[],           </span><br><span class="line">    ner_tags <span class="built_in">text</span>[],           </span><br><span class="line">    dep_types <span class="built_in">text</span>[],          </span><br><span class="line">    dep_tokens <span class="keyword">int</span>[]           </span><br><span class="line">) returns (p1_id <span class="built_in">text</span>, p2_id <span class="built_in">text</span>, label <span class="keyword">int</span>, rule_id <span class="built_in">text</span>)</span><br><span class="line">implementation <span class="string">"udf/supervise_play.py"</span> handles tsv lines.</span><br></pre></td></tr></table></figure>
<p>程序 udf/supervise_play.py 里通过一些指定的规则如 出演这种特征来进行预标记。给出label和rule_id的值。</p>
<h3 id="2-app-ddlog-中定义相应的函数调用"><a href="#2-app-ddlog-中定义相应的函数调用" class="headerlink" title="2)  app.ddlog 中定义相应的函数调用"></a>2)  app.ddlog 中定义相应的函数调用</h3><p>接下来调用标记函数，将规则抽到的数据写到play_label 表中：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">play_label += supervise(</span><br><span class="line">    p1_id, p1_begin, p1_end,</span><br><span class="line">    p2_id, p2_begin, p2_end,</span><br><span class="line">    doc_id, sentence_index, sentence_text,</span><br><span class="line">    tokens, lemmas, pos_tags, ner_tags, dep_types, dep_tokens_indexes</span><br><span class="line">    )<span class="keyword"> :</span>-</span><br><span class="line">    play_candidate(p1_id, _, p2_id, _),</span><br><span class="line">    actor_mention(p1_id, p1_text, doc_id, sentence_index, p1_begin, p1_end),</span><br><span class="line">    movie_mention(p2_id, p2_text, _, _, p2_begin, p2_end),</span><br><span class="line">    sentences(  doc_id, sentence_index, sentence_text,</span><br><span class="line">                tokens, lemmas, pos_tags, ner_tags, _, dep_types, dep_tokens_indexes</span><br><span class="line">    ).</span><br></pre></td></tr></table></figure>
<h3 id="3-app-ddlog-中定义，最终标记"><a href="#3-app-ddlog-中定义，最终标记" class="headerlink" title="3)  app.ddlog 中定义，最终标记"></a>3)  app.ddlog 中定义，最终标记</h3><p>由于不同的规则可能覆盖了相同的实体对，因此利用 vote方法进行综合给出最终标记：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">play_label_resolved(p1_id, p2_id, SUM(vote))<span class="keyword"> :</span>-</span><br><span class="line">    play_label(p1_id, p2_id, vote, rule_id).</span><br></pre></td></tr></table></figure>
<h3 id="4-编译及生成数据表-5"><a href="#4-编译及生成数据表-5" class="headerlink" title="4)  编译及生成数据表"></a>4)  编译及生成数据表</h3><p>最后编译并执行：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># chmod 777 udf/supervise_play.py</span></span><br><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># deepdive <span class="meta-keyword">compile</span> &amp;&amp; deepdive do play_label_resolved</span></span><br></pre></td></tr></table></figure>
<h2 id="4-变量表定义"><a href="#4-变量表定义" class="headerlink" title="4. 变量表定义"></a>4. 变量表定义</h2><p>首先定义最终存储的表格，[?]表示此表是用户模式下的变量表，即需要推到关系的表。这里我们需要推到的是演员和电影间是否存在演出关系。</p>
<h3 id="1-app-ddlog-中定义相应的数据表-6"><a href="#1-app-ddlog-中定义相应的数据表-6" class="headerlink" title="1)  app.ddlog 中定义相应的数据表"></a>1)  app.ddlog 中定义相应的数据表</h3><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@extraction</span><br><span class="line">has_play?(</span><br><span class="line">    p1_id <span class="keyword">text</span>,</span><br><span class="line">    p2_id <span class="keyword">text</span></span><br><span class="line">).</span><br></pre></td></tr></table></figure>
<h3 id="2-app-ddlog-中定义，写入已知的变量"><a href="#2-app-ddlog-中定义，写入已知的变量" class="headerlink" title="2)  app.ddlog 中定义，写入已知的变量"></a>2)  app.ddlog 中定义，写入已知的变量</h3><p>根据打标结果，写入已知的变量：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">has_play(p1_id, p2_id) = <span class="keyword">if</span> l &gt; <span class="number">0</span> <span class="keyword">then</span> <span class="literal">TRUE</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> l &lt; <span class="number">0</span> <span class="keyword">then</span> <span class="literal">FALSE</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="literal">NULL</span> <span class="function"><span class="keyword">end</span> :-</span></span><br><span class="line">                    play_label_resolved(p1_id, p2_id, l).</span><br></pre></td></tr></table></figure>
<h3 id="3-编译及生成数据表"><a href="#3-编译及生成数据表" class="headerlink" title="3)  编译及生成数据表"></a>3)  编译及生成数据表</h3><p>此时表中部分变量的label 已知，成为了先验变量。编译并执行：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># deepdive <span class="meta-keyword">compile</span> &amp;&amp; deepdive do has_play</span></span><br></pre></td></tr></table></figure>
<h2 id="5-构建因子图"><a href="#5-构建因子图" class="headerlink" title="5. 构建因子图"></a>5. 构建因子图</h2><h3 id="1-app-ddlog-中定义相应的，指定特征"><a href="#1-app-ddlog-中定义相应的，指定特征" class="headerlink" title="1)  app.ddlog 中定义相应的，指定特征"></a>1)  app.ddlog 中定义相应的，指定特征</h3><p>将每一对 has_play 中的实体对和特征表连接起来，通过特征因子连接，全局学习这些特征的权重 f</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@weight(f)</span><br><span class="line">has_play(p1_id, p2_id)<span class="keyword"> :</span>-</span><br><span class="line">    play_candidate(p1_id, _, p2_id, _),</span><br><span class="line">    play_feature(p1_id, p2_id, f).</span><br></pre></td></tr></table></figure>
<h3 id="2-编译及生成数据表"><a href="#2-编译及生成数据表" class="headerlink" title="2)  编译及生成数据表"></a>2)  编译及生成数据表</h3><p>a. 编译并生成最终的概率模型：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root<span class="symbol">@ubuntu</span>-mmm:/usr/<span class="keyword">local</span>/CNdeepdive/transaction2<span class="meta"># deepdive <span class="meta-keyword">compile</span> &amp;&amp; deepdive do probabilities</span></span><br></pre></td></tr></table></figure>
<p>b. 就完成了我们的推断，现在查询我们预测的演员-电影间的交易关系概率：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root<span class="meta">@ubuntu-mmm:/usr/local/CNdeepdive/transaction2#</span> deepdive sql <span class="string">"SELECT p1_id, p2_id, expectation FROM has_play_label_inference ORDER BY random() LIMIT 5"</span></span><br><span class="line"> </span><br><span class="line">   p1_id    |<span class="string">   p2_id    </span>|<span class="string"> expectation </span></span><br><span class="line"><span class="string">------------+------------+-------------</span></span><br><span class="line"><span class="string"> 6_38_20_20 </span>|<span class="string"> 6_38_44_44 </span>|<span class="string">       0.926</span></span><br><span class="line"><span class="string"> 0_30_36_36 </span>|<span class="string"> 0_30_57_57 </span>|<span class="string">       0.082</span></span><br><span class="line"><span class="string"> 0_39_83_83 </span>|<span class="string"> 0_39_94_95 </span>|<span class="string">       0.214</span></span><br><span class="line"><span class="string"> 6_21_7_8   </span>|<span class="string"> 6_21_43_43 </span>|<span class="string">       0.003</span></span><br><span class="line"><span class="string"> 5_66_0_0   </span>|<span class="string"> 5_66_20_21 </span>|<span class="string">       0.008</span></span><br><span class="line"><span class="string">(5 rows)</span></span><br></pre></td></tr></table></figure>
<h1 id="六-参考"><a href="#六-参考" class="headerlink" title="六. 参考"></a>六. 参考</h1><ol>
<li><p><a href="https://blog.csdn.net/weixin_42001089/article/details/91388707" target="_blank" rel="noopener">deepdive python3 环境下多种实体关系抽取流程</a></p>
</li>
<li><p><a href="http://www.openkg.cn/dataset/cn-deepdive" target="_blank" rel="noopener">支持中文的deepdive：斯坦福大学的开源知识抽取工具（三元组抽取）</a></p>
</li>
</ol>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2019/10/100596.html" class="pre-post btn btn-default" title='从零开始学习知识图谱 之 六.电影知识图谱构建 6.将关系型数据存入图数据库Neo4j'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">从零开始学习知识图谱 之 六.电影知识图谱构建 6.将关系型数据存入图数据库Neo4j</span>
        </a>
    
    
        <a href="/archives/2019/10/100594.html" class="next-post btn btn-default" title='从零开始学习知识图谱 之 四.电影知识图谱构建 4.基于ElasticSearch的简单语义搜索'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">从零开始学习知识图谱 之 四.电影知识图谱构建 4.基于ElasticSearch的简单语义搜索</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一-简介"><span class="toc-text">一. 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二-环境准备"><span class="toc-text">二. 环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-操作系统"><span class="toc-text">1. 操作系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-安装JDK"><span class="toc-text">2. 安装JDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-安装Deepdive"><span class="toc-text">3. 安装Deepdive</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三-项目框架搭建"><span class="toc-text">三. 项目框架搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-建立postgresql的数据库movie"><span class="toc-text">1. 建立postgresql的数据库movie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库管理工具推荐"><span class="toc-text">数据库管理工具推荐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-创建数据库movie"><span class="toc-text">1) 创建数据库movie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-验证数据库是否创建成功"><span class="toc-text">2) 验证数据库是否创建成功</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-返回自己的程序目录"><span class="toc-text">3) 返回自己的程序目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-项目框架搭建"><span class="toc-text">2. 项目框架搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1）创建项⽬⽂件夹"><span class="toc-text">1）创建项⽬⽂件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2）建⽴数据库配置⽂件db-url"><span class="toc-text">2）建⽴数据库配置⽂件db.url</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3）创建项⽬⽂件"><span class="toc-text">3）创建项⽬⽂件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三-数据准备"><span class="toc-text">三. 数据准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-先验数据导入"><span class="toc-text">1. 先验数据导入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-actor-movie-txt文件"><span class="toc-text">1) actor_movie.txt文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-获取-actor-movie-dbdata-csv-文件"><span class="toc-text">2) 获取 actor_movie_dbdata.csv 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-app-ddlog-中定义相应的数据表"><span class="toc-text">3)  app.ddlog 中定义相应的数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-编译及生成数据表"><span class="toc-text">4)  编译及生成数据表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-待抽取文章的导入"><span class="toc-text">2. 待抽取文章的导入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-爬取数据"><span class="toc-text">1) 爬取数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-数据转换"><span class="toc-text">2) 数据转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-app-ddlog-中定义相应的数据表-1"><span class="toc-text">3)  app.ddlog 中定义相应的数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-编译及生成数据表-1"><span class="toc-text">4)  编译及生成数据表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四-文本处理"><span class="toc-text">四. 文本处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-用-stanford-nlp-模块进行文本处理"><span class="toc-text">1. 用 stanford_nlp 模块进行文本处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-app-ddlog-中定义相应的数据表"><span class="toc-text">1)  app.ddlog 中定义相应的数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-app-ddlog-中定义相应的函数"><span class="toc-text">2)  app.ddlog 中定义相应的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-app-ddlog-中定义相应的函数调用"><span class="toc-text">3)  app.ddlog 中定义相应的函数调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-编写-nlp-markup-sh"><span class="toc-text">4)  编写 nlp_markup.sh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-编译及生成数据表-2"><span class="toc-text">4)  编译及生成数据表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五-实体抽取及候选实体对的生成"><span class="toc-text">五. 实体抽取及候选实体对的生成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-候选实体的生成"><span class="toc-text">1.候选实体的生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-app-ddlog-中定义相应的数据表-1"><span class="toc-text">1)  app.ddlog 中定义相应的数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-app-ddlog-中定义相应的函数-1"><span class="toc-text">2)  app.ddlog 中定义相应的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-app-ddlog-中定义相应的函数调用-1"><span class="toc-text">3)  app.ddlog 中定义相应的函数调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-编译及生成数据表-3"><span class="toc-text">4)  编译及生成数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-生成电影类的实体表"><span class="toc-text">5)  生成电影类的实体表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-生成候选实体对"><span class="toc-text">2. 生成候选实体对</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-app-ddlog-中定义相应的数据表-2"><span class="toc-text">1)  app.ddlog 中定义相应的数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-app-ddlog-中定义相应的统计每个句⼦的实体数"><span class="toc-text">2)  app.ddlog 中定义相应的统计每个句⼦的实体数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-app-ddlog-中定义相应的函数"><span class="toc-text">3)  app.ddlog 中定义相应的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-app-ddlog-中定义相应的函数调用"><span class="toc-text">4)  app.ddlog 中定义相应的函数调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-编译及生成数据表"><span class="toc-text">5)  编译及生成数据表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#六-数据处理"><span class="toc-text">六. 数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-特征抽取"><span class="toc-text">1. 特征抽取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-app-ddlog-中定义相应的数据表-3"><span class="toc-text">1)  app.ddlog 中定义相应的数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-app-ddlog-中定义相应的函数-2"><span class="toc-text">2)  app.ddlog 中定义相应的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-app-ddlog-中定义相应的函数调用-2"><span class="toc-text">3)  app.ddlog 中定义相应的函数调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-编译及生成数据表-4"><span class="toc-text">4)  编译及生成数据表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-有监督数据处理"><span class="toc-text">2. 有监督数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-app-ddlog-中定义相应的数据表-4"><span class="toc-text">1)  app.ddlog 中定义相应的数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-app-ddlog-中定义，初始化定义"><span class="toc-text">2)  app.ddlog 中定义，初始化定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-app-ddlog-中定义，导入"><span class="toc-text">2)  app.ddlog 中定义，导入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-预标记"><span class="toc-text">3. 预标记</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-app-ddlog-中定义相应的数据表-5"><span class="toc-text">1)  app.ddlog 中定义相应的数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-app-ddlog-中定义相应的函数调用"><span class="toc-text">2)  app.ddlog 中定义相应的函数调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-app-ddlog-中定义，最终标记"><span class="toc-text">3)  app.ddlog 中定义，最终标记</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-编译及生成数据表-5"><span class="toc-text">4)  编译及生成数据表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-变量表定义"><span class="toc-text">4. 变量表定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-app-ddlog-中定义相应的数据表-6"><span class="toc-text">1)  app.ddlog 中定义相应的数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-app-ddlog-中定义，写入已知的变量"><span class="toc-text">2)  app.ddlog 中定义，写入已知的变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-编译及生成数据表"><span class="toc-text">3)  编译及生成数据表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-构建因子图"><span class="toc-text">5. 构建因子图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-app-ddlog-中定义相应的，指定特征"><span class="toc-text">1)  app.ddlog 中定义相应的，指定特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-编译及生成数据表"><span class="toc-text">2)  编译及生成数据表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#六-参考"><span class="toc-text">六. 参考</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2023&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>