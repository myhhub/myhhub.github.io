<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="逆向,汇编">


    <meta name="description" content="1. FLEXLM简介FLEXlm是应用广泛的License管理工具。DS、ANSYS、MathWorks、80%以上的 EDA软件公司等等采用它管理授权，是目前最流行的加密方法，保护着世界上价...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>FLEXLM ECC 椭圆曲线加密分析 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="FLEXLM ECC 椭圆曲线加密分析">
            
	            FLEXLM ECC 椭圆曲线加密分析
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/crack/">破解</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/assemble/">汇编</a> <a class="tag-link" href="/tags/reverse/">逆向</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2021/08/30</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>588</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <h1 id="1-FLEXLM简介"><a href="#1-FLEXLM简介" class="headerlink" title="1. FLEXLM简介"></a><strong>1. FLEXLM简介</strong></h1><p>FLEXlm是应用广泛的License管理工具。DS、ANSYS、MathWorks、80%以上的 EDA软件公司等等采用它管理授权，是目前最流行的加密方法，保护着世界上价值上兆亿美元的软件，不过在破解者面前，它其实非常脆弱。<br>FLEXlm对厂商来说，它的优点是证书管理功能强大， 支持平台众多。<br>对最终用户来说，它的缺点是不够友好， 比如Windows下，经常由于某些原因，flexlm服务启动错误。维基百科上的条目为：<a href="http://en.wikipedia.org/wiki/FLEXlm" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/FLEXlm</a></p>
<p>FLEXLM本来属于GLOBEtrotter。Macrovision曾经收购GLOBEtrotter。<br>2006年的时候，FLEXLM原来的开发组跑路，另起灶头，产品叫RLM。<br><a href="http://www.reprisesoftware.com/index.php" target="_blank" rel="noopener">http://www.reprisesoftware.com/index.php</a></p>
<p>2008年Macrovision把FLEXLM卖了。现在叫FlexNet Publisher。<br><a href="http://www.flexerasoftware.com/products/flexnet-publisher.htm" target="_blank" rel="noopener">http://www.flexerasoftware.com/products/flexnet-publisher.htm</a></p>
<h1 id="2-FLexLM-的ECC（椭圆曲线加密）来由"><a href="#2-FLexLM-的ECC（椭圆曲线加密）来由" class="headerlink" title="2. FLexLM 的ECC（椭圆曲线加密）来由"></a><strong>2. FLexLM 的ECC（椭圆曲线加密）来由</strong></h1><p>早期的flexlm采用的常规加密，不安全，能被做出lic。这样的教程是很多的。<br>flexlm的安全性完全得不到保障，所以，自 v8(大约2001-2002)版本引入了公钥加密算法：椭圆曲线加密。<br>从此，它一直是flexlm的金钟罩。包括v9(2003-) , v10(2004-) , v11(2007-), 到最新的版本 v11.17 (2021) 。</p>
<p>FlexLm的ECC没有它自己的东西，完全采购自椭圆曲线加密系统的专利拥有者：Certicom公司。<br>换而言之， flexlm ecc是购买自certicom的一套代码，相当于在腐朽的木门上套一层黄金甲。<br>OK， 从此它是不破金身了。</p>
<h1 id="3-Certicom公司简介"><a href="#3-Certicom公司简介" class="headerlink" title="3. Certicom公司简介"></a><strong>3. Certicom公司简介</strong></h1><p>RSA和ECC是两大主流的公钥密码算法体系。相比RSA，ECC晚出生10多年，推广不如前者。<br>Certicom公司是ECC的主要商业支持者，它拥有多项专利。其地位可与RSA公司匹敌（RSA于2006年被EMC公司收购）。<br>有一则消息说，2003年美国国家安全局（NSA）以2500万美元支付了Certicom的26项技术许可。<br>另外有一则消息， Certicom 2007年起诉索尼公司，要求其支付PS3，DVD播放器等涉及加密技术侵权的专利费用。</p>
<p>Certicom的创办人Scott Vanstone，是加拿大滑铁卢大学的数学系教授和皇家科学院院士。<br>以前是研究椭圆曲线加密的，后来创办Certicom公司，努力把ECC从数学界推广到工业界。<br>Scott写过一本《椭圆曲线密码学导论》， 颇有名气。</p>
<h1 id="4-FLEXLM-如何使用ECC"><a href="#4-FLEXLM-如何使用ECC" class="headerlink" title="4. FLEXLM 如何使用ECC"></a><strong>4. FLEXLM 如何使用ECC</strong></h1><p>说来话长。一句话说：FLexLM 在license验证上，主要用的ECDSA（椭圆曲线数字签名算法）。</p>
<p>具体的讲： flexlm针对ECDSA有一些自己定义的东西以抵抗破解。 后面会说到，这些自定义的<br>东西也不是那么牢固。</p>
<h1 id="5-FLEXLM-ECC的通用破解方法"><a href="#5-FLEXLM-ECC的通用破解方法" class="headerlink" title="5. FLEXLM ECC的通用破解方法"></a><strong>5. FLEXLM ECC的通用破解方法</strong></h1><p>FLEXLM ECC的通用破解方法就是：<br>完全按照它的ECDSA算法签名， 只替换公钥和checksum， 写一个keygen生成license。<br>从逻辑上讲，生成license的方法和原厂的完全一致。</p>
<p>具体该怎么做呢：</p>
<p>首先， 实现标准的ECDSA签名算法。椭圆曲线的具体算法，可以用现成的miracl，cryptopp等加密库代码。 只需要搞清楚ECDSA的使用方法就可以。</p>
<p>从早期版本 v9.2 (2004) , 到最新版本v11.17 (2021) 。它的ecc公钥都是有checksum的。<br>替换公钥，首先得搞清楚checksum。它只有一个函数，不算复杂，后面会给出代码。<br>计算这个checksum， 对所有版本都是适合的。</p>
<p>其次， 公钥在文件里是加密打散的，有大量垃圾代码。这些干扰使得flexlm可读性很差。获取公钥需要调试。</p>
<p>那么，有没有更方便的方法获取公钥呢？</p>
<p>ECC验证代码在它执行过程中有其自身的特点。正如游戏辅助工具可以搜索血量，我们也可以写一个辅助工具从内存中获取公钥。</p>
<p>在很多次研究之后，找出一个通用的方法。不需要再拘泥于具体的代码，可以dump出公钥 ，然后用ecctool生成自己的公私钥对，替换公钥，然后可以就写keygen。</p>
<p>由此写了一个工具，对windows平台可直接操作。 对其它平台，把内存镜像出来操作即可。<br>对于非Windows平台，可以在VMware里面操作，制作一份snapshot，得到内存镜像。<br>算法上经过多次优化和排除错误数据，从2GB的内存镜像里找出正确的公钥，平均只需要6秒钟。</p>
<p>所以，对于纯粹采用flexlm ecc sign的license，是可以做出通用的patch_keygen的，<br>不需要去考虑它有没有反调试，也不用管具体的细节。</p>
<p>只要dump 公钥， 替换公钥和checksum， 写patch_keygen就可以了。</p>
<h1 id="6-研究flexlm主要资料"><a href="#6-研究flexlm主要资料" class="headerlink" title="6. 研究flexlm主要资料"></a><strong>6. 研究flexlm主要资料</strong></h1><p>flexlm相对来说资源丰富，基本上每个版本的sdk都有泄漏。<br>如果想深入研究flexlm的加密算法，flexlm sdk是必需的。</p>
<p>写kg是必须要读sdk的，值得注意的是v9.2 sdk sourcecode泄漏。这个网上可搜索到。<br>sdk有一部分是c代码，里面最有用的是l_prikey.c， 这里有ECDSA验证的函数。<br>这个文件的尾部有300行comments，其中有一封email很值得一读。</p>
<p>ECC核心库没有源文件，只有lib文件。<br>在certicom目录下的lib里面，主要为libsb.lib等（Certicom 的加密库：Security Builder）。<br>lib是混淆过了的，但是不影响ida反编译，只是不便于做sig文件。<br>主要依靠人脑识别函数，需要经验和时间。</p>
<h1 id="7-flexlm的key加密强度种类"><a href="#7-flexlm的key加密强度种类" class="headerlink" title="7. flexlm的key加密强度种类"></a><strong>7. flexlm的key加密强度种类</strong></h1><p>以flexlm sdk v9为例，用宏定义表示LM_SIGN_LEVEL。<br>#define LM_SIGN2 2 /<em> SIGN2= </em>/<br>#define LM_SIGN 1 /<em> SIGN= the default </em>/<br>#define LM_NO_SIGN 0 /<em> license key </em>/</p>
<p>v9以后，默认就采用ECC PUBKEY加密。SIGN支持ECC，所以大部分情况下用SIGN比较多，有些用SIGN2。<br>LM_NO_SIGN 是传统的license key， 强度最弱，不建议使用。<br>ECC PUBKEY 只有3种类别， 113， 163， 239 bits。<br>对应的sign长度（字符数） , 字节为( bits + 7 )/8 字节数 , 打印出来，<br>用hex digits表示，ECC的SIGN长度分别是一对 30，42，60 [0-9,A-F]。</p>
<p>采用ECC的，pubkey_strength 必须定义为下面的一个类别，否则l_pubkey_verify会出错：<br>LM_STRENGTH_113BIT，LM_STRENGTH_163BIT，LM_STRENGTH_239BIT。</p>
<p>#define LM_STRENGTH_LICENSE_KEY 0<br>#define LM_STRENGTH_DEFAULT 1<br>#define LM_STRENGTH_113BIT 2<br>#define LM_STRENGTH_163BIT 3<br>#define LM_STRENGTH_239BIT 4<br>#define LM_STRENGTH_PUBKEY LM_STRENGTH_113BIT<br>#define LM_STRENGTH_VERYHIGH LM_STRENGTH_239BIT</p>
<p>在l_pubkey_verify 有这么一段初始化代码， 判断pubkey_strength。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(pubkey_strength)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> LM_STRENGTH_LICENSE_KEY:</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">case</span> LM_STRENGTH_113BIT: ellipticCurve = &amp;LM_PUBKEY_CURVE113BIT;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> LM_STRENGTH_163BIT: ellipticCurve = &amp;LM_PUBKEY_CURVE163BIT;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> LM_STRENGTH_239BIT: ellipticCurve = &amp;LM_PUBKEY_CURVE239BIT;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,</span><br><span class="line">        <span class="string">"LM_STRENGTH in lm_code.h has invalid value %d\n"</span>,</span><br><span class="line">                        pubkey_strength);</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,</span><br><span class="line">            <span class="string">"Use only LM_STRENGTH_[113|163|239]BIT, LM_STRENGTH_DEFAULT, OR LM_STRENGTH_LICENSE_KEY, exiting\n"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面，演示 113， 163， 239 bits的ECDSA签名一段最简单的文本，<br>msg: “123”<br>sha hash：40BD001563085FC35165329EA1FF5C5ECBDBBEEF</p>
<p>#define LM_SEED1 0x47d381a0<br>#define LM_SEED2 0x4fadf97c<br>#define LM_SEED3 0xc4ae244c<br>l_genkeys: seed[3]=A081D3477CF9AD4F4C24AEC4</p>
<p>LM_PUBKEY_CURVE113BIT<br>prvlen=15, prv=00CFDF0247BF6EC0C8D1AA16DD505F<br>publen=16, pub=0301523DD4646BB65FE4238B8AB44D01<br>>&gt; l_prikey_sign_dbg start &gt;&gt;<br>signing “123”<br>hash=40BD001563085FC35165329EA1FF5C5ECBDBBEEF<br>>&gt; l_prikey_sign_dbg done &gt;&gt;<br>siglen=30<br>sig.r=0048D5DD2A57B1A1B357E98C193E63<br>sig.s=000A6FFDF76899F05ABFD2EDD9E065</p>
<p>LM_PUBKEY_CURVE163BIT<br>prvlen=21, prv=03DC603CB1683D43FF5631BBEEC5396D7BD4067300<br>publen=22, pub=0300368FE93082E1ACDD35222AD76782DBA8237B66EC<br>>&gt; l_prikey_sign_dbg start &gt;&gt;<br>signing “123”<br>hash=40BD001563085FC35165329EA1FF5C5ECBDBBEEF<br>>&gt; l_prikey_sign_dbg done &gt;&gt;<br>siglen=42<br>sig.r=039283F2FEA664BE7628F89BBA9D014E89E3868D2C<br>sig.s=017DA34A68C3FC64CB6EBE2B13676B04BE97EB5C20</p>
<p>LM_PUBKEY_CURVE239BIT<br>prvlen=30, prv=13C0E251A5130072A8D2D953EB2C94FAD487C0141B3197863BCC115D7B7E<br>publen=31, pub=035875A53B693A2861837E08FC6A7C58529DF52B565111C3DF55F18E34C9FA<br>>&gt; l_prikey_sign_dbg start &gt;&gt;<br>signing “123”<br>hash=40BD001563085FC35165329EA1FF5C5ECBDBBEEF<br>>&gt; l_prikey_sign_dbg done &gt;&gt;<br>inputlen=3, input=123<br>siglen=60<br>sig.r=1589FCFE91F988D28F7072DBF129424F0D71FA5E7AAC39258F3C408A656A<br>sig.s=0B50642E8ED77FC6A1E6F805CFA0299F44BC7B8035FE17142812B79EA576</p>
<p>sig.r sig.s组成一个完整的SIGN， 输出lic的时候，为了可读性， 一般切分为16 bit的分组（4个hex char）。<br>比如：<br>sig.r=038B9BE995B887B2665C02940C00155DD557C278AC95EADC1BD668DF185B<br>sig.s=1C50F25E81044E4DD9AD072699AAB4A63F4C99249AC8C091F476A6C73682<br>转化为：<br>SIGN=“ 038B9BE995B887B2665C02940C00155DD557C278AC95EADC1BD668DF185B<br>1C50F25E81044E4DD9AD072699AAB4A63F4C99249AC8C091F476A6C73682”<br>或者：<br>SIGN=”038B 9BE9 95B8 87B2 665C 0294 0C00 155D D557 C278 AC95 EADC 1BD6 68DF 185B 1C50 F25E 8104 4E4D D9AD 0726 99AA B4A6 3F4C 9924 9AC8 C091 F476 A6C7 3682”</p>
<p>对flexlm的程序来说，是没有差别的。 都能处理。</p>
<h1 id="8-flexlm所用到的椭圆曲线"><a href="#8-flexlm所用到的椭圆曲线" class="headerlink" title="8. flexlm所用到的椭圆曲线"></a><strong>8. flexlm所用到的椭圆曲线</strong></h1><p>flexlm用到三条椭圆曲线，都是有来历的， 名字分别为sect113r1， sect163k1， sect239k1。<br>具体参数可以参看：<a href="http://en.wikipedia.org/wiki/SECG" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/SECG</a><br>SEC 2: Recommended Elliptic Curve Domain Parameters (Version 2.0)</p>
<p>在flexlm lib里面， 它是写死的静态变量。位置在<br>certicom\libcrvs.lib</p>
<p>保存为3个结构体：<br>struct ellipticCurveParameters sect113r1<br>struct ellipticCurveParameters ec163a02<br>struct ellipticCurveParameters ec239a03</p>
<p>头文件在<br>erticom\i86_n3\include\curves.h</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*=== Curves Definitions ==================</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * sect113r1 (K-163 NIST), ec163a02 (SEC2, sect163k1) , ec239a03 (sec2, sect239k1)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LM_PUBKEY_CURVE113BIT   sect113r1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LM_PUBKEY_CURVE163BIT   ec163a02</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LM_PUBKEY_CURVE239BIT   ec239a03</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXIM_OID_CHARS   31</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ellipticCurveParameters</span> &#123;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(4)</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> oid[ MAXIM_OID_CHARS + <span class="number">1</span> ];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> major[ <span class="number">1</span> ];</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> minor[ <span class="number">1</span> ];</span><br><span class="line">    &#125; version;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> checksum[ <span class="number">4</span> ];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> fieldSize[ <span class="number">2</span> ]; <span class="comment">/* bits */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> fieldSizeOctets[ <span class="number">1</span> ]; <span class="comment">/* octets */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> basisType[ <span class="number">1</span> ];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> modulus[ <span class="number">32</span> ];</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *ident1;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *ident2;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> a[ <span class="number">32</span> ];</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> b[ <span class="number">32</span> ];</span><br><span class="line">    &#125; curveParameter;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> value[ <span class="number">64</span> ];</span><br><span class="line">    &#125; generatingPoint;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> size[ <span class="number">2</span> ]; <span class="comment">/* bits */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> value[ <span class="number">32</span> ];</span><br><span class="line">    &#125; pointOrder;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> size[ <span class="number">2</span> ]; <span class="comment">/* bits */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> value[ <span class="number">32</span> ];</span><br><span class="line">    &#125; cofactor;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> size[ <span class="number">2</span> ]; <span class="comment">/* bits */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> value[ <span class="number">32</span> ];</span><br><span class="line">    &#125; curveOrder;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(2)</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> A[ <span class="number">32</span> ];</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> B[ <span class="number">32</span> ];</span><br><span class="line">    &#125; reserved;</span><br><span class="line">&#125; ;</span><br></pre></td></tr></table></figure>
<h1 id="9-flexlm-ecc-ellipticCurveParameters-结构体中-checksum的计算方法"><a href="#9-flexlm-ecc-ellipticCurveParameters-结构体中-checksum的计算方法" class="headerlink" title="9. flexlm ecc ellipticCurveParameters 结构体中 checksum的计算方法"></a><strong>9. flexlm ecc ellipticCurveParameters 结构体中 checksum的计算方法</strong></h1><p>ellipticCurveParameters 带有4字节checksum，<br>每次初始化ECC计算时，都会校验checksum。一方面为了避错， 另一方面为了反对篡改。<br>修改其中的公钥，必须重新计算checksum。</p>
<p>从libsb.lib里面分析反汇编代码， 逆向为c代码，经测试无误的代码：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">int checksum(unsigned int len, void *src , int *val)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int i<span class="comment">;</span></span><br><span class="line">  unsigned int h<span class="comment">;</span></span><br><span class="line">  unsigned int c<span class="comment">;</span></span><br><span class="line">  unsigned char *p = (unsigned char *)src<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line">  if((p == <span class="number">0</span>) <span class="title">||</span> (val == <span class="number">0</span>) <span class="title">||</span> (len == <span class="number">0</span>))</span><br><span class="line">      return <span class="number">1</span><span class="comment">;</span></span><br><span class="line"> </span><br><span class="line">  i = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">  c = *val<span class="comment">;</span></span><br><span class="line">  while(i &lt; len)</span><br><span class="line">  &#123;</span><br><span class="line">      c =  p[i] + c * <span class="number">16</span><span class="comment">;</span></span><br><span class="line">      h = c &amp; <span class="number">0xF0000000</span><span class="comment">;</span></span><br><span class="line">      if ( h != <span class="number">0</span>)</span><br><span class="line">          c ^= (h &gt;&gt; <span class="number">24</span>)<span class="comment">;</span></span><br><span class="line">      c &amp;= ~h<span class="comment">;</span></span><br><span class="line">      i++<span class="comment">;</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  *val = c<span class="comment">;</span></span><br><span class="line">  return <span class="number">0</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">unsigned int getbits(unsigned char *p, unsigned int len)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int val<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line">    val = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    while(len --) &#123;</span><br><span class="line">        val &lt;&lt;= <span class="number">8</span><span class="comment">;</span></span><br><span class="line">        val += *p++<span class="comment">;   </span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    return val <span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">unsigned int getbytes(unsigned char *p, unsigned int len)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int <span class="keyword">bits </span>= getbits(p , len)<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line">    return  ((<span class="keyword">bits </span>+ <span class="number">7</span>) &gt;&gt; <span class="number">3</span>)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">int do_ecp_checksum(struct ellipticCurveParameters *e, int *sum1, int *sum2)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int val = getbytes(e-&gt;fieldSize, <span class="number">2</span>)<span class="comment">;</span></span><br><span class="line">    unsigned int <span class="keyword">bytes </span>= val<span class="comment">;</span></span><br><span class="line">    unsigned char *p = (unsigned char *)e<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#if 1</span></span><br><span class="line">    checksum(sizeof(e-&gt;oid), &amp;e-&gt;oid,  sum2)<span class="comment">;</span></span><br><span class="line">    checksum(sizeof(e-&gt;version.major), &amp;e-&gt;version.major,  sum2)<span class="comment">;</span></span><br><span class="line">    checksum(sizeof(e-&gt;version.minor), &amp;e-&gt;version.minor,  sum2)<span class="comment">;</span></span><br><span class="line">    checksum(sizeof(e-&gt;fieldSize), &amp;e-&gt;fieldSize,  sum2)<span class="comment">;</span></span><br><span class="line">    checksum(sizeof(e-&gt;fieldSizeOctets), &amp;e-&gt;fieldSizeOctets,  sum2)<span class="comment">;</span></span><br><span class="line">    checksum(sizeof(e-&gt;<span class="keyword">basisType), </span>&amp;e-&gt;<span class="keyword">basisType, </span> sum2)<span class="comment">;</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"> </span><br><span class="line">    checksum(<span class="number">32</span>u, p, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(<span class="number">1</span>u, p + <span class="number">32</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(<span class="number">1</span>u, p + <span class="number">33</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(<span class="number">2</span>u, p + <span class="number">38</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(<span class="number">1</span>u, p + <span class="number">40</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(<span class="number">1</span>u, p + <span class="number">41</span>, sum1)<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#if 1  </span></span><br><span class="line">    checksum(<span class="keyword">bytes, </span> &amp;e-&gt;modulus,  sum2)<span class="comment">;</span></span><br><span class="line">    checksum(<span class="keyword">bytes, </span> &amp;e-&gt;curveParameter.a,  sum2)<span class="comment">;  </span></span><br><span class="line">    checksum(<span class="keyword">bytes, </span> &amp;e-&gt;curveParameter.<span class="keyword">b, </span> sum2)<span class="comment">;  </span></span><br><span class="line">    checksum(<span class="number">2</span> * <span class="keyword">bytes, </span> &amp;e-&gt;generatingPoint.value,  sum2)<span class="comment">;</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"> </span><br><span class="line">    checksum(val, p + <span class="number">42</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(val, p + <span class="number">84</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(val, p + <span class="number">116</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(<span class="number">2</span> * val, p + <span class="number">148</span>, sum1)<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#if 1</span></span><br><span class="line">    checksum(<span class="number">2</span>,  &amp;e-&gt;pointOrder.size,  sum2)<span class="comment">;   </span></span><br><span class="line">    checksum(getbytes(e-&gt;pointOrder.size, <span class="number">2</span>),  &amp;e-&gt;pointOrder.value,  sum2)<span class="comment">;</span></span><br><span class="line">     </span><br><span class="line">    checksum(<span class="number">2</span>,  &amp;e-&gt;cofactor.size,  sum2)<span class="comment">; </span></span><br><span class="line">    checksum(getbytes(e-&gt;cofactor.size, <span class="number">2</span>),  &amp;e-&gt;cofactor.value,  sum2)<span class="comment">; </span></span><br><span class="line"> </span><br><span class="line">    checksum(<span class="number">2</span>,  &amp;e-&gt;curveOrder.size,  sum2)<span class="comment">;   </span></span><br><span class="line">    checksum(getbytes(e-&gt;curveOrder.size, <span class="number">2</span>),  &amp;e-&gt;curveOrder.value,  sum2)<span class="comment">; </span></span><br><span class="line">     </span><br><span class="line">    checksum(<span class="keyword">bytes, </span> &amp;e-&gt;reserved.A,  sum2)<span class="comment">;</span></span><br><span class="line">    checksum(<span class="keyword">bytes, </span> &amp;e-&gt;reserved.<span class="keyword">B, </span> sum2)<span class="comment">;</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"> </span><br><span class="line">    checksum(<span class="number">2</span>u, p + <span class="number">212</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(getbytes(e-&gt;pointOrder.size, <span class="number">2</span>), p + <span class="number">214</span>, sum1)<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line">    checksum(<span class="number">2</span>u, p + <span class="number">246</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(getbytes(e-&gt;cofactor.size, <span class="number">2</span>), p + <span class="number">248</span>, sum1)<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line">    checksum(<span class="number">2</span>u, p + <span class="number">280</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(getbytes(e-&gt;curveOrder.size, <span class="number">2</span>), p + <span class="number">282</span>, sum1)<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line">    checksum(val, p + <span class="number">314</span>, sum1)<span class="comment">;</span></span><br><span class="line">    checksum(val, p + <span class="number">346</span>, sum1)<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line">    return val<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="10-flexlm-ecc三条椭圆曲线的参数"><a href="#10-flexlm-ecc三条椭圆曲线的参数" class="headerlink" title="10. flexlm ecc三条椭圆曲线的参数"></a><strong>10. flexlm ecc三条椭圆曲线的参数</strong></h1><p>flexlm 采用GF(2^m)椭圆曲线。这三条椭圆曲线， 在openssl也有描述的。<br>在certicom\libcrvs.lib是纯数据保存。</p>
<p>openssl描述：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">EcRecommendedParameters<span class="symbol">&lt;EC2N&gt;</span>(ASN1::sect113r1(),</span><br><span class="line"><span class="number">113</span>, <span class="number">9</span>, <span class="number">0</span>,</span><br><span class="line">A/a2 = <span class="string">"003088250CA6E7C7FE649CE85820F7"</span>,</span><br><span class="line">B/a6 = <span class="string">"00E8BEE4D3E2260744188BE0E9C723"</span>,</span><br><span class="line"><span class="string">"04009D73616F35F4AB1407D73562C10F00A52830277958EE84D1315ED31886"</span>,</span><br><span class="line"><span class="string">"0100000000000000D9CCEC8A39E56F"</span>,</span><br><span class="line"><span class="number">2</span>),</span><br><span class="line"> </span><br><span class="line">EcRecommendedParameters<span class="symbol">&lt;EC2N&gt;</span>(ASN1::sect239k1(),</span><br><span class="line"><span class="number">239</span>, <span class="number">158</span>, <span class="number">0</span>,</span><br><span class="line"><span class="string">"000000000000000000000000000000000000000000000000000000000000"</span>,</span><br><span class="line"><span class="string">"000000000000000000000000000000000000000000000000000000000001"</span>,</span><br><span class="line"><span class="comment">"04</span></span><br><span class="line"><span class="number">29</span>A0B6A887A983E9730988A68727A8B2D126C44CC2CC7B2A6555193035DC7</span><br><span class="line"><span class="number">6310804</span>F12E549BDB011C103089E73510ACB275FC312A5DC6B76553F0CA<span class="comment">",</span></span><br><span class="line"><span class="string">"2000000000000000000000000000005A79FEC67CB6E91F1C1DA800E478A5"</span>,</span><br><span class="line"><span class="number">4</span>),</span><br><span class="line"> </span><br><span class="line">EcRecommendedParameters<span class="symbol">&lt;EC2N&gt;</span>(ASN1::sect163k1(),</span><br><span class="line"><span class="number">163</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>,</span><br><span class="line"><span class="string">"000000000000000000000000000000000000000001"</span>,</span><br><span class="line"><span class="string">"000000000000000000000000000000000000000001"</span>,</span><br><span class="line"><span class="string">"0402FE13C0537BBC11ACAA07D793DE4E6D5E5C94EEE80289070FB05D38FF58321F2E800536D538CCDAA3D9"</span>,</span><br><span class="line"><span class="string">"04000000000000000000020108A2E0CC0D99F8A5EF"</span>,</span><br><span class="line"><span class="number">2</span>),</span><br></pre></td></tr></table></figure>
<p>flexlm sdk<br>\certicom\libcrvs.lib 内存dump, checksum只需要签名378 bytes的结构体。</p>
<p>为了调试和区分的方便， 在尾部增加了标志：<br>‘E’ ‘C’ ‘1’ ‘1’ ， ‘E’ ‘C’ ‘1’ ‘6’ ， ‘E’ ‘C’ ‘2 ‘3’ ， 分别表示ecc 113, 163, 239 bits。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">unsigned char ec113[<span class="number">384</span>] = &#123;</span><br><span class="line">    <span class="number">0x06</span>, <span class="number">0x05</span>, <span class="number">0x2B</span>, <span class="number">0x81</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x43</span>, <span class="number">0x8E</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x71</span>, <span class="number">0x0F</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xE0</span>, <span class="number">0xCB</span>, <span class="number">0x46</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xF0</span>, <span class="number">0xCA</span>, <span class="number">0x46</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x30</span>, <span class="number">0x88</span>, <span class="number">0x25</span>, <span class="number">0x0C</span>, <span class="number">0xA6</span>, <span class="number">0xE7</span>, <span class="number">0xC7</span>, <span class="number">0xFE</span>, <span class="number">0x64</span>, <span class="number">0x9C</span>, <span class="number">0xE8</span>,</span><br><span class="line">    <span class="number">0x58</span>, <span class="number">0x20</span>, <span class="number">0xF7</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xE8</span>, <span class="number">0xBE</span>, <span class="number">0xE4</span>, <span class="number">0xD3</span>, <span class="number">0xE2</span>, <span class="number">0x26</span>, <span class="number">0x07</span>, <span class="number">0x44</span>, <span class="number">0x18</span>, <span class="number">0x8B</span>, <span class="number">0xE0</span>,</span><br><span class="line">    <span class="number">0xE9</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x9D</span>, <span class="number">0x73</span>, <span class="number">0x61</span>, <span class="number">0x6F</span>, <span class="number">0x35</span>, <span class="number">0xF4</span>, <span class="number">0xAB</span>, <span class="number">0x14</span>, <span class="number">0x07</span>, <span class="number">0xD7</span>, <span class="number">0x35</span>,</span><br><span class="line">    <span class="number">0x62</span>, <span class="number">0xC1</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0xA5</span>, <span class="number">0x28</span>, <span class="number">0x30</span>, <span class="number">0x27</span>, <span class="number">0x79</span>, <span class="number">0x58</span>, <span class="number">0xEE</span>, <span class="number">0x84</span>, <span class="number">0xD1</span>, <span class="number">0x31</span>, <span class="number">0x5E</span>, <span class="number">0xD3</span>,</span><br><span class="line">    <span class="number">0x18</span>, <span class="number">0x86</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x71</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xD9</span>, <span class="number">0xCC</span>,</span><br><span class="line">    <span class="number">0xEC</span>, <span class="number">0x8A</span>, <span class="number">0x39</span>, <span class="number">0xE5</span>, <span class="number">0x6F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x72</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xB3</span>, <span class="number">0x99</span>, <span class="number">0xD9</span>, <span class="number">0x14</span>, <span class="number">0x73</span>, <span class="number">0xCA</span>, <span class="number">0xDE</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, 'E', 'C',  '<span class="number">1</span>',  '<span class="number">1</span>'</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">unsigned char ec163[<span class="number">384</span>] = &#123;</span><br><span class="line">    <span class="number">0x06</span>, <span class="number">0x05</span>, <span class="number">0x2B</span>, <span class="number">0x81</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x48</span>, <span class="number">0x77</span>, <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0xA3</span>, <span class="number">0x15</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xC9</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xB0</span>, <span class="number">0xD4</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xD3</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0xFE</span>, <span class="number">0x13</span>, <span class="number">0xC0</span>, <span class="number">0x53</span>, <span class="number">0x7B</span>, <span class="number">0xBC</span>, <span class="number">0x11</span>, <span class="number">0xAC</span>, <span class="number">0xAA</span>, <span class="number">0x07</span>, <span class="number">0xD7</span>,</span><br><span class="line">    <span class="number">0x93</span>, <span class="number">0xDE</span>, <span class="number">0x4E</span>, <span class="number">0x6D</span>, <span class="number">0x5E</span>, <span class="number">0x5C</span>, <span class="number">0x94</span>, <span class="number">0xEE</span>, <span class="number">0xE8</span>, <span class="number">0x02</span>, <span class="number">0x89</span>, <span class="number">0x07</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x5D</span>, <span class="number">0x38</span>,</span><br><span class="line">    <span class="number">0xFF</span>, <span class="number">0x58</span>, <span class="number">0x32</span>, <span class="number">0x1F</span>, <span class="number">0x2E</span>, <span class="number">0x80</span>, <span class="number">0x05</span>, <span class="number">0x36</span>, <span class="number">0xD5</span>, <span class="number">0x38</span>, <span class="number">0xCC</span>, <span class="number">0xDA</span>, <span class="number">0xA3</span>, <span class="number">0xD9</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xA3</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0xA2</span>, <span class="number">0xE0</span>, <span class="number">0xCC</span>, <span class="number">0x0D</span>, <span class="number">0x99</span>, <span class="number">0xF8</span>, <span class="number">0xA5</span>, <span class="number">0xEF</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xA4</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x02</span>, <span class="number">0x11</span>, <span class="number">0x45</span>, <span class="number">0xC1</span>, <span class="number">0x98</span>, <span class="number">0x1B</span>, <span class="number">0x33</span>, <span class="number">0xF1</span>, <span class="number">0x4B</span>, <span class="number">0xDE</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,'E', 'C',  '<span class="number">1</span>',  '<span class="number">6</span>'</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">unsigned char ec239[<span class="number">384</span>] = &#123;</span><br><span class="line">    <span class="number">0x06</span>, <span class="number">0x05</span>, <span class="number">0x2B</span>, <span class="number">0x81</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x0A</span>, <span class="number">0xD7</span>, <span class="number">0xBD</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xEF</span>, <span class="number">0x1E</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xE0</span>, <span class="number">0xCA</span>, <span class="number">0x46</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0xC9</span>, <span class="number">0x46</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0xA0</span>, <span class="number">0xB6</span>, <span class="number">0xA8</span>, <span class="number">0x87</span>, <span class="number">0xA9</span>, <span class="number">0x83</span>, <span class="number">0xE9</span>, <span class="number">0x73</span>, <span class="number">0x09</span>, <span class="number">0x88</span>, <span class="number">0xA6</span>,</span><br><span class="line">    <span class="number">0x87</span>, <span class="number">0x27</span>, <span class="number">0xA8</span>, <span class="number">0xB2</span>, <span class="number">0xD1</span>, <span class="number">0x26</span>, <span class="number">0xC4</span>, <span class="number">0x4C</span>, <span class="number">0xC2</span>, <span class="number">0xCC</span>, <span class="number">0x7B</span>, <span class="number">0x2A</span>, <span class="number">0x65</span>, <span class="number">0x55</span>, <span class="number">0x19</span>, <span class="number">0x30</span>,</span><br><span class="line">    <span class="number">0x35</span>, <span class="number">0xDC</span>, <span class="number">0x76</span>, <span class="number">0x31</span>, <span class="number">0x08</span>, <span class="number">0x04</span>, <span class="number">0xF1</span>, <span class="number">0x2E</span>, <span class="number">0x54</span>, <span class="number">0x9B</span>, <span class="number">0xDB</span>, <span class="number">0x01</span>, <span class="number">0x1C</span>, <span class="number">0x10</span>, <span class="number">0x30</span>, <span class="number">0x89</span>,</span><br><span class="line">    <span class="number">0xE7</span>, <span class="number">0x35</span>, <span class="number">0x10</span>, <span class="number">0xAC</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>, <span class="number">0xFC</span>, <span class="number">0x31</span>, <span class="number">0x2A</span>, <span class="number">0x5D</span>, <span class="number">0xC6</span>, <span class="number">0xB7</span>, <span class="number">0x65</span>, <span class="number">0x53</span>, <span class="number">0xF0</span>, <span class="number">0xCA</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xEE</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x5A</span>, <span class="number">0x79</span>, <span class="number">0xFE</span>, <span class="number">0xC6</span>, <span class="number">0x7C</span>, <span class="number">0xB6</span>, <span class="number">0xE9</span>, <span class="number">0x1F</span>, <span class="number">0x1C</span>, <span class="number">0x1D</span>, <span class="number">0xA8</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xE4</span>, <span class="number">0x78</span>, <span class="number">0xA5</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF0</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x69</span>, <span class="number">0xE7</span>, <span class="number">0xFB</span>, <span class="number">0x19</span>, <span class="number">0xF2</span>, <span class="number">0xDB</span>, <span class="number">0xA4</span>,</span><br><span class="line">    <span class="number">0x7C</span>, <span class="number">0x70</span>, <span class="number">0x76</span>, <span class="number">0xA0</span>, <span class="number">0x03</span>, <span class="number">0x91</span>, <span class="number">0xE2</span>, <span class="number">0x94</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, 'E', 'C',  '<span class="number">2</span>',  '<span class="number">3</span>'</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="11-ECDSA的一些参考读物"><a href="#11-ECDSA的一些参考读物" class="headerlink" title="11. ECDSA的一些参考读物"></a><strong>11. ECDSA的一些参考读物</strong></h1><p>讲述ECDSA的一般原理， 与flexlm没有任何关系。但是flexlm ecc算法上属于ECDSA。理解了ECDSA就理解了flexlm ecc的基本原理。</p>
<p>前面说到，flexlm ecc的签名算法是ECDSA(The Elliptic Curve Digital Signature Algorithm). ECDSA 已经成为世界标准。ECDSA was accepted in 1999 as an ANSI standard, and was accepted in 2000 as IEEE and NIST standards. It was also accepted in 1998 as an ISO standard.</p>
<p>ECDSA是一个比较复杂的数字签名算法。其详细内容不是三言两语能说完的。</p>
<p>详细内容可以参考：<br>《SEC 1: Elliptic Curve Cryptography》，Certicom Corp.，2000<br>《IEEE P1363a 》，2001</p>
<p>ECDSA并不是一个从无到有的构思。它的思想来自于DSA（Digital Signature Algorithm），是把DSA推广到椭圆曲线上。<br>从这个角度讲，叫它DSAEC(Digital Signature Algorithm over Elliptic Curve )未尝不可。</p>
<p>DSA的主要思想来自于离散对数问题（DLP， Discrete Logarithm Problem）。 把DLP推广到椭圆曲线上，就成为ECDLP。<br>离散对数问题与因子分解（Integer Factorization Problem）问题是公钥密码学中两个典型的难题。</p>
<p>因子分解问题产出了RSA，Rabin等公钥加密、签名算法；离散对数问题产生了DSS/DSA，ElGamal等公钥加密、签名算法。</p>
<p>在椭圆曲线上，离散对数模型大放光彩，产生了ECDSA，ECNR，ECElGamal等一大批算法。</p>
<p>椭圆曲线比常见的数学问题要复杂，因为它需要一些初等数论的知识作为铺垫。大学低年级的普通数学基础是必须的。如果忘光了，还得重新翻翻教材。有些人可能学习几个月就能够理解椭圆曲线，那已经是相当不错的了。</p>
<p>在理解ECDSA之前，需要理解离散对数和椭圆曲线这两个东西。这里面内容太多了，有许多未知的东西。</p>
<p>11.1<br>离散对数本身的内容很多，常见的密码学教材中都有介绍。</p>
<p>11.2<br>椭圆曲线也是一个复杂的数学对象。它不是椭圆，它是由Weierstrass方程来描述的一类曲线，<br>具体是否牵涉到椭圆周长积分，椭圆周长积分不是初等函数，是无穷级数。</p>
<p>密码学里的椭圆曲线，跟几何上的椭圆和曲线完全不相同。<br>这里的椭圆曲线更特殊一些，它是一个有限域，每一个点 G（x，y）都是一个整数点。<br>一条椭圆曲线上的点数是确定的。</p>
<h1 id="12-一条椭圆曲线上做ECDSA的例子"><a href="#12-一条椭圆曲线上做ECDSA的例子" class="headerlink" title="12. 一条椭圆曲线上做ECDSA的例子"></a><strong>12. 一条椭圆曲线上做ECDSA的例子</strong></h1><p>12.1 描述一条Fp上的椭圆曲线的六个参量</p>
<p>密码学中，描述一条Fp上的椭圆曲线，常用到六个参量：<br>(p,a,b,G,n,h)。</p>
<p>p， a，b 用来确定一条椭圆曲线的方程，<br>G为基点，口头上也叫G点，或者 (Base point)，<br>n为点G的阶(Order)，也可以叫模或者周期，<br>h = E/n, 叫co-factor。 其中E是椭圆曲线上所有点的个数.</p>
<p>我们用乘法来表示椭圆曲线上点的倍加，那么，能找到一个n，<br>对于任何一个点G(x,y), n * G = 0 因此， 它具有循环的性质。<br>这个循环周期就是n。</p>
<p>对于密码学的应用上，为了抵御Pohlig-Hellman攻击（利用中国剩余定理），<br>采用的椭圆曲线有严格的限制。它要求E具有一个大素数因子，或者E本身就是素数。</p>
<p>有一个算法Schoof-Elkies-Atkin 用来计算椭圆曲线的点数E(Fp)。<br>需要用到中国剩余定理，具体的算法比较复杂。</p>
<p>n = E/h , h称之为co-factor.<br>常见的h=1 或者h=2.</p>
<p>E为什么不是一个参量？ 因为E可以由P,A,B计算出来的。计算完毕以后，E就没用了。<br>有用的是n， 而且E=h*n是一目了然的事。</p>
<p>附：一段题外话，关于中国剩余定理</p>
<p>Pohlig-Hellman算法和Schoof-Elkies-Atkin算法都要用到初等到数论里一个重要的定理，<br>也就是一次同余方程组的解法定理。称为中国剩余定理(CRT， Chinese Remainder Thereom)。<br>或称孙子定理，在数学史上，这个发现归根于中国古代的数学家们。</p>
<p>在这个帝国，两千年来文科生治国，数学毫无地位，剩余定理的发现很了不起。<br>类似于勾股定理一样，中国古代数学家发现此定理，但并没有严格的证明剩余定理。</p>
<p>剩余定理最早见于《孙子算经》，成书于约公元300年-400年，作者生平都无法考证了。<br>南宋数学家秦九韶编写《算术九章》，总结出“大衍求一术”。<br>和秦九韶同时代的意大利数学家裴波那契（1170—1250），他在《算法之书》中给出了<br>两个一次同余问题，但是没有一般的算法。相当于《孙子算经》的水准。</p>
<p>德国大数学家高斯（1777—1855）于公元1801年给出了剩余定理的严格证明。</p>
<p>中国古代的数学书里，剩余定理只有最简单的应用，相当于小学数学奥赛里面的模同余问题。</p>
<p>剩余定理在数论里用的比较多，初等数论教科书基本上都会提到她。<br>很多密码学库都有一个单独的crt.cpp,crt.c。</p>
<p>12.2 以NIST-P192为例， 讲述ECDSA</p>
<p>我们以NIST-P192 , GF (p-192)这条椭圆曲线来说，这是NIST推荐的一条曲线。</p>
<p>这是最简单的一类椭圆曲线。称之为GF(p)，P是一个素数。<br>GF(2^m)曲线更复杂，不再举例。</p>
<p>曲线方程：y^2 = x^3 + A*x + B (mod P)</p>
<p>这里：<br>A = -3<br>B = 64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1<br>P = ( 2^192 - 2^64 - 1 )<br>= FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF<br>P是一个素数。</p>
<p>对于NIST-P192，<br>E = FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831<br>h = 1<br>n = FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831<br>n是一个素数。</p>
<p>下面用公式简单描述一下ECDSA签名和验证的步骤：<br>大写字母代表椭圆曲线上的点 Point(x,y)， 小写字母代表一个数。</p>
<p>注意：这里的乘法是椭圆曲线上点的倍加；除法是整数的模逆运算，可用欧几里得算法。<br>mod是整数求余。</p>
<p>(1) 签名, Sign：<br>G为基点。h为要签名的hash。私钥为d。 公钥R = d*G（签名时只用到私钥）。<br>取随机数k , k是一个密码学意义上的随机数，范围在(1, n)。</p>
<p>r = k * G mod n … (1)<br>s = (h + rd)/k mod n … (2)</p>
<p>(2) 验证, Verify:<br>G为基点， r, s为签名， h为要验证的hash。 公钥为R。（验证时只用到公钥）<br>u = h/s<br>w = r/s<br>v = u <em> G + w </em> R mod n<br>验证(v == r)。</p>
<p>证明，为什么签名可以被验证？ 我们参照DSA的证明。可得:<br>v = u <em>G + w </em>R = (h/s) <em>G + (r/s) </em> ( d <em>G)<br>= (h/s + rd/s) </em>G<br>= ((h + rd)/s) *G</p>
<p>从（2） 得出， k<em>s = (h + rd) mod n =&gt; k = (h + rd)/s<br>从而 v = k </em>G， 所以签名和验证能一一对应上。</p>
<p>为什么说它安全：<br>由于 R = d<em>G是一个椭圆曲线离散对数问题，无法直接求的私钥x；<br>由于 r = k</em>G也是一个椭圆曲线离散对数问题，所以随机数k是也没有办法恢复的。<br>也就是说，在未知x或者k， 无法给出以下方程的一个解(r, s)：<br>h/s <em>G + r/s </em>R = r mod n<br>如果给出一个解，则表示， sign (r,s)可以被伪造。</p>
<p>这里面，对hash的强度也是有要求的。最基本的要求是sha 160 bit的hash。</p>
<p>严谨的证明， 见《IEEE P1363a 》等文档。</p>
<p>例子, NIST-P192 签名。<br>y^2 = x^3 - 3x + 64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1 mod FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF<br>n=FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831<br>G(x,y):<br>Gx=188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012<br>Gy=07192B95FFC8DA78631011ED6B24CDD573F977A11E794811</p>
<p>取<br>d=16fdbb3f3e4d7d253c421ae5a09f1ce500d973c04ae91564<br>那么公钥<br>R(x,y) = d * G(x,y)<br>Rx=2B443533CFBECB00ABE1F9D0F3A8FFD871EFDDAB4FF93B0C<br>Ry=6EFF3D69042B58F7C726BDB6B495AE75BD09D762259013DB</p>
<p>签名 “123”.<br>h = hash(sha-160)=40bd001563085fc35165329ea1ff5c5ecbdbbeef<br>取<br>k=CADDC27FEFC3040C1CCA194542218E002F58D504A639B668<br>得</p>
<p>Sign(用ECCTool计算):<br>sig.r=5C09A23549325C866F0C1D8D6AB81255977C90A9FD6D66C4<br>sig.s=C0DFFC8E4BA4A91EBFFBCE7FE07E202AAF567DC10D69D5E8</p>
<p>Verify (用ECCTool 和 BigIntCal计算):<br>u = h/s mod n = BBBBED787373E2407BA720D7851CE0895222B5B5DF81BECB<br>w = r/s mod n = 2BBC84EA2E318FC5666B50CEE41845F3EB1DF40C838FA86C<br>V(x,y) = u <em>G + w </em>R mod n =<br>V.x = 5C09A23549325C866F0C1D8D6AB81255977C90A9FD6D66C4<br>V.y = 70360EEEC1C42D5AC10226B8BE0EA507E3FF54290737B02C<br>So,<br>v = V mod n = 5C09A23549325C866F0C1D8D6AB81255977C90A9FD6D66C4</p>
<p>v==r 验证完毕。</p>
<p>打个最简单的比方，如果有一个软件，采用NIST-P192 ECDSA验证，其算法逻辑为：<br>sign = ecdsa(sha-160（name)）， 并且它的公钥，私钥如上所描述：<br>那么：<br>name:<br>123<br>sn:<br>5C09A23549325C866F0C1D8D6AB81255977C90A9FD6D66C4<br>C0DFFC8E4BA4A91EBFFBCE7FE07E202AAF567DC10D69D5E8</p>
<p>就是一对可用的注册码。</p>
<p>mybase的算法是标准ECDSA( GF (2^233)，跟这个很相似。只是曲线不同，私钥不同。<br>如果你理解了ECDSA，那么，写mybase的kg是很容易的事情了。</p>
<p>当然，它的私钥不是那么好计算的。 你可能需要几年的功底。</p>
<h1 id="13-FlexLM-ECDSA的公私钥对生成方法"><a href="#13-FlexLM-ECDSA的公私钥对生成方法" class="headerlink" title="13. FlexLM ECDSA的公私钥对生成方法"></a><strong>13. FlexLM ECDSA的公私钥对生成方法</strong></h1><p>FlexLM 生成公私钥对的方法是有固定标准的，它是一种IEEE-1363的弱化方法。<br>seed只有96 bits（3个32bit的digit）。<br>尽管如此，穷举96 bit在实际操作上不可行的，v9 - v11的版本是足够安全的。</p>
<p>下面对flexlm ECDSA密钥生成的分析，主要基于v9.x - v11.x 的SDK。核心代码在l_prikey.c。</p>
<p>(1) gen seed<br>(2) gen keys</p>
<p>(1)首先分析genseed：</p>
<p>lmrand1调用l_genseed产生三个强随机数，然后由它初始化rng，产生私钥。</p>
<p>对于Flexlm ECC来说，113, 163, 239只是椭圆曲线类型不一样，其他的算法完全一样。没有区别。</p>
<p>LM_SEED1,LM_SEED2,LM_SEED3除了出现在license gen中，不出现在任何地方。<br>从程序中无法恢复出LM_SEED1,LM_SEED2,LM_SEED3。</p>
<p>flexlm v8.0的版本，l_genseed()的随机性不够好，有bug，能够被恢复seed。<br>flexlm v9的版本已经修复。</p>
<p>它添加了一段hardware dependent的代码，给rng初始化的sha buffer添了大量数据。<br>意味着在不同的机器上，lmrand1产生的结果是不同的。</p>
<p>l_genseed() 函数增加了补丁， 代码如下。</p>
<p>找了一些资料，对比了v8.0c, v8.3b和v9.2的版本。<br>在 v8.0c时有此bug。 v8.3b时补丁已经打上了。查了histroy，是v8.1 (2002年)打的补丁。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">char</span> cmd[<span class="number">200</span>];</span><br><span class="line">      <span class="keyword">char</span> letter[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line">        <span class="built_in">memset</span>(letter, <span class="number">0</span>, <span class="keyword">sizeof</span>(letter));</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">"."</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        <span class="built_in">memset</span>(additional_seed, <span class="number">0</span>, <span class="keyword">sizeof</span>(additional_seed));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> PC</span></span><br><span class="line">        letter[<span class="number">0</span>] = (randcnt % <span class="number">25</span>) + <span class="string">'A'</span>;</span><br><span class="line">        <span class="keyword">if</span> (randcnt % <span class="number">2</span>)</span><br><span class="line">            <span class="built_in">sprintf</span>(cmd, <span class="string">"dir \"c:\\documents and settings\\%s*.*\" /s"</span>, randcnt &gt; <span class="number">2</span> ? letter : <span class="string">""</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">sprintf</span>(cmd, <span class="string">"dir %%SYSTEMROOT%%\\%s*.* /s /ta /od"</span>, randcnt &gt; <span class="number">2</span> ? letter : <span class="string">""</span>);</span><br><span class="line">        <span class="keyword">if</span> (!(fp = _popen(cmd, <span class="string">"r"</span>)))</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">        <span class="built_in">strcpy</span>(cmd, <span class="string">"sh -c \"ps auxww 2&gt;/dev/null\""</span>);</span><br><span class="line">        <span class="keyword">if</span> (!(fp = popen(cmd, <span class="string">"r"</span>)))</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Can't open c:\\documents and settings, exiting\n"</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (((c = fgetc(fp)) != EOF) &amp;&amp; (i &lt; MAX_SEED_LEN))</span><br><span class="line">            additional_seed[i++] = c;</span><br><span class="line">        fclose(fp);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> PC</span></span><br><span class="line">        <span class="keyword">if</span> (!(fp = _popen(<span class="string">"dir \\"</span>, <span class="string">"r"</span>)))</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">        <span class="keyword">if</span> (!(fp = popen(<span class="string">"sh -c \"ps -ef 2&gt;/dev/null\""</span>, <span class="string">"r"</span>)))</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Can't open \\, exiting\n"</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (((c = fgetc(fp)) != EOF) &amp;&amp; (i &lt; MAX_SEED_LEN))</span><br><span class="line">            additional_seed[i++] = c;</span><br><span class="line"> </span><br><span class="line">        fclose(fp);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (ret = sb_sha1Begin(global_data, &amp;hc))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Error 4: "</span>);</span><br><span class="line">            <span class="keyword">goto</span> exit_seed;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        lenbuf = i;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"len = %d\n"</span>, lenbuf);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (ret = sb_sha1Hash(global_data, i, additional_seed, &amp;hc))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Error 5: "</span>);</span><br><span class="line">            <span class="keyword">goto</span> exit_seed;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ret = sb_sha1End(global_data, &amp;hc, &amp;md))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Error 6: "</span>);</span><br><span class="line">            <span class="keyword">goto</span> exit_seed;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (ret = sb_fipsRngOptionalInput(global_data, md.size, md.digest))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Error 7: "</span>);</span><br><span class="line">            <span class="keyword">goto</span> exit_seed;</span><br><span class="line">        &#125;</span><br><span class="line">moreseeds:</span><br><span class="line">        ret = sb_rngFIPS186Session(</span><br><span class="line">            global_data,</span><br><span class="line">            <span class="number">3</span>*<span class="number">4</span>,</span><br><span class="line">            returned);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (ret != SB_SUCCESS)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Error 8: "</span>);</span><br><span class="line">            <span class="keyword">goto</span> exit_seed;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *      Convert to ints and test for reasonableness</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">        seed1 = seed2 = seed3 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>, i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">            seed1 |= returned[j++] &lt;&lt; (i * <span class="number">8</span>);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">            seed2 |= returned[j++] &lt;&lt; (i * <span class="number">8</span>);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">            seed3 |= returned[j++] &lt;&lt; (i * <span class="number">8</span>);</span><br><span class="line"> </span><br><span class="line">        randcnt++;</span><br><span class="line">         </span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">"%d\n"</span>,randcnt );</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line"> </span><br><span class="line">    &#125; <span class="keyword">while</span> ((randcnt &lt; <span class="number">5</span>) ||</span><br><span class="line">        (returned[<span class="number">0</span>] % <span class="number">40</span> )</span><br><span class="line">        || (!l_reasonable_seed(seed1) || !l_reasonable_seed(seed2) ||</span><br><span class="line">                        !l_reasonable_seed(seed3)));</span><br></pre></td></tr></table></figure>
<p>​    </p>
<p>(2) 接着分析gen keys</p>
<p>函数原型：<br>int l_genkeys( unsigned int lmseed1,<br>unsigned int lmseed2,<br>unsigned int lmseed3,<br>int pubkey_strength,<br>int <em>prikey_size,<br>char </em>prikey,<br>int <em>pubkey_size,<br>char </em>pubkey)</p>
<p>它调用另一函数实现，这里面的核心如下代码. rng是基于IEEE 1363， sha-160实现的。<br>FIPS_RNG没有分析价值。<br>到了sb_genKeyPair()以内，里面全部是certicom的算法库libsb.lib， 没有源代码。<br>sb_genKeyPair()完整的跟踪可以用上几个小时。 但是不会有什么惊喜的结论。</p>
<p>这意味着即使从私钥中，也无法恢复种子LM_SEED1,LM_SEED2,LM_SEED3.<br>实际上， 私钥产生以后， LM_SEED1,LM_SEED2,LM_SEED3.<br>对于开发商来说，只有存档的价值，不再有使用的价值。</p>
<p>有的开发商从v8等老版本升级而来，没有改变私钥，存在安全隐患。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">int genkeys(unsigned int *seed,</span><br><span class="line">    int pubkey_strength,</span><br><span class="line">    <span class="keyword">sb_PrivateKey </span>*privateKey,</span><br><span class="line">    <span class="keyword">sb_PublicKey </span>*publicKey)</span><br><span class="line">&#123;</span><br><span class="line">......</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  Set the initialization options.</span></span><br><span class="line"><span class="comment"> *  The selected options are:</span></span><br><span class="line"><span class="comment"> *  1) point compression is on.</span></span><br><span class="line"><span class="comment"> *  2) use new point compression.</span></span><br><span class="line"><span class="comment"> *  3) maximum length of the random number generator seed is</span></span><br><span class="line"><span class="comment"> *          SB_MAX_SEED_LEN.</span></span><br><span class="line"><span class="comment"> *  4) random number generator used is FIPS186.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="keyword">sb_Options.pointCompressionFlag </span>= <span class="keyword">SB_ON;</span></span><br><span class="line"><span class="keyword"> </span>   <span class="keyword">sb_Options.ecesCompressionFlag </span>= <span class="keyword">SB_P1363_13FEB1998;</span></span><br><span class="line"><span class="keyword"> </span>   <span class="keyword">sb_Options.rngInfo.seed.size </span>= <span class="keyword">SB_MAX_SEED_LEN;</span></span><br><span class="line"><span class="keyword"> </span>   <span class="keyword">sb_Options.rngInfo.type </span>= <span class="keyword">SB_FIPS_RNG;</span></span><br><span class="line"><span class="keyword"> </span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  Set seed to sb_Options using the value contained in seedValue.</span></span><br><span class="line"><span class="comment"> *  Note that it is assumed that the value in seedValue is obtained</span></span><br><span class="line"><span class="comment"> *  from a random source.  In practice, a real random value from</span></span><br><span class="line"><span class="comment"> *  a secure random source must be set here.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    memset(seedValue, <span class="number">0</span>, sizeof(seedValue))<span class="comment">;</span></span><br><span class="line"><span class="comment">#if 0 /* P5308 */</span></span><br><span class="line">    for (i = <span class="number">0</span><span class="comment">;i &lt; 4; i++)</span></span><br><span class="line">        seedValue[i] = (seed3 &gt;&gt; (<span class="number">1</span> &lt;&lt; (i * <span class="number">8</span>)) &amp; <span class="number">0xff</span>)<span class="comment">;</span></span><br><span class="line">    for (i = <span class="number">0</span><span class="comment">;i &lt; 4; i++)</span></span><br><span class="line">        seedValue[i + <span class="number">4</span>] = (seed4 &gt;&gt; (<span class="number">1</span> &lt;&lt; (i * <span class="number">8</span>)) &amp; <span class="number">0xff</span>)<span class="comment">;</span></span><br><span class="line"><span class="comment">#endif /* P5308 */</span></span><br><span class="line">    for (i = <span class="number">0</span><span class="comment">;i &lt; 4; i++)</span></span><br><span class="line">        seedValue[i] = ((seed[<span class="number">0</span>] &gt;&gt; (i * <span class="number">8</span>)) &amp; <span class="number">0xff</span>)<span class="comment">;</span></span><br><span class="line">    for (i = <span class="number">0</span><span class="comment">;i &lt; 4; i++)</span></span><br><span class="line">        seedValue[i + <span class="number">4</span>] = ((seed[<span class="number">1</span>] &gt;&gt; (i * <span class="number">8</span>)) &amp; <span class="number">0xff</span>)<span class="comment">;</span></span><br><span class="line">    if (seed[<span class="number">2</span>]) <span class="comment">/* added 3rd int in v8.1 */</span></span><br><span class="line">    &#123;</span><br><span class="line">        for (i = <span class="number">0</span><span class="comment">;i &lt; 4; i++)</span></span><br><span class="line">            seedValue[i + <span class="number">8</span>] = ((seed[<span class="number">2</span>] &gt;&gt; (i * <span class="number">8</span>)) &amp; <span class="number">0xff</span>)<span class="comment">;</span></span><br><span class="line">        <span class="comment">/* And added strength into seed */</span></span><br><span class="line">        for (i = <span class="number">0</span><span class="comment">;i &lt; sizeof(pubkey_strength); i++)</span></span><br><span class="line">            seedValue[i + <span class="number">12</span>] = ((pubkey_strength &gt;&gt; (i * <span class="number">8</span>)) &amp; <span class="number">0xff</span>)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    memcpy( <span class="keyword">sb_Options.rngInfo.seed.value, </span>seedValue, <span class="keyword">SB_MAX_SEED_LEN);</span></span><br><span class="line"><span class="keyword"> </span></span><br><span class="line">    ret = <span class="keyword">sb_initialize(</span></span><br><span class="line"><span class="keyword"> </span>       ellipticCurve,</span><br><span class="line">        &amp;<span class="keyword">sb_Options,</span></span><br><span class="line"><span class="keyword"> </span>       dataSize,</span><br><span class="line">        heapSize,</span><br><span class="line">        global_data,</span><br><span class="line">        heap_space</span><br><span class="line">    )<span class="comment">;</span></span><br><span class="line">    if (ret != <span class="keyword">SB_SUCCESS)</span></span><br><span class="line"><span class="keyword"> </span>   &#123;</span><br><span class="line">        <span class="keyword">displayErrorMsg(ret);</span></span><br><span class="line"><span class="keyword"> </span>       exit(<span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 2. Generate ECC key pairs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    ret = <span class="keyword">sb_genKeyPair(</span></span><br><span class="line"><span class="keyword"> </span>       global_data,</span><br><span class="line">        privateKey,</span><br><span class="line">        publicKey</span><br><span class="line">    )<span class="comment">;</span></span><br><span class="line">    if (ret != <span class="keyword">SB_SUCCESS)</span></span><br><span class="line"><span class="keyword"> </span>   &#123;</span><br><span class="line">        <span class="keyword">displayErrorMsg(ret);</span></span><br><span class="line"><span class="keyword"> </span>       exit(<span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * End Security Builder</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    ret = <span class="keyword">sb_end(global_data);</span></span><br><span class="line"><span class="keyword"> </span>   if (ret != <span class="keyword">SB_SUCCESS)</span></span><br><span class="line"><span class="keyword"> </span>   &#123;</span><br><span class="line">        <span class="keyword">displayErrorMsg(ret);</span></span><br><span class="line"><span class="keyword"> </span>       exit(<span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Free the memory space</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    free(heap_space)<span class="comment">;</span></span><br><span class="line">    free(global_data)<span class="comment">;</span></span><br><span class="line">    return <span class="number">0</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="14-FlexLM-ECDSA签名过程的漏洞"><a href="#14-FlexLM-ECDSA签名过程的漏洞" class="headerlink" title="14. FlexLM ECDSA签名过程的漏洞"></a><strong>14. FlexLM ECDSA签名过程的漏洞</strong></h1><p>IEEE-163对ECDSA的签名过程是有严格规定的。FlexLM的做法和它不一致。它的确减弱了签名的安全性，但是漏洞目前并不能被利用。</p>
<p>首先，给出一个线性rng下ECDSA不安全的示范。</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>) </span><br><span class="line"><span class="symbol">r1</span> = <span class="symbol">k1</span> * G</span><br><span class="line"><span class="symbol">s1</span> = (<span class="symbol">h1</span> + d*<span class="symbol">r1</span>)/<span class="symbol">k1</span> <span class="built_in">mod</span> <span class="built_in">n</span></span><br><span class="line"> </span><br><span class="line">(<span class="number">2</span>)</span><br><span class="line"><span class="symbol">r2</span> = <span class="symbol">k2</span> * G</span><br><span class="line"><span class="symbol">s2</span> = (<span class="symbol">h2</span> + d*<span class="symbol">r2</span>)/<span class="symbol">k2</span> <span class="built_in">mod</span> <span class="built_in">n</span></span><br><span class="line"> </span><br><span class="line">可以得到：</span><br><span class="line">(<span class="number">3</span>)</span><br><span class="line">(<span class="symbol">h1</span> + d*<span class="symbol">r1</span>) / <span class="symbol">s1</span> - (<span class="symbol">h2</span> + d*<span class="symbol">r2</span>) / <span class="symbol">s2</span> = <span class="symbol">k1</span> - <span class="symbol">k2</span>  <span class="built_in">mod</span> <span class="built_in">n</span></span><br><span class="line"> </span><br><span class="line">=&gt;</span><br><span class="line">d *(<span class="symbol">r1</span>/<span class="symbol">s1</span> - <span class="symbol">r2</span>/<span class="symbol">s2</span>) + (<span class="symbol">h1</span>/<span class="symbol">s1</span> - <span class="symbol">h2</span>/<span class="symbol">s2</span>) = C(k)   <span class="built_in">mod</span> <span class="built_in">n</span></span><br><span class="line"> </span><br><span class="line">注意到，这是一个线性方程：</span><br><span class="line">d * A + B = C(k)  <span class="built_in">mod</span> <span class="built_in">n</span></span><br></pre></td></tr></table></figure>
<p>可见，如果rng是h的线性函数，只要有两对sign， 并能获取k1与k2的差值，<br>并不需要知道k1，k2本身的值。就能解一个线性方程得出d来。<br>d = (C - B ) / A mod n<br>这里的除法是模逆运算， n是一个素数，它是有解且唯一的。</p>
<p>(1) 一个典型是，rng没有初始化或者初始化为一个常量；那么 k为常量。 差值C=0。</p>
<p>(2) 另一个典型是，某些不安全的rng，在seed session 时采用了系统时间。<br>prng=f( f1(Privkey), f2(Message), f3(Tickcount) ), 在Windows下， GetTickCount得到的是一个毫秒数。如果连续两次签名在1毫秒内完成， 那么它们的sign是同一个k生成的。从而差值C = 0。</p>
<p>因此，连续两次签名时需要检测， 它们的前半部分sign.r必须不同。以抵御攻击。</p>
<p>这里有一个案例， CloneCD v4，曾经采用ECNR-241签名（与ECDSA有所不同）。<br>被人做出keygen，原理和(3)一样。</p>
<p>FlexLM签名过程的rng分析</p>
<p>FlexLM rng有线性部分，也有非线性部分。它的Signing有如下特点：<br>参考l_prikey.c。<br>a) Seed with Private key, hash of message<br>b) Signature will be guaranteed repeatable given the same FEATURE data.<br>c) Requires a different certicom “context” for each signature.</p>
<p>这里面的b)是很诡异的做法，它充分暴露了FlexLM的k不是纯随机，而是与私钥和hash有关的伪随机。<br>但是这里要注意，它里面的确有大数相加的部分，但是那是一种保证bits的方法。</p>
<p>它的rng，并不是线性相加两个大数那么简单，而是拿它们Private key和hash去填充rng的buffer。</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">k = f1(<span class="name">privkey</span>) + f2(<span class="name">privkey</span>, msghash, curve)</span><br><span class="line"> </span><br><span class="line">C(<span class="name">k</span>) = f2(<span class="name">privkey</span>, msghash1, curve)  - f2(<span class="name">privkey</span>, msghash2, curve)</span><br></pre></td></tr></table></figure>
<p>的确，对于同一个priveky来说，在任何一次签名，rng在f2时初始状态是固定的。<br>但是，f2并不是一个线性函数，它被非线性的sha hash给冲掉了。<br>C(k)是与privkey有关的非线性量。</p>
<p>在分析了：<br>(1)多个不同privkey对同一条msg签名<br>(2) 同一个privkey对多条msg签名<br>都没有找到可供利用的线性差值。 不再有冗余信息可以得出签名的k。</p>
<p>所以，前面说的线性攻击方法对FlexLM ECDSA无效。<br><strong><br>那么，是否还有其它的攻击方法，恢复出k的信息，从而计算出privkey？<br>目前看来，没有直接的答案。
</strong></p>
<p>FlexLM的ECDSA的签名过程，b)点是一个非常不必要的做法。<br>为什么他们要做这么一个怪胎呢？显然不是为了制造一个漏洞假象。它只是保证签名的唯一性而已。</p>
<p>p.s. 关于RLM的题外话</p>
<p>这里要说到RLM (Reprise License Manager):<br>Flexlm原班开发人马，2006年从Macrovision跑路后，另起灶头，产品叫RLM。<br><a href="http://www.reprisesoftware.com/index.php" target="_blank" rel="noopener">http://www.reprisesoftware.com/index.php</a></p>
<p>它用的DSA-512签名。基于离散对数。 里面在签名的时候， 会把k加上若干个Q，填充到161 bit (or 163 bit ? 具体数值忘了 )。</p>
<p>这也是一个怪胎。因为 k + nQ mod Q 仍然是k。 开发者的意思是，在k上加上n倍模长，掩盖掉<br>k本身的bits信息，防止利用计时攻击，估算签名的时间，得出k。</p>
<p>RLM的开发者果然是有一鼓呆子气，如果攻击者都能物理接触到你的license maker Server了，<br>那直接复制你的文件就可以，还计时攻击个啥呢？对于PC来说，签名DSA-512在200 us内完成。<br>计时攻击要求：接触到服务器，能在服务器上运行纳秒级的计时器， 也就是能直接读取CPU的计时器(RDTSC)；可以执行签名程序，进行上万次的签名试验。这除了开发者本人蛋疼的测试，其他人能有这条件吗？ 这就是从自己口袋里掏钥匙的游戏。</p>
<p>这里说一个结论，RLM从 v1- v8，patch DSA verfiy， 写license maker，是很容易的事情。<br>v9之后checksum有所增强， 但是也不复杂。</p>
<p>包括RLM的Windows， linux， macos平台都一样。</p>
<p>RLM除了开发起来简单些，从Sign保护方面来说，只是把ECDSA Sign换成了DSA， 基本上是老虎变大猫的游戏。</p>
<h1 id="15-FlexLM-License服务器启动"><a href="#15-FlexLM-License服务器启动" class="headerlink" title="15. FlexLM License服务器启动"></a><strong>15. FlexLM License服务器启动</strong></h1><p>说明： 本篇主要是基本知识简单介绍，与ECDSA无关。详见用户文档。</p>
<p>FlexLM的license是一种格式化的文件，关于这种格式的说明，可以参考FlexLM用户文档。<br>&lt; License Administration Guide &gt; ( fnp_LicAdmin.pdf )</p>
<p>一般来说，发行软件本身会带证书管理指南文档。包括证书格式，服务器配置，故障排除等内容。</p>
<p>比如， Cadence v16.5 (采用FlexNet v11.9.1.0 build 89952 i86_n3)，安装完毕，<br>可以找到用户文档：FlexNet Publisher Licensing Toolkit 11.9.1，日期为 2010.12。</p>
<p>许可证服务器管理器是TCP/IP方式通讯的。一般可采用lmgrd + daemon（守护程序） 方式检查licensefile。<br>licensefile 可采用如下命令行启用：<br>lmgrd -c licensefile<br>licensefile 中描述了守护程序的名字。</p>
<p>许可证服务器管理器 lmgrd 的用途是：<br>• 启动并维护许可证文件的 VENDOR 行中列出的所有供应商守护程序。<br>• 向合适的供应商守护程序发出应用程序检出（或其它）请求。</p>
<p>lmgrd 命令行具体语法可以参考文档中《lmgrd 命令行语法》这一节。<br>lmgrd主要的用法为：<br>lmgrd [-c license_file_list] [-l [+]debug_log_path]<br>[-2 -p] [-local] [-x lmdown] [-x lmremove] [-z ] [-v] [-help]</p>
<h1 id="16-FlexLM-License文件格式"><a href="#16-FlexLM-License文件格式" class="headerlink" title="16. FlexLM License文件格式"></a><strong>16. FlexLM License文件格式</strong></h1><p>License文件采用文本格式，可以手工编辑，合并。对用户来说，比二进制格式要直观。<br>FlexLM特别强调它能灵活管理多种license。</p>
<p>可以参看<a href="https://docs.nomagic.com/download/attachments/70388394/fnp_LicAdmin_11_17_0.pdf?version=1&amp;modificationDate=1611149745747&amp;api=v2" target="_blank" rel="noopener">&lt; License Administration Guide &gt;</a> 这个文档。<br>Reading a License File， 这一章， 描述了license文件的格式。摘要如下：</p>
<p>许可证文件（license file）通常以一个 SERVER 行开始，<br>后跟一个或多个 VENDOR 行，然后是一个或多个 FEATURE 或 INCREMENT 行。<br>在某些情况下，许可证文件不需要 SERVER 行和 VENDOR 行（单机版，运行时不需要lmgrd和守护程序）。</p>
<p>许可证的类型有：<br>（1）流动许可证<br>流动许可证在各个FEATURE 行中没有 hostid这一项目。流动许可证要求运行 lmgrd 和 供应商守护程序以对许可证<br>的并发使用情况进行计数。lmgrd 使用FLEXnet Licensing TCP/IP 端口，缺省范围 (27000-27009) 。<br>也可以指定其它的端口。</p>
<p>文档里，给出浮动license的一个例子是：<br>SERVER lulu 17007ea8<br>VENDOR sampled<br>FEATURE f1 sampled 1.00 1-jan-2005 2 SIGN=signature1<br>FEATURE f2 sampled 1.00 1-jan-2005 6 SIGN=signature2<br>FEATURE f3 sampled 1.00 1-jan-2005 1 SIGN=signature3<br>此许可证文件指定许可证服务器为“lulu”，服务器hostid为17007ea8， 端口为默认。<br>客户可访问功能“f1”的 2 个许可证、功能“f2”的 6 个许可证以及功能“f3”的 1 个许可证。</p>
<p>（2）节点锁定许可证<br>节点锁定意味着，FLEXenabled 软件只能在一台或一组计算机上使用。节点锁定的许可证在某个 FEATURE 行中包含 hostid，该许可证将节点锁定到特定主机上。<br>共有两种类型的节点锁定许可证；不计数许可证和计数许可证。</p>
<p>如果将许可证数量设置为 0 （或 uncounted），则不对该许可证进行计数，并且允许在指定计算机上无限制地使用该许可证。<br>此配置不需要 lmgrd 或供应商守护程序，因为它不对功能的并发使用情况进行计数。</p>
<p>即使有hostid这一项目，如果hostid=ANY, 则不绑定硬件。</p>
<p>这里给出本地license的一个例子(SlickEdit 13, FlexNet v11.5)，<br>说明，这只是一个例子，不是一个valid的license（Sign修改了的）：</p>
<p>INCREMENT vswb vsflex 13.00 9-jul-2008 uncounted HOSTID=00117b8a597b \<br>    ISSUER=”SlickEdit Inc.” ISSUED=24-jun-2008 \<br>    NOTICE=” <strong>**</strong> “ \<br>    SN=SERIAL:WB_TRIAL|LICTYPE:TRL START=23-jun-2008 TS_OK \<br>    SIGN=”01D2 87C9 CAA9 C2B9 3FA9 48B1 5668 AE7F 8097 71CE 7602 \<br>    72F7 863C 82AD 422E 0802 ACDD D4B8 D4DE FADB EF50”</p>
<p>在这里，HOSTID 锁定为mac地址00117b8a597b。</p>
<p>在这里，守护程序是vsflex，本地license一样可以用lmgrd启动管理的。<br>本地slickedit.lic改为：<br>SERVER 127.0.0.1 ANY 27000<br>VENDOR vsflex<br>USE_SERVER</p>
<p>那么， slickedit将通过访问127.0.0.1:27000获取license。<br>我们在本地启动: lmgrd -z -c license.dat , license.dat如下：<br>SERVER this_host ANY<br>VENDOR vsflex<br>INCREMENT vswb vsflex 13.00 9-jul-2008 uncounted HOSTID=00117b8a597b \<br>    ISSUER=”SlickEdit Inc.” ISSUED=24-jun-2008 \<br>    NOTICE=” <strong>**</strong> “ \<br>    SN=SERIAL:WB_TRIAL|LICTYPE:TRL START=23-jun-2008 TS_OK \<br>    SIGN=”01D2 87C9 CAA9 C2B9 3FA9 48B1 5668 AE7F 8097 71CE 7602 \<br>    72F7 863C 82AD 422E 0802 ACDD D4B8 D4DE FADB EF50”</p>
<p>因此，采用本地license或是网络license主要看管理上的方便。</p>
<h1 id="17-FlexLM对FEATURE-INCREMENT进行ECDSA签名方法"><a href="#17-FlexLM对FEATURE-INCREMENT进行ECDSA签名方法" class="headerlink" title="17. FlexLM对FEATURE/INCREMENT进行ECDSA签名方法"></a><strong>17. FlexLM对FEATURE/INCREMENT进行ECDSA签名方法</strong></h1><p>FEATURE/INCREMENT 行的基本格式为：<br>{FEATURE|INCREMENT} feature vendor feat_version exp_date num_lic SIGN=sign [optional_attributes]</p>
<p>（1）必选属性<br>FEATURE/INCREMENT 行关有6个必选字段，并且它们具有固定的顺序。这些字段是由供应商定义的，不能对其进行更改。</p>
<p>（2）可选属性<br>可选属性由供应商自行提供的，以便提供特定的许可行为。这些属性采用keyword=value 语法，其中，keyword 为大写形式。<br>所以在 FEATURE 或 INCREMENT 行中，它们必须保留在该位置，最终用户不能对其进行更改。<br>常见的有：<br>ISSUED=dd-mmm-yyyy 签发日期。<br>ISSUER=”…” 许可证签发者。<br>NOTICE=”…” 用于知识产权通告的字段。<br>PLATFORMS=”…” 使用情况受所列出平台限制。<br>START=dd-mmm-yyyy 开始日期。<br>VENDOR_STRING=”…” 供应商定义的字符串，用双引号引起来。</p>
<p>签名过程中，这些属性会按照固定的顺序处理。因此保证了用户不能更改FEATURE中的属性或者Sign。</p>
<p>在SDK中，l_crypt_private()这个函数用来处理feature的属性。它调用real_crypt()实现。<br>real_crypt()其实并不是一个crypt， 它是一个字符处理函数，FEATURE 或 INCREMENT 经过它的处理，然后才会进行ECDSA签名。<br>接下来就是ECDSA签名， 签名的算法和RNG，前面的文章已有说明，因此不再重复。</p>
<p>这里给出一个例子, 采用是FlexNet 11.5， ECDSA-163。</p>
<p>INCREMENT vsee vsflex 13.01 16-jul-2099 uncounted HOSTID=ANY \<br> ISSUER=”SLICKEDIT KG READYU#2K8” ISSUED=28-jun-2008 \<br> NOTICE=”readyu” \<br> SN=SERIAL:FWC123-74973876|LICTYPE:STD TS_OK \<br> SIGN=”023843740B3B1FBF51630285E892CF2E3D4AC88CEF 010FBFCB08A51D71423825CB84C5CD63905679F60A”</p>
<p>对于ECDSA来说，这个签名其实是：<br>hash(msg)=5b176716984bf0e4c0f2016785612e0ad31690e2<br>sign.r=023843740B3B1FBF51630285E892CF2E3D4AC88CEF<br>sign.s=010FBFCB08A51D71423825CB84C5CD63905679F60A</p>
<p>ECDSA的签名hash来自于msg的sha-160。</p>
<p>msg并不是直接的把这一行“INCREMENT vsee vsflex 13.01 16-jul-2099 uncounted HOSTID=ANY ….” 连接起来。</p>
<p>它是对INCREMENT行，real_crypt() 之后得来的。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">它的签名msg如下：</span><br><span class="line"> </span><br><span class="line">unsigned char msg[] = &#123;</span><br><span class="line">    <span class="number">0xD2</span>, <span class="number">0x0F</span>, <span class="number">0x37</span>, <span class="number">0xAB</span>, <span class="number">0xEF</span>, <span class="number">0x28</span>, <span class="number">0x01</span>, <span class="number">0xD0</span>, <span class="number">0x00</span>, <span class="number">0x56</span>, <span class="number">0x53</span>, <span class="number">0x45</span>, <span class="number">0x45</span>, <span class="number">0x0D</span>, <span class="number">0x64</span>, <span class="number">0x10</span>,</span><br><span class="line">    <span class="number">0xC7</span>, <span class="number">0x6A</span>, <span class="number">0x75</span>, <span class="number">0x6C</span>, <span class="number">0x87</span>, <span class="number">0xC5</span>, <span class="number">0xD0</span>, <span class="number">0x73</span>, <span class="number">0x54</span>, <span class="number">0x59</span>, <span class="number">0x50</span>, <span class="number">0x45</span>, <span class="number">0x3D</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x38</span>,</span><br><span class="line">    <span class="number">0x49</span>, <span class="number">0x53</span>, <span class="number">0x53</span>, <span class="number">0x55</span>, <span class="number">0x45</span>, <span class="number">0x52</span>, <span class="number">0x3D</span>, <span class="number">0x53</span>, <span class="number">0x4C</span>, <span class="number">0x49</span>, <span class="number">0x43</span>, <span class="number">0x4B</span>, <span class="number">0x45</span>, <span class="number">0x44</span>, <span class="number">0x49</span>, <span class="number">0x54</span>,</span><br><span class="line">    <span class="number">0x4B</span>, <span class="number">0x47</span>, <span class="number">0x52</span>, <span class="number">0x45</span>, <span class="number">0x41</span>, <span class="number">0x44</span>, <span class="number">0x59</span>, <span class="number">0x55</span>, <span class="number">0x23</span>, <span class="number">0x32</span>, <span class="number">0x4B</span>, <span class="number">0x38</span>, <span class="number">0x1C</span>, <span class="number">0x6C</span>, <span class="number">0x6A</span>, <span class="number">0x75</span>,</span><br><span class="line">    <span class="number">0x6E</span>, <span class="number">0x4E</span>, <span class="number">0x4F</span>, <span class="number">0x54</span>, <span class="number">0x49</span>, <span class="number">0x43</span>, <span class="number">0x45</span>, <span class="number">0x3D</span>, <span class="number">0x52</span>, <span class="number">0x45</span>, <span class="number">0x41</span>, <span class="number">0x44</span>, <span class="number">0x59</span>, <span class="number">0x55</span>, <span class="number">0x53</span>, <span class="number">0x4E</span>,</span><br><span class="line">    <span class="number">0x3D</span>, <span class="number">0x53</span>, <span class="number">0x45</span>, <span class="number">0x52</span>, <span class="number">0x49</span>, <span class="number">0x41</span>, <span class="number">0x4C</span>, <span class="number">0x3A</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x43</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x2D</span>, <span class="number">0x37</span>,</span><br><span class="line">    <span class="number">0x34</span>, <span class="number">0x39</span>, <span class="number">0x37</span>, <span class="number">0x33</span>, <span class="number">0x38</span>, <span class="number">0x37</span>, <span class="number">0x36</span>, <span class="number">0x7C</span>, <span class="number">0x4C</span>, <span class="number">0x49</span>, <span class="number">0x43</span>, <span class="number">0x54</span>, <span class="number">0x59</span>, <span class="number">0x50</span>, <span class="number">0x45</span>, <span class="number">0x3A</span>,</span><br><span class="line">    <span class="number">0x53</span>, <span class="number">0x54</span>, <span class="number">0x44</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"> </span><br><span class="line">msg里面的非ASCII字符，是一些常数。比如：</span><br><span class="line">ANY_CODE (<span class="number">0xab370fd2</span>)，INCREMENT_FLAGv(<span class="number">0xd00128ef</span>)， NO_START_DATE_FLAG (<span class="number">0x73D0c587</span>)，</span><br><span class="line"> </span><br><span class="line">msg如果直接打印，这里面有<span class="number">00</span>字符，还有非ASCII字符,因此会出现部分”乱码“。</span><br><span class="line">?<span class="number">7</span>(?VSEEd莏ul嚺衧TYPE=128ISSUER=SLICKEDITKGREADYU#2K8ljunNOTICE=READYUSN=SERIAL:FWC123-<span class="number">74973876</span>|LICTYPE:<span class="keyword">STD</span></span><br></pre></td></tr></table></figure>
<p>x86的字节序是little-edian。所以在内存里，ANY_CODE (0xab370fd2) 的顺序为：<br>0xD2, 0x0F, 0x37, 0xAB</p>
<p>事实上，在flexlm-enabled的程序中，搜这四个字节，可以定位 real_crypt()函数。</p>
<p>附录： l_crypt 的一些常数定义：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> *  Some constants for flags going into the string</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">#define ANY_CODE         ((<span class="name">long</span>) <span class="number">0</span>xab370fd2)</span><br><span class="line">#define USER_CODE        ((<span class="name">long</span>) <span class="number">0</span>xba1584a2)</span><br><span class="line">#define DISPLAY_CODE     ((<span class="name">long</span>) <span class="number">0</span>xab8543cc)</span><br><span class="line">#define HOSTNAME_CODE    ((<span class="name">long</span>) <span class="number">0</span>xbadaef01)</span><br><span class="line">#define HOSTID_DOMAIN_CODE    ((<span class="name">long</span>) <span class="number">0</span>x49D654F9)</span><br><span class="line">#define HOSTID_COMPOSITE_CODE   ((<span class="name">long</span>) <span class="number">0</span>x2388341c)</span><br><span class="line">#define HOSTID_METER_BORROW_CODE    ((<span class="name">long</span>) <span class="number">0</span>x4aa87607)</span><br><span class="line">#define HOSTID_VENDOR_CODE ((<span class="name">long</span>) <span class="number">0</span>x12fe93a)</span><br><span class="line">#define NO_EXTENDED_CODE ((<span class="name">long</span>) <span class="number">0</span>x74ab99)</span><br><span class="line">#define DEMO_CODE        ((<span class="name">long</span>) <span class="number">0</span>x122345a)</span><br><span class="line">#define FLEXLOCK_CODE   ((<span class="name">long</span>) <span class="number">0</span>x1c8c6f21)</span><br><span class="line">#define FLEXID1_CODE    ((<span class="name">long</span>) <span class="number">0</span>x61420b1)</span><br><span class="line">#define FLEXID2_CODE    ((<span class="name">long</span>) <span class="number">0</span>x19481954)</span><br><span class="line">#define FLEXID3_CODE    ((<span class="name">long</span>) <span class="number">0</span>x29ab7264)</span><br><span class="line">#define FLEXID4_CODE    ((<span class="name">long</span>) <span class="number">0</span>x01181954)</span><br><span class="line">#define FLEXID_FILE_CODE    ((<span class="name">long</span>) <span class="number">0</span>x8adf678a)</span><br><span class="line">#define DISK_SERIAL_NUM_CODE    ((<span class="name">long</span>) <span class="number">0</span>x78131a7c)</span><br><span class="line">#define ID_STRING_CODE  ((<span class="name">long</span>) <span class="number">0</span>xaabb007c)</span><br><span class="line">#define SERNUM_ID_STRING_CODE   ((<span class="name">long</span>) <span class="number">0</span>x5c7b549c)</span><br><span class="line">#define INTERNET_CODE   ((<span class="name">long</span>) <span class="number">0</span>x7c7cfea0)</span><br><span class="line">             </span><br><span class="line">#define INCREMENT_FLAG   ((<span class="name">long</span>) <span class="number">0</span>xd00128ef)</span><br><span class="line">#define PACKAGE_FLAG     ((<span class="name">long</span>) <span class="number">0</span>x038ddeed)</span><br><span class="line">#define UPGRADE_FLAG     ((<span class="name">long</span>) <span class="number">0</span>x11052f73)</span><br><span class="line">#define NO_START_DATE_FLAG ((<span class="name">long</span>) <span class="number">0</span>x73D0c587)</span><br></pre></td></tr></table></figure>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2021/10/100679.html" class="pre-post btn btn-default" title='Qt项目升级到Qt6移植总结'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">Qt项目升级到Qt6移植总结</span>
        </a>
    
    
        <a href="/archives/2021/08/100677.html" class="next-post btn btn-default" title='Qt Installer Framework 使用手册'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">Qt Installer Framework 使用手册</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-FLEXLM简介"><span class="toc-text">1. FLEXLM简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-FLexLM-的ECC（椭圆曲线加密）来由"><span class="toc-text">2. FLexLM 的ECC（椭圆曲线加密）来由</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Certicom公司简介"><span class="toc-text">3. Certicom公司简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-FLEXLM-如何使用ECC"><span class="toc-text">4. FLEXLM 如何使用ECC</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-FLEXLM-ECC的通用破解方法"><span class="toc-text">5. FLEXLM ECC的通用破解方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-研究flexlm主要资料"><span class="toc-text">6. 研究flexlm主要资料</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-flexlm的key加密强度种类"><span class="toc-text">7. flexlm的key加密强度种类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-flexlm所用到的椭圆曲线"><span class="toc-text">8. flexlm所用到的椭圆曲线</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-flexlm-ecc-ellipticCurveParameters-结构体中-checksum的计算方法"><span class="toc-text">9. flexlm ecc ellipticCurveParameters 结构体中 checksum的计算方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-flexlm-ecc三条椭圆曲线的参数"><span class="toc-text">10. flexlm ecc三条椭圆曲线的参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-ECDSA的一些参考读物"><span class="toc-text">11. ECDSA的一些参考读物</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-一条椭圆曲线上做ECDSA的例子"><span class="toc-text">12. 一条椭圆曲线上做ECDSA的例子</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-FlexLM-ECDSA的公私钥对生成方法"><span class="toc-text">13. FlexLM ECDSA的公私钥对生成方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-FlexLM-ECDSA签名过程的漏洞"><span class="toc-text">14. FlexLM ECDSA签名过程的漏洞</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-FlexLM-License服务器启动"><span class="toc-text">15. FlexLM License服务器启动</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-FlexLM-License文件格式"><span class="toc-text">16. FlexLM License文件格式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#17-FlexLM对FEATURE-INCREMENT进行ECDSA签名方法"><span class="toc-text">17. FlexLM对FEATURE/INCREMENT进行ECDSA签名方法</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2023&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>