<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="qt,log4qt">


    <meta name="description" content="日志是一个优秀系统不可或缺的组成部分，利用它我们可以记录系统中所产生的所有行为。本文围绕 Log4Qt，探索 C++ 中的 Log4j 技术。快速了解 Log4j 内部工作机制，并能熟练使用其各...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>Log4Qt使用教程(Log4j for C++ 构建系统日志) | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Log4Qt使用教程(Log4j for C++ 构建系统日志)">
            
	            Log4Qt使用教程(Log4j for C++ 构建系统日志)
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/back/">后端</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/log4qt/">log4qt</a> <a class="tag-link" href="/tags/qt/">qt</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2021/03/12</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>766</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p>日志是一个优秀系统不可或缺的组成部分，利用它我们可以记录系统中所产生的所有行为。本文围绕 Log4Qt，探索 C++ 中的 Log4j 技术。快速了解 Log4j 内部工作机制，并能熟练使用其各个衍生品 - Log4cpp、log4cplus、log4cxx、Log4Qt。本教程的源码下载地址：<a href="https://github.com/myhhub/Log4Qt-project" target="_blank" rel="noopener">项目源代码</a>。</p>
<h1 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a><strong>基本介绍</strong></h1><p>Log4Qt 是 Apache Log4j 的 Qt 移植版，并且保持了 API 上的一致，主要用于记录日志。</p>
<p>通过使用 Log4，我们可以：</p>
<ul>
<li>控制日志的输出格式；</li>
<li>通过定义日志信息的级别，来更加细致地控制日志的生成过程；</li>
<li>控制日志信息的输出位置，例如：文件、控制台、数据库等；</li>
<li>……</li>
</ul>
<p>最不可思议的是，这些都可以通过配置文件来灵活地控制，而无需修改源代码。</p>
<p>由于 Log4Qt 是基于 Qt 编写的，所以它也继承了 Qt 的跨平台特性。也就是说，可以将其用于 Windows、Linux、以及 MacOS 平台上。</p>
<ul>
<li>主页：<a href="http://log4qt.sourceforge.net" target="_blank" rel="noopener">http://log4qt.sourceforge.net</a></li>
<li>文档：<a href="http://log4qt.sourceforge.net/html/index.html" target="_blank" rel="noopener">http://log4qt.sourceforge.net/html/index.html</a></li>
</ul>
<p>由于 Log4Qt 的开发在 2009 年就终止了，所以其官网提供的源码仅支持 Qt4：</p>
<ul>
<li>for Qt4：<a href="https://sourceforge.net/projects/log4qt" target="_blank" rel="noopener">https://sourceforge.net/projects/log4qt</a></li>
</ul>
<p>但值得庆祝的是，有人提供了一个兼容 Qt5 的版本：</p>
<ul>
<li>for Qt5：<a href="https://github.com/MEONMedical/Log4Qt" target="_blank" rel="noopener">https://github.com/MEONMedical/Log4Qt</a></li>
</ul>
<p>这个升级版很棒，不但可以将 Log4Qt 源码添加至项目中，而且还可以将其编译为库，并且它还同时支持 CMake 和 qmake。</p>
<p>最重要的是，它还在持续升级（已逐步迈向 Qt6），并且在老版本（for Qt4）的基础上添加了很多新 Feature。</p>
<h1 id="分层架构"><a href="#分层架构" class="headerlink" title="分层架构"></a><strong>分层架构</strong></h1><p>og4Qt API 设计为分层结构，其中每一层提供了执行不同任务的不同对象，这种设计为未来的发展提供了很好的可扩展性。</p>
<p>Log4Qt 对象分为：</p>
<ul>
<li>核心对象：使用框架必不可少的强制性对象。</li>
<li>支持对象：帮助核心对象完成重要的任务。</li>
</ul>
<h2 id="核心对象"><a href="#核心对象" class="headerlink" title="核心对象"></a><strong>核心对象</strong></h2><ul>
<li>Logger 对象：处于最上层，负责捕获日志信息。</li>
<li>Appender 对象：负责将日志信息输出到各种目的地，例如：控制台、文件、数据库等。</li>
<li>Layout 对象：用于控制日志输出格式，该层有助于以可读形式记录信息。</li>
</ul>
<h2 id="支持对象"><a href="#支持对象" class="headerlink" title="支持对象"></a><strong>支持对象</strong></h2><ul>
<li>Level 对象：定义日志信息的优先级：TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL。</li>
<li>LogManager：负责从配置文件或配置类中读取初始配置参数。</li>
<li>Filter 对象：用于分析日志信息，并进一步决定是否需要记录信息。</li>
<li>ObjectRenderer：用于向传递的各种 Logger 对象提供字符串表示（在 Log4Qt 中，尚未用到）。</li>
</ul>
<h1 id="编译构建"><a href="#编译构建" class="headerlink" title="编译构建"></a><strong>编译构建</strong></h1><p>下载 Log4Qt（for Qt5），进行解压缩。同时支持 CMake 和 qmake。其中，src 是需要特别关注的目录，里面包含了 Log4Qt 的所有源码。</p>
<p>由于代码结构已经组织好了，所以编译 Log4Qt（以 Windows 为例）非常简单：</p>
<ul>
<li>使用 Qt Creator 打开 log4qt.pro。</li>
<li>执行 qmake -&gt; 构建。</li>
</ul>
<p>成功之后，在构建目录下会生成 log4qt.lib、log4qt.dll 以及相应的示例程序。</p>
<p><strong><em>注意：</em></strong>如果要启用”日志输出到数据库功能”，需要修改src\log4qt\log4qt.pro,在QT += 中添加sql。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QT += core xml<span class="built_in"> network </span>concurrent sql</span><br></pre></td></tr></table></figure>
<h1 id="配置使用"><a href="#配置使用" class="headerlink" title="配置使用"></a><strong>配置使用</strong></h1><p>要使用 Log4Qt，有两种方式：将 Log4Qt 源码添加至项目中，或者将其当做第三方库来使用。</p>
<h2 id="将源码添加至项目中"><a href="#将源码添加至项目中" class="headerlink" title="将源码添加至项目中"></a><strong>将源码添加至项目中</strong></h2><p>在 Log4Qt-master/src/log4qt 目录中，有一个很重要的文件 - log4qt.pri，通过它可以很容易地将 Log4Qt 的源码添加至项目中。</p>
<p>仅需在 .pro（自己的工程文件）添加如下配置：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义所需的宏</span></span><br><span class="line">DEFINES += LOG4QT_LIBRARY</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 Log4Qt 源码根目录</span></span><br><span class="line">LOG4QT_ROOT_PATH = <span class="variable">$$</span>PWD/../Log4Qt-master</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定编译项目时应该被搜索的 #include 目录</span></span><br><span class="line">INCLUDEPATH += <span class="variable">$$</span>LOG4QT_ROOT_PATH/src \</span><br><span class="line">               <span class="variable">$$</span>LOG4QT_ROOT_PATH/src/log4qt \</span><br><span class="line">               <span class="variable">$$</span>LOG4QT_ROOT_PATH/<span class="keyword">include</span> \</span><br><span class="line">               <span class="variable">$$</span>LOG4QT_ROOT_PATH/<span class="keyword">include</span>/log4qt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 Log4Qt 源代码添加至项目中</span></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$$</span>LOG4QT_ROOT_PATH/src/log4qt/log4qt.pri)</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$$</span>LOG4QT_ROOT_PATH/build.pri)</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$$</span>LOG4QT_ROOT_PATH/g++.pri)</span><br></pre></td></tr></table></figure>
<h2 id="将其作为第三方库使用"><a href="#将其作为第三方库使用" class="headerlink" title="将其作为第三方库使用"></a><strong>将其作为第三方库使用</strong></h2><p>上面说过，编译 Log4Qt 后，会生成相应的库。所以如果想将其作为第三方库来使用的话，也很方便。</p>
<p>仅需在 .pro（自己的工程文件）添加如下配置：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义 Log4Qt 源码根目录</span></span><br><span class="line">LOG4QT_ROOT_PATH = $<span class="variable">$PWD</span><span class="regexp">/../</span>Log4Qt-master</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定链接到项目中的库列表</span></span><br><span class="line">LIBS += -L$<span class="variable">$PWD</span><span class="regexp">/../</span>Libs -llog4qt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定编译项目时应该被搜索的 #include 目录</span></span><br><span class="line">INCLUDEPATH += $<span class="variable">$LOG4QT_ROOT_PATH</span><span class="regexp">/src \</span></span><br><span class="line"><span class="regexp">               $$LOG4QT_ROOT_PATH/</span>src<span class="regexp">/log4qt \</span></span><br><span class="line"><span class="regexp">               $$LOG4QT_ROOT_PATH/i</span>nclude \</span><br><span class="line">               $<span class="variable">$LOG4QT_ROOT_PATH</span><span class="regexp">/include/</span>log4qt</span><br></pre></td></tr></table></figure>
<h1 id="获取-Log4Qt-中的-logger"><a href="#获取-Log4Qt-中的-logger" class="headerlink" title="获取 Log4Qt 中的 logger"></a>获取 Log4Qt 中的 logger</h1><p>在 Log4Qt 中，有一个很重要的类 - Logger，用于提供日志服务。那么，如何获取 logger 呢？</p>
<p>关于这部分，Log4Qt 中有一个简单的描述：</p>
<blockquote>
<p>Request a logger by either calling Log4Qt::Logger::logger or using LOG4QT_DECLARE_QCLASS_LOGGER</p>
</blockquote>
<p>其实，除了这两种方式外，还有另一种方式 <code>LOG4QT_DECLARE_STATIC_LOGGER</code> 可供选择。</p>
<p>具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/RequestLogger" target="_blank" rel="noopener">RequestLogger</a></p>
<h2 id="使用-Log4Qt-Logger-logger"><a href="#使用-Log4Qt-Logger-logger" class="headerlink" title="使用 Log4Qt::Logger::logger"></a>使用 Log4Qt::Logger::logger</h2><p>通过基础配置和 root logger，完成 Log4Qt 的一个简单使用：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/basicconfigurator.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logger.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QCoreApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一个简单的基础配置</span></span><br><span class="line">    Log4Qt::BasicConfigurator::configure();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取根 logger</span></span><br><span class="line">    Log4Qt::Logger* logger = Log4Qt::Logger::rootLogger();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    logger-&gt;debug(<span class="string">"Hello, Log4Qt!"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<blockquote>
<p>16 [0x0000026c077bf3c0] DEBUG root - Hello, Log4Qt!</p>
</blockquote>
<h2 id="使用-LOG4QT-DECLARE-QCLASS-LOGGER"><a href="#使用-LOG4QT-DECLARE-QCLASS-LOGGER" class="headerlink" title="使用 LOG4QT_DECLARE_QCLASS_LOGGER"></a>使用 LOG4QT_DECLARE_QCLASS_LOGGER</h2><p>关于 <code>LOG4QT_DECLARE_QCLASS_LOGGER</code>，先来了解下它是如何定义的（在 <code>logger.h</code> 中）：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#define LOG4QT_DECLARE_QCLASS_LOGGER \</span><br><span class="line">            <span class="keyword">private</span>:                                                              \</span><br><span class="line">                    mutable Log4Qt::ClassLogger mLog4QtClassLogger;                   \</span><br><span class="line">            <span class="keyword">public</span>:                                                               \</span><br><span class="line">                    <span class="keyword">inline</span> Log4Qt::Logger *logger() <span class="keyword">const</span>                             \</span><br><span class="line">                    &#123;   <span class="keyword">return</span> mLog4QtClassLogger.logger(<span class="keyword">this</span>);    &#125;                  \</span><br><span class="line">            <span class="keyword">private</span>:</span><br></pre></td></tr></table></figure>
<p>可以看到，该宏声明了一个成员函数，用于检索使用它的类的 Logger。在第一次调用时，通过调用 <code>Logger::logger(const char *pName)</code> 来请求 Logger，指针被存储以在随后的调用中返回。</p>
<p>看一个简单的示例，了解下如何使用它：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MY_LOGGER_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_LOGGER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logger.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLogger</span> :</span> <span class="keyword">public</span> QObject &#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line">    LOG4QT_DECLARE_QCLASS_LOGGER</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    MyLogger() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(<span class="keyword">const</span> QString &amp;message)</span> </span>&#123; logger()-&gt;debug(message); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// MY_LOGGER_H</span></span></span><br></pre></td></tr></table></figure>
<p>main.cpp 内容如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/basicconfigurator.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"my_logger.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QCoreApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一个简单的基础配置</span></span><br><span class="line">    Log4Qt::BasicConfigurator::configure();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用自定义的 logger</span></span><br><span class="line">    MyLogger logger;</span><br><span class="line">    logger.debug(<span class="string">"Hello, Log4Qt!"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<blockquote>
<p>16 [0x00000167090c2040] DEBUG MyLogger - Hello, Log4Qt!</p>
</blockquote>
<h2 id="使用-LOG4QT-DECLARE-STATIC-LOGGER"><a href="#使用-LOG4QT-DECLARE-STATIC-LOGGER" class="headerlink" title="使用 LOG4QT_DECLARE_STATIC_LOGGER"></a>使用 LOG4QT_DECLARE_STATIC_LOGGER</h2><p>和 <code>LOG4QT_DECLARE_QCLASS_LOGGER</code> 一样，<code>LOG4QT_DECLARE_STATIC_LOGGER</code> 也被定义在 <code>logger.h</code> 中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define LOG4QT_DECLARE_STATIC_LOGGER(FUNCTION, CLASS) \</span></span><br><span class="line">        <span class="keyword">static</span> Log4Qt::Logger *<span class="function"><span class="keyword">FUNCTION</span><span class="params">()</span> \ </span>&#123;                                                                 \</span><br><span class="line">            <span class="keyword">static</span> Log4Qt::Logger * p_logger(Log4Qt::Logger::logger(<span class="comment">#CLASS )); \</span></span><br><span class="line">            <span class="keyword">return</span> p_logger;                                               \</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>该宏声明了一个静态函数 <code>FUNCTION</code>，该函数返回一个指向 <code>Logger</code> 的指针。在第一次调用时，通过调用 <code>Logger::logger( #CLASS )</code> 来请求 Logger，指针被存储以在随后的调用中返回。</p>
<p>使用也非常简单，对上面的 <code>MyLogger</code> 稍作修改：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MY_LOGGER_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_LOGGER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logger.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">LOG4QT_DECLARE_STATIC_LOGGER(logger, MyLogger)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLogger</span> :</span> <span class="keyword">public</span> QObject &#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    MyLogger() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(<span class="keyword">const</span> QString &amp;message)</span> </span>&#123; logger()-&gt;debug(message); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// MY_LOGGER_H</span></span></span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<blockquote>
<p>16 [0x0000020574392900] DEBUG MyLogger - Hello, Log4Qt!</p>
</blockquote>
<h1 id="深入理解-rootLogger、logLogger、qtLogger"><a href="#深入理解-rootLogger、logLogger、qtLogger" class="headerlink" title="深入理解 rootLogger、logLogger、qtLogger"></a>深入理解 rootLogger、logLogger、qtLogger</h1><p>在 Log4Qt 中，你会发现有一系列的 Logger - rootLogger、logLogger、qtLogger。</p>
<p>具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/UnderstandLogger" target="_blank" rel="noopener">UnderstandLogger</a></p>
<h2 id="相互关系"><a href="#相互关系" class="headerlink" title="相互关系"></a>相互关系</h2><p>要了解它们之间的关系，最直接的方法就是从源码着手 - 源码面前，了无秘密！</p>
<h3 id="关系链"><a href="#关系链" class="headerlink" title="关系链"></a>关系链</h3><p>从 Logger 类开始，查看相关源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Logger *Logger::rootLogger()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> LogManager::rootLogger();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Logger *Logger::logger(<span class="keyword">const</span> QString &amp;rName)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> LogManager::logger(rName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，它们在内部调用的是 LogManager 类的相关接口：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Logger *LogManager::rootLogger()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> instance()-&gt;mpLoggerRepository-&gt;rootLogger();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Logger *LogManager::logger(<span class="keyword">const</span> QString &amp;rName)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> instance()-&gt;mpLoggerRepository-&gt;logger(rName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inline Logger *LogManager::logLogger()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> logger(QLatin1String(<span class="string">"Log4Qt"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inline Logger *LogManager::qtLogger()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> logger(QLatin1String(<span class="string">"Qt"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而这些最终都是由 Hierarchy 类来决定：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> Logger *Hierarchy::rootLogger() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// QReadLocker locker(&amp;mObjectGuard); // Constant for object lifetime</span></span><br><span class="line">    <span class="keyword">return</span> mpRootLogger;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Logger *Hierarchy::logger(<span class="keyword">const</span> QString &amp;rName)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">QWriteLocker <span class="title">locker</span><span class="params">(&amp;mObjectGuard)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> createLogger(rName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于 rootLogger() 返回的是 mpRootLogger，根据 Hierarchy 的构造函数：</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Hierarchy::Hierarchy<span class="comment">()</span> :</span><br><span class="line">    mObjectGuard<span class="comment">(QReadWriteLock::Recursive)</span>,</span><br><span class="line">    mLoggers<span class="comment">()</span>,</span><br><span class="line">    mThreshold<span class="comment">(Level::NULL_INT)</span>,</span><br><span class="line">    mpRootLogger<span class="comment">(logger(QString()</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Store root logger to allow rootLogger() to be const</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现，mpRootLogger 最终也是调用了 <code>Hierarchy::logger(const QString &amp;rName)</code>，只不过传递的是一个空字符串而已。</p>
<p>到这里，可以很直观地得到这样一个调用关系：</p>
<ul>
<li><code>Logger::rootLogger() -&gt; LogManager::rootLogger() -&gt; Hierarchy::logger(QString())</code></li>
<li><code>LogManager::logLogger() -&gt; LogManager::logger(&quot;Log4Qt&quot;) -&gt; Hierarchy::logger(&quot;Log4Qt&quot;)</code></li>
<li><code>LogManager::qtLogger() -&gt; LogManager::logger(&quot;Qt&quot;) -&gt; Hierarchy::logger(&quot;Qt&quot;)</code></li>
</ul>
<h3 id="等价调用"><a href="#等价调用" class="headerlink" title="等价调用"></a>等价调用</h3><p>通过上述调用关系，最终定位 <code>Hierarchy::logger(const QString &amp;rName)</code>，而它内部则调用了 <code>Hierarchy::createLogger(const QString &amp;orgName)</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Logger *Hierarchy::createLogger(<span class="keyword">const</span> QString &amp;orgName)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> binaryIndicator[] = <span class="string">"@@binary@@"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function">QString <span class="title">rName</span><span class="params">(OptionConverter::classNameJavaToCpp(orgName))</span></span>;</span><br><span class="line">    <span class="keyword">bool</span> needBinaryLogger = orgName.contains(binaryIndicator);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (needBinaryLogger)</span><br><span class="line">        rName.remove(binaryIndicator);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> QString name_separator = QLatin1String(<span class="string">"::"</span>);</span><br><span class="line"></span><br><span class="line">    Logger *p_logger = mLoggers.value(rName, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (p_logger != <span class="literal">nullptr</span>)</span><br><span class="line">        <span class="keyword">return</span> p_logger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rName.isEmpty())</span><br><span class="line">    &#123;</span><br><span class="line">        p_logger = <span class="keyword">new</span> Logger(<span class="keyword">this</span>, Level::DEBUG_INT, QLatin1String(<span class="string">"root"</span>), <span class="literal">nullptr</span>);</span><br><span class="line">        mLoggers.insert(QString(), p_logger);</span><br><span class="line">        <span class="keyword">return</span> p_logger;</span><br><span class="line">    &#125;</span><br><span class="line">    QString parent_name;</span><br><span class="line">    <span class="keyword">int</span> index = rName.lastIndexOf(name_separator);</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="number">0</span>)</span><br><span class="line">        parent_name = rName.left(index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (needBinaryLogger)</span><br><span class="line">        p_logger = <span class="keyword">new</span> BinaryLogger(<span class="keyword">this</span>, Level::NULL_INT, rName, createLogger(parent_name));</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        p_logger = <span class="keyword">new</span> Logger(<span class="keyword">this</span>, Level::NULL_INT, rName, createLogger(parent_name));</span><br><span class="line">    mLoggers.insert(rName, p_logger);</span><br><span class="line">    <span class="keyword">return</span> p_logger;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据源码可知，Logger 的创建是由形参 rName 的值来决定的：</p>
<ul>
<li>空字符串：用于创建 rootLogger，其 name 被设置为了“root”，而 mLoggers（QHash 类型）中对应的 key 为 QString()。</li>
<li>非空字符串：用于创建其他 Logger（包括：logLogger、qtLogger），并将其 parentLogger 设置为 rootLogger（注意构造时的递归调用 <code>createLogger(parent_name)</code>）。</li>
</ul>
<p>所以，最终得出以下结论：</p>
<ul>
<li><p><code>rootLogger()</code>：等价于 <code>logger(QString())</code>，其 <code>name()</code> 和 <code>objectName()</code> 都是“root”。</p>
</li>
<li><p><code>logLogger()</code>：等价于 <code>logger(“Log4Qt”)</code>，其 <code>name()</code> 和 <code>objectName()</code> 都是“Log4Qt”。</p>
</li>
<li><p><code>qtLogger()</code>：等价于 <code>logger(“Qt”)</code>，其 <code>name()</code> 和 <code>objectName()</code> 都是“Qt”。</p>
</li>
<li><p>rootLogger 是根 Logger，而其他 Logger（包括：logLogger、qtLogger）的 parentLogger 是 rootLogger。</p>
</li>
</ul>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>实践求证，对各个 Logger 分类，并进行输出：</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;QCoreApplication&gt;</span></span><br><span class="line"><span class="comment">#include &lt;qDebug&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/basicconfigurator.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/logger.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/logmanager.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一个简单的基础配置</span></span><br><span class="line">    Log4Qt::BasicConfigurator::configure();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 rootLogger</span></span><br><span class="line">    Log4Qt::Logger *rootLogger = Log4Qt::Logger::rootLogger();</span><br><span class="line">    Log4Qt::Logger *rootLogger2 = Log4Qt::LogManager::rootLogger();</span><br><span class="line">    Log4Qt::Logger *rootLogger3 = Log4Qt::Logger::logger(<span class="string">""</span>);</span><br><span class="line">    Log4Qt::Logger *rootLogger4 = Log4Qt::LogManager::logger(<span class="string">""</span>);</span><br><span class="line">    Log4Qt::Logger *rootParentLogger = rootLogger-&gt;parentLogger();</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"********** rootLogger **********"</span>;</span><br><span class="line">    qDebug() &lt;&lt; rootLogger &lt;&lt; rootLogger2 &lt;&lt; rootLogger3 &lt;&lt; rootLogger4;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"name:"</span> &lt;&lt; rootLogger-&gt;name() &lt;&lt; <span class="string">"object name:"</span> &lt;&lt; rootLogger-&gt;objectName();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"parent logger:"</span> &lt;&lt; rootParentLogger;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 logLogger</span></span><br><span class="line">    Log4Qt::Logger *logLogger = Log4Qt::LogManager::logLogger();</span><br><span class="line">    Log4Qt::Logger *logLogger2 = Log4Qt::Logger::logger(<span class="string">"Log4Qt"</span>);</span><br><span class="line">    Log4Qt::Logger *logLogger3 = Log4Qt::LogManager::logger(<span class="string">"Log4Qt"</span>);</span><br><span class="line">    Log4Qt::Logger *logParentLogger = logLogger-&gt;parentLogger();</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"********** logLogger **********"</span>;</span><br><span class="line">    qDebug() &lt;&lt; logLogger &lt;&lt; logLogger2 &lt;&lt; logLogger3;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"name:"</span> &lt;&lt; logLogger-&gt;name() &lt;&lt; <span class="string">"object name:"</span> &lt;&lt; logLogger-&gt;objectName();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"parent logger:"</span> &lt;&lt; logParentLogger;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 qtLogger</span></span><br><span class="line">    Log4Qt::Logger *qtLogger = Log4Qt::LogManager::qtLogger();</span><br><span class="line">    Log4Qt::Logger *qtLogger2 = Log4Qt::Logger::logger(<span class="string">"Qt"</span>);</span><br><span class="line">    Log4Qt::Logger *qtLogger3 = Log4Qt::LogManager::logger(<span class="string">"Qt"</span>);</span><br><span class="line">    Log4Qt::Logger *qtParentLogger = qtLogger-&gt;parentLogger();</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"********** qtLogger **********"</span>;</span><br><span class="line">    qDebug() &lt;&lt; qtLogger &lt;&lt; qtLogger2 &lt;&lt; qtLogger3;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"name:"</span> &lt;&lt; qtLogger-&gt;name() &lt;&lt; <span class="string">"object name:"</span> &lt;&lt; qtLogger-&gt;objectName();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"parent logger:"</span> &lt;&lt; qtParentLogger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显然，和推断一样。。。通过各种方式获取到的 Logger 其实都是等价的，而且一直存在一个 rootLogger，它是所有 Logger 的 parentLogger。</p>
<h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><p>rootLogger 是根，而 logLogger、qtLogger 是基于特定的需求而诞生的，下面重点讲解 qtLogger。</p>
<h3 id="logLogger"><a href="#logLogger" class="headerlink" title="logLogger"></a>logLogger</h3><blockquote>
<p>logLogger：用于记录内部消息的 logger</p>
</blockquote>
<p>也就是说，Log4Qt 除了对外提供日志之外，它内部也用了自己的日志（即：logLogger）来记录消息。关于包内记录，官方有一个简单说明 - Logging within the package。</p>
<p>既然是内部操作，这部分就不做过多赘述了，了解即可。</p>
<h3 id="qtLogger"><a href="#qtLogger" class="headerlink" title="qtLogger"></a>qtLogger</h3><blockquote>
<p>qtLogger：用于记录由 qDebug()、qWarning()、qCritical() 和 qFatal() 所创建的消息。</p>
</blockquote>
<p>默认情况下，这些消息处理是禁用的。可以通过调用 <code>setHandleQtMessages(true)</code> 来启用。一旦启用，所有的消息都将使用 qtLogger() 来记录。</p>
<p>除了使用 rootLogger 之外，我们再额外再使用 <code>qInfo()</code> 输出一条消息：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logger.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logmanager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/ttcclayout.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/fileappender.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/loggerrepository.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 layout</span></span><br><span class="line"><span class="symbol">    Log4Qt:</span>:Logger *logger = <span class="symbol">Log4Qt::</span><span class="symbol">Logger::</span>rootLogger();</span><br><span class="line"><span class="symbol">    Log4Qt:</span>:TTCCLayout *layout = new <span class="symbol">Log4Qt::</span>TTCCLayout();</span><br><span class="line">    layout-&gt;setName(<span class="string">"My Layout"</span>);</span><br><span class="line">    layout-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 fileAppender（将日志内容输出到文件中）</span></span><br><span class="line">    <span class="comment">// true 以 Append 方式打开文件，false 以 Truncate 方式打开文件。</span></span><br><span class="line">    QString file = <span class="symbol">QCoreApplication::</span>applicationDirPath() + <span class="string">"/info.log"</span>;</span><br><span class="line"><span class="symbol">    Log4Qt:</span>:FileAppender *fileAppender = new <span class="symbol">Log4Qt::</span>FileAppender(layout, file, true);</span><br><span class="line">    fileAppender-&gt;setName(<span class="string">"My file appender"</span>);</span><br><span class="line">    fileAppender-&gt;activateOptions();</span><br><span class="line">    <span class="comment">// 在 root logger 上添加 fileAppender</span></span><br><span class="line">    logger-&gt;addAppender(fileAppender);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置级别为 info</span></span><br><span class="line">    logger-&gt;setLevel(<span class="symbol">Log4Qt::</span><span class="symbol">Level::</span>INFO_INT);</span><br><span class="line">    <span class="comment">// 允许处理 Qt 消息</span></span><br><span class="line"><span class="symbol">    Log4Qt:</span>:<span class="symbol">LogManager::</span>setHandleQtMessages(true);</span><br><span class="line">    <span class="comment">// 输出信息</span></span><br><span class="line">    logger-&gt;info(<span class="string">"This is a info message."</span>);</span><br><span class="line">    qInfo() <span class="params">&lt;&lt; "This is a info message too.";</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">    // 关闭 root logger</span></span><br><span class="line"><span class="params">    logger-&gt;</span>removeAllAppenders();</span><br><span class="line">    logger-&gt;loggerRepository()-&gt;shutdown();</span><br><span class="line"></span><br><span class="line">    return a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，然后打开 info.log 文件。可以看到，使用 <code>qInfo()</code> 生成的消息也被输出到文件里了。</p>
<h1 id="Log4Qt-配置"><a href="#Log4Qt-配置" class="headerlink" title="Log4Qt  配置"></a>Log4Qt  配置</h1><h2 id="使用环境变量配置"><a href="#使用环境变量配置" class="headerlink" title="使用环境变量配置"></a>使用环境变量配置</h2><p>Log4Qt 有4个环境变量：</p>
<table>
<thead>
<tr>
<th>LOG4QT_DEBUG</th>
<th>控制Log4Qt自身输出日志的级别，即 logLogger() 的 Level 值。如果该值是有效的 Level 字符串，则将的级别设置为该级别。如果该值不是有效的<a href="http://log4qt.sourceforge.net/html/class_log4_qt_1_1_level.html" target="_blank" rel="noopener">Level</a>字符串，则使用<a href="http://log4qt.sourceforge.net/html/class_log4_qt_1_1_level.html#5cd72b3cca61f4c5a50ffb383cd56d0061a77a907d3d6e443639f7570f84fd56" target="_blank" rel="noopener">DEBUG_INT</a>。否则，使用<a href="http://log4qt.sourceforge.net/html/class_log4_qt_1_1_level.html#5cd72b3cca61f4c5a50ffb383cd56d009e94e68775f87df73eb1833762d2c6e9" target="_blank" rel="noopener">ERROR_INT</a></th>
</tr>
</thead>
<tbody>
<tr>
<td>LOG4QT_DEFAULTINITOVERRIDE</td>
<td>是否忽略默认的初始化（除”false”外均忽略）</td>
</tr>
<tr>
<td>LOG4QT_CONFIGURATION</td>
<td>用来指定初始化用的配置文件，可在代码中指定的配置文件，也可以在此指定</td>
</tr>
<tr>
<td>LOG4QT_CONFIGURATORCLASS</td>
<td>指定用于初始化程序包的配置程序类</td>
</tr>
</tbody>
</table>
<h2 id="使用-QSettings-配置"><a href="#使用-QSettings-配置" class="headerlink" title="使用 QSettings 配置"></a>使用 QSettings 配置</h2><p>LOG4QT_CONFIGURATION指定的配置文件，如果不存在，则尝试读取 QSettings 中的 Log4Qt/Properties。</p>
<p>具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/QSettingsInit" target="_blank" rel="noopener">QSettingsInit</a></p>
<p>下面通过代码设置 QSettings 中的 Log4Qt/Properties 中的内容。</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">void MyApplication::setupLog4Qt()</span><br><span class="line">&#123;</span><br><span class="line">    QSettings s;</span><br><span class="line"></span><br><span class="line">    QStringList groups = s.childGroups();</span><br><span class="line">    if (!groups.contains(<span class="string">"Log4Qt"</span>)) &#123;</span><br><span class="line">        // 将 Log4Qt 的日志级别设置为 INFO</span><br><span class="line">        s.beginGroup(<span class="string">"Log4Qt"</span>);</span><br><span class="line">        s.<span class="built_in">set</span>Value(<span class="string">"Debug"</span>, <span class="string">"INFO"</span>);</span><br><span class="line"></span><br><span class="line">        // 配置日志输出至文件 logger.<span class="keyword">log</span>，使用级别 INFO</span><br><span class="line">        s.beginGroup(<span class="string">"Properties"</span>);</span><br><span class="line">        s.<span class="built_in">set</span>Value(<span class="string">"log4j.rootLogger"</span>, <span class="string">"INFO, logFile"</span>);</span><br><span class="line">        s.<span class="built_in">set</span>Value(<span class="string">"log4j.appender.logFile"</span>, <span class="string">"org.apache.log4j.FileAppender"</span>);</span><br><span class="line">        s.<span class="built_in">set</span>Value(<span class="string">"log4j.appender.logFile.file"</span>, <span class="string">"logger.log"</span>);</span><br><span class="line">        s.<span class="built_in">set</span>Value(<span class="string">"log4j.appender.logFile.layout"</span>, <span class="string">"org.apache.log4j.TTCCLayout"</span>);</span><br><span class="line">        s.<span class="built_in">set</span>Value(<span class="string">"log4j.appender.logFile.layout.dateFormat"</span>, <span class="string">"ISO8601"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用-log4qt-properties-配置"><a href="#使用-log4qt-properties-配置" class="headerlink" title="使用 log4qt.properties 配置"></a>使用 log4qt.properties 配置</h2><p>读取 log4qt.properties 文件中的内容。</p>
<p>具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/PropertiesInit" target="_blank" rel="noopener">PropertiesInit</a></p>
<h3 id="在代码中配置"><a href="#在代码中配置" class="headerlink" title="在代码中配置"></a>在代码中配置</h3><p>首先编写<code>.properties</code>文件，扩展最好不要叫<code>.properties</code>，现在取名为<code>log4qt.conf</code>文件，编写需要的配置内容。</p>
<p>最后在代码中指定配置文件:<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用指定的配置文件进行配置</span></span><br><span class="line">QString configFile =  QCoreApplication<span class="type">::applicationDirPath</span>() + <span class="string">"/log4qt.conf"</span>;</span><br><span class="line">qDebug() &lt;&lt; configFile;</span><br><span class="line"><span class="keyword">if</span> (QFile<span class="type">::exists</span>(configFile))</span><br><span class="line">    Log4Qt<span class="type">::PropertyConfigurator</span><span class="type">::configureAndWatch</span>(configFile);</span><br></pre></td></tr></table></figure></p>
<h3 id="放置工作目录"><a href="#放置工作目录" class="headerlink" title="放置工作目录"></a>放置工作目录</h3><p>如果上面的配置都不存在，则读取应用<strong>工作目录</strong>下的 log4qt.properties 文件。</p>
<h1 id="Log4Qt-日志级别"><a href="#Log4Qt-日志级别" class="headerlink" title="Log4Qt 日志级别"></a>Log4Qt 日志级别</h1><p>Log4Qt 定义了一系列的日志级别，每个级别都对应一种特定类型的消息事件。通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程。具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/LogLevel" target="_blank" rel="noopener">LogLevel</a></p>
<h2 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h2><p>日志级别被定义在 <code>Level</code> 类中，由 <code>Level::Value</code> 来表示（按照严重性递增排序）：</p>
<table>
<thead>
<tr>
<th style="text-align:left">级别</th>
<th style="text-align:left">值</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>NULL_INT</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">用于未指定的级别</td>
</tr>
<tr>
<td style="text-align:left"><code>ALL_INT</code></td>
<td style="text-align:left">32</td>
<td style="text-align:left">所有级别（包括自定义级别）</td>
</tr>
<tr>
<td style="text-align:left"><code>TRACE_INT</code></td>
<td style="text-align:left">64</td>
<td style="text-align:left">指比 DEBUG 更细粒度的信息事件</td>
</tr>
<tr>
<td style="text-align:left"><code>DEBUG_INT</code></td>
<td style="text-align:left">96</td>
<td style="text-align:left">指细粒度的信息事件（该事件对调试应用程序非常有用）</td>
</tr>
<tr>
<td style="text-align:left"><code>INFO_INT</code></td>
<td style="text-align:left">128</td>
<td style="text-align:left">指信息性消息（该消息突出显示了应用程序在粗粒度级别上的进展）</td>
</tr>
<tr>
<td style="text-align:left"><code>WARN_INT</code></td>
<td style="text-align:left">150</td>
<td style="text-align:left">指具有潜在危害的情况</td>
</tr>
<tr>
<td style="text-align:left"><code>ERROR_INT</code></td>
<td style="text-align:left">182</td>
<td style="text-align:left">指错误事件（该事件可能仍然允许应用程序继续运行）</td>
</tr>
<tr>
<td style="text-align:left"><code>FATAL_INT</code></td>
<td style="text-align:left">214</td>
<td style="text-align:left">指非常严重的错误事件（该事件可能导致应用程序中止）</td>
</tr>
<tr>
<td style="text-align:left"><code>OFF_INT</code></td>
<td style="text-align:left">255</td>
<td style="text-align:left">最高等级，用于关闭日志记录</td>
</tr>
</tbody>
</table>
<p>虽然有这么多级别，但 Log4Qt 只建议使用四个级别，分别是：<code>DEBUG</code>、<code>INFO</code>、<code>WARN</code>、<code>ERROR</code>。</p>
<h2 id="日志级别的工作方式"><a href="#日志级别的工作方式" class="headerlink" title="日志级别的工作方式"></a>日志级别的工作方式</h2><p>关于日志级别，Log4Qt 有一个核心规则：</p>
<blockquote>
<p>ALL &lt; TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL &lt; OFF</p>
</blockquote>
<p>如果 p &gt;= q，则在具有级别 q 的 Logger 中，会启用对级别 p 的日志请求。</p>
<p>要设置日志的级别，需要使用 <code>Logger::setLevel(Level level)</code>。一旦设置，除 level 本身之外，比 level 高的级别日志也会被打印。</p>
<p>假如，要打印 level &gt;= WARN 的消息，可以使用下述方式：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/basicconfigurator.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logger.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/level.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一个简单的基础配置</span></span><br><span class="line"><span class="symbol">    Log4Qt:</span>:<span class="symbol">BasicConfigurator::</span>configure();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 rootLogger</span></span><br><span class="line"><span class="symbol">    Log4Qt:</span>:Logger* logger = <span class="symbol">Log4Qt::</span><span class="symbol">Logger::</span>rootLogger();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置日志级别为 WARN</span></span><br><span class="line">    logger-&gt;setLevel(<span class="symbol">Log4Qt::</span><span class="symbol">Level::</span>WARN_INT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印消息</span></span><br><span class="line">    logger-&gt;trace(<span class="string">"This is a trace message."</span>);</span><br><span class="line">    logger-&gt;debug(<span class="string">"This is a debug message."</span>);</span><br><span class="line">    logger-&gt;info(<span class="string">"This is a info message."</span>);</span><br><span class="line">    logger-&gt;warn(<span class="string">"This is a warn message."</span>);</span><br><span class="line">    logger-&gt;error(<span class="string">"This is a error message."</span>);</span><br><span class="line">    logger-&gt;fatal(<span class="string">"This is a fatal message."</span>);</span><br><span class="line"></span><br><span class="line">    return a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，输出如下：</p>
<blockquote>
<p>19 [0x000001643d8cfb90] WARN root - This is a warn message.<br>20 [0x000001643d8cfb90] ERROR root - This is a error message.<br>20 [0x000001643d8cfb90] FATAL root - This is a fatal message.</p>
</blockquote>
<p>除了 WARN 之外，级别比它高的信息也被输出了，而级别比它低的没有被输出。</p>
<h2 id="使用配置文件设置级别"><a href="#使用配置文件设置级别" class="headerlink" title="使用配置文件设置级别"></a>使用配置文件设置级别</h2><p>Log4Qt 提供了基于配置文件的级别设置，当想要更改调试级别时，无需再去更改源代码。</p>
<p><strong>注意：</strong> 出于兼容性考虑，Log4j 中的的条目依然会被识别，所以 Log4Qt 中的配置完全可以参考 Log4j 来写。</p>
<p>Log4j 根配置语法：</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lo<span class="name">g4</span>j.rootLogger = [ level ] , appe<span class="symbol">nderName1</span>, appe<span class="symbol">nderName2</span>, …</span><br></pre></td></tr></table></figure>
<ul>
<li>level：日志的级别（例如：DEBUG、INFO，也包含自定义级别）。通过在这里定义的级别，可以控制到应用程序中相应级别的日志信息的开关。</li>
<li>appenderName：指定日志信息的输出地（例如：CONSOLE、FILE），可以同时指定多个。</li>
</ul>
<p>编写一个配置文件 - <code>log4qt.properties</code>，执行与上例中使用 <code>logger-&gt;setLevel(Log4Qt::Level::WARN_INT)</code> 相同的任务：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义 rootLogger</span></span><br><span class="line"><span class="attr">log</span>=E:/</span><br><span class="line"><span class="attr">log4j.rootLogger</span>=WARN, FILE</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 fileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.FILE</span>=org.apache.log4j.FileAppender</span><br><span class="line"><span class="attr">log4j.appender.FILE.File</span>=<span class="variable">$&#123;log&#125;</span>/out.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为 fileAppender 定义 layout</span></span><br><span class="line"><span class="attr">log4j.appender.FILE.layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line"><span class="attr">log4j.appender.FILE.layout.conversionPattern</span>=%m%n</span><br></pre></td></tr></table></figure>
<p>然后，使用下面的程序：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QFile&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logger.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/propertyconfigurator.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用配置文件中的数据</span></span><br><span class="line">    QString configFile = <span class="symbol">QCoreApplication::</span>applicationDirPath() + <span class="string">"/log4qt.properties"</span>;</span><br><span class="line">    if (<span class="symbol">QFile::</span>exists(configFile))</span><br><span class="line"><span class="symbol">        Log4Qt:</span>:<span class="symbol">PropertyConfigurator::</span>configureAndWatch(configFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 rootLogger</span></span><br><span class="line"><span class="symbol">    Log4Qt:</span>:Logger* logger = <span class="symbol">Log4Qt::</span><span class="symbol">Logger::</span>rootLogger();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印消息</span></span><br><span class="line">    logger-&gt;trace(<span class="string">"This is a trace message."</span>);</span><br><span class="line">    logger-&gt;debug(<span class="string">"This is a debug message."</span>);</span><br><span class="line">    logger-&gt;info(<span class="string">"This is a info message."</span>);</span><br><span class="line">    logger-&gt;warn(<span class="string">"This is a warn message."</span>);</span><br><span class="line">    logger-&gt;error(<span class="string">"This is a error message."</span>);</span><br><span class="line">    logger-&gt;fatal(<span class="string">"This is a fatal message."</span>);</span><br><span class="line"></span><br><span class="line">    return a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，会生成一个日志文件（路径为 <code>E:/out.log</code>），内容为：</p>
<blockquote>
<p>This is a warn message.<br>This is a error message.<br>This is a fatal message.</p>
</blockquote>
<p>可以看到，输出的信息和上述示例中的一样。但是，使用配置文件显然更加灵活。</p>
<h1 id="Log4Qt-日志格式化"><a href="#Log4Qt-日志格式化" class="headerlink" title="Log4Qt 日志格式化"></a>Log4Qt 日志格式化</h1><p>Log4Qt 提供了各种布局对象，每个对象可以根据不同的布局对日志数据进行格式化。</p>
<p>通过使用这些 Layout，我们可以根据自己的喜好来格式化日志输出，自由指定日志级别、线程名称、Logger 名称、日期时间、类别等信息。</p>
<h2 id="继承关系图"><a href="#继承关系图" class="headerlink" title="继承关系图"></a>继承关系图</h2><p>Log4Qt::Layout 继承关系图：</p>
<p><img src="/img/qt/719_672_2b2.jpg" alt="img"></p>
<p>在该层次结构中，顶级类是 Layout，它是 Log4Qt API 中所有其他布局类的基类。</p>
<ul>
<li>PatternLayout：根据一个模式字符串输出日志事件</li>
<li>SimpleLayout：输出日志事件的级别和消息</li>
<li>TTCCLayout：输出日志事件的时间、线程名称、Logger 名称和嵌套的诊断上下文信息</li>
</ul>
<p>这些类扩展了 Layout，并根据提供的模式重写了 <code>format()</code> 方法来构造日志信息。</p>
<p>在内部，PatternLayout 和 TTCCLayout 通过 PatternFormatter 来实现格式化。当 PatternFormatter 解析模式字符串时，它会根据发现的信息创建了一个 PatternConverter 链，每个 PatternConverter 会处理 LoggingEvent 的某个成员。</p>
<h2 id="转换字符"><a href="#转换字符" class="headerlink" title="转换字符"></a>转换字符</h2><p>转换说明符以百分号（<code>%</code>）开始，后跟转换字符。</p>
<blockquote>
<p>转换字符：用于指定数据的类型，例如：类别、级别、日期、线程名称。</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">转换字符</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>c{section_count}</code></td>
<td style="text-align:left">Logger 名称。参数 <code>section_count</code> 可选，从 logger 名称的末尾处计数，分隔符是 <code>&quot;::&quot;</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>d{format_string}</code></td>
<td style="text-align:left">日期。参数 <code>format_string</code> 可选，被用于 <code>QDateTime::toString()</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>m</code></td>
<td style="text-align:left">消息</td>
</tr>
<tr>
<td style="text-align:left"><code>p</code></td>
<td style="text-align:left">级别名称</td>
</tr>
<tr>
<td style="text-align:left"><code>r</code></td>
<td style="text-align:left">启动应用程序的相对日期/时间</td>
</tr>
<tr>
<td style="text-align:left"><code>t</code></td>
<td style="text-align:left">线程名称</td>
</tr>
<tr>
<td style="text-align:left"><code>x</code></td>
<td style="text-align:left">NDC（嵌套的诊断上下文）名称</td>
</tr>
<tr>
<td style="text-align:left"><code>X</code></td>
<td style="text-align:left">MDC（映射的诊断上下文）名称</td>
</tr>
<tr>
<td style="text-align:left"><code>F</code></td>
<td style="text-align:left">文件名称</td>
</tr>
<tr>
<td style="text-align:left"><code>M</code></td>
<td style="text-align:left">方法名称</td>
</tr>
<tr>
<td style="text-align:left"><code>L</code></td>
<td style="text-align:left">行号</td>
</tr>
<tr>
<td style="text-align:left"><code>l</code></td>
<td style="text-align:left">位置信息</td>
</tr>
<tr>
<td style="text-align:left"><code>n</code></td>
<td style="text-align:left">平台相关的行分隔符（Windows：<code>\r\n</code>，Linux：<code>\n</code>）</td>
</tr>
<tr>
<td style="text-align:left"><code>%</code></td>
<td style="text-align:left">序列 <code>%%</code> 输出一个百分号 <code>%</code></td>
</tr>
</tbody>
</table>
<h2 id="PatternLayout"><a href="#PatternLayout" class="headerlink" title="PatternLayout"></a>PatternLayout</h2><p>如果想生成基于模式的特定格式的日志信息，那么可以使用 PatternLayout 来进行格式化。具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/PatternLayout" target="_blank" rel="noopener">PatternLayout</a></p>
<h3 id="使用-ConversionPattern"><a href="#使用-ConversionPattern" class="headerlink" title="使用 ConversionPattern"></a>使用 ConversionPattern</h3><p>枚举 ConversionPattern 定义了两个常用的模式：</p>
<table>
<thead>
<tr>
<th style="text-align:left">枚举</th>
<th style="text-align:left">模式字符串</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>DEFAULT_CONVERSION_PATTERN</code></td>
<td style="text-align:left"><code>&quot;%m,%n&quot;</code></td>
</tr>
<tr>
<td style="text-align:left"><code>TTCC_CONVERSION_PATTERN</code></td>
<td style="text-align:left"><code>&quot;%r [%t] %p %c %x - %m%n&quot;</code></td>
</tr>
</tbody>
</table>
<p>创建一个 PatternLayout：</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;QCoreApplication&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/logger.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/patternlayout.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/consoleappender.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/loggerrepository.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 PatternLayout（根据模式字符串输出日志事件）</span></span><br><span class="line">    Log4Qt::Logger *logger = Log4Qt::Logger::rootLogger();</span><br><span class="line">    Log4Qt::PatternLayout *layout = <span class="keyword">new</span> Log4Qt::PatternLayout();</span><br><span class="line">    layout-&gt;setHeader(<span class="string">"Header"</span>);  <span class="comment">// 设置标头信息</span></span><br><span class="line">    layout-&gt;setFooter(<span class="string">"Footer"</span>);  <span class="comment">// 设置页脚信息</span></span><br><span class="line">    layout-&gt;setName(<span class="string">"My Layout"</span>);</span><br><span class="line">    <span class="comment">// layout-&gt;setConversionPattern(Log4Qt::PatternLayout::TTCC_CONVERSION_PATTERN);</span></span><br><span class="line">    layout-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 ConsoleAppender（将日志内容输出到控制台上）</span></span><br><span class="line">    Log4Qt::ConsoleAppender *appender = <span class="keyword">new</span> Log4Qt::ConsoleAppender(layout, Log4Qt::ConsoleAppender::STDOUT_TARGET);</span><br><span class="line">    appender-&gt;setName(<span class="string">"My Appender"</span>);</span><br><span class="line">    appender-&gt;activateOptions();</span><br><span class="line">    logger-&gt;addAppender(appender);</span><br><span class="line"></span><br><span class="line">    logger-&gt;setLevel(Log4Qt::Level::DEBUG_INT);</span><br><span class="line">    logger-&gt;debug(<span class="string">"Hello, Log4Qt!"</span>);</span><br><span class="line"></span><br><span class="line">    logger-&gt;removeAllAppenders();</span><br><span class="line">    logger-&gt;loggerRepository()-&gt;shutdown();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong> 除正文之外，还可以为日志消息指定标头和页脚。布局对象的内容类型默认为 <code>text/plain</code>，如果要自定义布局并制定其他类型，需要重写 Layout 的 <code>contentType()</code> 方法。</p>
<p>默认情况下，转换模式为 <code>DEFAULT_CONVERSION_PATTERN</code>，输出如下：</p>
<blockquote>
<p>Header<br>Hello, Log4Qt!<br>Footer</p>
</blockquote>
<p>现在，打开程序中的注释部分：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layout-&gt;setConversionPattern(<span class="name">Log4Qt</span>:<span class="symbol">:PatternLayout</span>:<span class="symbol">:TTCC_CONVERSION_PATTERN</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>不仅会输出消息内容，还会输出启动时间、线程名称、logger 名称：</p>
<blockquote>
<p>25 [0x0000019586423050] DEBUG root - Hello, Log4Qt!</p>
</blockquote>
<p>实际上，这采用的是和 TTCCLayout 相同的模式，从名字就可以看出。</p>
<h3 id="自定义模式字符串"><a href="#自定义模式字符串" class="headerlink" title="自定义模式字符串"></a>自定义模式字符串</h3><p>和其他布局相比，PatternLayout 很大的一个优势在于灵活。</p>
<p>除了上述方式之外，还可以通过自定义模式字符串来指定日期时间：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layout-&gt;setConversionPattern(<span class="string">"%d&#123;yyyy-MM-dd hh:mm:ss&#125; - %m%n"</span>);</span><br></pre></td></tr></table></figure>
<p>运行程序，输出如下：</p>
<blockquote>
<p>2017-12-22 15:21:52 - Hello, Log4Qt!</p>
</blockquote>
<p>除此之外，还可以额外为消息添加一些文本：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layout-&gt;setConversionPattern(<span class="string">"The output message is: %m%n"</span>);</span><br></pre></td></tr></table></figure>
<p>运行程序，输出如下：</p>
<blockquote>
<p>The output message is: Hello, Log4Qt!</p>
</blockquote>
<p>通过这种方式，我们可以自由地在转换模式中插入任何文本，使用起来相当方便。</p>
<h2 id="SimpleLayout"><a href="#SimpleLayout" class="headerlink" title="SimpleLayout"></a>SimpleLayout</h2><p>和 PatternLayout 不同的是，SimpleLayout 只包含了日志的级别和消息内容。具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/SimpleLayout" target="_blank" rel="noopener">SimpleLayout</a></p>
<p>创建一个 SimpleLayout：</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;QCoreApplication&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/logger.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/simplelayout.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/consoleappender.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/loggerrepository.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 SimpleLayout（输出日志的级别和消息内容）</span></span><br><span class="line">    Log4Qt::Logger *logger = Log4Qt::Logger::rootLogger();</span><br><span class="line">    Log4Qt::SimpleLayout *layout = <span class="keyword">new</span> Log4Qt::SimpleLayout();</span><br><span class="line">    layout-&gt;setName(<span class="string">"My Layout"</span>);</span><br><span class="line">    layout-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 ConsoleAppender（将日志内容输出到控制台上）</span></span><br><span class="line">    Log4Qt::ConsoleAppender *appender = <span class="keyword">new</span> Log4Qt::ConsoleAppender(layout, Log4Qt::ConsoleAppender::STDOUT_TARGET);</span><br><span class="line">    appender-&gt;setName(<span class="string">"My Appender"</span>);</span><br><span class="line">    appender-&gt;activateOptions();</span><br><span class="line">    logger-&gt;addAppender(appender);</span><br><span class="line"></span><br><span class="line">    logger-&gt;setLevel(Log4Qt::Level::DEBUG_INT);</span><br><span class="line">    logger-&gt;debug(<span class="string">"Hello, Log4Qt!"</span>);</span><br><span class="line"></span><br><span class="line">    logger-&gt;removeAllAppenders();</span><br><span class="line">    logger-&gt;loggerRepository()-&gt;shutdown();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，输出如下：</p>
<blockquote>
<p>DEBUG - Hello, Log4Qt!</p>
</blockquote>
<p>可以看到，只包含了日志的级别和消息内容，并没有线程、Logger 等信息。</p>
<h2 id="TTCCLayout"><a href="#TTCCLayout" class="headerlink" title="TTCCLayout"></a>TTCCLayout</h2><p>TTCC 布局格式由下列字段组成：</p>
<ul>
<li>Time：时间</li>
<li>Thread：线程</li>
<li>Category：类别</li>
<li>nested diagnostic Context information：嵌套的诊断上下文信息</li>
</ul>
<p>TTCC 是它们全拼的缩写，因此而得名。另外，这四个字段中的每一个都可以单独启用或禁用。</p>
<p>时间格式取决于 DateFormat：</p>
<table>
<thead>
<tr>
<th style="text-align:left">枚举</th>
<th style="text-align:left">日期格式字符串</th>
<th style="text-align:left">将被格式化为</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>NONE</code></td>
<td style="text-align:left"><code>&quot;NONE&quot;</code></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left"><code>ISO8601</code></td>
<td style="text-align:left"><code>&quot;ISO8601&quot;</code></td>
<td style="text-align:left"><code>yyyy-MM-dd hh:mm:ss.zzz</code></td>
</tr>
<tr>
<td style="text-align:left"><code>ABSOLUTE</code></td>
<td style="text-align:left"><code>&quot;ABSOLUTE&quot;</code></td>
<td style="text-align:left"><code>HH:mm:ss.zzz</code></td>
</tr>
<tr>
<td style="text-align:left"><code>DATE</code></td>
<td style="text-align:left"><code>&quot;DATE&quot;</code></td>
<td style="text-align:left"><code>MMM YYYY HH:mm:ss.zzzz</code></td>
</tr>
<tr>
<td style="text-align:left"><code>RELATIVE</code></td>
<td style="text-align:left"><code>&quot;RELATIVE&quot;</code></td>
<td style="text-align:left">从程序开始时的毫秒数</td>
</tr>
</tbody>
</table>
<p>具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/TTCCLayout" target="_blank" rel="noopener">TTCCLayout</a></p>
<p>创建一个 TTCCLayout：</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;QCoreApplication&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/logger.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/ttcclayout.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/consoleappender.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/loggerrepository.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 TTCCLayout（输出时间、线程、Logger 以及消息内容）</span></span><br><span class="line">    Log4Qt::Logger *logger = Log4Qt::Logger::rootLogger();</span><br><span class="line">    Log4Qt::TTCCLayout *layout = <span class="keyword">new</span> Log4Qt::TTCCLayout();</span><br><span class="line">    layout-&gt;setName(<span class="string">"My Layout"</span>);</span><br><span class="line">    <span class="comment">// layout-&gt;setCategoryPrefixing(false); // 禁用 logger 名称</span></span><br><span class="line">    <span class="comment">// layout-&gt;setContextPrinting(false); // 禁用嵌套的上下文信息</span></span><br><span class="line">    <span class="comment">// layout-&gt;setThreadPrinting(false); // 禁用线程名</span></span><br><span class="line">    <span class="comment">// layout-&gt;setDateFormat("ISO8601"); // 设置日期格式</span></span><br><span class="line">    layout-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 ConsoleAppender（将日志内容输出到控制台上）</span></span><br><span class="line">    Log4Qt::ConsoleAppender *appender = <span class="keyword">new</span> Log4Qt::ConsoleAppender(layout, Log4Qt::ConsoleAppender::STDOUT_TARGET);</span><br><span class="line">    appender-&gt;setName(<span class="string">"My Appender"</span>);</span><br><span class="line">    appender-&gt;activateOptions();</span><br><span class="line">    logger-&gt;addAppender(appender);</span><br><span class="line"></span><br><span class="line">    logger-&gt;setLevel(Log4Qt::Level::DEBUG_INT);</span><br><span class="line">    logger-&gt;debug(<span class="string">"Hello, Log4Qt!"</span>);</span><br><span class="line"></span><br><span class="line">    logger-&gt;removeAllAppenders();</span><br><span class="line">    logger-&gt;loggerRepository()-&gt;shutdown();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，输出如下：</p>
<blockquote>
<p>20 [0x00000280b2afe920] DEBUG root - Hello, Log4Qt!</p>
</blockquote>
<p>倘若要输出日期时间，并且想禁用其中的一些信息，可以根据注释部分进行控制。打开注释部分，再次运行程序，输出如下：</p>
<blockquote>
<p>2017-12-22 17:33:28.054 DEBUG - Hello, Log4Qt!</p>
</blockquote>
<p>可以看到，新增了日期时间，并且 Logger、线程也被禁用了。</p>
<h1 id="Log4Qt-输出重定向"><a href="#Log4Qt-输出重定向" class="headerlink" title="Log4Qt 输出重定向"></a>Log4Qt 输出重定向</h1><p>Log4Qt 支持自定义输出，格式化由 Layout 完成，输出地则由 Appender 控制。</p>
<p>Appender 表示将日志输出到什么地方，常见的 Appender 有 Console（控制台）、File（文件）、数据库等等。</p>
<h2 id="继承关系图-1"><a href="#继承关系图-1" class="headerlink" title="继承关系图"></a>继承关系图</h2><p><code>Log4Qt::Appender</code> 继承关系图：</p>
<p><img src="/img/qt/958_927_afc.jpg" alt="img"></p>
<p>在该层次结构中，顶级类是 Appender，它是 Log4Qt API 中所有其他输出地的基类。</p>
<ul>
<li>AppenderSkeleton：实现一般 Appender 的功能</li>
</ul>
<p>通常来讲，自定义输出需要继承 AppenderSkeleton，并实现其中的几个方法。</p>
<ul>
<li>DebugAppender：将日志事件附加到特定于平台的调试输出（在 Windows 上附加到 Debugger，其它系统上附加到 stderr）</li>
<li>ListAppender：将日志记录事件追加到列表中，供后续处理。</li>
<li>NullAppender：忽略所有要附加的请求</li>
</ul>
<p>当然，最常用的是以下几个：</p>
<ul>
<li>WriterAppender：将日志事件附加到 QTextStream<ul>
<li>ConsoleAppender：附加到 stdout 或 stderr</li>
<li>FileAppender：将日志事件附加到文件</li>
<li>DailyRollingFileAppender：以指定的频率滚动日志文件</li>
<li>RollingFileAppender：在达到特定大小时滚动日志文件</li>
</ul>
</li>
</ul>
<h2 id="输出到控制台"><a href="#输出到控制台" class="headerlink" title="输出到控制台"></a>输出到控制台</h2><p>在项目开发阶段，往往需要在控制台中输出日志的内容，这对于调试代码来说非常方便。</p>
<p>具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/ConsoleAppender" target="_blank" rel="noopener">ConsoleAppender</a></p>
<p>这时，ConsoleAppender 会十分有用：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logger.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logmanager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/ttcclayout.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/consoleappender.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/loggerrepository.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 TTCCLayout（输出时间、线程、Logger 以及消息内容）</span></span><br><span class="line"><span class="symbol">    Log4Qt:</span>:Logger *logger = <span class="symbol">Log4Qt::</span><span class="symbol">Logger::</span>rootLogger();</span><br><span class="line"><span class="symbol">    Log4Qt:</span>:TTCCLayout *layout = new <span class="symbol">Log4Qt::</span>TTCCLayout();</span><br><span class="line">    layout-&gt;setName(<span class="string">"My Layout"</span>);</span><br><span class="line">    layout-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 ConsoleAppender（将日志内容输出到控制台上）</span></span><br><span class="line"><span class="symbol">    Log4Qt:</span>:ConsoleAppender *appender = new <span class="symbol">Log4Qt::</span>ConsoleAppender(layout, <span class="symbol">Log4Qt::</span><span class="symbol">ConsoleAppender::</span>STDOUT_TARGET);</span><br><span class="line">    appender-&gt;setName(<span class="string">"My Appender"</span>);</span><br><span class="line">    appender-&gt;activateOptions();</span><br><span class="line">    <span class="comment">// 在 logger 上添加 appender</span></span><br><span class="line">    logger-&gt;addAppender(appender);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置级别为 DEBUG</span></span><br><span class="line">    logger-&gt;setLevel(<span class="symbol">Log4Qt::</span><span class="symbol">Level::</span>DEBUG_INT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出信息</span></span><br><span class="line">    logger-&gt;debug(<span class="string">"Hello, Log4Qt!"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭 logger</span></span><br><span class="line">    logger-&gt;removeAllAppenders();</span><br><span class="line">    logger-&gt;loggerRepository()-&gt;shutdown();</span><br><span class="line"></span><br><span class="line">    return a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中，Logger 用于提供日志记录服务，Layout 用于控制消息的输出格式。</p>
<p>在程序的最后，记得关闭 Logger - 删除之前添加的所有 Appender，并关闭 LoggerRepository（以释放 Appender 持有的资源）。</p>
<h2 id="输出到文件"><a href="#输出到文件" class="headerlink" title="输出到文件"></a>输出到文件</h2><p>但在实际的产品阶段，我们更希望将日志输出到指定的文件中，以便后续跟踪程序的行为、定位问题。</p>
<p>这时，就需要用到 FileAppender：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logger.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logmanager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/ttcclayout.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/fileappender.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/loggerrepository.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 TTCCLayout（输出时间、线程、Logger 以及消息内容）</span></span><br><span class="line"><span class="symbol">    Log4Qt:</span>:Logger *logger = <span class="symbol">Log4Qt::</span><span class="symbol">Logger::</span>rootLogger();</span><br><span class="line"><span class="symbol">    Log4Qt:</span>:TTCCLayout *layout = new <span class="symbol">Log4Qt::</span>TTCCLayout();</span><br><span class="line">    layout-&gt;setName(<span class="string">"My Layout"</span>);</span><br><span class="line">    layout-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 FileAppender（将日志内容输出到文件中）</span></span><br><span class="line">    QString file = <span class="symbol">QCoreApplication::</span>applicationDirPath() + <span class="string">"/debug.log"</span>;</span><br><span class="line"><span class="symbol">    Log4Qt:</span>:FileAppender *appender = new <span class="symbol">Log4Qt::</span>FileAppender(layout, file, true);</span><br><span class="line">    appender-&gt;setName(<span class="string">"My Appender"</span>);</span><br><span class="line">    appender-&gt;activateOptions();</span><br><span class="line">    <span class="comment">// 在 logger 上添加 appender</span></span><br><span class="line">    logger-&gt;addAppender(appender);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置级别为 DEBUG</span></span><br><span class="line">    logger-&gt;setLevel(<span class="symbol">Log4Qt::</span><span class="symbol">Level::</span>DEBUG_INT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出信息</span></span><br><span class="line">    logger-&gt;debug(<span class="string">"Hello, Log4Qt!"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭 logger</span></span><br><span class="line">    logger-&gt;removeAllAppenders();</span><br><span class="line">    logger-&gt;loggerRepository()-&gt;shutdown();</span><br><span class="line"></span><br><span class="line">    return a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在构造 FileAppender 时，可以用第三个参数指定文件的打开方式，true 表示以 Append（追加）方式打开，false 表示以 Truncate（截断） 方式打开。除此之外，也可以使用 <code>setAppendFile(bool append)</code>。</p>
<p>虽然 FileAppender 提供了对日志文件的支持，但都是一些最基本的操作。倘若要实现周期性生成日志文件、限制文件大小和个数等一些更高级的控制，则需要用到其派生类 - DailyRollingFileAppender 和 RollingFileAppender。</p>
<h2 id="以指定的频率滚动日志文件"><a href="#以指定的频率滚动日志文件" class="headerlink" title="以指定的频率滚动日志文件"></a>以指定的频率滚动日志文件</h2><p>为了根据日期时间来定位日志，使其更加清晰易查，可以周期性生成日志文件（例如：<code>DAILY_ROLLOVER</code> 指定每天生成一个新文件），这由 DailyRollingFileAppender 来完成。</p>
<p>具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/DailyRollingFileAppender" target="_blank" rel="noopener">DailyRollingFileAppender</a></p>
<p>DatePattern 用于指定日期模式（频率），其有效值包括：</p>
<table>
<thead>
<tr>
<th style="text-align:left">枚举</th>
<th style="text-align:left">模式字符串</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>MINUTELY_ROLLOVER</code></td>
<td style="text-align:left"><code>&quot;&#39;.&#39;yyyy-MM-dd-hh-mm&quot;</code></td>
<td style="text-align:left">每分钟</td>
</tr>
<tr>
<td style="text-align:left"><code>HOURLY_ROLLOVER</code></td>
<td style="text-align:left"><code>&quot;&#39;.&#39;yyyy-MM-dd-hh&quot;</code></td>
<td style="text-align:left">每小时</td>
</tr>
<tr>
<td style="text-align:left"><code>HALFDAILY_ROLLOVER</code></td>
<td style="text-align:left"><code>&quot;&#39;.&#39;yyyy-MM-dd-a&quot;</code></td>
<td style="text-align:left">每半天</td>
</tr>
<tr>
<td style="text-align:left"><code>DAILY_ROLLOVER</code>（默认值）</td>
<td style="text-align:left"><code>&quot;&#39;.&#39;yyyy-MM-dd&quot;</code></td>
<td style="text-align:left">每天</td>
</tr>
<tr>
<td style="text-align:left"><code>WEEKLY_ROLLOVER</code></td>
<td style="text-align:left"><code>&quot;&#39;.&#39;yyyy-ww&quot;</code></td>
<td style="text-align:left">每周</td>
</tr>
<tr>
<td style="text-align:left"><code>MONTHLY_ROLLOVER</code></td>
<td style="text-align:left"><code>&quot;&#39;.&#39;yyyy-MM&quot;</code></td>
<td style="text-align:left">每月</td>
</tr>
</tbody>
</table>
<p><strong>注意：</strong> DatePattern 中不用处理的文字要放到单引号（<code>&#39;&#39;</code>）中，如上面的 <code>&#39;.&#39;</code>。</p>
<p>为了方便测试，以最短的间隔（每分钟）生成日志文件：</p>
<p>可以看到，文件名后自动加上了日期时间，很容易区分。</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;QCoreApplication&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QThread&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QtDebug&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/logger.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/ttcclayout.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/dailyrollingfileappender.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/loggerrepository.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"********** Begin **********"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 rootLogger 打印日志</span></span><br><span class="line">    Log4Qt::Logger *logger = Log4Qt::Logger::rootLogger();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 TTCCLayout（输出时间、线程、Logger 以及消息内容）</span></span><br><span class="line">    Log4Qt::TTCCLayout *layout = <span class="keyword">new</span> Log4Qt::TTCCLayout();</span><br><span class="line">    layout-&gt;setName(<span class="string">"My Layout"</span>);</span><br><span class="line">    layout-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 DailyRollingFileAppender（以指定的频率滚动）</span></span><br><span class="line">    Log4Qt::DailyRollingFileAppender *appender = <span class="keyword">new</span> Log4Qt::DailyRollingFileAppender();</span><br><span class="line">    appender-&gt;setName(<span class="string">"My Appender"</span>);</span><br><span class="line">    appender-&gt;setLayout(layout);</span><br><span class="line">    appender-&gt;setFile(QCoreApplication::applicationDirPath() + <span class="string">"/log.out"</span>);</span><br><span class="line">    appender-&gt;setImmediateFlush(<span class="keyword">true</span>);  <span class="comment">// 立即刷新</span></span><br><span class="line">    appender-&gt;setThreshold(Log4Qt::Level::INFO_INT);  <span class="comment">// 设置阈值级别为 INFO</span></span><br><span class="line">    appender-&gt;setAppendFile(<span class="keyword">true</span>);  <span class="comment">// 追加的方式</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等价于 appender-&gt;setDatePattern("'.'yyyy-MM-dd-hh-mm");</span></span><br><span class="line">    appender-&gt;setDatePattern(Log4Qt::DailyRollingFileAppender::MINUTELY_ROLLOVER); <span class="comment">// 日期模式</span></span><br><span class="line"></span><br><span class="line">    appender-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在 logger 上添加 appender</span></span><br><span class="line">    logger-&gt;addAppender(appender);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置级别为 DEBUG</span></span><br><span class="line">    logger-&gt;setLevel(Log4Qt::Level::DEBUG_INT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (count &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="comment">// 输出信息</span></span><br><span class="line">        logger-&gt;info(<span class="string">"Hello, Log4Qt!"</span>);</span><br><span class="line">        QThread::sleep(<span class="number">30</span>);</span><br><span class="line">        ++count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭 logger</span></span><br><span class="line">    logger-&gt;removeAllAppenders();</span><br><span class="line">    logger-&gt;loggerRepository()-&gt;shutdown();</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"********** End **********"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要设置频率，除了可以使用 <code>setDatePattern(DatePattern datePattern)</code> 指定一个枚举值进行设置，还可以在 <code>DailyRollingFileAppender</code> 的构造函数中指定一个模式字符串之外。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Log4Qt::DailyRollingFileAppender(layout, <span class="keyword">file</span>, <span class="string">"'.'yyyy-MM-dd-hh-mm"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="在达到特定大小时滚动日志文件"><a href="#在达到特定大小时滚动日志文件" class="headerlink" title="在达到特定大小时滚动日志文件"></a>在达到特定大小时滚动日志文件</h2><p>随着时间的推移，日志文件会越来越多、越来越大，倘若不进行数量和大小上的限制，最后日志将会占满整个硬盘。</p>
<p>RollingFileAppender 使用 MaxFileSize 和 MaxBackupIndex 来限制日志文件的大小和数量。当产生多个日志文件时，会在日志名称后面加上“.1”、“.2”、… 这样的后缀。</p>
<p>具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/RollingFileAppender" target="_blank" rel="noopener">RollingFileAppender</a></p>
<p>下面，来读取一个文件，并将其内容写入到我们的日志文件中：</p>
<p>在此过程中，限制每个日志文件的最大大小为 10 KB，最大文件数为 5 个：</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;QCoreApplication&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QtDebug&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/logger.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/ttcclayout.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/RollingFileAppender.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/loggerrepository.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;qt_windows.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QFile&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"********** Begin **********"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 rootLogger 打印日志</span></span><br><span class="line">    Log4Qt::Logger *logger = Log4Qt::Logger::rootLogger();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 TTCCLayout（输出时间、线程、Logger 以及消息内容）</span></span><br><span class="line">    Log4Qt::TTCCLayout *layout = <span class="keyword">new</span> Log4Qt::TTCCLayout();</span><br><span class="line">    layout-&gt;setName(<span class="string">"My Layout"</span>);</span><br><span class="line">    layout-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 RollingFileAppender（滚动多个文件）</span></span><br><span class="line">    Log4Qt::RollingFileAppender *appender = <span class="keyword">new</span> Log4Qt::RollingFileAppender();</span><br><span class="line">    appender-&gt;setName(<span class="string">"My Appender"</span>);</span><br><span class="line">    appender-&gt;setLayout(layout);</span><br><span class="line">    appender-&gt;setFile(QCoreApplication::applicationDirPath() + <span class="string">"/log.out"</span>);</span><br><span class="line">    appender-&gt;setImmediateFlush(<span class="keyword">true</span>);  <span class="comment">// 立即刷新</span></span><br><span class="line">    appender-&gt;setThreshold(Log4Qt::Level::INFO_INT);  <span class="comment">// 设置阈值级别为 INFO</span></span><br><span class="line">    appender-&gt;setAppendFile(<span class="keyword">true</span>);  <span class="comment">// 追加的方式</span></span><br><span class="line">    <span class="comment">// 等价于 appender-&gt;setMaximumFileSize(10 * 1024);</span></span><br><span class="line">    appender-&gt;setMaxFileSize(<span class="string">"10KB"</span>); <span class="comment">// 在滚动之前设置文件的最大大小</span></span><br><span class="line">    appender-&gt;setMaxBackupIndex(<span class="number">5</span>);  <span class="comment">// 设置备份索引</span></span><br><span class="line"></span><br><span class="line">    appender-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在 logger 上添加 appender</span></span><br><span class="line">    logger-&gt;addAppender(appender);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置级别为 DEBUG</span></span><br><span class="line">    logger-&gt;setLevel(Log4Qt::Level::DEBUG_INT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取文件，并写入日志</span></span><br><span class="line">    QString appPath = QCoreApplication::applicationDirPath();</span><br><span class="line">    QFile f(appPath + <span class="string">"/QtSrc.log"</span>);</span><br><span class="line">    <span class="keyword">if</span> (f.open(QIODevice::ReadOnly | QIODevice::Text)) &#123;</span><br><span class="line">        QTextStream in(&amp;f);</span><br><span class="line">        QString line;</span><br><span class="line">        <span class="keyword">while</span> (!in.atEnd()) &#123;</span><br><span class="line">            line = in.readLine();</span><br><span class="line">            logger-&gt;info(line);</span><br><span class="line">        &#125;</span><br><span class="line">        f.close();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"Open failed: "</span> &lt;&lt; f.errorString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭 logger</span></span><br><span class="line">    logger-&gt;removeAllAppenders();</span><br><span class="line">    logger-&gt;loggerRepository()-&gt;shutdown();</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"********** End **********"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="输出到数据库"><a href="#输出到数据库" class="headerlink" title="输出到数据库"></a>输出到数据库</h2><p>我们也可以将日志输出到指定的数据库中，以便后续跟踪程序的行为、定位问题。</p>
<p>这时，就需要用到 DatabaseAppender 。<strong>注意：编译Log4Qt时要启用它。</strong></p>
<p>数据库“输出源”<br>DatabaseAppender (append log event into sql table)<br>数据库“输出布局”<br>DatabaseLayout (put log event into sql table columns)</p>
<p>具体参见项目源码：<a href="https://github.com/myhhub/Log4Qt-project/tree/main/DatabaseAppender" target="_blank" rel="noopener">DatabaseAppender</a></p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;QCoreApplication&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QSqlQuery&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QtDebug&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/logger.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/logmanager.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/databaseappender.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/databaselayout.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;log4qt/loggerrepository.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据库连接名</span></span><br><span class="line">    <span class="keyword">const</span> QString connectionName = <span class="string">"MyConnection"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据库名</span></span><br><span class="line">    <span class="keyword">const</span> QString databaseName = <span class="string">"MyDB.db"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 表名</span></span><br><span class="line">    <span class="keyword">const</span> QString tableName = <span class="string">"MyTable"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 表中的字段名</span></span><br><span class="line">    <span class="keyword">const</span> QString timeStampField = <span class="string">"TimeStamp"</span>;</span><br><span class="line">    <span class="keyword">const</span> QString loggeNameField = <span class="string">"LoggeName"</span>;</span><br><span class="line">    <span class="keyword">const</span> QString threadNameField = <span class="string">"ThreadName"</span>;</span><br><span class="line">    <span class="keyword">const</span> QString levelField = <span class="string">"Level"</span>;</span><br><span class="line">    <span class="keyword">const</span> QString messageField = <span class="string">"Message"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 建表语句</span></span><br><span class="line">    <span class="keyword">const</span> QString createStatement = QString(<span class="string">"create table %1"</span></span><br><span class="line">                                            <span class="string">"(%2 varchar,%3 varchar,%4 varchar,%5 varchar,%6 varchar)"</span>)</span><br><span class="line">            .arg(tableName).arg(timeStampField).arg(loggeNameField)</span><br><span class="line">            .arg(threadNameField).arg(levelField).arg(messageField);</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"********** Begin **********"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建连接，并打开数据库</span></span><br><span class="line">    QSqlDatabase db = QSqlDatabase::addDatabase(<span class="string">"QSQLITE"</span>, connectionName);</span><br><span class="line">    db.setDatabaseName(databaseName);</span><br><span class="line">    <span class="keyword">if</span> (!db.open()) &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"Database open failed."</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据库中的表</span></span><br><span class="line">    QStringList tables = db.tables();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"Tables: "</span> &lt;&lt; db.tables();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 若表不存在，则创建</span></span><br><span class="line">    <span class="keyword">if</span> (!tables.contains(tableName)) &#123;</span><br><span class="line"></span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"Table does not exist."</span>;</span><br><span class="line"></span><br><span class="line">        QSqlQuery query(db);</span><br><span class="line">        <span class="keyword">bool</span> success = query.exec(createStatement);</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            qDebug() &lt;&lt; <span class="string">"Create table failed."</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 layout（用于控制日志输出格式）</span></span><br><span class="line">    Log4Qt::Logger *logger = Log4Qt::Logger::rootLogger();</span><br><span class="line">    Log4Qt::DatabaseLayout *layout = <span class="keyword">new</span> Log4Qt::DatabaseLayout();</span><br><span class="line">    layout-&gt;setName(<span class="string">"My Layout"</span>);</span><br><span class="line">    layout-&gt;setTimeStampColumn(timeStampField);</span><br><span class="line">    layout-&gt;setLoggenameColumn(loggeNameField);</span><br><span class="line">    layout-&gt;setThreadNameColumn(threadNameField);</span><br><span class="line">    layout-&gt;setLevelColumn(levelField);</span><br><span class="line">    layout-&gt;setMessageColumn(messageField);</span><br><span class="line">    layout-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 appender（将日志内容输出到数据库）</span></span><br><span class="line">    Log4Qt::DatabaseAppender *appender = <span class="keyword">new</span> Log4Qt::DatabaseAppender(layout);</span><br><span class="line">    appender-&gt;setLayout(layout);</span><br><span class="line">    appender-&gt;setName(<span class="string">"My Appender"</span>);</span><br><span class="line">    appender-&gt;setConnection(connectionName);</span><br><span class="line">    appender-&gt;setTable(tableName);</span><br><span class="line">    appender-&gt;activateOptions();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在 logger 上添加 appender</span></span><br><span class="line">    logger-&gt;addAppender(appender);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置级别为 DEBUG</span></span><br><span class="line">    logger-&gt;setLevel(Log4Qt::Level::DEBUG_INT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出信息</span></span><br><span class="line">    logger-&gt;debug(<span class="string">"Hello, Log4Qt!"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭 rootLogger</span></span><br><span class="line">    logger-&gt;removeAllAppenders();</span><br><span class="line">    logger-&gt;loggerRepository()-&gt;shutdown();</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"********** End **********"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="使用自己的-Logger"><a href="#使用自己的-Logger" class="headerlink" title="使用自己的 Logger"></a>使用自己的 Logger</h1><p>在实际应用中，我们依据项目的需要，需要使用自己定义的logger</p>
<h2 id="方法一-定义logger类"><a href="#方法一-定义logger类" class="headerlink" title="方法一.定义logger类"></a>方法一.定义logger类</h2><p>编写 <code>log4qt.properties</code>，定义自己的 logger 名字，例如下面定义为：<code>MyLogger</code>。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义 MyLogger</span></span><br><span class="line"><span class="attr">log4j.logger.MyLogger</span>= DEBUG, dest</span><br></pre></td></tr></table></figure>
<p>定义类 <code>MyLogger</code> ，其文件 <code>my_logger.h</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MY_LOGGER_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_LOGGER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/logger.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;log4qt/loggerrepository.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLogger</span> :</span> <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line">    LOG4QT_DECLARE_QCLASS_LOGGER</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    MyLogger()&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭 logger</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger()-&gt;removeAllAppenders();</span><br><span class="line">        logger()-&gt;loggerRepository()-&gt;shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// MY_LOGGER_H</span></span></span><br></pre></td></tr></table></figure>
<p>使用，<code>.cpp</code>中代码：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">int main(<span class="name">int</span> argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; "********** Begin **********";</span><br><span class="line"></span><br><span class="line">    // 使用自定义的 logger</span><br><span class="line">    MyLogger myLogger;</span><br><span class="line"></span><br><span class="line">    // 输出信息</span><br><span class="line">    myLogger.logger()-&gt;debug("Hello, Log4Qt!");</span><br><span class="line">    myLogger.logger()-&gt;info("Hello, Qt!");</span><br><span class="line"></span><br><span class="line">    // 关闭 logger</span><br><span class="line">    myLogger.shutdown();</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; "********** End **********";</span><br><span class="line"></span><br><span class="line">    return a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方法二-通过LogManager-logger获取"><a href="#方法二-通过LogManager-logger获取" class="headerlink" title="方法二.通过LogManager::logger获取"></a>方法二.通过LogManager::logger获取</h2><p>编写 <code>log4qt.properties</code>，定义自己的 <code>logger</code> 名字，例如下面定义为：<code>MyLogger1</code> 及 <code>MyLogger2</code>。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义 myLogger1</span></span><br><span class="line"><span class="attr">log4j.logger.myLogger1</span>=DEBUG, dest1</span><br><span class="line"><span class="attr">log4j.appender.dest1</span>=org.apache.log4j.FileAppender</span><br><span class="line"><span class="attr">log4j.appender.dest1.file</span>=<span class="variable">$&#123;logPath&#125;</span>/log1.out</span><br><span class="line"><span class="attr">log4j.appender.dest1.layout</span>=org.apache.log4j.TTCCLayout</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 myLogger2</span></span><br><span class="line"><span class="attr">log4j.logger.myLogger2</span>=DEBUG, dest2</span><br><span class="line"><span class="attr">log4j.appender.dest2</span>=org.apache.log4j.FileAppender</span><br><span class="line"><span class="attr">log4j.appender.dest2.file</span>=<span class="variable">$&#123;logPath&#125;</span>/log2.out</span><br><span class="line"><span class="attr">log4j.appender.dest2.layout</span>=org.apache.log4j.TTCCLayout</span><br></pre></td></tr></table></figure>
<p>代码中获取：</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 Logger</span></span><br><span class="line">Log4Qt::Logger *logger1 = Log4Qt::LogManager::logger(<span class="string">"myLogger1"</span>);</span><br><span class="line">Log4Qt::Logger *logger2 = Log4Qt::LogManager::logger(<span class="string">"myLogger2"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印信息</span></span><br><span class="line"><span class="function"><span class="title">logger1</span>-&gt;</span>debug(<span class="string">"Hello, logger1!"</span>);</span><br><span class="line"><span class="function"><span class="title">logger2</span>-&gt;</span>debug(<span class="string">"Hello, logger2!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭 logger</span></span><br><span class="line"><span class="function"><span class="title">logger1</span>-&gt;</span>removeAllAppenders();</span><br><span class="line"><span class="function"><span class="title">logger1</span>-&gt;</span><span class="function"><span class="title">loggerRepository</span>()-&gt;</span>shutdown();</span><br><span class="line"><span class="function"><span class="title">logger2</span>-&gt;</span>removeAllAppenders();</span><br><span class="line"><span class="function"><span class="title">logger2</span>-&gt;</span><span class="function"><span class="title">loggerRepository</span>()-&gt;</span>shutdown();</span><br></pre></td></tr></table></figure>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2021/03/100647.html" class="pre-post btn btn-default" title='QxOrm使用教程(ORM for C++ 对象关系映射)'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">QxOrm使用教程(ORM for C++ 对象关系映射)</span>
        </a>
    
    
        <a href="/archives/2021/03/100645.html" class="next-post btn btn-default" title='CTK完整教程(OSGI for C++ 实现 C++ Qt 模块化)'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">CTK完整教程(OSGI for C++ 实现 C++ Qt 模块化)</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#基本介绍"><span class="toc-text">基本介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#分层架构"><span class="toc-text">分层架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#核心对象"><span class="toc-text">核心对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#支持对象"><span class="toc-text">支持对象</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编译构建"><span class="toc-text">编译构建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置使用"><span class="toc-text">配置使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#将源码添加至项目中"><span class="toc-text">将源码添加至项目中</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#将其作为第三方库使用"><span class="toc-text">将其作为第三方库使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#获取-Log4Qt-中的-logger"><span class="toc-text">获取 Log4Qt 中的 logger</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-Log4Qt-Logger-logger"><span class="toc-text">使用 Log4Qt::Logger::logger</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-LOG4QT-DECLARE-QCLASS-LOGGER"><span class="toc-text">使用 LOG4QT_DECLARE_QCLASS_LOGGER</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-LOG4QT-DECLARE-STATIC-LOGGER"><span class="toc-text">使用 LOG4QT_DECLARE_STATIC_LOGGER</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#深入理解-rootLogger、logLogger、qtLogger"><span class="toc-text">深入理解 rootLogger、logLogger、qtLogger</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#相互关系"><span class="toc-text">相互关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#关系链"><span class="toc-text">关系链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#等价调用"><span class="toc-text">等价调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证"><span class="toc-text">验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#适用场景"><span class="toc-text">适用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#logLogger"><span class="toc-text">logLogger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#qtLogger"><span class="toc-text">qtLogger</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Log4Qt-配置"><span class="toc-text">Log4Qt  配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用环境变量配置"><span class="toc-text">使用环境变量配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-QSettings-配置"><span class="toc-text">使用 QSettings 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-log4qt-properties-配置"><span class="toc-text">使用 log4qt.properties 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在代码中配置"><span class="toc-text">在代码中配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#放置工作目录"><span class="toc-text">放置工作目录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Log4Qt-日志级别"><span class="toc-text">Log4Qt 日志级别</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#日志级别"><span class="toc-text">日志级别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#日志级别的工作方式"><span class="toc-text">日志级别的工作方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用配置文件设置级别"><span class="toc-text">使用配置文件设置级别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Log4Qt-日志格式化"><span class="toc-text">Log4Qt 日志格式化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#继承关系图"><span class="toc-text">继承关系图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#转换字符"><span class="toc-text">转换字符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PatternLayout"><span class="toc-text">PatternLayout</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-ConversionPattern"><span class="toc-text">使用 ConversionPattern</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义模式字符串"><span class="toc-text">自定义模式字符串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SimpleLayout"><span class="toc-text">SimpleLayout</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TTCCLayout"><span class="toc-text">TTCCLayout</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Log4Qt-输出重定向"><span class="toc-text">Log4Qt 输出重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#继承关系图-1"><span class="toc-text">继承关系图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#输出到控制台"><span class="toc-text">输出到控制台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#输出到文件"><span class="toc-text">输出到文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#以指定的频率滚动日志文件"><span class="toc-text">以指定的频率滚动日志文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在达到特定大小时滚动日志文件"><span class="toc-text">在达到特定大小时滚动日志文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#输出到数据库"><span class="toc-text">输出到数据库</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用自己的-Logger"><span class="toc-text">使用自己的 Logger</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#方法一-定义logger类"><span class="toc-text">方法一.定义logger类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#方法二-通过LogManager-logger获取"><span class="toc-text">方法二.通过LogManager::logger获取</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2023&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>