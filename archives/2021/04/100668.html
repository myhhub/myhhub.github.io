<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="qt,c++">


    <meta name="description" content="变量声明
声明每一个变量都要用独立的一行
避免短的或无意义的命名
单个字符的变量名只适用于用来计数的临时变量，因为此时该变量的用途十分明显
当一个变量被用到时再声明它
123456789// W...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>Qt 编程风格与规范 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Qt 编程风格与规范">
            
	            Qt 编程风格与规范
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/back/">后端</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/c/">c++</a> <a class="tag-link" href="/tags/qt/">qt</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2021/04/20</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>716</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <h2 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h2><ul>
<li>声明每一个变量都要用独立的一行</li>
<li>避免短的或无意义的命名</li>
<li>单个字符的变量名只适用于用来计数的临时变量，因为此时该变量的用途十分明显</li>
<li><p>当一个变量被用到时再声明它</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">int</span> a, b;</span><br><span class="line"><span class="keyword">char</span> *c, *d;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">int</span> <span class="built_in">height</span>;</span><br><span class="line"><span class="keyword">int</span> <span class="built_in">width</span>;</span><br><span class="line"><span class="keyword">char</span> *nameOfThis;</span><br><span class="line"><span class="keyword">char</span> *nameOfThat;</span><br></pre></td></tr></table></figure>
<h2 id="变量一般命名法"><a href="#变量一般命名法" class="headerlink" title="变量一般命名法"></a>变量一般命名法</h2></li>
<li><p>变量名和函数名以小写字母开头，开头之后的部分每个单词以大写字母开头</p>
</li>
<li><p>避免使用缩写</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"> <span class="keyword">short</span> Cntr;</span><br><span class="line"> <span class="keyword">char</span> ITEM_DELIM = <span class="string">' '</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Correct</span></span><br><span class="line"> <span class="keyword">short</span> counter;</span><br><span class="line"> <span class="keyword">char</span> itemDelimiter = <span class="string">' '</span>;</span><br></pre></td></tr></table></figure>
<h2 id="变量在Qt中的命名"><a href="#变量在Qt中的命名" class="headerlink" title="变量在Qt中的命名"></a>变量在Qt中的命名</h2></li>
<li><p>类名以大写字母开头，公开类以Q开头，紧跟大写字母；公用函数以q开头。（此为Qt内部规范，我们可不遵守）</p>
</li>
<li><p>首字母缩写词出现在命名中，采用驼峰命名法，如QXmlStreamReader,而不是QXMLStreamReader（即只有第一个字母大写）</p>
<h2 id="空白行与空格的使用"><a href="#空白行与空格的使用" class="headerlink" title="空白行与空格的使用"></a>空白行与空格的使用</h2></li>
<li><p>用空行在适当的地方划分代码块</p>
</li>
<li>总是只用一个空行</li>
<li><p>在关键词和花括号之间总是只用一个空格符</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">if</span>(foo)&#123;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> (foo) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="指针的书写规范"><a href="#指针的书写规范" class="headerlink" title="指针的书写规范"></a>指针的书写规范</h2></li>
<li><p>对于指针或引用，在类型名和<em>或&amp;之间用一个空格，但是在</em>或&amp;和变量名之间没有空格</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *x;</span><br><span class="line"><span class="keyword">const</span> QString &amp;myString;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> * <span class="keyword">const</span> y = <span class="string">"hello"</span>;</span><br></pre></td></tr></table></figure>
<h2 id="二元操作符"><a href="#二元操作符" class="headerlink" title="二元操作符"></a>二元操作符</h2></li>
<li><p>二元操作符的左右都要有空格</p>
</li>
<li>二元操作符对待它的两个参数是同样对待的，只是在该操作符是类外的操作符</li>
<li><p>例如QLineF有它自己的==操作符</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QLineF lineF;</span><br><span class="line">QLine lineN;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (lineF == lineN) <span class="comment">// Ok,  lineN is implicitly converted to QLineF</span></span><br><span class="line"><span class="keyword">if</span> (lineN == lineF) <span class="comment">// Error: QLineF cannot be converted implicitly to QLine, and the LHS is a member so no conversion applies</span></span><br></pre></td></tr></table></figure>
<h2 id="逗号"><a href="#逗号" class="headerlink" title="逗号"></a>逗号</h2></li>
<li><p>逗号左边没有空格，逗号右边有一个空格</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QMessageBox&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QT_REQUIRE_VERSION(argc, argv, <span class="string">"4.0.2"</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="function">QApplication <span class="title">app</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> app.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="分号"><a href="#分号" class="headerlink" title="分号"></a>分号</h2></li>
<li><p>分号左边没有空格，分号作为语句的结束符，其右边一般不再有内容</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point2D</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">int</span> y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="井号"><a href="#井号" class="headerlink" title="井号"></a>井号</h2></li>
<li><p>#号右边没有空格</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtGlobal&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> (QT_VERSION &gt;= QT_VERSION_CHECK(5, 0, 0))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtWidgets&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtGui&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h2 id="引号"><a href="#引号" class="headerlink" title="引号"></a>引号</h2></li>
<li><p>左引号的左边和右引号的右边都有一个空格，左引号的右边和右引号的左边都没有空格</p>
</li>
<li><p>如果右引号右边是又括号的话，它们之间没有空格</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qDebug() &lt;&lt; Q_FUNC_INFO &lt;&lt; <span class="string">"was called with value1:"</span> &lt;&lt; value1 &lt;&lt; <span class="string">"value2:"</span> &lt;&lt; value2<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">QT_REQUIRE_VERSION(<span class="name">argc</span>, argv, <span class="string">"4.0.2"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="cast"><a href="#cast" class="headerlink" title="cast"></a>cast</h2></li>
<li><p>cast后无须空格</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">char</span>* blockOfMemory = (<span class="keyword">char</span>* ) <span class="built_in">malloc</span>(data.size());</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">char</span> *blockOfMemory = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">char</span> *&gt;(<span class="built_in">malloc</span>(data.size()));</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免C语言的casts，尽量用C++的casts (static_cast, const_cast, reinterpret_cast)。 reinterpret_cast 和 C风格的cast用起来都是危险的，但至少 reinterpret_cast 不会把const修饰符去掉。</p>
</li>
<li>涉及到QObjects或重构自己的代码时，不要使用dynamic_cast,而是用qobject_cast，例如在引进一个类型的方法时。</li>
<li><p>用构造函数去cast简单类型,例如：用int(myFloat)代替(int)myFloat</p>
<h2 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h2></li>
<li><p>不要在一行写多条语句</p>
</li>
<li><p>另起一行写控制流语句的定义</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">if</span> (foo) <span class="built_in">bar</span>();</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> (foo)</span><br><span class="line">    <span class="built_in">bar</span>();</span><br></pre></td></tr></table></figure>
<h2 id="花括号写法"><a href="#花括号写法" class="headerlink" title="花括号写法"></a>花括号写法</h2></li>
<li><p>使用紧贴括号：左括号和语句的开头在同一行，如果右括号是紧跟在一个关键词之后的，则右括号和该关键词在同一行</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">if</span> (codec)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> (codec) &#123;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>例外：函数的实现和类的声明中，左括号总是在一行的开头</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    qDebug(<span class="string">"foo: %i"</span>, g);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当条件语句的执行部分多于一句的时候才使用花括号</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">if</span> (address.isEmpty()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; +<span class="string">''</span>i) &#123;</span><br><span class="line">    qDebug(<span class="string">"%i"</span>, i);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> (address.isEmpty())</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>;i)</span><br><span class="line">    qDebug(<span class="string">"%i"</span>, i);</span><br></pre></td></tr></table></figure>
<h2 id="花括号用途"><a href="#花括号用途" class="headerlink" title="花括号用途"></a>花括号用途</h2></li>
<li><p>例外1：如果父语句占有多行，或经过多层封装，子语句要用到花括号</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> (address.isEmpty() || !isValid()</span><br><span class="line">    || !codec) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>例外2：对称原则：在if-else语句块中，如果if或else中的一个包含了多行，另一个为了对称性原则，也要用花括号</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">if</span> <span class="comment">(address.isEmpty()</span>)</span><br><span class="line">    qDebug<span class="comment">("empty!")</span>;</span><br><span class="line">else &#123;</span><br><span class="line">    qDebug<span class="comment">("%s", qPrintable(address)</span>);</span><br><span class="line">    it;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> <span class="comment">(address.isEmpty()</span>) &#123;</span><br><span class="line">    qDebug<span class="comment">("empty!")</span>;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    qDebug<span class="comment">("%s", qPrintable(address)</span>);</span><br><span class="line">    it;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">if</span> <span class="comment">(a)</span></span><br><span class="line">    …</span><br><span class="line">else</span><br><span class="line">    <span class="keyword">if</span> <span class="comment">(b)</span></span><br><span class="line">        …</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> <span class="comment">(a)</span> &#123;</span><br><span class="line">    …</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="comment">(b)</span></span><br><span class="line">        …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当条件语句的执行体是空语句的时候，用一个花括号</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">while</span> <span class="comment">(a)</span>;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">while</span> <span class="comment">(a)</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="圆括号"><a href="#圆括号" class="headerlink" title="圆括号"></a>圆括号</h2></li>
<li><p>圆括号用来给语句分组</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">if</span> <span class="comment">(a &amp;&amp; b || c)</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> <span class="comment">((a &amp;&amp; b)</span> || c)</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Wrong</span></span><br><span class="line">a + b &amp; c</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="comment">(a + b)</span> &amp; c</span><br></pre></td></tr></table></figure>
<h2 id="Switch-语句"><a href="#Switch-语句" class="headerlink" title="Switch 语句"></a>Switch 语句</h2></li>
<li><p>case标签和switch在同一列</p>
</li>
<li><p>每一个case语句的末尾都要有一个break语句或return语句，除非因功能需要故意不加或另外一个case是紧跟上一个case的。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (myEnum) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">Value1:</span></span><br><span class="line">  doSomething();</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">Value2:</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">Value3:</span></span><br><span class="line">  doSomethingElse();</span><br><span class="line">  <span class="comment">// fall through</span></span><br><span class="line"><span class="string">default:</span></span><br><span class="line">  defaultHandling();</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="跳转语句"><a href="#跳转语句" class="headerlink" title="跳转语句"></a>跳转语句</h2></li>
<li><p>包括：break, continue, return, and goto</p>
</li>
<li><p>不要在跳转关键词后边加else</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"> <span class="keyword">if</span> (thisOrThat)</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">     <span class="built_in">somethingElse</span>();</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Correct</span></span><br><span class="line"> <span class="keyword">if</span> (thisOrThat)</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line"> <span class="built_in">somethingElse</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>例外：如果这段代码是固有的对称结构，用else实现视觉上的对称也是可以的</p>
<h2 id="换行"><a href="#换行" class="headerlink" title="换行"></a>换行</h2></li>
<li><p>每行代码不多于100个字符；若有必要，用括号括起来</p>
</li>
<li>逗号在行尾。操作符在新行的开头位置，这是因为编辑器过窄的话，操作符在行尾容易看不见</li>
<li><p>换行时尽量避免行于行之间看起来参差不齐</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">if</span> (longExpression +</span><br><span class="line">    otherLongExpression +</span><br><span class="line">    otherOtherLongExpression) &#123;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> (longExpression</span><br><span class="line">    + otherLongExpression</span><br><span class="line">    + otherOtherLongExpression) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="一般例外与Artistic-style选项"><a href="#一般例外与Artistic-style选项" class="headerlink" title="一般例外与Artistic style选项"></a>一般例外与Artistic style选项</h2></li>
<li><p>一般例外：当严格遵守一条规范会让你的代码看起来很糟糕时，废弃这条规范</p>
</li>
<li><p>用astyle格式化代码时的选项</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">--style</span>=kr </span><br><span class="line"><span class="attribute">--indent</span>=spaces=4 </span><br><span class="line"><span class="attribute">--align-pointer</span>=name </span><br><span class="line"><span class="attribute">--align-reference</span>=name </span><br><span class="line">--convert-tabs </span><br><span class="line">--attach-namespaces</span><br><span class="line"><span class="attribute">--max-code-length</span>=100 </span><br><span class="line"><span class="attribute">--max-instatement-indent</span>=120 </span><br><span class="line">--pad-header</span><br><span class="line">--pad-oper</span><br></pre></td></tr></table></figure>
</li>
<li><p>例如，你可以这样用以上的代码</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int foo = some_really_long_function_name(<span class="name">and_another_one_to_drive_the_point_home</span>(</span><br><span class="line">        first_argument, second_argument, third_arugment))<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h2 id="C-特性"><a href="#C-特性" class="headerlink" title="C++特性"></a>C++特性</h2></li>
<li><p>不要使用异常处理</p>
</li>
<li>不要使用运行时类型识别</li>
<li><p>理智地使用模板，不要仅仅因为你会用就去用</p>
<h2 id="Qt源码中的规范"><a href="#Qt源码中的规范" class="headerlink" title="Qt源码中的规范"></a>Qt源码中的规范</h2></li>
<li><p>所有代码都是ascii，使用者如果不确定的话，只可能是7字节</p>
</li>
<li>每一个QObject的子类都必须有Q_OBJECT宏，即使这个类没用到信号或槽。否则qobject_cast将不能使用</li>
<li><p>在connect语句中，使信号和槽的参数规范化（参看 QMetaObject::normalizedSignature），可以加快信号/槽的查找速度。可以使用qtrepotools/util/normalize规范已有代码</p>
<h2 id="包含头文件"><a href="#包含头文件" class="headerlink" title="包含头文件"></a>包含头文件</h2></li>
<li><p>用#include</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qstring.h&gt;</span> // Qt class</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;</span> // STL stuff</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span> // system stuff</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果你想包含qplatforms.h，把它作为第一个被包含的头文件</p>
</li>
<li><p>如果你想包含私有头文件，要十分小心。使用以下的语法而不用管whatever_p.h属于哪个模块在哪个文件目录下</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;private/whatever_p.h&gt;</span>1</span></span><br></pre></td></tr></table></figure>
<h2 id="编译器-平台特定问题"><a href="#编译器-平台特定问题" class="headerlink" title="编译器/平台特定问题"></a>编译器/平台特定问题</h2></li>
<li><p>使用三目运算符 ？时要特别小心，如果每次的返回值的类型可能不一样的话，一些编译器会在运行时生成冲突的代码（此时编译器甚至不会报错）</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QString s;</span><br><span class="line"><span class="keyword">return</span> condition ? s : <span class="string">"nothing"</span>; <span class="comment">// crash at runtime - QString vs. const char *</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>要特别小心对齐问题。无论何时，当一个指针被cast后的对齐数是增加的时候，它都可能会崩溃。例如一个const char <em>被cast成了cons int</em>，当cast之后的数字不得不在2或4个字节之间对齐时，指针就会在机器上崩溃。</p>
</li>
<li><p>使用一个union强迫编译器正确地对齐变量，示例如下，你可以确定AlignHelper中所有的实例都和int边界对齐了</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">AlignHelper</span> &#123;</span></span><br><span class="line">    char c;</span><br><span class="line">    int i;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>任何需要需要执行构造函数或相关代码进行初始化的实例，都不能用作库代码中的全局实例。因为当构造函数或代码将要运行的时候，该实例还没有被定义（在第一次调用该实例时，在加载库时，在执行main()之前）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global scope</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> QString x; <span class="comment">// Wrong - default constructor needs to be run to initialize x</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> QString y = <span class="string">"Hello"</span>; <span class="comment">// Wrong - constructor that takes a const char * has to be run</span></span><br><span class="line">QString z; <span class="comment">// super wrong</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> i = foo(); <span class="comment">// wrong - call time of foo() undefined, might not be called at all</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>你可以按照下面的方法去做：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global scope</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> x[] = <span class="string">"someText"</span>; <span class="comment">// Works - no constructor must be run, x set at compile time</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> y = <span class="number">7</span>; <span class="comment">// Works - y will be set at compile time</span></span><br><span class="line"><span class="keyword">static</span> MyStruct s = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;; <span class="comment">// Works - will be initialized statically, no code being run</span></span><br><span class="line"><span class="keyword">static</span> QString *ptr = <span class="number">0</span>; <span class="comment">// Pointers to objects are ok - no code needed to be run to initialize ptr</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用Q_GLOBAL_STATIC定义全局实例</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Q_GLOBAL_STATIC</span>(QString, s)</span><br><span class="line">  </span><br><span class="line"><span class="selector-tag">void</span> <span class="selector-tag">foo</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="selector-tag">s</span>()<span class="selector-tag">-</span>&gt;<span class="selector-tag">append</span>(<span class="string">"moo"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>char型变量是有符号的还是无符号的取决于它运行环境的架构。如果你明确地想使用一个signed或unsinged char，就使用signed char或unsigned char。以下代码运行在把char默认为无符号的平台上时，其条件判断恒为真。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> char c; // c can't be negative <span class="keyword">if</span> it <span class="built_in">is</span> unsigned</span><br><span class="line"><span class="comment">/********/</span></span><br><span class="line"><span class="comment">/*******/</span></span><br><span class="line"> <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123; … &#125; // WRONG - condition <span class="built_in">is</span> always <span class="literal">true</span> on platforms where the default <span class="built_in">is</span> unsigned</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免64位的枚举值</p>
<ul>
<li>嵌入式应用系统二进制接口将所有的枚举类型的值硬编码成32位int值</li>
<li>微软的编译器不支持64位的枚举值</li>
</ul>
<h2 id="编程美学"><a href="#编程美学" class="headerlink" title="编程美学"></a>编程美学</h2></li>
<li><p>偏爱用枚举值定义常量而非用const int或defines</p>
<ul>
<li>枚举值会在编译时被编译器用实际值替换掉，因而运行时得出结果的速度更快</li>
<li>defines不是命名空间安全的（并且看起来很丑）</li>
</ul>
</li>
<li>偏爱使用冗长而详细的参数名</li>
<li><p>当重新实现一个虚方法时，不要在头文件中用virtual关键字，在Qt5中，用 Q_DECL_OVERRIDE宏在函数声明之后，分号之前注解它。</p>
<h2 id="避免出现的事"><a href="#避免出现的事" class="headerlink" title="避免出现的事"></a>避免出现的事</h2></li>
<li><p>不要继承模版/工具类</p>
<ul>
<li>其析构函数不是虚函数，会导致潜在的内存泄漏</li>
<li>其符号不是导出的（not exported）,会导致符号冲突</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如：A库有以下代码</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Q_EXPORT</span> <span class="title">X</span>:</span> <span class="keyword">public</span> QList&lt;QVariant&gt; &#123;&#125;;</span><br><span class="line"><span class="comment">//B库有以下代码  </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Q_EXPORT</span> <span class="title">Y</span>:</span> <span class="keyword">public</span> QList&lt;QVariant&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>这样，QList的符号就被导出了两次</p>
</li>
<li><p>不要把const-iterator和none-const iterator搞混。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Container::const_iterator <span class="keyword">it</span> = c.begin(); <span class="keyword">it</span> != c.<span class="keyword">end</span>(); ++<span class="keyword">it</span>)<span class="comment"> // W R O N G</span></span><br><span class="line"><span class="keyword">for</span> (Container::const_iterator <span class="keyword">it</span> = c.cbegin(); <span class="keyword">it</span> != c.cend(); ++<span class="keyword">it</span>)<span class="comment"> // Right</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Q[Core]Application 是一个单例类。同一时间只能有一个实例在运行，但是这个实例可以被销毁，新的实例将可以被创建，如下的代码容易产生崩溃</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static QObject *obj = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">if (!obj)</span><br><span class="line">    obj = new QObject(<span class="name">QCoreApplication</span>:<span class="symbol">:instance</span>())<span class="comment">;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当QCoreApplication application被销毁时，obj成为了迷途指针(野指针)，可以用 Q_GLOBAL_STATIC 和qAddPostRoutine清理</p>
</li>
<li><p>为了尽可能地支持静态关键词，避免使用匿名命名空间。编译单位内的一个静态名称可以保证它是一个内部连接。而一个位于匿名命名空间的名称，C++规定它是一个外部链接。</p>
<h2 id="二进制和源兼容性"><a href="#二进制和源兼容性" class="headerlink" title="二进制和源兼容性"></a>二进制和源兼容性</h2></li>
<li><p>定义</p>
<ul>
<li>Qt 4.0.0是一个主版本，Qt 4.1.0是一个微调版本，Qt 4.1.1是一个补丁版本。</li>
<li>在此之后的版本：代码链接到之前版本的库可以运行</li>
<li>在此之前的版本：代码链接到一个新版本的库只对旧版本的库能工作。</li>
<li>源码兼容性：源码在不修改的情况下进行编译</li>
</ul>
</li>
<li>微调版本保持向后的二进制兼容性</li>
<li>补丁版本保持向后和向前的二进制兼容性<ul>
<li>不要增加或去掉任何公共API（例如公共的函数，公有/保护/私有的方法）</li>
<li>不要重新实现方法（甚至不要修改内连方法，也不要修改保护/私有方法）</li>
</ul>
</li>
<li>当继承一个QWidget的子类时，总是要去重写event(),即使它是空的。这将使你的widget类可以被操作而不破坏其二进制兼容性</li>
<li><p>所有从Qt中导出的方法，必须以q或Q开头。用autotest符号检测是否存在违反此规则的情况。（此为Qt本身要求的规范，我们不需要严格执行。）</p>
<h2 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h2></li>
<li><p>请记住，Qt中，除了Tests和WibKit，全部都是处在命名空间中的代码</p>
<h2 id="float值"><a href="#float值" class="headerlink" title="float值"></a>float值</h2></li>
<li><p>没有float值之间的比较</p>
<ul>
<li>用qFuzzyCompare去和delta比较其值</li>
<li>用qIsNull去判断float值是不是二进制0，而不是和0.0比较。</li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[static] bool qFuzzyCompare(double p1, double p2)</span><br><span class="line"><span class="comment">// Instead of comparing with 0.0</span></span><br><span class="line">qFuzzyCompare(<span class="number">0.0</span>,<span class="number">1.0e-200</span>); <span class="comment">// This will return false</span></span><br><span class="line"><span class="comment">// Compare adding 1 to both values will fix the problem</span></span><br><span class="line">qFuzzyCompare(<span class="number">1</span> + <span class="number">0.0</span>, <span class="number">1</span> + <span class="number">1.0e-200</span>); <span class="comment">// This will return true</span></span><br></pre></td></tr></table></figure>
<h2 id="虚方法"><a href="#虚方法" class="headerlink" title="虚方法"></a>虚方法</h2></li>
<li><p>不要在子类中隐藏父类的虚方法：假设A类中有个virtual int val()方法，以下代码是不规范的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span> <span class="keyword">public</span> A</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> A::val;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">val</span><span class="params">(<span class="keyword">int</span> x)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h2></li>
<li><p>在操作一个预处理器之前，先判断它是否被定义</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> Foo == 0  <span class="comment">// W R O N G</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(Foo) &amp;&amp; (Foo == 0) <span class="comment">// Right</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> Foo - 0 == 0 <span class="comment">// Clever, are we? Use the one above instead, for better readability</span></span></span><br></pre></td></tr></table></figure>
<h2 id="类的成员命名"><a href="#类的成员命名" class="headerlink" title="类的成员命名"></a>类的成员命名</h2></li>
<li><p>成员变量一般为名词</p>
</li>
<li><p>函数成员一般为动词/动词+名词，但是当动词为get时，get常常省略。当返回值为Bool型变量时，函数名一般以前缀’is’开头</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setColor</span><span class="params">(<span class="keyword">const</span> QColor&amp; c)</span></span>;</span><br><span class="line">    <span class="function">QColor <span class="title">color</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setDirty</span><span class="params">(<span class="keyword">bool</span> b)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isDirty</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Q_SLOTS:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slotParentChanged</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="定义私有类"><a href="#定义私有类" class="headerlink" title="定义私有类"></a>定义私有类</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//.h文件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KFooPrivate</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KFoo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/* public members */</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">const</span> QScopedPointer&lt;KFooPrivate&gt; d;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//.cpp文件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KFooPrivate</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">int</span> someInteger;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">KFoo::KFoo() : d(<span class="keyword">new</span> KFooPrivate)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">KFoo::~KFoo()</span><br><span class="line">&#123; </span><br><span class="line"> <span class="comment">// You must define a non-inline destructor in the .cpp file, even if it is empty</span></span><br><span class="line"> <span class="comment">// else, a default one will be built in placed where KFooPrivate is only forward</span></span><br><span class="line"> <span class="comment">// declare, leading to error in the destructor of QScopedPointer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="标记-flags"><a href="#标记-flags" class="headerlink" title="标记(flags)"></a>标记(flags)</h2></li>
<li><p>避免使用无意义的bool型参数，以下是糟糕的例子</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> QString KApplication::makeStdCaption( <span class="keyword">const</span> QString &amp;caption,</span><br><span class="line">                                             <span class="keyword">bool</span> withAppName,</span><br><span class="line">                                             <span class="keyword">bool</span> modified);</span><br></pre></td></tr></table></figure>
</li>
<li><p>解决方案是用QFlags。即使其中只有一个值，也建议这么做，这将允许你以后很方便地添加更多的值并且保持二进制兼容性。</p>
</li>
<li><p>示例如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KApplication</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/* [...] */</span></span><br><span class="line">    enum StandardCaptionOption &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Indicates to include the application name</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        WithApplicationName = <span class="number">0x01</span>,</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Note in the caption that there is unsaved data</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Modified = <span class="number">0x02</span></span><br><span class="line">    &#125;;</span><br><span class="line">    Q_DECLARE_FLAGS(StandardCaptionOptions, </span><br><span class="line">                    StandardCaptionOption)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Builds a caption using a standard layout.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userCaption The caption string you want to display</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> options a set of flags from MakeStandartCaptionOption</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> QString makeStandardCaption(<span class="keyword">const</span> QString&amp; userCaption,</span><br><span class="line">       <span class="keyword">const</span> StandardCaptionOptions&amp; options = WithApplicationName);</span><br><span class="line">    <span class="comment">/* [...] */</span></span><br><span class="line">&#125;;</span><br><span class="line">Q_DECLARE_OPERATORS_FOR_FLAGS(KApplication::StandardCaptionOptions)</span><br></pre></td></tr></table></figure>
<h2 id="常引用"><a href="#常引用" class="headerlink" title="常引用"></a>常引用</h2></li>
<li><p>每一个对象，只要它不是基础类型(int, float, bool, enum, or pointers)，都应该以常量引用的形式传递。这条使得代码运行得更快。即使一个对象是隐式共享的，也应该这么做</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QString <span class="title">myMethod</span><span class="params">( <span class="keyword">const</span> QString&amp; foo,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">const</span> QPixmap&amp; bar,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">int</span> number )</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免常引用的返回类型</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> QList&lt;<span class="keyword">int</span>&gt; &amp;someProperty() <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>有种情况还是可以使用常引用的返回类型的，这种情况下，此处代码的运行性能至关重要，此处的代码实现也是固定的，思考再三之后，你可以写成这样：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QList&lt;<span class="keyword">int</span>&gt; <span class="title">someProperty</span>(<span class="params"></span>) <span class="keyword">const</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="库代码中的信号-amp-槽"><a href="#库代码中的信号-amp-槽" class="headerlink" title="库代码中的信号&amp;槽"></a>库代码中的信号&amp;槽</h2></li>
<li><p>在库代码中，用Q_SIGNALS 和 Q_SLOTS 代替 signals 和 slots。它们在语法上是相等的，用以避免和boost信号的冲突。和python协同工作时使用”slots”</p>
<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2></li>
<li><p>设置属性时用Q_PROPERTY。理由是属性可以被javascript 接口访问到</p>
</li>
<li><p>moc中设置特定的flag用 QMetaProperty.</p>
<h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2></li>
<li><p>为了使构造函数被错误使用的可能性降到最小，每一个构造函数（除了拷贝构函数）都应该检查自己是否需要加上explicit 符号。</p>
<h2 id="include"><a href="#include" class="headerlink" title="#include"></a>#include</h2></li>
<li><p>尽量减少在头文件中包含其他头文件的数量</p>
</li>
<li><p>如下所示，可以用前置声明法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;kfoobase.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KBar</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KFoo</span> :</span> <span class="keyword">public</span> KFooBase</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">/* [...] */</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">myMethod</span><span class="params">(<span class="keyword">const</span> KBar &amp;bar)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>包含Qt自带头文件或外部库的头文件用尖括号</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDate&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;zlib.h&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>包含自己的项目头文件用双引号</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"myclass.h"</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>包含Qt类的头文件不用包含它所在的模块名</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//正确示例</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDate&gt;</span> //correct</span></span><br><span class="line"><span class="comment">//错误示例</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtCore/QDate&gt;</span> //incorrect, no need to specify the module QtCore</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtCore&gt;</span>   //incorrect, do not <span class="meta-keyword">include</span> the top-level Qt module</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>假如你有一个Foo类，有Foo.h文件和Foo.cpp文件，在你的Foo.cpp文件中，要先包含Foo.h文件再包含其他头文件</p>
</li>
<li><p>如果你的代码写成下面这样：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//.h文件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Bar <span class="title">getBar</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">.cpp文件</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"bar.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"foo.h"</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>你的cpp文件能够正常编译，但当其他人用到Foo.h文件时，如果没有包含bar.h文件，编译器将不能进行编译。</p>
</li>
<li>因此在cpp文件中首先包含其相应的.h文件，是为了.h文件能够被其他人使用</li>
<li><p>头文件必须进行包含保护：避免多次包含而引起多次的编译</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MYFOO_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MYFOO_H</span></span><br><span class="line">... <span class="params">&lt;stuff&gt;</span>...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* MYFOO_H */</span></span></span><br></pre></td></tr></table></figure>
<h2 id="信号-amp-槽的标准化写法"><a href="#信号-amp-槽的标准化写法" class="headerlink" title="信号&amp;槽的标准化写法"></a>信号&amp;槽的标准化写法</h2></li>
<li><p>标准化的写法增加代码可读性</p>
</li>
<li><p>不标准的写法可能是如下写法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QObject::connect(<span class="keyword">this</span>, SIGNAL( newValue(<span class="keyword">const</span> QString&amp;,</span><br><span class="line">                                        <span class="keyword">const</span> MyNamespace::Type&amp;) ),</span><br><span class="line">                 other, SLOT( value(<span class="keyword">const</span> QString &amp;) ));</span><br></pre></td></tr></table></figure>
</li>
<li><p>建议采用以下写法</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">QObject:</span>:connect(<span class="keyword">this</span>, SIGNAL(newValue(QString,<span class="string">MyNamespace:</span>:Type)),</span><br><span class="line">                 other, SLOT(value(QString)));</span><br></pre></td></tr></table></figure>
<h2 id="API-最小化原则"><a href="#API-最小化原则" class="headerlink" title="API-最小化原则"></a>API-最小化原则</h2></li>
<li><p>最小化的API意味着，每个API中使用尽可能少的类，每个类中使用尽可能少的公用成员(public members)。这样做的好处是使得API易于理解、记忆、调试和修改</p>
<h2 id="API-完整性原则"><a href="#API-完整性原则" class="headerlink" title="API-完整性原则"></a>API-完整性原则</h2></li>
<li><p>一个完整的API意味着实现它预期的功能。这和最小化的特性可能会产生冲突。另外如果一个成员函数出现在一个错误的类里，API的使用者们可能会找不到它</p>
<h2 id="API-有明确和简单的语意"><a href="#API-有明确和简单的语意" class="headerlink" title="API-有明确和简单的语意"></a>API-有明确和简单的语意</h2></li>
<li><p>正如其他的设计工作一样，你应当遵守“最小惊奇”原则。一般情况下，这是容易做到的。请不要用解决方案所解决的问题过于笼统。（例如Qt3中的QMimeSourceFactory，应该被叫做 QImageLoader从而作为一个不同的API）</p>
<h2 id="API-直观性原则"><a href="#API-直观性原则" class="headerlink" title="API-直观性原则"></a>API-直观性原则</h2></li>
<li><p>不同的经历和背景让人们对什么具有“直观性”什么不具有，有着不同的感觉。以下情况我们可以认为一个API是直观的</p>
</li>
<li>一个稍有一些经验的用户在不看帮助文档的情况下，能够正确地使用该API</li>
<li><p>一个从不知道该API的用户能够看懂使用该API写成的代码</p>
<h2 id="API-便于记住"><a href="#API-便于记住" class="headerlink" title="API-便于记住"></a>API-便于记住</h2></li>
<li><p>选择一个一致的和准确的命名约定</p>
</li>
<li>使用可识别的模式和概念</li>
<li><p>避免使用缩写</p>
<h2 id="API-易读性原则"><a href="#API-易读性原则" class="headerlink" title="API-易读性原则"></a>API-易读性原则</h2></li>
<li><p>代码是一次写成，但需要多次阅读，易读的代码可能写的时候会花费稍长的时间，但是在整个产品的生命周期之中，但节省你很多阅读和理解的时间</p>
</li>
<li><p>最后，记住不同的用户会用到一个API的不同部分。虽然直接使用Qt的类生成一个实例是直观的，但我们还是有理由期待用户在派生一个Qt的类之前先阅读它的官方文档</p>
<h2 id="API-静态多态性"><a href="#API-静态多态性" class="headerlink" title="API-静态多态性"></a>API-静态多态性</h2></li>
<li><p>相似的类应该有相似的API，这可以用继承的方式实现，这用到了运行时多态。</p>
</li>
<li>但是多态也可以发生在设计类的时候，例如，你把一个对象的类型从QProgressBar 换成Qslider，或者从QString 换成QByteArray，你会发现它们之间的API是何其的相似，以至于你可以很简单地用一个去替换另一个。这就是我们所说的“静态多态性”</li>
<li>“静态多态性”使得记住这些API和使用编程模式都更为简单了。因此，为一系列相关类设计相似的API好过为每个类设计独立的、更切合自身的API</li>
<li><p>一般来说，在Qt中我们偏爱使用“静态多态性”而非实际的继承，除非一些不可控制的原因要求我们不得不如此。</p>
<h2 id="常引用-1"><a href="#常引用-1" class="headerlink" title="常引用"></a>常引用</h2></li>
<li><p>如果一个类型超过16个字节，用常引用传递它。</p>
</li>
<li>如果一个类型有一个非平凡拷贝构造函数(non-trivial copy-constructor)，或一个非平凡析构函数(non-trivial destructor)，用常引用传递它的值而避免使用以上方法</li>
<li><p>所有的其他类型都应该直接传递其值</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span></span>; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(QChar cat)</span></span>; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(QLatin1String name)</span></span>; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setAlarm</span><span class="params">(<span class="keyword">const</span> QSharedPointer&lt;Alarm&gt; &amp;alarm)</span></span>; <span class="comment">// const-ref is much faster than running copy-constructor and destructor </span></span><br><span class="line"><span class="comment">// QDate, QTime, QPoint, QPointF, QSize, QSizeF, QRect are good examples of other classes you should pass by value.</span></span><br></pre></td></tr></table></figure>
<h2 id="枚举类型和枚举值的命名"><a href="#枚举类型和枚举值的命名" class="headerlink" title="枚举类型和枚举值的命名"></a>枚举类型和枚举值的命名</h2></li>
<li><p>以下的示例说明了枚举值命名时给出一般的名称的危险</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">namespace Qt</span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Corner</span> &#123; <span class="title">TopLeft</span>, <span class="title">BottomRight</span>, … &#125;;</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">CaseSensitivity</span> &#123; <span class="title">Insensitive</span>, <span class="title">Sensitive</span> &#125;;</span></span><br><span class="line">…</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">tabWidget-&gt;setCornerWidget(widget, <span class="symbol">Qt:</span>:TopLeft);</span><br><span class="line">str.indexOf(<span class="string">"$(QTDIR)"</span>, <span class="symbol">Qt:</span>:Insensitive);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在最后一行，Insensitive 是什么含义呢？这是不易于理解的。因此，枚举值命名时，至少重复枚举类型名中的一个字母</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">namespace Qt</span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Corner</span> &#123; <span class="title">TopLeftCorner</span>, <span class="title">BottomRightCorner</span>, … &#125;;</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">CaseSensitivity</span> &#123; <span class="title">CaseInsensitive</span>,</span></span><br><span class="line">CaseSensitive &#125;;</span><br><span class="line">…</span><br><span class="line">&#125;;</span><br><span class="line">tabWidget-&gt;setCornerWidget(widget, <span class="symbol">Qt:</span>:TopLeftCorner);</span><br><span class="line">str.indexOf(<span class="string">"$(QTDIR)"</span>, <span class="symbol">Qt:</span>:CaseInsensitive);</span><br></pre></td></tr></table></figure>
<h2 id="企图少写代码的陷阱"><a href="#企图少写代码的陷阱" class="headerlink" title="企图少写代码的陷阱"></a>企图少写代码的陷阱</h2></li>
<li><p>不要为了图方便少些一些代码。因为代码是一次书写，后期不止一次地要去理解。例如</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QSlider *slider = <span class="keyword">new</span> QSlider(<span class="number">12</span>, <span class="number">18</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="string">Qt:</span>:Vertical, <span class="number">0</span>, <span class="string">"volume"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>改成下面的方式会更容易理解</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QSlider *slider = new QSlider(Qt::Vertical);</span><br><span class="line"><span class="function"><span class="title">slider</span>-&gt;</span>setRange(<span class="number">12</span>, <span class="number">18</span>);</span><br><span class="line"><span class="function"><span class="title">slider</span>-&gt;</span>setPageStep(<span class="number">3</span>);</span><br><span class="line"><span class="function"><span class="title">slider</span>-&gt;</span>setValue(<span class="number">13</span>);</span><br><span class="line"><span class="function"><span class="title">slider</span>-&gt;</span>setObjectName(<span class="string">"volume"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Bool型参数陷阱"><a href="#Bool型参数陷阱" class="headerlink" title="Bool型参数陷阱"></a>Bool型参数陷阱</h2></li>
<li><p>这方面经典的例子是Qt中的repaint()函数，它的bool型参数用来标记窗口的背景是否被擦除。用法如下：</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">widget</span>-&gt;</span>repaint(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>上面的代码很容易被理解成“不重新绘制”</p>
</li>
<li><p>上面代码的中用到的repaint()函数，其设计时的考虑无非是为了可以少定义一个函数，结果反而带来了误解，有多少人可以对以下三行代码所代表队含义进行准确地区分呢？</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">widget</span>-&gt;</span>repaint();</span><br><span class="line"><span class="function"><span class="title">widget</span>-&gt;</span>repaint(<span class="literal">true</span>);</span><br><span class="line"><span class="function"><span class="title">widget</span>-&gt;</span>repaint(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>稍微好一点的做法是这样</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">widget</span>-&gt;</span>repaint();</span><br><span class="line"><span class="function"><span class="title">widget</span>-&gt;</span>repaintWithoutErasing();</span><br></pre></td></tr></table></figure>
</li>
<li><p>还有一个很明显的做法是尽可能地用枚举类型代替bool型参数，请对比以下的两行代码</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span>.replace(<span class="string">"USER"</span>, user, <span class="literal">false</span>); <span class="comment">// Qt 3</span></span><br><span class="line"><span class="built_in">str</span>.replace(<span class="string">"USER"</span>, user, Qt::CaseInsensitive); <span class="comment">// Qt 4</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="https://wiki.qt.io/Qt_Contribution_Guidelines" target="_blank" rel="noopener">https://wiki.qt.io/Qt_Contribution_Guidelines</a></li>
<li><a href="https://wiki.qt.io/Qt_Coding_Style" target="_blank" rel="noopener">https://wiki.qt.io/Qt_Coding_Style</a></li>
<li><a href="https://wiki.qt.io/Coding_Conventions" target="_blank" rel="noopener">https://wiki.qt.io/Coding_Conventions</a></li>
<li><a href="https://community.kde.org/Policies/Library_Code_Policy" target="_blank" rel="noopener">https://community.kde.org/Policies/Library_Code_Policy</a></li>
<li><a href="https://wiki.qt.io/UI_Text_Conventions" target="_blank" rel="noopener">https://wiki.qt.io/UI_Text_Conventions</a></li>
<li><a href="https://wiki.qt.io/API_Design_Principles" target="_blank" rel="noopener">https://wiki.qt.io/API_Design_Principles</a></li>
<li><a href="http://doc.qt.io/qt-5/qml-codingconventions.html" target="_blank" rel="noopener">http://doc.qt.io/qt-5/qml-codingconventions.html</a></li>
<li><a href="https://google.github.io/styleguide/cppguide.html" target="_blank" rel="noopener">https://google.github.io/styleguide/cppguide.html</a></li>
</ol>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2021/04/100669.html" class="pre-post btn btn-default" title='QT 插件(QtPlugin)教程'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">QT 插件(QtPlugin)教程</span>
        </a>
    
    
        <a href="/archives/2021/03/100667.html" class="next-post btn btn-default" title='CMake 完整使用教程'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">CMake 完整使用教程</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#变量声明"><span class="toc-text">变量声明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#变量一般命名法"><span class="toc-text">变量一般命名法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#变量在Qt中的命名"><span class="toc-text">变量在Qt中的命名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#空白行与空格的使用"><span class="toc-text">空白行与空格的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#指针的书写规范"><span class="toc-text">指针的书写规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二元操作符"><span class="toc-text">二元操作符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#逗号"><span class="toc-text">逗号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分号"><span class="toc-text">分号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#井号"><span class="toc-text">井号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#引号"><span class="toc-text">引号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cast"><span class="toc-text">cast</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#语句"><span class="toc-text">语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#花括号写法"><span class="toc-text">花括号写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#花括号用途"><span class="toc-text">花括号用途</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#圆括号"><span class="toc-text">圆括号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Switch-语句"><span class="toc-text">Switch 语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跳转语句"><span class="toc-text">跳转语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#换行"><span class="toc-text">换行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一般例外与Artistic-style选项"><span class="toc-text">一般例外与Artistic style选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-特性"><span class="toc-text">C++特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Qt源码中的规范"><span class="toc-text">Qt源码中的规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#包含头文件"><span class="toc-text">包含头文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译器-平台特定问题"><span class="toc-text">编译器/平台特定问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编程美学"><span class="toc-text">编程美学</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#避免出现的事"><span class="toc-text">避免出现的事</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二进制和源兼容性"><span class="toc-text">二进制和源兼容性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命名空间"><span class="toc-text">命名空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#float值"><span class="toc-text">float值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#虚方法"><span class="toc-text">虚方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#宏定义"><span class="toc-text">宏定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类的成员命名"><span class="toc-text">类的成员命名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定义私有类"><span class="toc-text">定义私有类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#标记-flags"><span class="toc-text">标记(flags)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常引用"><span class="toc-text">常引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#库代码中的信号-amp-槽"><span class="toc-text">库代码中的信号&amp;槽</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#属性"><span class="toc-text">属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构造函数"><span class="toc-text">构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#include"><span class="toc-text">#include</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#信号-amp-槽的标准化写法"><span class="toc-text">信号&amp;槽的标准化写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-最小化原则"><span class="toc-text">API-最小化原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-完整性原则"><span class="toc-text">API-完整性原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-有明确和简单的语意"><span class="toc-text">API-有明确和简单的语意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-直观性原则"><span class="toc-text">API-直观性原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-便于记住"><span class="toc-text">API-便于记住</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-易读性原则"><span class="toc-text">API-易读性原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-静态多态性"><span class="toc-text">API-静态多态性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常引用-1"><span class="toc-text">常引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#枚举类型和枚举值的命名"><span class="toc-text">枚举类型和枚举值的命名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#企图少写代码的陷阱"><span class="toc-text">企图少写代码的陷阱</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bool型参数陷阱"><span class="toc-text">Bool型参数陷阱</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2023&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>