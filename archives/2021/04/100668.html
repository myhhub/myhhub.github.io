<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="qt,c++" />


    <meta name="description" content="变量声明
声明每一个变量都要用独立的一行
避免短的或无意义的命名
单个字符的变量名只适用于用来计数的临时变量，因为此时该变量的用途十分明显
当一个变量被用到时再声明它

  123456789/..." />



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />

    <!--Title-->


<title>Qt 编程风格与规范 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    




<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">





    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx" />


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

<meta name="generator" content="Hexo 7.3.0"></head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Qt 编程风格与规范">
            
	            Qt 编程风格与规范
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/back/">后端</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-none-link" href="/tags/c/" rel="tag">c++</a> <a class="tag-none-link" href="/tags/qt/" rel="tag">qt</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2021/04/20</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1427</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <h2 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h2><ul>
<li>声明每一个变量都要用独立的一行</li>
<li>避免短的或无意义的命名</li>
<li>单个字符的变量名只适用于用来计数的临时变量，因为此时该变量的用途十分明显</li>
<li>当一个变量被用到时再声明它</li>
</ul>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="type">int</span> a, b;</span><br><span class="line"><span class="type">char</span> *c, *d;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="type">int</span> height;</span><br><span class="line"><span class="type">int</span> width;</span><br><span class="line"><span class="type">char</span> *nameOfThis;</span><br><span class="line"><span class="type">char</span> *nameOfThat;</span><br></pre></td></tr></table></figure>

<h2 id="变量一般命名法"><a href="#变量一般命名法" class="headerlink" title="变量一般命名法"></a>变量一般命名法</h2><ul>
<li>变量名和函数名以小写字母开头，开头之后的部分每个单词以大写字母开头</li>
<li>避免使用缩写</li>
</ul>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"> <span class="type">short</span> Cntr;</span><br><span class="line"> <span class="type">char</span> ITEM_DELIM = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Correct</span></span><br><span class="line"> <span class="type">short</span> counter;</span><br><span class="line"> <span class="type">char</span> itemDelimiter = <span class="string">&#x27; &#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="变量在Qt中的命名"><a href="#变量在Qt中的命名" class="headerlink" title="变量在Qt中的命名"></a>变量在Qt中的命名</h2><ul>
<li>类名以大写字母开头，公开类以Q开头，紧跟大写字母；公用函数以q开头。（此为Qt内部规范，我们可不遵守）</li>
<li>首字母缩写词出现在命名中，采用驼峰命名法，如QXmlStreamReader,而不是QXMLStreamReader（即只有第一个字母大写）</li>
</ul>
<h2 id="空白行与空格的使用"><a href="#空白行与空格的使用" class="headerlink" title="空白行与空格的使用"></a>空白行与空格的使用</h2><ul>
<li>用空行在适当的地方划分代码块</li>
<li>总是只用一个空行</li>
<li>在关键词和花括号之间总是只用一个空格符</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="built_in">if</span>(foo)&#123;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line">if (foo) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="指针的书写规范"><a href="#指针的书写规范" class="headerlink" title="指针的书写规范"></a>指针的书写规范</h2><ul>
<li>对于指针或引用，在类型名和<em>或&amp;之间用一个空格，但是在</em>或&amp;和变量名之间没有空格</li>
</ul>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *x;</span><br><span class="line"><span class="type">const</span> QString &amp;myString;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> * <span class="type">const</span> y = <span class="string">&quot;hello&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="二元操作符"><a href="#二元操作符" class="headerlink" title="二元操作符"></a>二元操作符</h2><ul>
<li>二元操作符的左右都要有空格</li>
<li>二元操作符对待它的两个参数是同样对待的，只是在该操作符是类外的操作符</li>
<li>例如QLineF有它自己的&#x3D;&#x3D;操作符</li>
</ul>
  <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QLineF lineF;</span><br><span class="line">QLine lineN;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (lineF == lineN) // Ok,  lineN <span class="keyword">is</span> implicitly converted <span class="keyword">to</span> QLineF</span><br><span class="line"><span class="keyword">if</span> (lineN == lineF) // Error: QLineF cannot be converted implicitly <span class="keyword">to</span> QLine, <span class="keyword">and</span> the LHS <span class="keyword">is</span> a member so <span class="keyword">no</span> <span class="keyword">conversion</span> applies</span><br></pre></td></tr></table></figure>

<h2 id="逗号"><a href="#逗号" class="headerlink" title="逗号"></a>逗号</h2><ul>
<li>逗号左边没有空格，逗号右边有一个空格</li>
</ul>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMessageBox&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">QT_REQUIRE_VERSION</span>(argc, argv, <span class="string">&quot;4.0.2&quot;</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="function">QApplication <span class="title">app</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> app.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分号"><a href="#分号" class="headerlink" title="分号"></a>分号</h2><ul>
<li>分号左边没有空格，分号作为语句的结束符，其右边一般不再有内容</li>
</ul>
  <figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct Point2D</span><br><span class="line">&#123;</span><br><span class="line">    int x<span class="comment">;</span></span><br><span class="line">    int y<span class="comment">;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h2 id="井号"><a href="#井号" class="headerlink" title="井号"></a>井号</h2><ul>
<li>#号右边没有空格</li>
</ul>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtGlobal&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">if</span> (QT_VERSION &gt;= QT_VERSION_CHECK(5, 0, 0))</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtGui&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h2 id="引号"><a href="#引号" class="headerlink" title="引号"></a>引号</h2><ul>
<li>左引号的左边和右引号的右边都有一个空格，左引号的右边和右引号的左边都没有空格</li>
<li>如果右引号右边是又括号的话，它们之间没有空格</li>
</ul>
  <figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qDebug() &lt;&lt; Q_FUNC_INFO &lt;&lt; <span class="string">&quot;was called with value1:&quot;</span> &lt;&lt; value1 &lt;&lt; <span class="string">&quot;value2:&quot;</span> &lt;&lt; value2<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">QT_REQUIRE_VERSION(<span class="name">argc</span>, argv, <span class="string">&quot;4.0.2&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="cast"><a href="#cast" class="headerlink" title="cast"></a>cast</h2><ul>
<li>cast后无须空格</li>
</ul>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="type">char</span>* blockOfMemory = (<span class="type">char</span>* ) <span class="built_in">malloc</span>(data.<span class="built_in">size</span>());</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="type">char</span> *blockOfMemory = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span> *&gt;(<span class="built_in">malloc</span>(data.<span class="built_in">size</span>()));</span><br></pre></td></tr></table></figure>

<ul>
<li>避免C语言的casts，尽量用C++的casts (static_cast, const_cast, reinterpret_cast)。 reinterpret_cast 和 C风格的cast用起来都是危险的，但至少 reinterpret_cast 不会把const修饰符去掉。</li>
<li>涉及到QObjects或重构自己的代码时，不要使用dynamic_cast,而是用qobject_cast，例如在引进一个类型的方法时。</li>
<li>用构造函数去cast简单类型,例如：用int(myFloat)代替(int)myFloat</li>
</ul>
<h2 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h2><ul>
<li>不要在一行写多条语句</li>
<li>另起一行写控制流语句的定义</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line">if (foo) <span class="built_in">bar</span>();</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line">if (foo)</span><br><span class="line">    <span class="built_in">bar</span>();</span><br></pre></td></tr></table></figure>

<h2 id="花括号写法"><a href="#花括号写法" class="headerlink" title="花括号写法"></a>花括号写法</h2><ul>
<li>使用紧贴括号：左括号和语句的开头在同一行，如果右括号是紧跟在一个关键词之后的，则右括号和该关键词在同一行</li>
</ul>
  <figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">if</span> (codec)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> (codec) &#123;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>例外：函数的实现和类的声明中，左括号总是在一行的开头</li>
</ul>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">static void foo(<span class="keyword">int</span> g)</span><br><span class="line">&#123;</span><br><span class="line">    qDebug(<span class="string">&quot;foo: <span class="variable">%i</span>&quot;</span>, g);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>当条件语句的执行部分多于一句的时候才使用花括号</li>
</ul>
  <figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">if</span> (address.<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="number">10</span>; +<span class="string">&#x27;&#x27;</span>i) &#123;</span><br><span class="line">    qDebug(<span class="string">&quot;%i&quot;</span>, i);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> (address.<span class="built_in">isEmpty</span>())</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="number">10</span>;i)</span><br><span class="line">    qDebug(<span class="string">&quot;%i&quot;</span>, i);</span><br></pre></td></tr></table></figure>

<h2 id="花括号用途"><a href="#花括号用途" class="headerlink" title="花括号用途"></a>花括号用途</h2><ul>
<li>例外1：如果父语句占有多行，或经过多层封装，子语句要用到花括号</li>
</ul>
  <figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">if</span> (address.<span class="built_in">isEmpty</span>() || !isValid()</span><br><span class="line">    || !codec) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>例外2：对称原则：在if-else语句块中，如果if或else中的一个包含了多行，另一个为了对称性原则，也要用花括号</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line">if (address.isEmpty())</span><br><span class="line">    <span class="built_in">qDebug</span>(&quot;empty!&quot;);</span><br><span class="line">else &#123;</span><br><span class="line">    <span class="built_in">qDebug</span>(&quot;%s&quot;, qPrintable(address));</span><br><span class="line">    it;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line">if (address.isEmpty()) &#123;</span><br><span class="line">    <span class="built_in">qDebug</span>(&quot;empty!&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    <span class="built_in">qDebug</span>(&quot;%s&quot;, qPrintable(address));</span><br><span class="line">    it;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Wrong</span></span><br><span class="line">if (a)</span><br><span class="line">    …</span><br><span class="line">else</span><br><span class="line">    if (b)</span><br><span class="line">        …</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line">if (a) &#123;</span><br><span class="line">    …</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if (b)</span><br><span class="line">        …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>当条件语句的执行体是空语句的时候，用一个花括号</li>
</ul>
  <figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="keyword">while</span> (a);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="keyword">while</span> (a) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="圆括号"><a href="#圆括号" class="headerlink" title="圆括号"></a>圆括号</h2><ul>
<li>圆括号用来给语句分组</li>
</ul>
  <figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line">if <span class="punctuation">(</span>a <span class="meta">&amp;&amp; b || c)</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line">if <span class="punctuation">(</span><span class="punctuation">(</span>a <span class="meta">&amp;&amp; b) || c)</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Wrong</span></span><br><span class="line">a <span class="punctuation">+</span> b <span class="meta">&amp; c</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="punctuation">(</span>a <span class="punctuation">+</span> b<span class="punctuation">)</span> <span class="meta">&amp; c</span></span><br></pre></td></tr></table></figure>

<h2 id="Switch-语句"><a href="#Switch-语句" class="headerlink" title="Switch 语句"></a>Switch 语句</h2><ul>
<li>case标签和switch在同一列</li>
<li>每一个case语句的末尾都要有一个break语句或return语句，除非因功能需要故意不加或另外一个case是紧跟上一个case的。</li>
</ul>
  <figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (myEnum) &#123;</span><br><span class="line"><span class="keyword">case</span> Value1:</span><br><span class="line">  doSomething();</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> Value2:</span><br><span class="line"><span class="keyword">case</span> Value3:</span><br><span class="line">  doSomethingElse();</span><br><span class="line">  <span class="comment">// fall through</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">  defaultHandling();</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="跳转语句"><a href="#跳转语句" class="headerlink" title="跳转语句"></a>跳转语句</h2><ul>
<li>包括：break, continue, return, and goto</li>
<li>不要在跳转关键词后边加else</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"> if (thisOrThat)</span><br><span class="line">     return;</span><br><span class="line"> else</span><br><span class="line">     <span class="built_in">somethingElse</span>();</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Correct</span></span><br><span class="line"> if (thisOrThat)</span><br><span class="line">     return;</span><br><span class="line"> <span class="built_in">somethingElse</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li>例外：如果这段代码是固有的对称结构，用else实现视觉上的对称也是可以的</li>
</ul>
<h2 id="换行"><a href="#换行" class="headerlink" title="换行"></a>换行</h2><ul>
<li>每行代码不多于100个字符；若有必要，用括号括起来</li>
<li>逗号在行尾。操作符在新行的开头位置，这是因为编辑器过窄的话，操作符在行尾容易看不见</li>
<li>换行时尽量避免行于行之间看起来参差不齐</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line">if (longExpression +</span><br><span class="line">    otherLongExpression +</span><br><span class="line">    otherOtherLongExpression) &#123;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line">if (longExpression</span><br><span class="line">    + otherLongExpression</span><br><span class="line">    + otherOtherLongExpression) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="一般例外与Artistic-style选项"><a href="#一般例外与Artistic-style选项" class="headerlink" title="一般例外与Artistic style选项"></a>一般例外与Artistic style选项</h2><ul>
<li>一般例外：当严格遵守一条规范会让你的代码看起来很糟糕时，废弃这条规范</li>
<li>用astyle格式化代码时的选项</li>
</ul>
  <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">--style</span>=kr </span><br><span class="line"><span class="attribute">--indent</span>=spaces=4 </span><br><span class="line"><span class="attribute">--align-pointer</span>=name </span><br><span class="line"><span class="attribute">--align-reference</span>=name </span><br><span class="line">--convert-tabs </span><br><span class="line">--attach-namespaces</span><br><span class="line"><span class="attribute">--max-code-length</span>=100 </span><br><span class="line"><span class="attribute">--max-instatement-indent</span>=120 </span><br><span class="line">--pad-header</span><br><span class="line">--pad-oper</span><br></pre></td></tr></table></figure>

<ul>
<li>例如，你可以这样用以上的代码</li>
</ul>
  <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">int foo</span> = some_really_long_function_name(and_another_one_to_drive_the_point_home(</span><br><span class="line">        first_argument, second_argument, third_arugment));</span><br></pre></td></tr></table></figure>

<h2 id="C-特性"><a href="#C-特性" class="headerlink" title="C++特性"></a>C++特性</h2><ul>
<li>不要使用异常处理</li>
<li>不要使用运行时类型识别</li>
<li>理智地使用模板，不要仅仅因为你会用就去用</li>
</ul>
<h2 id="Qt源码中的规范"><a href="#Qt源码中的规范" class="headerlink" title="Qt源码中的规范"></a>Qt源码中的规范</h2><ul>
<li>所有代码都是ascii，使用者如果不确定的话，只可能是7字节</li>
<li>每一个QObject的子类都必须有Q_OBJECT宏，即使这个类没用到信号或槽。否则qobject_cast将不能使用</li>
<li>在connect语句中，使信号和槽的参数规范化（参看 QMetaObject::normalizedSignature），可以加快信号&#x2F;槽的查找速度。可以使用qtrepotools&#x2F;util&#x2F;normalize规范已有代码</li>
</ul>
<h2 id="包含头文件"><a href="#包含头文件" class="headerlink" title="包含头文件"></a>包含头文件</h2><ul>
<li>用#include</li>
</ul>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;qstring.h&gt;</span> <span class="comment">// Qt class</span></span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;new&gt;</span> <span class="comment">// STL stuff</span></span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;limits.h&gt;</span> <span class="comment">// system stuff</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果你想包含qplatforms.h，把它作为第一个被包含的头文件</li>
<li>如果你想包含私有头文件，要十分小心。使用以下的语法而不用管whatever_p.h属于哪个模块在哪个文件目录下</li>
</ul>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;private/whatever_p.h&gt;</span>1</span></span><br></pre></td></tr></table></figure>

<h2 id="编译器-平台特定问题"><a href="#编译器-平台特定问题" class="headerlink" title="编译器&#x2F;平台特定问题"></a>编译器&#x2F;平台特定问题</h2><ul>
<li>使用三目运算符 ？时要特别小心，如果每次的返回值的类型可能不一样的话，一些编译器会在运行时生成冲突的代码（此时编译器甚至不会报错）</li>
</ul>
  <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QString s;</span><br><span class="line"><span class="keyword">return</span> condition ? s : <span class="string">&quot;nothing&quot;</span>; <span class="comment">// crash at runtime - QString vs. const char *</span></span><br></pre></td></tr></table></figure>

<ul>
<li>要特别小心对齐问题。无论何时，当一个指针被cast后的对齐数是增加的时候，它都可能会崩溃。例如一个const char <em>被cast成了cons int</em>，当cast之后的数字不得不在2或4个字节之间对齐时，指针就会在机器上崩溃。</li>
<li>使用一个union强迫编译器正确地对齐变量，示例如下，你可以确定AlignHelper中所有的实例都和int边界对齐了</li>
</ul>
  <figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">union AlignHelper &#123;</span><br><span class="line">    char c<span class="comment">;</span></span><br><span class="line">    int i<span class="comment">;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>任何需要需要执行构造函数或相关代码进行初始化的实例，都不能用作库代码中的全局实例。因为当构造函数或代码将要运行的时候，该实例还没有被定义（在第一次调用该实例时，在加载库时，在执行main()之前）</li>
</ul>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global scope</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> QString x; <span class="comment">// Wrong - default constructor needs to be run to initialize x</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> QString y = <span class="string">&quot;Hello&quot;</span>; <span class="comment">// Wrong - constructor that takes a const char * has to be run</span></span><br><span class="line">QString z; <span class="comment">// super wrong</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> i = <span class="built_in">foo</span>(); <span class="comment">// wrong - call time of foo() undefined, might not be called at all</span></span><br></pre></td></tr></table></figure>

<ul>
<li>你可以按照下面的方法去做：</li>
</ul>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global scope</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> x[] = <span class="string">&quot;someText&quot;</span>; <span class="comment">// Works - no constructor must be run, x set at compile time</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> y = <span class="number">7</span>; <span class="comment">// Works - y will be set at compile time</span></span><br><span class="line"><span class="type">static</span> MyStruct s = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;; <span class="comment">// Works - will be initialized statically, no code being run</span></span><br><span class="line"><span class="type">static</span> QString *ptr = <span class="number">0</span>; <span class="comment">// Pointers to objects are ok - no code needed to be run to initialize ptr</span></span><br></pre></td></tr></table></figure>

<ul>
<li>用Q_GLOBAL_STATIC定义全局实例</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Q_GLOBAL_STATIC</span>(QString, s)</span><br><span class="line">  </span><br><span class="line">void <span class="built_in">foo</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">s</span>()-&gt;<span class="built_in">append</span>(&quot;moo&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>char型变量是有符号的还是无符号的取决于它运行环境的架构。如果你明确地想使用一个signed或unsinged char，就使用signed char或unsigned char。以下代码运行在把char默认为无符号的平台上时，其条件判断恒为真。</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> char c; <span class="comment">// c can&#x27;t be negative if it is unsigned</span></span><br><span class="line"><span class="comment">/********/</span></span><br><span class="line"><span class="comment">/*******/</span></span><br><span class="line"> if (c &gt; <span class="number">0</span>) &#123; … &#125; <span class="comment">// WRONG - condition is always true on platforms where the default is unsigned</span></span><br></pre></td></tr></table></figure>

<ul>
<li>避免64位的枚举值<ul>
<li>嵌入式应用系统二进制接口将所有的枚举类型的值硬编码成32位int值</li>
<li>微软的编译器不支持64位的枚举值</li>
</ul>
</li>
</ul>
<h2 id="编程美学"><a href="#编程美学" class="headerlink" title="编程美学"></a>编程美学</h2><ul>
<li>偏爱用枚举值定义常量而非用const int或defines<ul>
<li>枚举值会在编译时被编译器用实际值替换掉，因而运行时得出结果的速度更快</li>
<li>defines不是命名空间安全的（并且看起来很丑）</li>
</ul>
</li>
<li>偏爱使用冗长而详细的参数名</li>
<li>当重新实现一个虚方法时，不要在头文件中用virtual关键字，在Qt5中，用 Q_DECL_OVERRIDE宏在函数声明之后，分号之前注解它。</li>
</ul>
<h2 id="避免出现的事"><a href="#避免出现的事" class="headerlink" title="避免出现的事"></a>避免出现的事</h2><ul>
<li>不要继承模版&#x2F;工具类<ul>
<li>其析构函数不是虚函数，会导致潜在的内存泄漏</li>
<li>其符号不是导出的（not exported）,会导致符号冲突</li>
</ul>
</li>
</ul>
  <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如：A库有以下代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Q_EXPORT</span> <span class="symbol">X: <span class="symbol">public</span></span> <span class="symbol">QList</span>&lt;<span class="symbol">QVariant</span>&gt; &#123;&#125;;</span><br><span class="line"><span class="comment">//B库有以下代码  </span></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Q_EXPORT</span> <span class="symbol">Y: <span class="symbol">public</span></span> <span class="symbol">QList</span>&lt;<span class="symbol">QVariant</span>&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>  这样，QList的符号就被导出了两次</p>
<ul>
<li>不要把const-iterator和none-const iterator搞混。</li>
</ul>
  <figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Container::const_iterator <span class="keyword">it</span> = c.begin(); <span class="keyword">it</span> != c.<span class="keyword">end</span>(); ++<span class="keyword">it</span>)<span class="comment"> // W R O N G</span></span><br><span class="line"><span class="keyword">for</span> (Container::const_iterator <span class="keyword">it</span> = c.cbegin(); <span class="keyword">it</span> != c.cend(); ++<span class="keyword">it</span>)<span class="comment"> // Right</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Q[Core]Application 是一个单例类。同一时间只能有一个实例在运行，但是这个实例可以被销毁，新的实例将可以被创建，如下的代码容易产生崩溃</li>
</ul>
  <figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static QObject *obj = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">if (!obj)</span><br><span class="line">    obj = new QObject(<span class="name">QCoreApplication</span>:<span class="symbol">:instance</span>())<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>当QCoreApplication application被销毁时，obj成为了迷途指针(野指针)，可以用 Q_GLOBAL_STATIC 和qAddPostRoutine清理</li>
<li>为了尽可能地支持静态关键词，避免使用匿名命名空间。编译单位内的一个静态名称可以保证它是一个内部连接。而一个位于匿名命名空间的名称，C++规定它是一个外部链接。</li>
</ul>
<h2 id="二进制和源兼容性"><a href="#二进制和源兼容性" class="headerlink" title="二进制和源兼容性"></a>二进制和源兼容性</h2><ul>
<li>定义<ul>
<li>Qt 4.0.0是一个主版本，Qt 4.1.0是一个微调版本，Qt 4.1.1是一个补丁版本。</li>
<li>在此之后的版本：代码链接到之前版本的库可以运行</li>
<li>在此之前的版本：代码链接到一个新版本的库只对旧版本的库能工作。</li>
<li>源码兼容性：源码在不修改的情况下进行编译</li>
</ul>
</li>
<li>微调版本保持向后的二进制兼容性</li>
<li>补丁版本保持向后和向前的二进制兼容性<ul>
<li>不要增加或去掉任何公共API（例如公共的函数，公有&#x2F;保护&#x2F;私有的方法）</li>
<li>不要重新实现方法（甚至不要修改内连方法，也不要修改保护&#x2F;私有方法）</li>
</ul>
</li>
<li>当继承一个QWidget的子类时，总是要去重写event(),即使它是空的。这将使你的widget类可以被操作而不破坏其二进制兼容性</li>
<li>所有从Qt中导出的方法，必须以q或Q开头。用autotest符号检测是否存在违反此规则的情况。（此为Qt本身要求的规范，我们不需要严格执行。）</li>
</ul>
<h2 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h2><ul>
<li>请记住，Qt中，除了Tests和WibKit，全部都是处在命名空间中的代码</li>
</ul>
<h2 id="float值"><a href="#float值" class="headerlink" title="float值"></a>float值</h2><ul>
<li>没有float值之间的比较<ul>
<li>用qFuzzyCompare去和delta比较其值</li>
<li>用qIsNull去判断float值是不是二进制0，而不是和0.0比较。</li>
</ul>
</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[static]</span> bool <span class="built_in">qFuzzyCompare</span>(double p1, double p2)</span><br><span class="line"><span class="comment">// Instead of comparing with 0.0</span></span><br><span class="line"><span class="built_in">qFuzzyCompare</span>(<span class="number">0.0</span>,<span class="number">1.0</span>e-<span class="number">200</span>); <span class="comment">// This will return false</span></span><br><span class="line"><span class="comment">// Compare adding 1 to both values will fix the problem</span></span><br><span class="line"><span class="built_in">qFuzzyCompare</span>(<span class="number">1</span> + <span class="number">0.0</span>, <span class="number">1</span> + <span class="number">1.0</span>e-<span class="number">200</span>); <span class="comment">// This will return true</span></span><br></pre></td></tr></table></figure>

<h2 id="虚方法"><a href="#虚方法" class="headerlink" title="虚方法"></a>虚方法</h2><ul>
<li>不要在子类中隐藏父类的虚方法：假设A类中有个virtual int val()方法，以下代码是不规范的。</li>
</ul>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>: <span class="title">public</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    using A::val;</span><br><span class="line">    <span class="keyword">int</span> val(<span class="keyword">int</span> <span class="keyword">x</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h2><ul>
<li>在操作一个预处理器之前，先判断它是否被定义</li>
</ul>
  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#if</span> Foo == <span class="number">0</span>  <span class="comment">// W R O N G</span></span><br><span class="line"><span class="selector-id">#if</span> <span class="built_in">defined</span>(Foo) &amp;&amp; (Foo == <span class="number">0</span>) <span class="comment">// Right</span></span><br><span class="line"><span class="selector-id">#if</span> Foo - <span class="number">0</span> == <span class="number">0</span> <span class="comment">// Clever, are we? Use the one above instead, for better readability</span></span><br></pre></td></tr></table></figure>

<h2 id="类的成员命名"><a href="#类的成员命名" class="headerlink" title="类的成员命名"></a>类的成员命名</h2><ul>
<li>成员变量一般为名词</li>
<li>函数成员一般为动词&#x2F;动词+名词，但是当动词为get时，get常常省略。当返回值为Bool型变量时，函数名一般以前缀’is’开头</li>
</ul>
  <figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setColor</span>(<span class="params"><span class="keyword">const</span> QColor&amp; c</span>)</span>;</span><br><span class="line">    <span class="function">QColor <span class="title">color</span>() <span class="keyword">const</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setDirty</span>(<span class="params"><span class="built_in">bool</span> b</span>)</span>;</span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">isDirty</span>() <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Q_SLOTS:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slotParentChanged</span>()</span>;</span><br></pre></td></tr></table></figure>

<h2 id="定义私有类"><a href="#定义私有类" class="headerlink" title="定义私有类"></a>定义私有类</h2>  <figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//.h文件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KFooPrivate</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KFoo</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/* public members */</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">const</span> QScopedPointer&lt;KFooPrivate&gt; d;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//.cpp文件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KFooPrivate</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">int</span> someInteger;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">KFoo::KFoo() : d(<span class="keyword">new</span> KFooPrivate)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">KFoo::~KFoo()</span><br><span class="line">&#123; </span><br><span class="line"> <span class="comment">// You must define a non-inline destructor in the .cpp file, even if it is empty</span></span><br><span class="line"> <span class="comment">// else, a default one will be built in placed where KFooPrivate is only forward</span></span><br><span class="line"> <span class="comment">// declare, leading to error in the destructor of QScopedPointer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="标记-flags"><a href="#标记-flags" class="headerlink" title="标记(flags)"></a>标记(flags)</h2><ul>
<li>避免使用无意义的bool型参数，以下是糟糕的例子</li>
</ul>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> QString <span class="title">KApplication::makeStdCaption</span><span class="params">( <span class="type">const</span> QString &amp;caption,</span></span></span><br><span class="line"><span class="params"><span class="function">                                             <span class="type">bool</span> withAppName,</span></span></span><br><span class="line"><span class="params"><span class="function">                                             <span class="type">bool</span> modified)</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>解决方案是用QFlags。即使其中只有一个值，也建议这么做，这将允许你以后很方便地添加更多的值并且保持二进制兼容性。</li>
<li>示例如下：</li>
</ul>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KApplication</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/* [...] */</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">StandardCaptionOption</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Indicates to include the application name</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        WithApplicationName = <span class="number">0x01</span>,</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Note in the caption that there is unsaved data</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Modified = <span class="number">0x02</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_ invoke__">Q_DECLARE_FLAGS</span>(StandardCaptionOptions, </span><br><span class="line">                    StandardCaptionOption)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Builds a caption using a standard layout.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userCaption The caption string you want to display</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> options a set of flags from MakeStandartCaptionOption</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">static</span> QString <span class="title function_ invoke__">makeStandardCaption</span>(<span class="keyword">const</span> QString&amp; userCaption,</span><br><span class="line">       <span class="keyword">const</span> StandardCaptionOptions&amp; options = WithApplicationName);</span><br><span class="line">    <span class="comment">/* [...] */</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_ invoke__">Q_DECLARE_OPERATORS_FOR_FLAGS</span>(<span class="title class_">KApplication</span>::<span class="variable constant_">StandardCaptionOptions</span>)</span><br></pre></td></tr></table></figure>

<h2 id="常引用"><a href="#常引用" class="headerlink" title="常引用"></a>常引用</h2><ul>
<li>每一个对象，只要它不是基础类型(int, float, bool, enum, or pointers)，都应该以常量引用的形式传递。这条使得代码运行得更快。即使一个对象是隐式共享的，也应该这么做</li>
</ul>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QString <span class="title">myMethod</span><span class="params">( <span class="type">const</span> QString&amp; foo,</span></span></span><br><span class="line"><span class="params"><span class="function">                  <span class="type">const</span> QPixmap&amp; bar,</span></span></span><br><span class="line"><span class="params"><span class="function">                  <span class="type">int</span> number )</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>避免常引用的返回类型</li>
</ul>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> QList&lt;<span class="type">int</span>&gt; &amp;<span class="title">someProperty</span><span class="params">()</span> <span class="type">const</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>有种情况还是可以使用常引用的返回类型的，这种情况下，此处代码的运行性能至关重要，此处的代码实现也是固定的，思考再三之后，你可以写成这样：</li>
</ul>
  <figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QList&lt;<span class="built_in">int</span>&gt; <span class="title">someProperty</span>() <span class="keyword">const</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="库代码中的信号-槽"><a href="#库代码中的信号-槽" class="headerlink" title="库代码中的信号&amp;槽"></a>库代码中的信号&amp;槽</h2><ul>
<li>在库代码中，用Q_SIGNALS 和 Q_SLOTS 代替 signals 和 slots。它们在语法上是相等的，用以避免和boost信号的冲突。和python协同工作时使用”slots”</li>
</ul>
<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><ul>
<li>设置属性时用Q_PROPERTY。理由是属性可以被javascript 接口访问到</li>
<li>moc中设置特定的flag用 QMetaProperty.</li>
</ul>
<h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><ul>
<li>为了使构造函数被错误使用的可能性降到最小，每一个构造函数（除了拷贝构函数）都应该检查自己是否需要加上explicit 符号。</li>
</ul>
<h2 id="include"><a href="#include" class="headerlink" title="#include"></a>#include</h2><ul>
<li>尽量减少在头文件中包含其他头文件的数量</li>
<li>如下所示，可以用前置声明法</li>
</ul>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;kfoobase.h&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KBar</span></span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KFoo</span><span class="attr"> : public</span> <span class="title">KFooBase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    public:</span><br><span class="line">        <span class="regexp">/* [...] */</span></span><br><span class="line">        void myMethod(const KBar &amp;bar);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>包含Qt自带头文件或外部库的头文件用尖括号</li>
</ul>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDate&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;zlib.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>包含自己的项目头文件用双引号</li>
</ul>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myclass.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>包含Qt类的头文件不用包含它所在的模块名</li>
</ul>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//正确示例</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDate&gt;</span> <span class="comment">//correct</span></span></span><br><span class="line"><span class="comment">//错误示例</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtCore/QDate&gt;</span> <span class="comment">//incorrect, no need to specify the module QtCore</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtCore&gt;</span>   <span class="comment">//incorrect, do not include the top-level Qt module</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>假如你有一个Foo类，有Foo.h文件和Foo.cpp文件，在你的Foo.cpp文件中，要先包含Foo.h文件再包含其他头文件</li>
<li>如果你的代码写成下面这样：</li>
</ul>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//.h文件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Bar <span class="title">getBar</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">.cpp文件</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;bar.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;foo.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>你的cpp文件能够正常编译，但当其他人用到Foo.h文件时，如果没有包含bar.h文件，编译器将不能进行编译。</li>
<li>因此在cpp文件中首先包含其相应的.h文件，是为了.h文件能够被其他人使用</li>
<li>头文件必须进行包含保护：避免多次包含而引起多次的编译</li>
</ul>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MYFOO_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYFOO_H</span></span><br><span class="line">... &lt;stuff&gt;...</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* MYFOO_H */</span></span></span><br></pre></td></tr></table></figure>

<h2 id="信号-槽的标准化写法"><a href="#信号-槽的标准化写法" class="headerlink" title="信号&amp;槽的标准化写法"></a>信号&amp;槽的标准化写法</h2><ul>
<li>标准化的写法增加代码可读性</li>
<li>不标准的写法可能是如下写法</li>
</ul>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QObject::<span class="built_in">connect</span>(this, <span class="built_in">SIGNAL</span>( <span class="built_in">newValue</span>(const QString&amp;,</span><br><span class="line">                                        const MyNamespace::Type&amp;) ),</span><br><span class="line">                 other, <span class="built_in">SLOT</span>( <span class="built_in">value</span>(const QString &amp;) ));</span><br></pre></td></tr></table></figure>

<ul>
<li>建议采用以下写法</li>
</ul>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QObject::<span class="built_in">connect</span>(this, <span class="built_in">SIGNAL</span>(<span class="built_in">newValue</span>(QString,MyNamespace::Type)),</span><br><span class="line">                 other, <span class="built_in">SLOT</span>(<span class="built_in">value</span>(QString)));</span><br></pre></td></tr></table></figure>

<h2 id="API-最小化原则"><a href="#API-最小化原则" class="headerlink" title="API-最小化原则"></a>API-最小化原则</h2><ul>
<li>最小化的API意味着，每个API中使用尽可能少的类，每个类中使用尽可能少的公用成员(public members)。这样做的好处是使得API易于理解、记忆、调试和修改</li>
</ul>
<h2 id="API-完整性原则"><a href="#API-完整性原则" class="headerlink" title="API-完整性原则"></a>API-完整性原则</h2><ul>
<li>一个完整的API意味着实现它预期的功能。这和最小化的特性可能会产生冲突。另外如果一个成员函数出现在一个错误的类里，API的使用者们可能会找不到它</li>
</ul>
<h2 id="API-有明确和简单的语意"><a href="#API-有明确和简单的语意" class="headerlink" title="API-有明确和简单的语意"></a>API-有明确和简单的语意</h2><ul>
<li>正如其他的设计工作一样，你应当遵守“最小惊奇”原则。一般情况下，这是容易做到的。请不要用解决方案所解决的问题过于笼统。（例如Qt3中的QMimeSourceFactory，应该被叫做 QImageLoader从而作为一个不同的API）</li>
</ul>
<h2 id="API-直观性原则"><a href="#API-直观性原则" class="headerlink" title="API-直观性原则"></a>API-直观性原则</h2><ul>
<li>不同的经历和背景让人们对什么具有“直观性”什么不具有，有着不同的感觉。以下情况我们可以认为一个API是直观的</li>
<li>一个稍有一些经验的用户在不看帮助文档的情况下，能够正确地使用该API</li>
<li>一个从不知道该API的用户能够看懂使用该API写成的代码</li>
</ul>
<h2 id="API-便于记住"><a href="#API-便于记住" class="headerlink" title="API-便于记住"></a>API-便于记住</h2><ul>
<li>选择一个一致的和准确的命名约定</li>
<li>使用可识别的模式和概念</li>
<li>避免使用缩写</li>
</ul>
<h2 id="API-易读性原则"><a href="#API-易读性原则" class="headerlink" title="API-易读性原则"></a>API-易读性原则</h2><ul>
<li>代码是一次写成，但需要多次阅读，易读的代码可能写的时候会花费稍长的时间，但是在整个产品的生命周期之中，但节省你很多阅读和理解的时间</li>
<li>最后，记住不同的用户会用到一个API的不同部分。虽然直接使用Qt的类生成一个实例是直观的，但我们还是有理由期待用户在派生一个Qt的类之前先阅读它的官方文档</li>
</ul>
<h2 id="API-静态多态性"><a href="#API-静态多态性" class="headerlink" title="API-静态多态性"></a>API-静态多态性</h2><ul>
<li>相似的类应该有相似的API，这可以用继承的方式实现，这用到了运行时多态。</li>
<li>但是多态也可以发生在设计类的时候，例如，你把一个对象的类型从QProgressBar 换成Qslider，或者从QString 换成QByteArray，你会发现它们之间的API是何其的相似，以至于你可以很简单地用一个去替换另一个。这就是我们所说的“静态多态性”</li>
<li>“静态多态性”使得记住这些API和使用编程模式都更为简单了。因此，为一系列相关类设计相似的API好过为每个类设计独立的、更切合自身的API</li>
<li>一般来说，在Qt中我们偏爱使用“静态多态性”而非实际的继承，除非一些不可控制的原因要求我们不得不如此。</li>
</ul>
<h2 id="常引用-1"><a href="#常引用-1" class="headerlink" title="常引用"></a>常引用</h2><ul>
<li>如果一个类型超过16个字节，用常引用传递它。</li>
<li>如果一个类型有一个非平凡拷贝构造函数(non-trivial copy-constructor)，或一个非平凡析构函数(non-trivial destructor)，用常引用传递它的值而避免使用以上方法</li>
<li>所有的其他类型都应该直接传递其值</li>
</ul>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">setAge</span><span class="params">(<span class="type">int</span> age)</span></span>; </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setCategory</span><span class="params">(QChar cat)</span></span>; </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setName</span><span class="params">(QLatin1String name)</span></span>; </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setAlarm</span><span class="params">(<span class="type">const</span> QSharedPointer&lt;Alarm&gt; &amp;alarm)</span></span>; <span class="comment">// const-ref is much faster than running copy-constructor and destructor </span></span><br><span class="line"><span class="comment">// QDate, QTime, QPoint, QPointF, QSize, QSizeF, QRect are good examples of other classes you should pass by value.</span></span><br></pre></td></tr></table></figure>

<h2 id="枚举类型和枚举值的命名"><a href="#枚举类型和枚举值的命名" class="headerlink" title="枚举类型和枚举值的命名"></a>枚举类型和枚举值的命名</h2><ul>
<li>以下的示例说明了枚举值命名时给出一般的名称的危险</li>
</ul>
  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">namespace Qt</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Corner</span> &#123; TopLeft, BottomRight, … &#125;;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">CaseSensitivity</span> &#123; Insensitive, Sensitive &#125;;</span><br><span class="line">…</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">tabWidget<span class="punctuation">-&gt;</span><span class="title function_ invoke__">setCornerWidget</span>(widget, Qt::TopLeft);</span><br><span class="line"><span class="type">str</span>.<span class="title function_ invoke__">indexOf</span>(<span class="string">&quot;$(QTDIR)&quot;</span>, Qt::Insensitive);</span><br></pre></td></tr></table></figure>

<ul>
<li>在最后一行，Insensitive 是什么含义呢？这是不易于理解的。因此，枚举值命名时，至少重复枚举类型名中的一个字母</li>
</ul>
  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">namespace Qt</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Corner</span> &#123; TopLeftCorner, BottomRightCorner, … &#125;;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">CaseSensitivity</span> &#123; CaseInsensitive,</span><br><span class="line">CaseSensitive &#125;;</span><br><span class="line">…</span><br><span class="line">&#125;;</span><br><span class="line">tabWidget<span class="punctuation">-&gt;</span><span class="title function_ invoke__">setCornerWidget</span>(widget, Qt::TopLeftCorner);</span><br><span class="line"><span class="type">str</span>.<span class="title function_ invoke__">indexOf</span>(<span class="string">&quot;$(QTDIR)&quot;</span>, Qt::CaseInsensitive);</span><br></pre></td></tr></table></figure>

<h2 id="企图少写代码的陷阱"><a href="#企图少写代码的陷阱" class="headerlink" title="企图少写代码的陷阱"></a>企图少写代码的陷阱</h2><ul>
<li>不要为了图方便少些一些代码。因为代码是一次书写，后期不止一次地要去理解。例如</li>
</ul>
  <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">QSlider</span> *slider = new QSlider(<span class="number">12</span>, <span class="number">18</span>, <span class="number">3</span>, <span class="number">13</span>, Qt::Vertical, <span class="number">0</span>, <span class="string">&quot;volume&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>改成下面的方式会更容易理解</li>
</ul>
  <figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QSlider *slider = new QSlider(Qt::Vertical);</span><br><span class="line"><span class="function"><span class="title">slider</span>-&gt;</span>setRange(<span class="number">12</span>, <span class="number">18</span>);</span><br><span class="line"><span class="function"><span class="title">slider</span>-&gt;</span>setPageStep(<span class="number">3</span>);</span><br><span class="line"><span class="function"><span class="title">slider</span>-&gt;</span>setValue(<span class="number">13</span>);</span><br><span class="line"><span class="function"><span class="title">slider</span>-&gt;</span>setObjectName(<span class="string">&quot;volume&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Bool型参数陷阱"><a href="#Bool型参数陷阱" class="headerlink" title="Bool型参数陷阱"></a>Bool型参数陷阱</h2><ul>
<li>这方面经典的例子是Qt中的repaint()函数，它的bool型参数用来标记窗口的背景是否被擦除。用法如下：</li>
</ul>
  <figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">widget</span>-&gt;</span>repaint(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>上面的代码很容易被理解成“不重新绘制”</li>
<li>上面代码的中用到的repaint()函数，其设计时的考虑无非是为了可以少定义一个函数，结果反而带来了误解，有多少人可以对以下三行代码所代表队含义进行准确地区分呢？</li>
</ul>
  <figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">widget</span>-&gt;</span>repaint();</span><br><span class="line"><span class="function"><span class="title">widget</span>-&gt;</span>repaint(<span class="literal">true</span>);</span><br><span class="line"><span class="function"><span class="title">widget</span>-&gt;</span>repaint(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>稍微好一点的做法是这样</li>
</ul>
  <figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">widget-&gt;<span class="built_in">repaint</span>();</span><br><span class="line">widget-&gt;<span class="built_in">repaintWithoutErasing</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li>还有一个很明显的做法是尽可能地用枚举类型代替bool型参数，请对比以下的两行代码</li>
</ul>
  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">str</span>.<span class="title function_ invoke__">replace</span>(<span class="string">&quot;USER&quot;</span>, user, <span class="literal">false</span>); <span class="comment">// Qt 3</span></span><br><span class="line"><span class="type">str</span>.<span class="title function_ invoke__">replace</span>(<span class="string">&quot;USER&quot;</span>, user, Qt::CaseInsensitive); <span class="comment">// Qt 4</span></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="https://wiki.qt.io/Qt_Contribution_Guidelines">https://wiki.qt.io/Qt_Contribution_Guidelines</a></li>
<li><a href="https://wiki.qt.io/Qt_Coding_Style">https://wiki.qt.io/Qt_Coding_Style</a></li>
<li><a href="https://wiki.qt.io/Coding_Conventions">https://wiki.qt.io/Coding_Conventions</a></li>
<li><a href="https://community.kde.org/Policies/Library_Code_Policy">https://community.kde.org/Policies/Library_Code_Policy</a></li>
<li><a href="https://wiki.qt.io/UI_Text_Conventions">https://wiki.qt.io/UI_Text_Conventions</a></li>
<li><a href="https://wiki.qt.io/API_Design_Principles">https://wiki.qt.io/API_Design_Principles</a></li>
<li><a href="http://doc.qt.io/qt-5/qml-codingconventions.html">http://doc.qt.io/qt-5/qml-codingconventions.html</a></li>
<li><a href="https://google.github.io/styleguide/cppguide.html">https://google.github.io/styleguide/cppguide.html</a></li>
</ol>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2021/04/100669.html" class="pre-post btn btn-default" title='QT 插件(QtPlugin)教程'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">QT 插件(QtPlugin)教程</span>
        </a>
    
    
        <a href="/archives/2021/03/100667.html" class="next-post btn btn-default" title='CMake 完整使用教程'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">CMake 完整使用教程</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>


    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E"><span class="toc-text">变量声明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E4%B8%80%E8%88%AC%E5%91%BD%E5%90%8D%E6%B3%95"><span class="toc-text">变量一般命名法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E5%9C%A8Qt%E4%B8%AD%E7%9A%84%E5%91%BD%E5%90%8D"><span class="toc-text">变量在Qt中的命名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E7%99%BD%E8%A1%8C%E4%B8%8E%E7%A9%BA%E6%A0%BC%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">空白行与空格的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E9%92%88%E7%9A%84%E4%B9%A6%E5%86%99%E8%A7%84%E8%8C%83"><span class="toc-text">指针的书写规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E5%85%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text">二元操作符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%97%E5%8F%B7"><span class="toc-text">逗号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%8F%B7"><span class="toc-text">分号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%95%E5%8F%B7"><span class="toc-text">井号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%8F%B7"><span class="toc-text">引号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cast"><span class="toc-text">cast</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E5%8F%A5"><span class="toc-text">语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%B1%E6%8B%AC%E5%8F%B7%E5%86%99%E6%B3%95"><span class="toc-text">花括号写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%B1%E6%8B%AC%E5%8F%B7%E7%94%A8%E9%80%94"><span class="toc-text">花括号用途</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%86%E6%8B%AC%E5%8F%B7"><span class="toc-text">圆括号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Switch-%E8%AF%AD%E5%8F%A5"><span class="toc-text">Switch 语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%B3%E8%BD%AC%E8%AF%AD%E5%8F%A5"><span class="toc-text">跳转语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8D%A2%E8%A1%8C"><span class="toc-text">换行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E4%BE%8B%E5%A4%96%E4%B8%8EArtistic-style%E9%80%89%E9%A1%B9"><span class="toc-text">一般例外与Artistic style选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-%E7%89%B9%E6%80%A7"><span class="toc-text">C++特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Qt%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E8%A7%84%E8%8C%83"><span class="toc-text">Qt源码中的规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-text">包含头文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%99%A8-%E5%B9%B3%E5%8F%B0%E7%89%B9%E5%AE%9A%E9%97%AE%E9%A2%98"><span class="toc-text">编译器&#x2F;平台特定问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E7%BE%8E%E5%AD%A6"><span class="toc-text">编程美学</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E5%87%BA%E7%8E%B0%E7%9A%84%E4%BA%8B"><span class="toc-text">避免出现的事</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%92%8C%E6%BA%90%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="toc-text">二进制和源兼容性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-text">命名空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#float%E5%80%BC"><span class="toc-text">float值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%96%B9%E6%B3%95"><span class="toc-text">虚方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="toc-text">宏定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E6%88%90%E5%91%98%E5%91%BD%E5%90%8D"><span class="toc-text">类的成员命名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E7%A7%81%E6%9C%89%E7%B1%BB"><span class="toc-text">定义私有类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E8%AE%B0-flags"><span class="toc-text">标记(flags)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E5%BC%95%E7%94%A8"><span class="toc-text">常引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%93%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BF%A1%E5%8F%B7-%E6%A7%BD"><span class="toc-text">库代码中的信号&amp;槽</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-text">属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#include"><span class="toc-text">#include</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7-%E6%A7%BD%E7%9A%84%E6%A0%87%E5%87%86%E5%8C%96%E5%86%99%E6%B3%95"><span class="toc-text">信号&amp;槽的标准化写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-%E6%9C%80%E5%B0%8F%E5%8C%96%E5%8E%9F%E5%88%99"><span class="toc-text">API-最小化原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-%E5%AE%8C%E6%95%B4%E6%80%A7%E5%8E%9F%E5%88%99"><span class="toc-text">API-完整性原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-%E6%9C%89%E6%98%8E%E7%A1%AE%E5%92%8C%E7%AE%80%E5%8D%95%E7%9A%84%E8%AF%AD%E6%84%8F"><span class="toc-text">API-有明确和简单的语意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-%E7%9B%B4%E8%A7%82%E6%80%A7%E5%8E%9F%E5%88%99"><span class="toc-text">API-直观性原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-%E4%BE%BF%E4%BA%8E%E8%AE%B0%E4%BD%8F"><span class="toc-text">API-便于记住</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-%E6%98%93%E8%AF%BB%E6%80%A7%E5%8E%9F%E5%88%99"><span class="toc-text">API-易读性原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-%E9%9D%99%E6%80%81%E5%A4%9A%E6%80%81%E6%80%A7"><span class="toc-text">API-静态多态性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E5%BC%95%E7%94%A8-1"><span class="toc-text">常引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E5%92%8C%E6%9E%9A%E4%B8%BE%E5%80%BC%E7%9A%84%E5%91%BD%E5%90%8D"><span class="toc-text">枚举类型和枚举值的命名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%81%E5%9B%BE%E5%B0%91%E5%86%99%E4%BB%A3%E7%A0%81%E7%9A%84%E9%99%B7%E9%98%B1"><span class="toc-text">企图少写代码的陷阱</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bool%E5%9E%8B%E5%8F%82%E6%95%B0%E9%99%B7%E9%98%B1"><span class="toc-text">Bool型参数陷阱</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">参考资料</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2025&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>








<script src="/js/app.js?rev=@@hash.js"></script>


</body>
</html>