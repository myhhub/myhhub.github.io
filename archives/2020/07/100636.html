<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content=".net,csharp,wpf,mvvm,prism" />


    <meta name="description" content="介绍如何在.NET Core3环境下使用MVVM框架Prism基于区域Region的导航系统
在讲解Prism导航系统之前，我们先来看看一个例子,我在之前的demo项目创建一个登录界面：

我们..." />



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />

    <!--Title-->


<title>使用 Prism Unity 实现 .NET Core WPF MVVM 之六 导航系统 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    




<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">





    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx" />


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

<meta name="generator" content="Hexo 7.3.0"></head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="使用 Prism Unity 实现 .NET Core WPF MVVM 之六 导航系统">
            
	            使用 Prism Unity 实现 .NET Core WPF MVVM 之六 导航系统
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/back/">后端</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-none-link" href="/tags/net/" rel="tag">.net</a> <a class="tag-none-link" href="/tags/csharp/" rel="tag">csharp</a> <a class="tag-none-link" href="/tags/mvvm/" rel="tag">mvvm</a> <a class="tag-none-link" href="/tags/prism/" rel="tag">prism</a> <a class="tag-none-link" href="/tags/wpf/" rel="tag">wpf</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2020/07/12</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1710</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p>介绍如何在.NET Core3环境下使用MVVM框架Prism基于区域Region的导航系统</p>
<p>在讲解Prism导航系统之前，我们先来看看一个例子,我在之前的demo项目创建一个登录界面：</p>
<p><img src="/img/net/csharp/1294271-20200415110149251-1788714342.gif" alt="img"></p>
<p>我们看到这里是不是一开始想象到使用WPF带有的导航系统，通过Frame和Page进行页面跳转，然后通过导航日志的GoBack和GoForward实现后退和前进，其实这是通过使用Prism的导航框架实现的,下面我们来看看如何在Prism的MVVM模式下实现该功能</p>
<h1 id="一-区域导航"><a href="#一-区域导航" class="headerlink" title="一.区域导航"></a>一.区域导航</h1><p>我们在上一篇介绍了Prism的区域管理，而Prism的导航系统也是基于区域的，首先我们来看看如何在区域导航</p>
<h2 id="1-注册区域"><a href="#1-注册区域" class="headerlink" title="1.注册区域"></a>1.注册区域</h2><p>LoginWindow.xaml：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Window</span> <span class="attr">x:Class</span>=<span class="string">&quot;PrismMetroSample.Shell.Views.Login.LoginWindow&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:x</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:d</span>=<span class="string">&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:mc</span>=<span class="string">&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:local</span>=<span class="string">&quot;clr-namespace:PrismMetroSample.Shell.Views.Login&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:region</span>=<span class="string">&quot;clr-namespace:PrismMetroSample.Infrastructure.Constants;assembly=PrismMetroSample.Infrastructure&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">mc:Ignorable</span>=<span class="string">&quot;d&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:prism</span>=<span class="string">&quot;http://prismlibrary.com/&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xmlns:i</span>=<span class="string">&quot;http://schemas.microsoft.com/expression/2010/interactivity&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">Height</span>=<span class="string">&quot;600&quot;</span> <span class="attr">Width</span>=<span class="string">&quot;400&quot;</span> <span class="attr">prism:ViewModelLocator.AutoWireViewModel</span>=<span class="string">&quot;True&quot;</span> <span class="attr">ResizeMode</span>=<span class="string">&quot;NoResize&quot;</span> <span class="attr">WindowStartupLocation</span>=<span class="string">&quot;CenterScreen&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">Icon</span>=<span class="string">&quot;pack://application:,,,/PrismMetroSample.Infrastructure;Component/Assets/Photos/Home, homepage, menu.png&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">i:Interaction.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i:EventTrigger</span> <span class="attr">EventName</span>=<span class="string">&quot;Loaded&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">i:InvokeCommandAction</span> <span class="attr">Command</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;Binding LoginLoadingCommand&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">i:EventTrigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">i:Interaction.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Grid</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ContentControl</span> <span class="attr">prism:RegionManager.RegionName</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;x:Static region:RegionNames.LoginContentRegion&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span> <span class="attr">Margin</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Window</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="2-注册导航"><a href="#2-注册导航" class="headerlink" title="2.注册导航"></a>2.注册导航</h2><p>App.cs：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">protected override void <span class="built_in">RegisterTypes</span>(IContainerRegistry containerRegistry)</span><br><span class="line">&#123;</span><br><span class="line">      containerRegistry<span class="selector-class">.Register</span>&lt;IMedicineSerivce, MedicineSerivce&gt;();</span><br><span class="line">      containerRegistry<span class="selector-class">.Register</span>&lt;IPatientService, PatientService&gt;();</span><br><span class="line">      containerRegistry<span class="selector-class">.Register</span>&lt;IUserService, UserService&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//注册全局命令</span></span><br><span class="line">      containerRegistry<span class="selector-class">.RegisterSingleton</span>&lt;IApplicationCommands, ApplicationCommands&gt;();</span><br><span class="line">      containerRegistry<span class="selector-class">.RegisterInstance</span>&lt;IFlyoutService&gt;(Container.Resolve&lt;FlyoutService&gt;());</span><br><span class="line"></span><br><span class="line">      <span class="comment">//注册导航</span></span><br><span class="line">      containerRegistry<span class="selector-class">.RegisterForNavigation</span>&lt;LoginMainContent&gt;();</span><br><span class="line">      containerRegistry<span class="selector-class">.RegisterForNavigation</span>&lt;CreateAccount&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-区域导航"><a href="#3-区域导航" class="headerlink" title="3.区域导航"></a>3.区域导航</h2><p>LoginWindowViewModel.cs：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LoginWindowViewModel</span>:<span class="title">BindableBase</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IRegionManager _regionManager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IUserService _userService;</span><br><span class="line">    <span class="keyword">private</span> DelegateCommand _loginLoadingCommand;</span><br><span class="line">    <span class="keyword">public</span> DelegateCommand LoginLoadingCommand =&gt;</span><br><span class="line">            _loginLoadingCommand ?? (_loginLoadingCommand = <span class="keyword">new</span> DelegateCommand(ExecuteLoginLoadingCommand));</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ExecuteLoginLoadingCommand</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//在LoginContentRegion区域导航到LoginMainContent</span></span><br><span class="line">        _regionManager.RequestNavigate(RegionNames.LoginContentRegion, <span class="string">&quot;LoginMainContent&quot;</span>);</span><br><span class="line"></span><br><span class="line">         Global.AllUsers = _userService.GetAllUsers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginWindowViewModel</span>(<span class="params">IRegionManager regionManager, IUserService userService</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">          _regionManager = regionManager;</span><br><span class="line">          _userService = userService;            </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LoginMainContentViewModel.cs：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LoginMainContentViewModel</span> : <span class="title">BindableBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IRegionManager _regionManager;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DelegateCommand _createAccountCommand;</span><br><span class="line">    <span class="keyword">public</span> DelegateCommand CreateAccountCommand =&gt;</span><br><span class="line">            _createAccountCommand ?? (_createAccountCommand = <span class="keyword">new</span> DelegateCommand(ExecuteCreateAccountCommand));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//导航到CreateAccount</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ExecuteCreateAccountCommand</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">         Navigate(<span class="string">&quot;CreateAccount&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Navigate</span>(<span class="params"><span class="built_in">string</span> navigatePath</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">         <span class="keyword">if</span> (navigatePath != <span class="literal">null</span>)</span><br><span class="line">              _regionManager.RequestNavigate(RegionNames.LoginContentRegion, navigatePath);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginMainContentViewModel</span>(<span class="params">IRegionManager regionManager</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">         _regionManager = regionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/img/net/csharp/1294271-20200415110207403-430620532.gif" alt="img"></p>
<p>这里我们可以看到我们调用RegionMannager的RequestNavigate方法，其实这样看不能很好的说明是基于区域的做法，如果将换成下面的写法可能更好理解一点：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在LoginContentRegion区域导航到LoginMainContent</span></span><br><span class="line">_regionManager.RequestNavigate<span class="punctuation">(</span>RegionNames.LoginContentRegion<span class="punctuation">,</span> <span class="string">&quot;LoginMainContent&quot;</span><span class="punctuation">)</span><span class="punctuation">;</span></span><br></pre></td></tr></table></figure>

<p>换成</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//在LoginContentRegion区域导航到LoginMainContent</span><br><span class="line">IRegion region <span class="operator">=</span> _regionManager.Regions[RegionNames.LoginContentRegion]<span class="comment">;</span></span><br><span class="line">region.RequestNavigate(<span class="string">&quot;LoginMainContent&quot;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>其实RegionMannager的RequestNavigate源码也是大概实现也是大概如此，就是去调Region的RequestNavigate的方法，而Region的导航是实现了一个INavigateAsync接口：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">INavigateAsync</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">RequestNavigate</span><span class="params">(Uri <span class="keyword">target</span>, Action&lt;NavigationResult&gt; navigationCallback)</span></span>;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">RequestNavigate</span><span class="params">(Uri <span class="keyword">target</span>, Action&lt;NavigationResult&gt; navigationCallback, NavigationParameters navigationParameters)</span></span>;</span><br><span class="line">    </span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p>我们可以看到有RequestNavigate方法三个形参：</p>
<ul>
<li>target：表示将要导航的页面Uri</li>
<li>navigationCallback:导航后的回调方法</li>
<li>navigationParameters:导航传递参数(下面会详解)</li>
</ul>
<p>那么我们将上述加上回调方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在LoginContentRegion区域导航到LoginMainContent</span></span><br><span class="line"><span class="type">IRegion</span> <span class="variable">region</span> <span class="operator">=</span> _regionManager.Regions[RegionNames.LoginContentRegion];</span><br><span class="line">region.RequestNavigate(<span class="string">&quot;LoginMainContent&quot;</span>, NavigationCompelted);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">NavigationCompelted</span><span class="params">(NavigationResult result)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (result.Result==<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox.Show(<span class="string">&quot;导航到LoginMainContent页面成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox.Show(<span class="string">&quot;导航到LoginMainContent页面失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/img/net/csharp/1294271-20200415110218802-700948755.gif" alt="img"></p>
<h1 id="二-View和ViewModel参与导航过程"><a href="#二-View和ViewModel参与导航过程" class="headerlink" title="二.View和ViewModel参与导航过程"></a>二.View和ViewModel参与导航过程</h1><h2 id="1-INavigationAware"><a href="#1-INavigationAware" class="headerlink" title="1.INavigationAware"></a>1.INavigationAware</h2><p>我们经常在两个页面之间导航需要处理一些逻辑，例如，LoginMainContent页面导航到CreateAccount页面时候，LoginMainContent退出页面的时刻要保存页面数据，导航到CreateAccount页面的时刻处理逻辑(例如获取从LoginMainContent页面的信息)，Prism的导航系统通过一个INavigationAware接口：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">INavigationAware</span> : <span class="type">Object</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Void</span> OnNavigatedTo(NavigationContext navigationContext);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Boolean</span> IsNavigationTarget(NavigationContext navigationContext);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Void</span> OnNavigatedFrom(NavigationContext navigationContext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>OnNavigatedFrom：导航之前触发,一般用于保存该页面的数据</li>
<li>OnNavigatedTo：导航后目的页面触发，一般用于初始化或者接受上页面的传递参数</li>
<li>IsNavigationTarget：True则重用该View实例，Flase则每一次导航到该页面都会实例化一次</li>
</ul>
<p>我们用代码来演示这三个方法：</p>
<p>LoginMainContentViewModel.cs：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LoginMainContentViewModel</span> : <span class="title">BindableBase</span>, <span class="title">INavigationAware</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">readonly</span> IRegionManager _regionManager;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> DelegateCommand _createAccountCommand;</span><br><span class="line">     <span class="keyword">public</span> DelegateCommand CreateAccountCommand =&gt;</span><br><span class="line">            _createAccountCommand ?? (_createAccountCommand = <span class="keyword">new</span> DelegateCommand(ExecuteCreateAccountCommand));</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">void</span> <span class="title">ExecuteCreateAccountCommand</span>()</span></span><br><span class="line">     &#123;</span><br><span class="line">         Navigate(<span class="string">&quot;CreateAccount&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Navigate</span>(<span class="params"><span class="built_in">string</span> navigatePath</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">if</span> (navigatePath != <span class="literal">null</span>)</span><br><span class="line">            _regionManager.RequestNavigate(RegionNames.LoginContentRegion, navigatePath);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="title">LoginMainContentViewModel</span>(<span class="params">IRegionManager regionManager</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">          _regionManager = regionManager;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsNavigationTarget</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">     &#123;            </span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedFrom</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">          MessageBox.Show(<span class="string">&quot;退出了LoginMainContent&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedTo</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">          MessageBox.Show(<span class="string">&quot;从CreateAccount导航到LoginMainContent&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>CreateAccountViewModel.cs:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CreateAccountViewModel</span> : <span class="title">BindableBase</span>,<span class="title">INavigationAware</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">private</span> DelegateCommand _loginMainContentCommand;</span><br><span class="line">     <span class="keyword">public</span> DelegateCommand LoginMainContentCommand =&gt;</span><br><span class="line">            _loginMainContentCommand ?? (_loginMainContentCommand = <span class="keyword">new</span> DelegateCommand(ExecuteLoginMainContentCommand));</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">void</span> <span class="title">ExecuteLoginMainContentCommand</span>()</span></span><br><span class="line">     &#123;</span><br><span class="line">         Navigate(<span class="string">&quot;LoginMainContent&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="title">CreateAccountViewModel</span>(<span class="params">IRegionManager regionManager</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">         _regionManager = regionManager;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Navigate</span>(<span class="params"><span class="built_in">string</span> navigatePath</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">        <span class="keyword">if</span> (navigatePath != <span class="literal">null</span>)</span><br><span class="line">            _regionManager.RequestNavigate(RegionNames.LoginContentRegion, navigatePath);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsNavigationTarget</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedFrom</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">         MessageBox.Show(<span class="string">&quot;退出了CreateAccount&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedTo</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">         MessageBox.Show(<span class="string">&quot;从LoginMainContent导航到CreateAccount&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/img/net/csharp/1294271-20200415110233915-537703433.gif" alt="img"></p>
<p>修改IsNavigationTarget为false：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">LoginMainContentViewModel</span> : <span class="symbol">BindableBase, <span class="symbol">INavigationAware</span></span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="built_in">bool</span> IsNavigationTarget(NavigationContext navigationContext)</span><br><span class="line">     &#123;            </span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">CreateAccountViewModel</span> : <span class="symbol">BindableBase,<span class="symbol">INavigationAware</span></span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="built_in">bool</span> IsNavigationTarget(NavigationContext navigationContext)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>效果如下:</p>
<p><img src="/img/net/csharp/1294271-20200415110243272-1595301581.gif" alt="img"></p>
<p>我们会发现LoginMainContent和CreateAccount页面的数据不见了，这是因为第二次导航到页面的时候当IsNavigationTarget为false时，View将会重新实例化，导致ViewModel也重新加载,因此所有数据都清空了</p>
<h2 id="2-IRegionMemberLifetime"><a href="#2-IRegionMemberLifetime" class="headerlink" title="2.IRegionMemberLifetime"></a>2.IRegionMemberLifetime</h2><p>同时，Prism还可以通过<strong>IRegionMemberLifetime</strong>接口的<strong>KeepAlive</strong>布尔属性控制区域的视图的生命周期,我们在上一篇关于区域管理器说到，当视图添加到区域时候，像<strong>ContentControl</strong>这种单独显示一个活动视图，可以通过<strong>Region</strong>的<strong>Activate</strong>和<strong>Deactivate</strong>方法激活和失效视图，像<strong>ItemsControl</strong>这种可以同时显示多个活动视图的，可以通过<strong>Region</strong>的<strong>Add</strong>和<strong>Remove</strong>方法控制增加活动视图和失效视图，而当视图的<strong>KeepAlive</strong>为<strong>false</strong>，<strong>Region</strong>的<strong>Activate</strong>另外一个视图时，则该视图的实例则会去除出区域，为什么我们不在区域管理器讲解该接口呢？因为当导航的时候，同样的是在触发了<strong>Region</strong>的<strong>Activate</strong>和<strong>Deactivate</strong>，当有<strong>IRegionMemberLifetime</strong>接口时则会触发<strong>Region</strong>的<strong>Add</strong>和<strong>Remove</strong>方法，这里可以去看下Prism的RegionMemberLifetimeBehavior源码</p>
<p>我们将LoginMainContentViewModel实现<strong>IRegionMemberLifetime</strong>接口，并且把<strong>KeepAlive</strong>设置为<strong>false</strong>，同样的将<strong>IsNavigationTarget</strong>设置为<strong>true</strong></p>
<p>LoginMainContentViewModel.cs:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginMainContentViewModel</span> : BindableBase, INavigationAware，IRegionMemberLifetime</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="type">bool</span> <span class="variable">KeepAlive</span> <span class="operator">=</span>&gt; <span class="literal">false</span>;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">private</span> readonly IRegionManager _regionManager;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> DelegateCommand _createAccountCommand;</span><br><span class="line">     <span class="keyword">public</span> <span class="type">DelegateCommand</span> <span class="variable">CreateAccountCommand</span> <span class="operator">=</span>&gt;</span><br><span class="line">            _createAccountCommand ?? (_createAccountCommand = <span class="keyword">new</span> <span class="title class_">DelegateCommand</span>(ExecuteCreateAccountCommand));</span><br><span class="line"></span><br><span class="line">     <span class="keyword">void</span> <span class="title function_">ExecuteCreateAccountCommand</span><span class="params">()</span></span><br><span class="line">     &#123;</span><br><span class="line">         Navigate(<span class="string">&quot;CreateAccount&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">Navigate</span><span class="params">(string navigatePath)</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">if</span> (navigatePath != <span class="literal">null</span>)</span><br><span class="line">            _regionManager.RequestNavigate(RegionNames.LoginContentRegion, navigatePath);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="title function_">LoginMainContentViewModel</span><span class="params">(IRegionManager regionManager)</span></span><br><span class="line">     &#123;</span><br><span class="line">          _regionManager = regionManager;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> bool <span class="title function_">IsNavigationTarget</span><span class="params">(NavigationContext navigationContext)</span></span><br><span class="line">     &#123;            </span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnNavigatedFrom</span><span class="params">(NavigationContext navigationContext)</span></span><br><span class="line">     &#123;</span><br><span class="line">          MessageBox.Show(<span class="string">&quot;退出了LoginMainContent&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnNavigatedTo</span><span class="params">(NavigationContext navigationContext)</span></span><br><span class="line">     &#123;</span><br><span class="line">          MessageBox.Show(<span class="string">&quot;从CreateAccount导航到LoginMainContent&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/img/net/csharp/1294271-20200415110253901-148813412.gif" alt="img"></p>
<p>我们会发现跟没实现<strong>IRegionMemberLifetime</strong>接口和<strong>IsNavigationTarget</strong>设置为<strong>false</strong>情况一样，当<strong>KeepAlive</strong>为<strong>false</strong>时，通过断点知道，重新导航回LoginMainContent页面时不会触发<strong>IsNavigationTarget</strong>方法，因此可以</p>
<p>知道判断顺序是：<strong>KeepAlive</strong> –&gt;<strong>IsNavigationTarget</strong></p>
<h2 id="3-IConfirmNavigationRequest"><a href="#3-IConfirmNavigationRequest" class="headerlink" title="3.IConfirmNavigationRequest"></a>3.IConfirmNavigationRequest</h2><p>Prism的导航系统还支持再导航前允许是否需要导航的交互需求，这里我们在CreateAccount注册完用户后寻问是否需要导航回LoginMainContent页面，代码如下：</p>
<p>CreateAccountViewModel.cs:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateAccountViewModel</span> : BindableBase, INavigationAware，IConfirmNavigationRequest</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">private</span> DelegateCommand _loginMainContentCommand;</span><br><span class="line">     <span class="keyword">public</span> <span class="type">DelegateCommand</span> <span class="variable">LoginMainContentCommand</span> <span class="operator">=</span>&gt;</span><br><span class="line">            _loginMainContentCommand ?? (_loginMainContentCommand = <span class="keyword">new</span> <span class="title class_">DelegateCommand</span>(ExecuteLoginMainContentCommand));</span><br><span class="line">    </span><br><span class="line">     <span class="keyword">private</span> DelegateCommand&lt;object&gt; _verityCommand;</span><br><span class="line">     <span class="keyword">public</span> DelegateCommand&lt;object&gt; VerityCommand =&gt;</span><br><span class="line">            _verityCommand ?? (_verityCommand = <span class="keyword">new</span> <span class="title class_">DelegateCommand</span>&lt;object&gt;(ExecuteVerityCommand));</span><br><span class="line"></span><br><span class="line">     <span class="keyword">void</span> <span class="title function_">ExecuteLoginMainContentCommand</span><span class="params">()</span></span><br><span class="line">     &#123;</span><br><span class="line">         Navigate(<span class="string">&quot;LoginMainContent&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="title function_">CreateAccountViewModel</span><span class="params">(IRegionManager regionManager)</span></span><br><span class="line">     &#123;</span><br><span class="line">         _regionManager = regionManager;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">Navigate</span><span class="params">(string navigatePath)</span></span><br><span class="line">     &#123;</span><br><span class="line">        <span class="keyword">if</span> (navigatePath != <span class="literal">null</span>)</span><br><span class="line">            _regionManager.RequestNavigate(RegionNames.LoginContentRegion, navigatePath);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> bool <span class="title function_">IsNavigationTarget</span><span class="params">(NavigationContext navigationContext)</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnNavigatedFrom</span><span class="params">(NavigationContext navigationContext)</span></span><br><span class="line">     &#123;</span><br><span class="line">         MessageBox.Show(<span class="string">&quot;退出了CreateAccount&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnNavigatedTo</span><span class="params">(NavigationContext navigationContext)</span></span><br><span class="line">     &#123;</span><br><span class="line">         MessageBox.Show(<span class="string">&quot;从LoginMainContent导航到CreateAccount&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">//注册账号</span></span><br><span class="line">     <span class="keyword">void</span> <span class="title function_">ExecuteVerityCommand</span><span class="params">(object parameter)</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">if</span> (!VerityRegister(parameter))</span><br><span class="line">         &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         MessageBox.Show(<span class="string">&quot;注册成功!&quot;</span>);</span><br><span class="line">         LoginMainContentCommand.Execute();</span><br><span class="line">     &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">//导航前询问</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ConfirmNavigationRequest</span><span class="params">(NavigationContext navigationContext, Action&lt;bool&gt; continuationCallback)</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">         <span class="keyword">if</span> (MessageBox.Show(<span class="string">&quot;是否需要导航到LoginMainContent页面?&quot;</span>, <span class="string">&quot;Naviagte?&quot;</span>,MessageBoxButton.YesNo) ==MessageBoxResult.Yes)</span><br><span class="line">         &#123;</span><br><span class="line">             result = <span class="literal">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         continuationCallback(result);</span><br><span class="line">      &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/img/net/csharp/1294271-20200415110306828-1576810000.gif" alt="img"></p>
<h1 id="三-导航期间传递参数"><a href="#三-导航期间传递参数" class="headerlink" title="三.导航期间传递参数"></a>三.导航期间传递参数</h1><p>Prism提供<strong>NavigationParameters</strong>类以帮助指定和检索导航参数，在导航期间，可以通过访问以下方法来传递导航参数：</p>
<ul>
<li><strong>INavigationAware</strong>接口的<strong>IsNavigationTarget</strong>，<strong>OnNavigatedFrom</strong>和<strong>OnNavigatedTo</strong>方法中<strong>IsNavigationTarget</strong>，<strong>OnNavigatedFrom</strong>和<strong>OnNavigatedTo</strong>中形参<strong>NavigationContext</strong>对象的<strong>NavigationParameters</strong>属性</li>
<li><strong>IConfirmNavigationRequest</strong>接口的<strong>ConfirmNavigationRequest</strong>形参<strong>NavigationContext</strong>对象的<strong>NavigationParameters</strong>属性</li>
<li>区域导航的<strong>INavigateAsync</strong>接口的<strong>RequestNavigate</strong>方法赋值给其形参<strong>navigationParameters</strong></li>
<li>导航日志<strong>IRegionNavigationJournal</strong>接口<strong>CurrentEntry</strong>属性的<strong>NavigationParameters</strong>类型的<strong>Parameters</strong>属性(下面会介绍导航日志)</li>
</ul>
<p>这里我们CreateAccount页面注册完用户后询问是否需要用当前注册用户来作为登录LoginId，来演示传递导航参数，代码如下：</p>
<p>CreateAccountViewModel.cs(修改代码部分):</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> _registeredLoginId;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> RegisteredLoginId</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">get</span> &#123; <span class="keyword">return</span> _registeredLoginId; &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123; SetProperty(<span class="keyword">ref</span> _registeredLoginId, <span class="keyword">value</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">bool</span> IsUseRequest &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ExecuteVerityCommand</span>(<span class="params"><span class="built_in">object</span> parameter</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!VerityRegister(parameter))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.IsUseRequest = <span class="literal">true</span>;</span><br><span class="line">    MessageBox.Show(<span class="string">&quot;注册成功!&quot;</span>);</span><br><span class="line">    LoginMainContentCommand.Execute();</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfirmNavigationRequest</span>(<span class="params">NavigationContext navigationContext, Action&lt;<span class="built_in">bool</span>&gt; continuationCallback</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(RegisteredLoginId) &amp;&amp; <span class="keyword">this</span>.IsUseRequest)</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="keyword">if</span> (MessageBox.Show(<span class="string">&quot;是否需要用当前注册的用户登录?&quot;</span>, <span class="string">&quot;Naviagte?&quot;</span>, MessageBoxButton.YesNo) == MessageBoxResult.Yes)</span><br><span class="line">         &#123;</span><br><span class="line">              navigationContext.Parameters.Add(<span class="string">&quot;loginId&quot;</span>, RegisteredLoginId);</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    continuationCallback(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LoginMainContentViewModel.cs(修改代码部分):</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedTo</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">     MessageBox.Show(<span class="string">&quot;从CreateAccount导航到LoginMainContent&quot;</span>);</span><br><span class="line">            </span><br><span class="line">     <span class="keyword">var</span> loginId= navigationContext.Parameters[<span class="string">&quot;loginId&quot;</span>] <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">     <span class="keyword">if</span> (loginId!=<span class="literal">null</span>)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">this</span>.CurrentUser = <span class="keyword">new</span> User() &#123; LoginId=loginId&#125;;</span><br><span class="line">     &#125;</span><br><span class="line">            </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/img/net/csharp/1294271-20200415110652741-875644212.gif" alt="img"></p>
<h1 id="四-导航日志"><a href="#四-导航日志" class="headerlink" title="四.导航日志"></a>四.导航日志</h1><p>Prism导航系统同样的和WPF导航系统一样，都支持导航日志，Prism是通过<strong>IRegionNavigationJournal</strong>接口来提供区域导航日志功能，</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IRegionNavigationJournal</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">bool</span> CanGoBack &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">bool</span> CanGoForward &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">    IRegionNavigationJournalEntry CurrentEntry &#123;<span class="keyword">get</span>;&#125;</span><br><span class="line"></span><br><span class="line">    INavigateAsync NavigationTarget &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GoBack</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GoForward</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">RecordNavigation</span>(<span class="params">IRegionNavigationJournalEntry entry, <span class="built_in">bool</span> persistInHistory</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Clear</span>()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们将在登录界面接入导航日志功能,代码如下:</p>
<p>LoginMainContent.xaml(前进箭头代码部分):</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Width</span>=<span class="string">&quot;30&quot;</span> <span class="attr">Height</span>=<span class="string">&quot;30&quot;</span> <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Right&quot;</span> <span class="attr">Text</span>=<span class="string">&quot;<span class="symbol">&amp;#xe624;</span>&quot;</span> <span class="attr">FontWeight</span>=<span class="string">&quot;Bold&quot;</span> <span class="attr">FontFamily</span>=<span class="string">&quot;pack://application:,,,/PrismMetroSample.Infrastructure;Component/Assets/Fonts/#iconfont&quot;</span> <span class="attr">FontSize</span>=<span class="string">&quot;30&quot;</span> <span class="attr">Margin</span>=<span class="string">&quot;10&quot;</span> <span class="attr">Visibility</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;Binding IsCanExcute,Converter=&#123;StaticResource boolToVisibilityConverter&#125;</span><span class="language-xml"><span class="tag"><span class="string">&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">i:Interaction.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">i:EventTrigger</span> <span class="attr">EventName</span>=<span class="string">&quot;MouseLeftButtonDown&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                 <span class="tag">&lt;<span class="name">i:InvokeCommandAction</span> <span class="attr">Command</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;Binding GoForwardCommand&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">i:EventTrigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">i:Interaction.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TextBlock.Style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">Style</span> <span class="attr">TargetType</span>=<span class="string">&quot;TextBlock&quot;</span>&gt;</span><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">                <span class="tag">&lt;<span class="name">Style.Triggers</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Trigger</span> <span class="attr">Property</span>=<span class="string">&quot;IsMouseOver&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;True&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">                          <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;#F9F9F9&quot;</span>/&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Trigger</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">                 <span class="tag">&lt;/<span class="name">Style.Triggers</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">            </span><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">TextBlock.Style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">TextBlock</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>BoolToVisibilityConverter.cs:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BoolToVisibilityConverter</span> : <span class="type">IValueConverter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">object</span> Convert(<span class="keyword">object</span> value, Type targetType, <span class="keyword">object</span> parameter, CultureInfo culture)</span><br><span class="line">    &#123;</span><br><span class="line">          <span class="keyword">if</span> (value==<span class="literal">null</span>)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">return</span> DependencyProperty.UnsetValue;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">var</span> isCanExcute = (bool)value;</span><br><span class="line">          <span class="keyword">if</span> (isCanExcute)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">return</span> Visibility.Visible;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">return</span> Visibility.Hidden;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">object</span> ConvertBack(<span class="keyword">object</span> value, Type targetType, <span class="keyword">object</span> parameter, CultureInfo culture)</span><br><span class="line">    &#123;</span><br><span class="line">            <span class="keyword">throw</span> new NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>LoginMainContentViewModel.cs(修改代码部分):</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">IRegionNavigationJournal _journal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> DelegateCommand&lt;PasswordBox&gt; _loginCommand;</span><br><span class="line"><span class="keyword">public</span> DelegateCommand&lt;PasswordBox&gt; LoginCommand =&gt;</span><br><span class="line">            _loginCommand ?? (_loginCommand = <span class="keyword">new</span> DelegateCommand&lt;PasswordBox&gt;(ExecuteLoginCommand, CanExecuteGoForwardCommand));</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> DelegateCommand _goForwardCommand;</span><br><span class="line"><span class="keyword">public</span> DelegateCommand GoForwardCommand =&gt;</span><br><span class="line">            _goForwardCommand ?? (_goForwardCommand = <span class="keyword">new</span> DelegateCommand(ExecuteGoForwardCommand));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ExecuteGoForwardCommand</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    _journal.GoForward();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">CanExecuteGoForwardCommand</span>(<span class="params">PasswordBox passwordBox</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.IsCanExcute=_journal != <span class="literal">null</span> &amp;&amp; _journal.CanGoForward;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedTo</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="comment">//MessageBox.Show(&quot;从CreateAccount导航到LoginMainContent&quot;);</span></span><br><span class="line">     _journal = navigationContext.NavigationService.Journal;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">var</span> loginId= navigationContext.Parameters[<span class="string">&quot;loginId&quot;</span>] <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">     <span class="keyword">if</span> (loginId!=<span class="literal">null</span>)</span><br><span class="line">     &#123;</span><br><span class="line">                <span class="keyword">this</span>.CurrentUser = <span class="keyword">new</span> User() &#123; LoginId=loginId&#125;;</span><br><span class="line">     &#125;</span><br><span class="line">     LoginCommand.RaiseCanExecuteChanged();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CreateAccountViewModel.cs(修改代码部分):</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">IRegionNavigationJournal _journal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> DelegateCommand _goBackCommand;</span><br><span class="line"><span class="keyword">public</span> DelegateCommand GoBackCommand =&gt;</span><br><span class="line">            _goBackCommand ?? (_goBackCommand = <span class="keyword">new</span> DelegateCommand(ExecuteGoBackCommand));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ExecuteGoBackCommand</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">     _journal.GoBack();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedTo</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="comment">//MessageBox.Show(&quot;从LoginMainContent导航到CreateAccount&quot;);</span></span><br><span class="line">     _journal = navigationContext.NavigationService.Journal;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/img/net/csharp/1294271-20200415110626312-1663510848.gif" alt="img"></p>
<h2 id="选择退出导航日志"><a href="#选择退出导航日志" class="headerlink" title="选择退出导航日志"></a>选择退出导航日志</h2><p>如果不打算将页面在导航过程中不加入导航日志，例如LoginMainContent页面，可以通过实现<strong>IJournalAware</strong>并从<strong>PersistInHistory（）<strong>返回</strong>false</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LoginMainContentViewModel</span> : <span class="title">IJournalAware</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">PersistInHistory</span>()</span> =&gt; <span class="literal">false</span>;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<h1 id="五-小结"><a href="#五-小结" class="headerlink" title="五.小结"></a>五.小结</h1><p>prism的导航系统可以跟wpf导航并行使用，这是prism官方文档也支持的，因为prism的导航系统是基于区域的，不依赖于wpf，不过更推荐于单独使用prism的导航系统，因为在MVVM模式下更灵活，支持依赖注入,通过区域管理器能够更好的管理视图View,更能适应复杂应用程序需求，wpf导航系统不支持依赖注入模式，也依赖于Frame元素，而且在导航过程中也是容易强依赖View部分，下一篇将会讲解Prism的对话框服务</p>
<h1 id="六-源码"><a href="#六-源码" class="headerlink" title="六.源码"></a>六.源码</h1><p> 项目源代码：<a href="https://github.com/myhhub/NetCoreWpfMVVMPrismSample/tree/master/PrismMetroSample">PrismDemo源码</a></p>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2020/07/100637.html" class="pre-post btn btn-default" title='使用 Prism Unity 实现 .NET Core WPF MVVM 之七 对话框服务'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">使用 Prism Unity 实现 .NET Core WPF MVVM 之七 对话框服务</span>
        </a>
    
    
        <a href="/archives/2020/07/100635.html" class="next-post btn btn-default" title='使用 Prism Unity 实现 .NET Core WPF MVVM 之五 区域管理器'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">使用 Prism Unity 实现 .NET Core WPF MVVM 之五 区域管理器</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>


    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E5%8C%BA%E5%9F%9F%E5%AF%BC%E8%88%AA"><span class="toc-text">一.区域导航</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%B3%A8%E5%86%8C%E5%8C%BA%E5%9F%9F"><span class="toc-text">1.注册区域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%B3%A8%E5%86%8C%E5%AF%BC%E8%88%AA"><span class="toc-text">2.注册导航</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8C%BA%E5%9F%9F%E5%AF%BC%E8%88%AA"><span class="toc-text">3.区域导航</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-View%E5%92%8CViewModel%E5%8F%82%E4%B8%8E%E5%AF%BC%E8%88%AA%E8%BF%87%E7%A8%8B"><span class="toc-text">二.View和ViewModel参与导航过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-INavigationAware"><span class="toc-text">1.INavigationAware</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-IRegionMemberLifetime"><span class="toc-text">2.IRegionMemberLifetime</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-IConfirmNavigationRequest"><span class="toc-text">3.IConfirmNavigationRequest</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-%E5%AF%BC%E8%88%AA%E6%9C%9F%E9%97%B4%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="toc-text">三.导航期间传递参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B-%E5%AF%BC%E8%88%AA%E6%97%A5%E5%BF%97"><span class="toc-text">四.导航日志</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E9%80%80%E5%87%BA%E5%AF%BC%E8%88%AA%E6%97%A5%E5%BF%97"><span class="toc-text">选择退出导航日志</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94-%E5%B0%8F%E7%BB%93"><span class="toc-text">五.小结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD-%E6%BA%90%E7%A0%81"><span class="toc-text">六.源码</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2025&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>








<script src="/js/app.js?rev=@@hash.js"></script>


</body>
</html>