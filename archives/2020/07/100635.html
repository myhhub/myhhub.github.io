<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content=".net,csharp,wpf,mvvm,prism">


    <meta name="description" content="介绍如何在.NET Core3环境下使用MVVM框架Prism的使用区域管理器对于View的管理
一.区域管理器我们在之前的Prism系列构建了一个标准式Prism项目，这篇文章将会讲解之前项目...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>使用 Prism Unity 实现 .NET Core WPF MVVM 之五 区域管理器 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="使用 Prism Unity 实现 .NET Core WPF MVVM 之五 区域管理器">
            
	            使用 Prism Unity 实现 .NET Core WPF MVVM 之五 区域管理器
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/back/">后端</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/net/">.net</a> <a class="tag-link" href="/tags/csharp/">csharp</a> <a class="tag-link" href="/tags/mvvm/">mvvm</a> <a class="tag-link" href="/tags/prism/">prism</a> <a class="tag-link" href="/tags/wpf/">wpf</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2020/07/12</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1010</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p>介绍如何在.NET Core3环境下使用MVVM框架Prism的使用区域管理器对于View的管理</p>
<h1 id="一-区域管理器"><a href="#一-区域管理器" class="headerlink" title="一.区域管理器"></a>一.区域管理器</h1><p>我们在之前的Prism系列构建了一个标准式Prism项目，这篇文章将会讲解之前项目中用到的利用区域管理器更好的对我们的View进行管理，同样的我们来看看官方给出的模型图：</p>
<p><img src="/img/net/csharp/1294271-20200331150607822-923107646.png" alt="img"></p>
<p>现在我们可以知道的是，大致一个区域管理器RegionMannager对一个控件创建区域的要点：</p>
<ul>
<li>创建Region的控件必须包含一个RegionAdapter适配器</li>
<li>region是依赖在具有RegionAdapter控件身上的</li>
</ul>
<p>其实后来我去看了下官方的介绍和源码，默认RegionAdapter是有三个，且还支持自定义RegionAdapter，因此在官方的模型图之间我做了点补充：</p>
<p><img src="/img/net/csharp/1294271-20200331150617806-226264999.png" alt="img"></p>
<h1 id="二-区域创建与视图的注入"><a href="#二-区域创建与视图的注入" class="headerlink" title="二.区域创建与视图的注入"></a>二.区域创建与视图的注入</h1><p>我们先来看看我们之前项目的区域的划分，以及如何创建区域并且把View注入到区域中：</p>
<p><img src="/img/net/csharp/1294271-20200331150628801-1210659452.png" alt="img"></p>
<p>我们把整个主窗体划分了四个区域：</p>
<ul>
<li><strong>ShowSearchPatientRegion</strong>：注入了ShowSearchPatient视图</li>
<li><strong>PatientListRegion</strong>：注入了PatientList视图</li>
<li><strong>FlyoutRegion</strong>：注入了PatientDetail和SearchMedicine视图</li>
<li><strong>ShowSearchPatientRegion</strong>：注入了ShowSearchPatient视图</li>
</ul>
<p>在Prism中，我们有两种方式去实现区域创建和视图注入：</p>
<ol>
<li><strong>ViewDiscovery</strong></li>
<li><strong>ViewInjection</strong></li>
</ol>
<h2 id="1-ViewDiscovery"><a href="#1-ViewDiscovery" class="headerlink" title="1.ViewDiscovery"></a>1.<strong>ViewDiscovery</strong></h2><p>我们截取其中<strong>PatientListRegion</strong>的创建和视图注入的代码(更仔细的可以去观看demo源码)：</p>
<p>MainWindow.xaml：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ContentControl Grid.<span class="attribute">Row</span>=<span class="string">"2"</span> prism:RegionManager.<span class="attribute">RegionName</span>=<span class="string">"PatientListRegion"</span> <span class="attribute">Margin</span>=<span class="string">"10"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>这里相当于在后台MainWindow.cs：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">RegionManager</span><span class="selector-class">.SetRegionName</span>(ContentControl, <span class="string">"PatientListRegion"</span>);</span><br></pre></td></tr></table></figure>
<p>PatientModule.cs：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PatientModule</span> : <span class="title">IModule</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnInitialized</span>(<span class="params">IContainerProvider containerProvider</span>)</span></span><br><span class="line"><span class="function"></span>   &#123;</span><br><span class="line">        <span class="keyword">var</span> regionManager = containerProvider.Resolve&lt;IRegionManager&gt;();</span><br><span class="line">        <span class="comment">//PatientList</span></span><br><span class="line">        regionManager.RegisterViewWithRegion(RegionNames.PatientListRegion, <span class="keyword">typeof</span>(PatientList));</span><br><span class="line">        <span class="comment">//PatientDetail-Flyout</span></span><br><span class="line">        regionManager.RegisterViewWithRegion(RegionNames.FlyoutRegion, <span class="keyword">typeof</span>(PatientDetail));</span><br><span class="line">          </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterTypes</span>(<span class="params">IContainerRegistry containerRegistry</span>)</span></span><br><span class="line"><span class="function"></span>   &#123;</span><br><span class="line">          </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-ViewInjection"><a href="#2-ViewInjection" class="headerlink" title="2.ViewInjection"></a>2.<strong>ViewInjection</strong></h2><p>我们在MainWindow窗体的Loaded事件中使用<strong>ViewInjection</strong>方式注入视图PatientList</p>
<p>MainWindow.xaml：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">i</span>:Interaction.Triggers&gt;</span><br><span class="line">    &lt;<span class="selector-tag">i</span>:EventTrigger EventName=<span class="string">"Loaded"</span>&gt;</span><br><span class="line">        &lt;<span class="selector-tag">i</span>:InvokeCommandAction Command=<span class="string">"&#123;Binding LoadingCommand&#125;"</span>/&gt;</span><br><span class="line">     /<span class="selector-tag">i</span>:EventTrigger&gt;</span><br><span class="line">&lt;/<span class="selector-tag">i</span>:Interaction.Triggers&gt;</span><br></pre></td></tr></table></figure>
<p>MainWindowViewModel.cs:</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> IRegionManager <span class="variable">_regionManager</span>;</span><br><span class="line"><span class="keyword">private</span> IRegion <span class="variable">_paientListRegion</span>;        </span><br><span class="line"><span class="keyword">private</span> PatientList <span class="variable">_patientListView</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> DelegateCommand <span class="variable">_loadingCommand</span>;</span><br><span class="line">public DelegateCommand LoadingCommand =&gt;</span><br><span class="line">     <span class="variable">_loadingCommand</span> ?? (<span class="variable">_loadingCommand</span> = new DelegateCommand(ExecuteLoadingCommand));</span><br><span class="line"></span><br><span class="line">void ExecuteLoadingCommand()</span><br><span class="line">&#123;</span><br><span class="line">     <span class="variable">_regionManager</span> = CommonServiceLocator.ServiceLocator.Current.GetInstance&lt;IRegionManager&gt;();</span><br><span class="line">     <span class="variable">_paientListRegion</span> = <span class="variable">_regionManager</span>.Regions[RegionNames.PatientListRegion];</span><br><span class="line">     <span class="variable">_patientListView</span> = CommonServiceLocator.ServiceLocator.Current.GetInstance&lt;PatientList&gt;();</span><br><span class="line">     <span class="variable">_paientListRegion</span>.Add(<span class="variable">_patientListView</span>);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>我们可以明显的感觉到两种方式的不同，<strong>ViewDiscovery</strong>方式是自动地实例化视图并且加载出来，而<strong>ViewInjection</strong>方式则是可以手动控制注入视图和加载视图的时机(上述例子是通过Loaded事件)，官方对于两者的推荐使用场景如下：</p>
<p><strong>ViewDiscovery</strong>：</p>
<ul>
<li>需要或要求自动加载视图</li>
<li>视图的单个实例将加载到该区域中</li>
</ul>
<p><strong>ViewInjection</strong>：</p>
<ul>
<li>需要显式或编程控制何时创建和显示视图，或者您需要从区域中删除视图</li>
<li>需要在区域中显示相同视图的多个实例，其中每个视图实例都绑定到不同的数据</li>
<li>需要控制添加视图的区域的哪个实例</li>
<li>应用程序使用导航API(后面会讲到)</li>
</ul>
<h1 id="三-激活与失效视图"><a href="#三-激活与失效视图" class="headerlink" title="三.激活与失效视图"></a>三.激活与失效视图</h1><h2 id="1-Activate和Deactivate"><a href="#1-Activate和Deactivate" class="headerlink" title="1.Activate和Deactivate"></a>1.Activate和Deactivate</h2><p>首先我们需要控制PatientList和MedicineMainContent两个视图的激活情况，上代码：</p>
<p>MainWindow.xaml：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">StackPanel</span> <span class="attr">Grid.Row</span>=<span class="string">"1"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Button</span>  <span class="attr">Content</span>=<span class="string">"Load MedicineModule"</span> <span class="attr">FontSize</span>=<span class="string">"25"</span>  <span class="attr">Margin</span>=<span class="string">"5"</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding LoadMedicineModuleCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">UniformGrid</span> <span class="attr">Margin</span>=<span class="string">"5"</span>&gt;</span></span></span><br><span class="line"><span class="xml">         <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Content</span>=<span class="string">"ActivePaientList"</span> <span class="attr">Margin</span>=<span class="string">"5"</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding ActivePaientListCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">         <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Content</span>=<span class="string">"DeactivePaientList"</span> <span class="attr">Margin</span>=<span class="string">"5"</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding DeactivePaientListCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">         <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Content</span>=<span class="string">"ActiveMedicineList"</span> <span class="attr">Margin</span>=<span class="string">"5"</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding ActiveMedicineListCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">         <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Content</span>=<span class="string">"DeactiveMedicineList"</span> <span class="attr">Margin</span>=<span class="string">"5"</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding DeactiveMedicineListCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;/<span class="name">UniformGrid</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">StackPanel</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">ContentControl</span> <span class="attr">Grid.Row</span>=<span class="string">"2"</span> <span class="attr">prism:RegionManager.RegionName</span>=<span class="string">"PatientListRegion"</span> <span class="attr">Margin</span>=<span class="string">"10"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">ContentControl</span> <span class="attr">Grid.Row</span>=<span class="string">"3"</span> <span class="attr">prism:RegionManager.RegionName</span>=<span class="string">"MedicineMainContentRegion"</span>/&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>MainWindowViewModel.cs：</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> IRegionManager <span class="variable">_regionManager</span>;</span><br><span class="line"> <span class="keyword">private</span> IRegion <span class="variable">_paientListRegion</span>;</span><br><span class="line"> <span class="keyword">private</span> IRegion <span class="variable">_medicineListRegion</span>;</span><br><span class="line"> <span class="keyword">private</span> PatientList <span class="variable">_patientListView</span>;</span><br><span class="line"> <span class="keyword">private</span> MedicineMainContent <span class="variable">_medicineMainContentView</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> bool <span class="variable">_isCanExcute</span> = <span class="literal">false</span>;</span><br><span class="line"> public bool IsCanExcute</span><br><span class="line"> &#123;</span><br><span class="line">    get &#123; return <span class="variable">_isCanExcute</span>; &#125;</span><br><span class="line">    <span class="built_in">set</span> &#123; SetProperty(ref <span class="variable">_isCanExcute</span>, value); &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> DelegateCommand <span class="variable">_loadingCommand</span>;</span><br><span class="line"> public DelegateCommand LoadingCommand =&gt;</span><br><span class="line">     <span class="variable">_loadingCommand</span> ?? (<span class="variable">_loadingCommand</span> = new DelegateCommand(ExecuteLoadingCommand));</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> DelegateCommand <span class="variable">_activePaientListCommand</span>;</span><br><span class="line"> public DelegateCommand ActivePaientListCommand =&gt;</span><br><span class="line">     <span class="variable">_activePaientListCommand</span> ?? (<span class="variable">_activePaientListCommand</span> = new DelegateCommand(ExecuteActivePaientListCommand));</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> DelegateCommand <span class="variable">_deactivePaientListCommand</span>;</span><br><span class="line"> public DelegateCommand DeactivePaientListCommand =&gt;</span><br><span class="line">     <span class="variable">_deactivePaientListCommand</span> ?? (<span class="variable">_deactivePaientListCommand</span> = new DelegateCommand(ExecuteDeactivePaientListCommand));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> DelegateCommand <span class="variable">_activeMedicineListCommand</span>;</span><br><span class="line">  public DelegateCommand ActiveMedicineListCommand =&gt;</span><br><span class="line">     <span class="variable">_activeMedicineListCommand</span> ?? (<span class="variable">_activeMedicineListCommand</span> = new DelegateCommand(ExecuteActiveMedicineListCommand)</span><br><span class="line">     .ObservesCanExecute(() =&gt; IsCanExcute));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> DelegateCommand <span class="variable">_deactiveMedicineListCommand</span>;</span><br><span class="line">  public DelegateCommand DeactiveMedicineListCommand =&gt;</span><br><span class="line">      <span class="variable">_deactiveMedicineListCommand</span> ?? (<span class="variable">_deactiveMedicineListCommand</span> = new DelegateCommand(ExecuteDeactiveMedicineListCommand)</span><br><span class="line">     .ObservesCanExecute(() =&gt; IsCanExcute));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> DelegateCommand <span class="variable">_loadMedicineModuleCommand</span>;</span><br><span class="line">  public DelegateCommand LoadMedicineModuleCommand =&gt;</span><br><span class="line">      <span class="variable">_loadMedicineModuleCommand</span> ?? (<span class="variable">_loadMedicineModuleCommand</span> = new DelegateCommand(ExecuteLoadMedicineModuleCommand));</span><br><span class="line"></span><br><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// 窗体加载事件</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">void ExecuteLoadingCommand()</span><br><span class="line">&#123;</span><br><span class="line">     <span class="variable">_regionManager</span> = CommonServiceLocator.ServiceLocator.Current.GetInstance&lt;IRegionManager&gt;();</span><br><span class="line">     <span class="variable">_paientListRegion</span> = <span class="variable">_regionManager</span>.Regions[RegionNames.PatientListRegion];</span><br><span class="line">     <span class="variable">_patientListView</span> = CommonServiceLocator.ServiceLocator.Current.GetInstance&lt;PatientList&gt;();</span><br><span class="line">     <span class="variable">_paientListRegion</span>.Add(<span class="variable">_patientListView</span>);</span><br><span class="line">     <span class="variable">_medicineListRegion</span> = <span class="variable">_regionManager</span>.Regions[RegionNames.MedicineMainContentRegion];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"> <span class="comment">/// 失效medicineMainContent视图</span></span><br><span class="line"> <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"> void ExecuteDeactiveMedicineListCommand()</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="variable">_medicineListRegion</span>.Deactivate(<span class="variable">_medicineMainContentView</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"> <span class="comment">/// 激活medicineMainContent视图</span></span><br><span class="line"> <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"> void ExecuteActiveMedicineListCommand()</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="variable">_medicineListRegion</span>.Activate(<span class="variable">_medicineMainContentView</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"> <span class="comment">/// 失效patientList视图</span></span><br><span class="line"> <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"> void ExecuteDeactivePaientListCommand()</span><br><span class="line"> &#123;</span><br><span class="line">      <span class="variable">_paientListRegion</span>.Deactivate(<span class="variable">_patientListView</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"> <span class="comment">/// 激活patientList视图</span></span><br><span class="line"> <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"> void ExecuteActivePaientListCommand()</span><br><span class="line"> &#123;</span><br><span class="line">      <span class="variable">_paientListRegion</span>.Activate(<span class="variable">_patientListView</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"> <span class="comment">/// 加载MedicineModule</span></span><br><span class="line"> <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"> void ExecuteLoadMedicineModuleCommand()</span><br><span class="line"> &#123;</span><br><span class="line">      <span class="variable">_moduleManager</span>.LoadModule(<span class="string">"MedicineModule"</span>);</span><br><span class="line">      <span class="variable">_medicineMainContentView</span> = (MedicineMainContent)<span class="variable">_medicineListRegion</span>.Views</span><br><span class="line">           .Where(t =&gt; t.GetType() == <span class="built_in">typeof</span>(MedicineMainContent)).FirstOrDefault();</span><br><span class="line">      this.IsCanExcute = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="/img/net/csharp/1294271-20200331150701465-763264378.gif" alt="img"></p>
<h2 id="2-监控视图激活状态"><a href="#2-监控视图激活状态" class="headerlink" title="2.监控视图激活状态"></a>2.监控视图激活状态</h2><p>Prism其中还支持监控视图的激活状态，是通过在View中继承IActiveAware来实现的，我们以监控其中MedicineMainContent视图的激活状态为例子：</p>
<p>MedicineMainContentViewModel.cs:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MedicineMainContentViewModel</span> : <span class="title">BindableBase</span>,<span class="title">IActiveAware</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventHandler IsActiveChanged;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> _isActive;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> IsActive</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> _isActive; &#125;</span><br><span class="line">        <span class="keyword">set</span></span><br><span class="line">        &#123;</span><br><span class="line">            _isActive = <span class="keyword">value</span>;</span><br><span class="line">            <span class="keyword">if</span> (_isActive)</span><br><span class="line">            &#123;</span><br><span class="line">                MessageBox.Show(<span class="string">"视图被激活了"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                MessageBox.Show(<span class="string">"视图失效了"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            IsActiveChanged?.Invoke(<span class="keyword">this</span>, <span class="keyword">new</span> EventArgs());</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/net/csharp/1294271-20200331150713576-1911934096.gif" alt="img"></p>
<h2 id="3-Add和Remove"><a href="#3-Add和Remove" class="headerlink" title="3.Add和Remove"></a>3.Add和Remove</h2><p>上述例子用的是ContentControl，我们再用一个ItemsControl的例子，代码如下：</p>
<p>MainWindow.xaml:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">metro:MetroWindow.RightWindowCommands</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">metro:WindowCommands</span> <span class="attr">x:Name</span>=<span class="string">"rightWindowCommandsRegion"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">metro:MetroWindow.RightWindowCommands</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>MainWindow.cs:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MainWindow</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   InitializeComponent();</span><br><span class="line">   <span class="keyword">var</span> regionManager= ServiceLocator.Current.GetInstance&lt;IRegionManager&gt;();</span><br><span class="line">   <span class="keyword">if</span> (regionManager != <span class="literal">null</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      SetRegionManager(regionManager, <span class="keyword">this</span>.flyoutsControlRegion, RegionNames.FlyoutRegion);</span><br><span class="line">      <span class="comment">//创建WindowCommands控件区域</span></span><br><span class="line">      SetRegionManager(regionManager, <span class="keyword">this</span>.rightWindowCommandsRegion, RegionNames.ShowSearchPatientRegion);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetRegionManager</span>(<span class="params">IRegionManager regionManager, DependencyObject regionTarget, <span class="keyword">string</span> regionName</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RegionManager.SetRegionName(regionTarget, regionName);</span><br><span class="line">    RegionManager.SetRegionManager(regionTarget, regionManager);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ShowSearchPatient.xaml：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">StackPanel</span> <span class="attr">x:Class</span>=<span class="string">"PrismMetroSample.MedicineModule.Views.ShowSearchPatient"</span></span></span></span><br><span class="line"><span class="xml">       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span><br><span class="line"><span class="xml">       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"</span></span><br><span class="line"><span class="xml">       xmlns:prism="http://prismlibrary.com/"  </span></span><br><span class="line"><span class="xml">       xmlns:const="clr-namespace:PrismMetroSample.Infrastructure.Constants;assembly=PrismMetroSample.Infrastructure"</span></span><br><span class="line"><span class="xml">       Orientation="Horizontal"    </span></span><br><span class="line"><span class="xml">       xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"</span></span><br><span class="line"><span class="xml">       prism:ViewModelLocator.AutoWireViewModel="True"&gt;</span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">i:Interaction.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">i:EventTrigger</span> <span class="attr">EventName</span>=<span class="string">"Loaded"</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">i:InvokeCommandAction</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding ShowSearchLoadingCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">i:EventTrigger</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">i:Interaction.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">CheckBox</span> <span class="attr">IsChecked</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding IsShow&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding ApplicationCommands.ShowCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">CommandParameter</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;x:Static const:FlyoutNames.SearchMedicineFlyout&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">StackPanel</span> <span class="attr">Orientation</span>=<span class="string">"Horizontal"</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">Image</span> <span class="attr">Height</span>=<span class="string">"20"</span> <span class="attr">Source</span>=<span class="string">"pack://application:,,,/PrismMetroSample.Infrastructure;Component/Assets/Photos/按钮.png"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">"Show"</span> <span class="attr">FontWeight</span>=<span class="string">"Bold"</span> <span class="attr">FontSize</span>=<span class="string">"15"</span> <span class="attr">VerticalAlignment</span>=<span class="string">"Center"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">StackPanel</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">StackPanel</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>ShowSearchPatientViewModel.cs:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> IApplicationCommands _applicationCommands;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> IRegionManager _regionManager;</span><br><span class="line"><span class="keyword">private</span> ShowSearchPatient _showSearchPatientView;</span><br><span class="line"><span class="keyword">private</span> IRegion _region;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> IApplicationCommands ApplicationCommands</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">get</span> &#123; <span class="keyword">return</span> _applicationCommands; &#125;</span><br><span class="line">     <span class="keyword">set</span> &#123; SetProperty(<span class="keyword">ref</span> _applicationCommands, <span class="keyword">value</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">bool</span> _isShow=<span class="literal">true</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">bool</span> IsShow</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">get</span> &#123; <span class="keyword">return</span> _isShow=<span class="literal">true</span>; &#125;</span><br><span class="line">     <span class="keyword">set</span> </span><br><span class="line">     &#123; </span><br><span class="line">         SetProperty(<span class="keyword">ref</span> _isShow, <span class="keyword">value</span>);</span><br><span class="line">         <span class="keyword">if</span> (_isShow)</span><br><span class="line">         &#123;</span><br><span class="line">              ActiveShowSearchPatient();</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         &#123;</span><br><span class="line">              DeactiveShowSearchPaitent();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> DelegateCommand _showSearchLoadingCommand;</span><br><span class="line"><span class="keyword">public</span> DelegateCommand ShowSearchLoadingCommand =&gt;</span><br><span class="line">        _showSearchLoadingCommand ?? (_showSearchLoadingCommand = <span class="keyword">new</span> DelegateCommand(ExecuteShowSearchLoadingCommand));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ExecuteShowSearchLoadingCommand</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       _region = _regionManager.Regions[RegionNames.ShowSearchPatientRegion];</span><br><span class="line">       _showSearchPatientView = (ShowSearchPatient)_region.Views</span><br><span class="line">           .Where(t =&gt; t.GetType() == <span class="keyword">typeof</span>(ShowSearchPatient)).FirstOrDefault();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">ShowSearchPatientViewModel</span>(<span class="params">IApplicationCommands applicationCommands,IRegionManager regionManager</span>)</span></span><br><span class="line"><span class="function"></span> &#123;</span><br><span class="line">       <span class="keyword">this</span>.ApplicationCommands = applicationCommands;</span><br><span class="line">       _regionManager = regionManager;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> 激活视图</span></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ActiveShowSearchPatient</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!_region.ActiveViews.Contains(_showSearchPatientView))</span><br><span class="line">      &#123;</span><br><span class="line">          _region.Add(_showSearchPatientView);</span><br><span class="line">      &#125;         </span><br><span class="line"> &#125;</span><br><span class="line">  </span><br><span class="line"> <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> 失效视图</span></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">DeactiveShowSearchPaitent</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>  &#123;</span><br><span class="line">       _region.Remove(_showSearchPatientView);</span><br><span class="line">       <span class="keyword">await</span> Task.Delay(<span class="number">2000</span>);</span><br><span class="line">       IsShow = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="/img/net/csharp/1294271-20200331150729733-326316595.gif" alt="img"></p>
<p>这里的WindowCommands 的继承链为：WindowCommands &lt;– ToolBar &lt;– HeaderedItemsControl &lt;–ItemsControl，因此由于Prism默认的适配器有ItemsControlRegionAdapter,因此其子类也继承了其行为</p>
<p>这里重点归纳一下：</p>
<ul>
<li>当进行模块化时，加载完模块才会去注入视图到区域(可参考MedicineModule视图加载顺序)</li>
<li>ContentControl控件由于Content只能显示一个，在其区域中可以通过Activate和Deactivate方法来控制显示哪个视图，其行为是由ContentControlRegionAdapter适配器控制</li>
<li>ItemsControl控件及其子控件由于显示一个集合视图，默认全部集合视图是激活的，这时候不能通过Activate和Deactivate方式来控制(会报错),通过Add和Remove来控制要显示哪些视图，其行为是由ItemsControlRegionAdapter适配器控制</li>
<li>这里没讲到Selector控件，因为也是继承自ItemsControl，因此其SelectorRegionAdapter适配器和ItemsControlRegionAdapter适配器异曲同工</li>
<li>可以通过继承IActiveAware接口来监控视图激活状态</li>
</ul>
<h1 id="四-自定义区域适配器"><a href="#四-自定义区域适配器" class="headerlink" title="四.自定义区域适配器"></a>四.自定义区域适配器</h1><p>我们在介绍整个区域管理器模型图中说过，Prism有三个默认的区域适配器：ItemsControlRegionAdapter，ContentControlRegionAdapter，SelectorRegionAdapter，且支持自定义区域适配器，现在我们来自定义一下适配器</p>
<h2 id="1-创建自定义适配器"><a href="#1-创建自定义适配器" class="headerlink" title="1.创建自定义适配器"></a>1.创建自定义适配器</h2><p>新建类UniformGridRegionAdapter.cs：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UniformGridRegionAdapter</span> : <span class="title">RegionAdapterBase</span>&lt;<span class="title">UniformGrid</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> UniformGridRegionAdapter(IRegionBehaviorFactory regionBehaviorFactory) : base(regionBehaviorFactory)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> Adapt(IRegion region, UniformGrid regionTarget)</span><br><span class="line">    &#123;</span><br><span class="line">        region.Views.CollectionChanged += (s, e) =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (e.Action==System.Collections.Specialized.NotifyCollectionChangedAction.Add)</span><br><span class="line">          &#123;</span><br><span class="line">              foreach (FrameworkElement element <span class="keyword">in</span> e.NewItems)</span><br><span class="line">              &#123;</span><br><span class="line">                   regionTarget.Children.Add(element);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">override</span> IRegion CreateRegion()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AllActiveRegion();</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-注册映射"><a href="#2-注册映射" class="headerlink" title="2.注册映射"></a>2.注册映射</h2><p>App.cs:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ConfigureRegionAdapterMappings</span>(<span class="params">RegionAdapterMappings regionAdapterMappings</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">base</span>.ConfigureRegionAdapterMappings(regionAdapterMappings);</span><br><span class="line">    <span class="comment">//为UniformGrid控件注册适配器映射</span></span><br><span class="line">    regionAdapterMappings.RegisterMapping(<span class="keyword">typeof</span>(UniformGrid),Container.Resolve&lt;UniformGridRegionAdapter&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-为控件创建区域"><a href="#3-为控件创建区域" class="headerlink" title="3.为控件创建区域"></a>3.为控件创建区域</h2><p>MainWindow.xaml:</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">UniformGrid</span> <span class="attr">Margin</span>=<span class="string">"5"</span> <span class="attr">prism:RegionManager.RegionName</span>=<span class="string">"UniformContentRegion"</span> <span class="attr">Columns</span>=<span class="string">"2"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Content</span>=<span class="string">"ActivePaientList"</span> <span class="attr">Margin</span>=<span class="string">"5"</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding ActivePaientListCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Content</span>=<span class="string">"DeactivePaientList"</span> <span class="attr">Margin</span>=<span class="string">"5"</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding DeactivePaientListCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Content</span>=<span class="string">"ActiveMedicineList"</span> <span class="attr">Margin</span>=<span class="string">"5"</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding ActiveMedicineListCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Content</span>=<span class="string">"DeactiveMedicineList"</span> <span class="attr">Margin</span>=<span class="string">"5"</span> <span class="attr">Command</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;Binding DeactiveMedicineListCommand&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;/<span class="name">UniformGrid</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="4-为区域注入视图"><a href="#4-为区域注入视图" class="headerlink" title="4.为区域注入视图"></a>4.为区域注入视图</h2><p>这里用的是ViewInjection方式：</p>
<p>MainWindowViewModel.cs</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">void ExecuteLoadingCommand()</span><br><span class="line">&#123;</span><br><span class="line">       _regionManager = CommonServiceLocator.ServiceLocator.Current.GetInstance&lt;IRegionManager&gt;()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">       var uniformContentRegion = _regionManager.Regions[<span class="string">"UniformContentRegion"</span>]<span class="comment">;</span></span><br><span class="line">       var regionAdapterView1 = CommonServiceLocator.ServiceLocator.Current.GetInstance&lt;RegionAdapterView1&gt;()<span class="comment">;</span></span><br><span class="line">       uniformContentRegion.Add(regionAdapterView1)<span class="comment">;</span></span><br><span class="line">       var regionAdapterView2 = CommonServiceLocator.ServiceLocator.Current.GetInstance&lt;RegionAdapterView2&gt;()<span class="comment">;</span></span><br><span class="line">       uniformContentRegion.Add(regionAdapterView2)<span class="comment">; </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如图：</p>
<p><img src="/img/net/csharp/1294271-20200331150744622-1824940697.png" alt="img"></p>
<p>我们可以看到我们为UniformGrid创建区域适配器，并且注册后，也能够为UniformGrid控件创建区域，并且注入视图显示，如果没有该区域适配器，则是会报错，下一篇我们将会讲解基于区域Region的prism导航系统。</p>
<h1 id="五-源码"><a href="#五-源码" class="headerlink" title="五.源码"></a>五.源码</h1><p> 项目源代码：<a href="https://github.com/myhhub/NetCoreWpfMVVMPrismSample/tree/master/PrismMetroSample" target="_blank" rel="noopener">PrismDemo源码</a></p>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2020/07/100636.html" class="pre-post btn btn-default" title='使用 Prism Unity 实现 .NET Core WPF MVVM 之六 导航系统'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">使用 Prism Unity 实现 .NET Core WPF MVVM 之六 导航系统</span>
        </a>
    
    
        <a href="/archives/2020/07/100634.html" class="next-post btn btn-default" title='使用 Prism Unity 实现 .NET Core WPF MVVM 之四 事件聚合器'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">使用 Prism Unity 实现 .NET Core WPF MVVM 之四 事件聚合器</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一-区域管理器"><span class="toc-text">一.区域管理器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二-区域创建与视图的注入"><span class="toc-text">二.区域创建与视图的注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-ViewDiscovery"><span class="toc-text">1.ViewDiscovery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-ViewInjection"><span class="toc-text">2.ViewInjection</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三-激活与失效视图"><span class="toc-text">三.激活与失效视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Activate和Deactivate"><span class="toc-text">1.Activate和Deactivate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-监控视图激活状态"><span class="toc-text">2.监控视图激活状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Add和Remove"><span class="toc-text">3.Add和Remove</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四-自定义区域适配器"><span class="toc-text">四.自定义区域适配器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-创建自定义适配器"><span class="toc-text">1.创建自定义适配器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-注册映射"><span class="toc-text">2.注册映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-为控件创建区域"><span class="toc-text">3.为控件创建区域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-为区域注入视图"><span class="toc-text">4.为区域注入视图</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五-源码"><span class="toc-text">五.源码</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2023&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>