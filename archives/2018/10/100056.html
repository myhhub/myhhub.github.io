<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="kubernetes,安装,helm">


    <meta name="description" content="Helm 致力于成为 Kubernetes 的包管理工具，可以方便地发现、共享和使用为 Kubernetes 构建的应用，它包含几个基本概念：

Chart：一个 Helm 包，其中包含了运行一...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>kubernetes包管理工具Helm之 一.Helm安装 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="kubernetes包管理工具Helm之 一.Helm安装">
            
	            kubernetes包管理工具Helm之 一.Helm安装
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/cloud/">云计算</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/helm/">helm</a> <a class="tag-link" href="/tags/kubernetes/">kubernetes</a> <a class="tag-link" href="/tags/install/">安装</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/10/22</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1639</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p>Helm 致力于成为 Kubernetes 的包管理工具，可以方便地发现、共享和使用为 Kubernetes 构建的应用，它包含几个基本概念：</p>
<ol>
<li><p>Chart：一个 Helm 包，其中包含了运行一个应用所需要的镜像、依赖和资源定义等，还可能包含 Kubernetes 集群中的服务定义，类似 Homebrew 中的 formula，APT 的 dpkg 或者 Yum 的 rpm 文件；</p>
</li>
<li><p>Release: 在 Kubernetes 集群上运行的 Chart 的一个实例。在同一个集群上，一个 Chart 可以安装很多次。每次安装都会创建一个新的 release。例如一个 MySQL Chart，如果想在服务器上运行两个数据库，就可以把这个 Chart 安装两次。每次安装都会生成自己的 Release，会有自己的 Release 名称；</p>
</li>
<li><p>Repository：用于发布和存储 Chart 的仓库</p>
</li>
</ol>
<h2 id="一、Helm-组件"><a href="#一、Helm-组件" class="headerlink" title="一、Helm 组件"></a>一、Helm 组件</h2><p>Helm 采用客户端/服务器架构，有如下组件组成：</p>
<ol>
<li>Helm CLI 是 Helm 客户端，可以在本地执行；</li>
<li>Tiller 是服务器端组件，在 Kubernetes 群集上运行，并管理 Kubernetes 应用程序的生命周期 </li>
<li>Repository 是 Chart 仓库，Helm客户端通过HTTP协议来访问仓库中Chart的索引文件和压缩包</li>
</ol>
<div align="center"><img src="/img/posts/356a3bd722c6434180f1b30fb75c9822adc3c9dd.jpeg" alt="img"></div>

<h3 id="Helm工作原理："><a href="#Helm工作原理：" class="headerlink" title="Helm工作原理："></a>Helm工作原理：</h3><p>Helm把Kubernetes资源(比如deployments、services或 ingress等) 打包到一个chart中，而chart被保存到chart仓库。通过chart仓库可用来存储和分享chart。Helm使发布可配置，支持发布应用配置的版本管理，简化了Kubernetes部署应用的版本控制、打包、发布、删除、更新等操作。</p>
<h3 id="Helm客户端："><a href="#Helm客户端：" class="headerlink" title="Helm客户端："></a>Helm客户端：</h3><p>Helm客户端是一个命令行工具，负责管理charts、reprepository和release。它通过gPRC API（使用kubectl port-forward将tiller的端口映射到本地，然后再通过映射后的端口跟tiller通信）向tiller发送请求，并由tiller来管理对应的Kubernetes资源。</p>
<h3 id="Tiller服务端："><a href="#Tiller服务端：" class="headerlink" title="Tiller服务端："></a>Tiller服务端：</h3><p>Tiller接收来自Helm客户端的请求，并把相关资源的操作发送到Kubernetes，负责管理（安装、查询、升级或删除等）和跟踪Kubernetes资源。为了方便管理，tiller把release的相关信息保存在kubernetes的ConfigMap中。</p>
<h2 id="二、Helm-客户端安装"><a href="#二、Helm-客户端安装" class="headerlink" title="二、Helm 客户端安装"></a>二、Helm 客户端安装</h2><p>从官网下载最新版本的二进制安装包到本地：<a href="https://github.com/kubernetes/helm/releases" target="_blank" rel="noopener">https://github.com/kubernetes/helm/releases</a></p>
<p>解压安装：</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 解压压缩包</span></span><br><span class="line">tar -zxvf helm<span class="number">-2.9</span><span class="number">.0</span>.tar.gz</span><br><span class="line"><span class="meta"># 把 helm 指令放到bin目录下</span></span><br><span class="line">mv helm<span class="number">-2.9</span><span class="number">.0</span>/helm /usr/local/bin/helm</span><br><span class="line"> </span><br><span class="line"><span class="meta"># 验证</span></span><br><span class="line">helm help</span><br></pre></td></tr></table></figure>
<h2 id="三、Helm-服务端安装"><a href="#三、Helm-服务端安装" class="headerlink" title="三、Helm 服务端安装"></a>三、Helm 服务端安装</h2><p>在 Kubernetes 中安装 Tiller 服务，可选镜像：registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.9.1（阿里云）</p>
<h3 id="1）先在-K8S-集群上每个节点安装-socat-软件，不然会报如下错误："><a href="#1）先在-K8S-集群上每个节点安装-socat-软件，不然会报如下错误：" class="headerlink" title="1）先在 K8S 集群上每个节点安装 socat 软件，不然会报如下错误："></a>1）先在 K8S 集群上每个节点安装 socat 软件，不然会报如下错误：</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">E0522 22:22:15.492436   24409 portforward.go:331] an <span class="builtin-name">error</span> occurred forwarding 38398 -&gt; 44134: <span class="builtin-name">error</span> forwarding<span class="built_in"> port </span>44134 <span class="keyword">to</span> pod dc6da4ab99ad9c497c0cef1776b9dd18e0a612d507e2746ed63d36ef40f30174, uid : unable <span class="keyword">to</span> <span class="keyword">do</span><span class="built_in"> port </span>forwarding: socat <span class="keyword">not</span> found.</span><br><span class="line">Error: cannot connect <span class="keyword">to</span> Tiller</span><br><span class="line"><span class="comment"># YUM 安装（每个node节点都要安装）</span></span><br><span class="line">yum install -y socat</span><br></pre></td></tr></table></figure>
<h3 id="2）安装服务端（Tiller）"><a href="#2）安装服务端（Tiller）" class="headerlink" title="2）安装服务端（Tiller）"></a>2）安装服务端（Tiller）</h3><ul>
<li>没有启用权限控制</li>
</ul>
<p>当没有启用权限控制时，安装部署过程很简单，解压后直接执行<code>helm init</code>即可。<br> 但是默认<code>helm</code>会去官方仓库下载服务端<strong>tiller</strong>镜像，地址为：<code>gcr.io/kubernetes-helm/tiller:v2.9.1</code>。<br> 由于某种众所周知的原因，<code>gcr.io</code>这个仓库是无法使用的，这里我也通过阿里云容器服务，上传了一个镜像供大家使用。<br> 只要在我们初始化的时候，指定使用的<strong>tiller</strong>镜像地址即可，如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm init --tiller-image registry<span class="selector-class">.cn-hangzhou</span><span class="selector-class">.aliyuncs</span><span class="selector-class">.com</span>/luhaoyuan/tiller:v2.<span class="number">9.1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>启用RBAC权限控制</li>
</ul>
<p>如果启用了权限控制，那就麻烦一点了，需要我们创建对应的<strong>serviceaccount</strong>，否则以下报错：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">list:</span> failed to <span class="string">list:</span> Get <span class="string">http:</span><span class="comment">//localhost:8080/api/v1/namespaces/kube-system/configmaps?</span></span><br><span class="line">labelSelector=OWNER%<span class="number">3</span><span class="string">DTILLER:</span> dial tcp <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span>: <span class="string">connect:</span> connection refused</span><br></pre></td></tr></table></figure>
<p>执行<code>helm ls</code>的时候报下面这种错误提示：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: configmaps is forbidden:<span class="built_in"> User </span><span class="string">"system:serviceaccount:kube-system:default"</span> cannot list configmaps <span class="keyword">in</span> the namespace <span class="string">"kube-system"</span></span><br></pre></td></tr></table></figure>
<p>好了，我们开始安装并授予权限吧，依次执行以下命令：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在kube-system命名空间中创建tiller账户</span></span><br><span class="line">kubectl create serviceaccount <span class="params">--namespace</span> kube-system tiller</span><br><span class="line"><span class="comment"># 创建角色并授予cluster-admin权限</span></span><br><span class="line">kubectl create clusterrolebinding tiller-cluster-rule <span class="params">--clusterrole=cluster-admin</span> <span class="params">--serviceaccount=kube-system</span><span class="function">:tiller</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 指定账户进行初始化，别忘了还要指定tiller镜像哦</span></span><br><span class="line">helm init <span class="params">--service-account</span> tiller <span class="params">--upgrade</span> -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller<span class="function">:v2.9.1</span>  <span class="params">--stable-repo-url</span> https:<span class="string">//kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span><br><span class="line"><span class="comment"># 创建TLS认证服务端，参考地址：https://github.com/gjmzj/kubeasz/blob/master/docs/guide/helm.md</span></span><br><span class="line">helm init <span class="params">--service-account</span> tiller <span class="params">--upgrade</span> -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller<span class="function">:v2.9.1</span> <span class="params">--tiller-tls-cert</span> <span class="string">/etc/kubernetes/ssl/tiller001.pem</span> <span class="params">--tiller-tls-key</span> <span class="string">/etc/kubernetes/ssl/tiller001-key.pem</span> <span class="params">--tls-ca-cert</span> <span class="string">/etc/kubernetes/ssl/ca.pem</span> <span class="params">--tiller-namespace</span> kube-system <span class="params">--stable-repo-url</span> https:<span class="string">//kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span><br></pre></td></tr></table></figure>
<p>遇到错误<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">failed <span class="keyword">to</span> list: configmaps is forbidden:<span class="built_in"> User </span>“system:serviceaccount:kube-system:default” cannot list configmaps <span class="keyword">in</span> the namespace “kube-system”</span><br></pre></td></tr></table></figure></p>
<p>执行以下命令创建 serviceaccount tiller 并且给它集群管理权限</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create serviceaccount <span class="params">--namespace</span> kube-system tiller</span><br><span class="line">kubectl create clusterrolebinding tiller-cluster-rule <span class="params">--clusterrole=cluster-admin</span> <span class="params">--serviceaccount=kube-system</span><span class="function">:tiller</span></span><br><span class="line">kubectl <span class="keyword">patch</span> <span class="keyword">deploy</span> <span class="params">--namespace</span> kube-system tiller-deploy -p '&#123;<span class="string">"spec"</span>:&#123;<span class="string">"template"</span>:&#123;<span class="string">"spec"</span>:&#123;<span class="string">"serviceAccount"</span>:<span class="string">"tiller"</span>&#125;&#125;&#125;&#125;'</span><br></pre></td></tr></table></figure>
<p>配置 Helm 的 Repository。这里我们使用了阿里云容器服务提供的 Charts 存储库。<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">helm repo **<span class="built_in">add</span>** incubator http<span class="variable">s:</span>//aliacs-app-catalog.oss-**<span class="keyword">cn</span>**-hangzhou.aliyuncs.**<span class="keyword">com</span>**/charts-incubator/</span><br><span class="line">helm repo **<span class="keyword">update</span>**</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">cd</span> /usr/local/bin/</span><br><span class="line">$ helm repo <span class="built_in">add</span> dev http<span class="variable">s:</span>//kubernetes-charts.storage.googleapis.<span class="keyword">com</span></span><br></pre></td></tr></table></figure></p>
<h3 id="验证是否安装成功："><a href="#验证是否安装成功：" class="headerlink" title="验证是否安装成功："></a>验证是否安装成功：</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最后验证一下，是否有报错，执行以下命令没报错则表示成功了</span></span><br><span class="line">helm ls</span><br><span class="line"><span class="comment"># 查看 helm 版本信息</span></span><br><span class="line">helm version</span><br><span class="line"> </span><br><span class="line">Client: &amp;version.Version&#123;SemVer:<span class="string">"v2.9.1"</span>, GitCommit:<span class="string">"20adb27c7c5868466912eebdf6664e7390ebe710"</span>, GitTreeState:<span class="string">"clean"</span>&#125;</span><br><span class="line">Server: &amp;version.Version&#123;SemVer:<span class="string">"v2.9.1"</span>, GitCommit:<span class="string">"20adb27c7c5868466912eebdf6664e7390ebe710"</span>, GitTreeState:<span class="string">"clean"</span>&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 查看 pod 运行情况</span></span><br><span class="line">kubectl <span class="builtin-name">get</span> pod -o wide --all-namespaces</span><br><span class="line"> </span><br><span class="line">NAMESPACE     NAME                             READY     STATUS    RESTARTS   AGE      <span class="built_in"> IP </span>           NODE</span><br><span class="line">kube-system   tiller-deploy-59c7578f9b-28kb9   1/1       Running   0          16s       172.20.0.41   192.168.80.231</span><br></pre></td></tr></table></figure>
<h3 id="卸载-tiller卸载后-移除tiller相关svc-deploy以及-root-helm目录-重新安装"><a href="#卸载-tiller卸载后-移除tiller相关svc-deploy以及-root-helm目录-重新安装" class="headerlink" title="卸载 tiller卸载后(移除tiller相关svc,deploy以及/root/.helm目录),重新安装"></a>卸载 tiller卸载后(移除tiller相关svc,deploy以及/root/.helm目录),重新安装</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">helm <span class="built_in">reset</span></span><br><span class="line"><span class="keyword">or</span></span><br><span class="line">kubectl -n kube-<span class="built_in">system</span> <span class="built_in">delete</span> deployment tiller-dep</span><br><span class="line"></span><br><span class="line">kubectl -n kube-<span class="built_in">system</span> <span class="built_in">delete</span> svc  tiller-deploy</span><br><span class="line"></span><br><span class="line">rm -rf /root/.helm</span><br></pre></td></tr></table></figure>
<h2 id="四、Helm-使用"><a href="#四、Helm-使用" class="headerlink" title="四、Helm 使用"></a>四、Helm 使用</h2><h3 id="1）更换仓库："><a href="#1）更换仓库：" class="headerlink" title="1）更换仓库："></a>1）更换仓库：</h3><p>若遇到Unable to get an update from the “stable” chart repository (<a href="https://kubernetes-charts.storage.googleapis.com/" target="_blank" rel="noopener">https://kubernetes-charts.storage.googleapis.com</a>) 错误<br> 手动更换stable 存储库为阿里云的存储库</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 先移除原先的仓库</span></span><br><span class="line">helm repo remove stable</span><br><span class="line"><span class="meta"># 添加新的仓库地址</span></span><br><span class="line">helm repo add stable https:<span class="comment">//kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span><br><span class="line"><span class="meta"># 更新仓库</span></span><br><span class="line">helm repo update</span><br></pre></td></tr></table></figure>
<h3 id="2）查看在存储库中可用的所有-Helm-charts："><a href="#2）查看在存储库中可用的所有-Helm-charts：" class="headerlink" title="2）查看在存储库中可用的所有 Helm charts："></a>2）查看在存储库中可用的所有 Helm charts：</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">helm search</span><br><span class="line"> </span><br><span class="line">NAME                            CHART VERSION   APP VERSION     DESCRIPTION                                       </span><br><span class="line">stable/acs-engine-autoscaler    <span class="number">2.1</span><span class="number">.3</span>           <span class="number">2.1</span><span class="number">.1</span>           Scales worker nodes within agent pools            </span><br><span class="line">stable/aerospike                <span class="number">0.1</span><span class="number">.7</span>           v3<span class="number">.14</span><span class="number">.1</span><span class="number">.2</span>       A Helm chart for Aerospike in Kubernetes          </span><br><span class="line">stable/anchore-engine           <span class="number">0.1</span><span class="number">.3</span>           <span class="number">0.1</span><span class="number">.6</span>           Anchore container analysis and policy evaluatio...</span><br><span class="line">stable/artifactory              <span class="number">7.0</span><span class="number">.3</span>           <span class="number">5.8</span><span class="number">.4</span>           Universal Repository Manager supporting all maj...</span><br><span class="line">stable/artifactory-ha           <span class="number">0.1</span><span class="number">.0</span>           <span class="number">5.8</span><span class="number">.4</span>           Universal Repository Manager supporting all maj...</span><br><span class="line">stable/aws-cluster-autoscaler   <span class="number">0.3</span><span class="number">.2</span>                           Scales worker nodes within autoscaling groups.</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure>
<h3 id="3）更新charts列表："><a href="#3）更新charts列表：" class="headerlink" title="3）更新charts列表："></a>3）更新charts列表：</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">helm repo update</span></span><br></pre></td></tr></table></figure>
<h3 id="4）安装charts："><a href="#4）安装charts：" class="headerlink" title="4）安装charts："></a>4）安装charts：</h3><p>Monocular是一个开源软件，用于管理kubernetes上以Helm Charts形式创建的服务，可以通过它的web页面来安装helm Charts</p>
<p>安装Nginx Ingress controller，安装的k8s集群启用了RBAC，则一定要加rbac.create=true参数</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install stable/nginx-ingress --<span class="builtin-name">set</span> controller.<span class="attribute">hostNetwork</span>=<span class="literal">true</span>，rbac.create=true</span><br></pre></td></tr></table></figure>
<p>安装Monocular：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 添加新的源</span><br><span class="line">helm repo <span class="built_in">add</span> monocular http<span class="variable">s:</span>//kubernetes-helm.github.io/monocular</span><br><span class="line"># 安装</span><br><span class="line">helm install monocular/monocular -<span class="keyword">f</span> custom-repos.yaml</span><br><span class="line"> </span><br><span class="line"># custom-repos.yaml 内容</span><br><span class="line"><span class="keyword">cat</span> custom-repos.yaml</span><br><span class="line"> </span><br><span class="line">api:</span><br><span class="line">  confi<span class="variable">g:</span></span><br><span class="line">    repo<span class="variable">s:</span></span><br><span class="line">      - name: stable</span><br><span class="line">        ur<span class="variable">l:</span> http<span class="variable">s:</span>//aliacs-app-catalog.oss-<span class="keyword">cn</span>-hangzhou.aliyuncs.<span class="keyword">com</span>/charts</span><br><span class="line">        <span class="keyword">source</span>: http<span class="variable">s:</span>//github.<span class="keyword">com</span>/kubernetes/charts/tree/master/stable</span><br><span class="line">      - name: incubator</span><br><span class="line">        ur<span class="variable">l:</span> http<span class="variable">s:</span>//aliacs-app-catalog.oss-<span class="keyword">cn</span>-hangzhou.aliyuncs.<span class="keyword">com</span>/charts-incubator</span><br><span class="line">        <span class="keyword">source</span>: http<span class="variable">s:</span>//github.<span class="keyword">com</span>/kubernetes/charts/tree/master/incubator</span><br><span class="line">      - name: monocular</span><br><span class="line">        ur<span class="variable">l:</span> http<span class="variable">s:</span>//kubernetes-helm.github.io/monocular</span><br><span class="line">        <span class="keyword">source</span>: http<span class="variable">s:</span>//github.<span class="keyword">com</span>/kubernetes-helm/monocular/tree/master/charts</span><br></pre></td></tr></table></figure>
<h3 id="5）查看K8S中已安装的charts："><a href="#5）查看K8S中已安装的charts：" class="headerlink" title="5）查看K8S中已安装的charts："></a>5）查看K8S中已安装的charts：</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">helm list</span><br><span class="line"> </span><br><span class="line">NAME                REVISION    UPDATED                     STATUS      CHART               NAMESPACE</span><br><span class="line">amber-seal          1           Mon Jul  2 17:29:25 2018    DEPLOYED    nginx-ingress-0.9.5<span class="built_in"> default </span> </span><br><span class="line">my-release          1           Mon Jul  2 15:19:44 2018    DEPLOYED    spark-0.1.10       <span class="built_in"> default </span> </span><br><span class="line">nonplussed-panther  1           Mon Jul  2 17:27:41 2018    FAILED      nginx-ingress-0.9.5<span class="built_in"> default </span> </span><br><span class="line">turbulent-tuatara   1           Mon Jul  2 17:31:33 2018    DEPLOYED    monocular-0.6.2     default</span><br></pre></td></tr></table></figure>
<h3 id="6）删除安装的charts："><a href="#6）删除安装的charts：" class="headerlink" title="6）删除安装的charts："></a>6）删除安装的charts：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 删除：helm <span class="keyword">delete</span> xxx</span><br><span class="line">helm <span class="keyword">delete</span> amber-seal</span><br></pre></td></tr></table></figure>
<h2 id="五、卸载-Helm-服务端"><a href="#五、卸载-Helm-服务端" class="headerlink" title="五、卸载 Helm 服务端"></a>五、卸载 Helm 服务端</h2><p>执行命令，加 –force强制卸载</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm <span class="keyword">reset</span> 或</span><br><span class="line">helm <span class="keyword">reset</span> <span class="comment">--force</span></span><br></pre></td></tr></table></figure>
<hr>
<p><strong>参考资料</strong><br><a href="https://github.com/gjmzj/kubeasz/blob/master/docs/guide/helm.md" target="_blank" rel="noopener">https://github.com/gjmzj/kubeasz/blob/master/docs/guide/helm.md</a><br><a href="https://blog.csdn.net/wenwenxiong/article/details/79067054" target="_blank" rel="noopener">https://blog.csdn.net/wenwenxiong/article/details/79067054</a><br><a href="https://blog.csdn.net/luanpeng825485697/article/details/80873236" target="_blank" rel="noopener">https://blog.csdn.net/luanpeng825485697/article/details/80873236</a></p>
<hr>
<p>接下文: <a href="100063.html">kubernetes包管理工具Helm之 二.Helm模板使用</a></p>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2018/10/100063.html" class="pre-post btn btn-default" title='kubernetes包管理工具Helm之 二.Helm模板使用'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">kubernetes包管理工具Helm之 二.Helm模板使用</span>
        </a>
    
    
        <a href="/archives/2018/10/100057.html" class="next-post btn btn-default" title='信息抽取、知识图谱、情感分析、社会计算等自然语言处理开源项目'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">信息抽取、知识图谱、情感分析、社会计算等自然语言处理开源项目</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、Helm-组件"><span class="toc-text">一、Helm 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Helm工作原理："><span class="toc-text">Helm工作原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Helm客户端："><span class="toc-text">Helm客户端：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tiller服务端："><span class="toc-text">Tiller服务端：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、Helm-客户端安装"><span class="toc-text">二、Helm 客户端安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、Helm-服务端安装"><span class="toc-text">三、Helm 服务端安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1）先在-K8S-集群上每个节点安装-socat-软件，不然会报如下错误："><span class="toc-text">1）先在 K8S 集群上每个节点安装 socat 软件，不然会报如下错误：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2）安装服务端（Tiller）"><span class="toc-text">2）安装服务端（Tiller）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证是否安装成功："><span class="toc-text">验证是否安装成功：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#卸载-tiller卸载后-移除tiller相关svc-deploy以及-root-helm目录-重新安装"><span class="toc-text">卸载 tiller卸载后(移除tiller相关svc,deploy以及/root/.helm目录),重新安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、Helm-使用"><span class="toc-text">四、Helm 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1）更换仓库："><span class="toc-text">1）更换仓库：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2）查看在存储库中可用的所有-Helm-charts："><span class="toc-text">2）查看在存储库中可用的所有 Helm charts：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3）更新charts列表："><span class="toc-text">3）更新charts列表：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4）安装charts："><span class="toc-text">4）安装charts：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5）查看K8S中已安装的charts："><span class="toc-text">5）查看K8S中已安装的charts：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6）删除安装的charts："><span class="toc-text">6）删除安装的charts：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、卸载-Helm-服务端"><span class="toc-text">五、卸载 Helm 服务端</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2023&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>