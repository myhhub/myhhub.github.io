<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.ljjyy.com">
    <!--SEO-->

    <meta name="keywords" content="kubernetes,安装,helm" />


    <meta name="description" content="Helm 致力于成为 Kubernetes 的包管理工具，可以方便地发现、共享和使用为 Kubernetes 构建的应用，它包含几个基本概念：

Chart：一个 Helm 包，其中包含了运行一..." />



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />

    <!--Title-->


<title>kubernetes包管理工具Helm之 一.Helm安装 | 来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</title>


    <link rel="alternate" href="/atom.xml" title="来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    




<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">





    
	<div class="hide">
        <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
        <script>LA.init({id: "JgbNOaw1xxsmUUsQ",ck: "JgbNOaw1xxsmUUsQ"})</script>
	</div>






    
    <meta name="baidu-site-verification" content="dTHILoORpx" />


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

<meta name="generator" content="Hexo 7.3.0"></head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <!--a class="header-avatar" href="/" title='Ljjyy.com'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a-->
        <div class="branding">
            
                <h2> 多读书多实践，勤思考善领悟 </h2>
            
    	  </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">

        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="web-logo"  href="/" title='Ljjyy.com'></a>
                    <!--a class="navbar-brand" href="https://www.ljjyy.com">来唧唧歪歪(Ljjyy.com) - 多读书多实践，勤思考善领悟</a-->
                </div>
                <div class="collapse navbar-collapse" id="main-menu" style="">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/cloud/"><i class="fa "></i>云计算</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/front/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/back/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/devops/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/crack/"><i class="fa "></i>破解</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/penetration/"><i class="fa "></i>渗透</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/tool/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/other/"><i class="fa "></i>其他</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="kubernetes包管理工具Helm之 一.Helm安装">
            
	            kubernetes包管理工具Helm之 一.Helm安装
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/cloud/">云计算</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-none-link" href="/tags/helm/" rel="tag">helm</a> <a class="tag-none-link" href="/tags/kubernetes/" rel="tag">kubernetes</a> <a class="tag-none-link" href="/tags/install/" rel="tag">安装</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/10/22</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>2339</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p>Helm 致力于成为 Kubernetes 的包管理工具，可以方便地发现、共享和使用为 Kubernetes 构建的应用，它包含几个基本概念：</p>
<ol>
<li><p>Chart：一个 Helm 包，其中包含了运行一个应用所需要的镜像、依赖和资源定义等，还可能包含 Kubernetes 集群中的服务定义，类似 Homebrew 中的 formula，APT 的 dpkg 或者 Yum 的 rpm 文件；</p>
</li>
<li><p>Release: 在 Kubernetes 集群上运行的 Chart 的一个实例。在同一个集群上，一个 Chart 可以安装很多次。每次安装都会创建一个新的 release。例如一个 MySQL Chart，如果想在服务器上运行两个数据库，就可以把这个 Chart 安装两次。每次安装都会生成自己的 Release，会有自己的 Release 名称；</p>
</li>
<li><p>Repository：用于发布和存储 Chart 的仓库</p>
</li>
</ol>
<h2 id="一、Helm-组件"><a href="#一、Helm-组件" class="headerlink" title="一、Helm 组件"></a>一、Helm 组件</h2><p>Helm 采用客户端&#x2F;服务器架构，有如下组件组成：</p>
<ol>
<li>Helm CLI 是 Helm 客户端，可以在本地执行；</li>
<li>Tiller 是服务器端组件，在 Kubernetes 群集上运行，并管理 Kubernetes 应用程序的生命周期 </li>
<li>Repository 是 Chart 仓库，Helm客户端通过HTTP协议来访问仓库中Chart的索引文件和压缩包</li>
</ol>
<div align="center">![img](/img/posts/356a3bd722c6434180f1b30fb75c9822adc3c9dd.jpeg)</div>

<h3 id="Helm工作原理："><a href="#Helm工作原理：" class="headerlink" title="Helm工作原理："></a>Helm工作原理：</h3><p>Helm把Kubernetes资源(比如deployments、services或 ingress等) 打包到一个chart中，而chart被保存到chart仓库。通过chart仓库可用来存储和分享chart。Helm使发布可配置，支持发布应用配置的版本管理，简化了Kubernetes部署应用的版本控制、打包、发布、删除、更新等操作。</p>
<h3 id="Helm客户端："><a href="#Helm客户端：" class="headerlink" title="Helm客户端："></a>Helm客户端：</h3><p>Helm客户端是一个命令行工具，负责管理charts、reprepository和release。它通过gPRC API（使用kubectl port-forward将tiller的端口映射到本地，然后再通过映射后的端口跟tiller通信）向tiller发送请求，并由tiller来管理对应的Kubernetes资源。</p>
<h3 id="Tiller服务端："><a href="#Tiller服务端：" class="headerlink" title="Tiller服务端："></a>Tiller服务端：</h3><p>Tiller接收来自Helm客户端的请求，并把相关资源的操作发送到Kubernetes，负责管理（安装、查询、升级或删除等）和跟踪Kubernetes资源。为了方便管理，tiller把release的相关信息保存在kubernetes的ConfigMap中。</p>
<h2 id="二、Helm-客户端安装"><a href="#二、Helm-客户端安装" class="headerlink" title="二、Helm 客户端安装"></a>二、Helm 客户端安装</h2><p>从官网下载最新版本的二进制安装包到本地：<a href="https://github.com/kubernetes/helm/releases">https://github.com/kubernetes/helm/releases</a></p>
<p>解压安装：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压压缩包</span></span><br><span class="line"><span class="attribute">tar</span> -zxvf helm-<span class="number">2</span>.<span class="number">9</span>.<span class="number">0</span>.tar.gz</span><br><span class="line"><span class="comment"># 把 helm 指令放到bin目录下</span></span><br><span class="line"><span class="attribute">mv</span> helm-<span class="number">2</span>.<span class="number">9</span>.<span class="number">0</span>/helm /usr/local/bin/helm</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line"><span class="attribute">helm</span> help</span><br></pre></td></tr></table></figure>

<h2 id="三、Helm-服务端安装"><a href="#三、Helm-服务端安装" class="headerlink" title="三、Helm 服务端安装"></a>三、Helm 服务端安装</h2><p>在 Kubernetes 中安装 Tiller 服务，可选镜像：registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;tiller:v2.9.1（阿里云）</p>
<h3 id="1）先在-K8S-集群上每个节点安装-socat-软件，不然会报如下错误："><a href="#1）先在-K8S-集群上每个节点安装-socat-软件，不然会报如下错误：" class="headerlink" title="1）先在 K8S 集群上每个节点安装 socat 软件，不然会报如下错误："></a>1）先在 K8S 集群上每个节点安装 socat 软件，不然会报如下错误：</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">E0522 22:22:15.492436   24409 portforward.go:331] an <span class="built_in">error</span> occurred forwarding 38398 -&gt; 44134: <span class="built_in">error</span> forwarding<span class="built_in"> port </span>44134 <span class="keyword">to</span> pod dc6da4ab99ad9c497c0cef1776b9dd18e0a612d507e2746ed63d36ef40f30174, uid : unable <span class="keyword">to</span> <span class="keyword">do</span><span class="built_in"> port </span>forwarding: socat <span class="keyword">not</span> found.</span><br><span class="line">Error: cannot connect <span class="keyword">to</span> Tiller</span><br><span class="line"><span class="comment"># YUM 安装（每个node节点都要安装）</span></span><br><span class="line">yum install -y socat </span><br></pre></td></tr></table></figure>

<h3 id="2）安装服务端（Tiller）"><a href="#2）安装服务端（Tiller）" class="headerlink" title="2）安装服务端（Tiller）"></a>2）安装服务端（Tiller）</h3><ul>
<li>没有启用权限控制</li>
</ul>
<p>当没有启用权限控制时，安装部署过程很简单，解压后直接执行<code>helm init</code>即可。<br> 但是默认<code>helm</code>会去官方仓库下载服务端<strong>tiller</strong>镜像，地址为：<code>gcr.io/kubernetes-helm/tiller:v2.9.1</code>。<br> 由于某种众所周知的原因，<code>gcr.io</code>这个仓库是无法使用的，这里我也通过阿里云容器服务，上传了一个镜像供大家使用。<br> 只要在我们初始化的时候，指定使用的<strong>tiller</strong>镜像地址即可，如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm init <span class="attr">--tiller-image</span> registry<span class="selector-class">.cn-hangzhou</span><span class="selector-class">.aliyuncs</span>.com/luhaoyuan/tiller:v2.<span class="number">9.1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启用RBAC权限控制</li>
</ul>
<p>如果启用了权限控制，那就麻烦一点了，需要我们创建对应的<strong>serviceaccount</strong>，否则以下报错：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list: failed <span class="keyword">to</span> list: <span class="keyword">Get</span> http://localhost:<span class="number">8080</span>/api/v1/namespaces/kube-<span class="keyword">system</span>/configmaps?</span><br><span class="line">labelSelector=<span class="keyword">OWNER</span>%<span class="number">3</span>DTILLER: dial tcp <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span>: <span class="keyword">connect</span>: <span class="keyword">connection</span> refused</span><br></pre></td></tr></table></figure>

<p>执行<code>helm ls</code>的时候报下面这种错误提示：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Error: </span>configmaps is forbidden: User &quot;system:serviceaccount:kube-system:default&quot; cannot list configmaps in the namespace &quot;kube-system&quot;</span><br></pre></td></tr></table></figure>

<p>好了，我们开始安装并授予权限吧，依次执行以下命令：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在kube-system命名空间中创建tiller账户</span></span><br><span class="line">kubectl create serviceaccount <span class="params">--namespace</span> kube-system tiller</span><br><span class="line"><span class="comment"># 创建角色并授予cluster-admin权限</span></span><br><span class="line">kubectl create clusterrolebinding tiller-cluster-rule <span class="params">--clusterrole=cluster-admin</span> <span class="params">--serviceaccount=kube-system</span><span class="function">:tiller</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 指定账户进行初始化，别忘了还要指定tiller镜像哦</span></span><br><span class="line">helm init <span class="params">--service-account</span> tiller <span class="params">--upgrade</span> -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller<span class="function">:v2.9.1</span>  <span class="params">--stable-repo-url</span> https:<span class="string">//kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span><br><span class="line"><span class="comment"># 创建TLS认证服务端，参考地址：https://github.com/gjmzj/kubeasz/blob/master/docs/guide/helm.md</span></span><br><span class="line">helm init <span class="params">--service-account</span> tiller <span class="params">--upgrade</span> -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller<span class="function">:v2.9.1</span> <span class="params">--tiller-tls-cert</span> <span class="string">/etc/kubernetes/ssl/tiller001.pem</span> <span class="params">--tiller-tls-key</span> <span class="string">/etc/kubernetes/ssl/tiller001-key.pem</span> <span class="params">--tls-ca-cert</span> <span class="string">/etc/kubernetes/ssl/ca.pem</span> <span class="params">--tiller-namespace</span> kube-system <span class="params">--stable-repo-url</span> https:<span class="string">//kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span><br></pre></td></tr></table></figure>

<p>遇到错误</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">failed <span class="keyword">to</span> list: configmaps <span class="keyword">is</span> forbidden: <span class="keyword">User</span> “<span class="keyword">system</span>:serviceaccount:kube-<span class="keyword">system</span>:<span class="keyword">default</span>” cannot list configmaps <span class="keyword">in</span> the namespace “kube-<span class="keyword">system</span>”</span><br></pre></td></tr></table></figure>

<p>执行以下命令创建 serviceaccount tiller 并且给它集群管理权限</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create serviceaccount <span class="params">--namespace</span> kube-system tiller</span><br><span class="line">kubectl create clusterrolebinding tiller-cluster-rule <span class="params">--clusterrole=cluster-admin</span> <span class="params">--serviceaccount=kube-system</span><span class="function">:tiller</span></span><br><span class="line">kubectl <span class="keyword">patch</span> <span class="keyword">deploy</span> <span class="params">--namespace</span> kube-system tiller-deploy -p &#x27;&#123;<span class="string">&quot;spec&quot;</span>:&#123;<span class="string">&quot;template&quot;</span>:&#123;<span class="string">&quot;spec&quot;</span>:&#123;<span class="string">&quot;serviceAccount&quot;</span>:<span class="string">&quot;tiller&quot;</span>&#125;&#125;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>配置 Helm 的 Repository。这里我们使用了阿里云容器服务提供的 Charts 存储库。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">helm repo **<span class="built_in">add</span>** incubator https://aliacs-app-catalog.oss-**<span class="keyword">cn</span>**-hangzhou.aliyuncs.**<span class="keyword">com</span>**/charts-incubator/</span><br><span class="line">helm repo **<span class="keyword">update</span>**</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">cd</span> /usr/local/bin/</span><br><span class="line">$ helm repo <span class="built_in">add</span> dev https://kubernetes-charts.storage.googleapis.<span class="keyword">com</span></span><br></pre></td></tr></table></figure>

<h3 id="验证是否安装成功："><a href="#验证是否安装成功：" class="headerlink" title="验证是否安装成功："></a>验证是否安装成功：</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最后验证一下，是否有报错，执行以下命令没报错则表示成功了</span></span><br><span class="line"><span class="attribute">helm</span> ls</span><br><span class="line"><span class="comment"># 查看 helm 版本信息</span></span><br><span class="line"><span class="attribute">helm</span> version</span><br><span class="line"> </span><br><span class="line"><span class="attribute">Client</span>: &amp;version.Version&#123;SemVer:<span class="string">&quot;v2.9.1&quot;</span>, GitCommit:<span class="string">&quot;20adb27c7c5868466912eebdf6664e7390ebe710&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>&#125;</span><br><span class="line"><span class="attribute">Server</span>: &amp;version.Version&#123;SemVer:<span class="string">&quot;v2.9.1&quot;</span>, GitCommit:<span class="string">&quot;20adb27c7c5868466912eebdf6664e7390ebe710&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 查看 pod 运行情况</span></span><br><span class="line"><span class="attribute">kubectl</span> get pod -o wide --<span class="literal">all</span>-namespaces</span><br><span class="line"> </span><br><span class="line"><span class="attribute">NAMESPACE</span>     NAME                             READY     STATUS    RESTARTS   AGE       IP            NODE</span><br><span class="line"><span class="attribute">kube</span>-system   tiller-deploy-<span class="number">59</span>c7578f9b-<span class="number">28</span>kb9   <span class="number">1</span>/<span class="number">1</span>       Running   <span class="number">0</span>          <span class="number">16</span>s       <span class="number">172.20.0.41</span>   <span class="number">192.168.80.231</span></span><br></pre></td></tr></table></figure>

<h3 id="卸载-tiller卸载后-移除tiller相关svc-deploy以及-root-helm目录-重新安装"><a href="#卸载-tiller卸载后-移除tiller相关svc-deploy以及-root-helm目录-重新安装" class="headerlink" title="卸载 tiller卸载后(移除tiller相关svc,deploy以及&#x2F;root&#x2F;.helm目录),重新安装"></a>卸载 tiller卸载后(移除tiller相关svc,deploy以及&#x2F;root&#x2F;.helm目录),重新安装</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">helm <span class="built_in">reset</span></span><br><span class="line"><span class="keyword">or</span></span><br><span class="line">kubectl -n kube-<span class="built_in">system</span> <span class="built_in">delete</span> deployment tiller-dep</span><br><span class="line"></span><br><span class="line">kubectl -n kube-<span class="built_in">system</span> <span class="built_in">delete</span> svc  tiller-deploy</span><br><span class="line"></span><br><span class="line">rm -rf /root/.helm </span><br></pre></td></tr></table></figure>
<h2 id="四、Helm-使用"><a href="#四、Helm-使用" class="headerlink" title="四、Helm 使用"></a>四、Helm 使用</h2><h3 id="1）更换仓库："><a href="#1）更换仓库：" class="headerlink" title="1）更换仓库："></a>1）更换仓库：</h3><p>若遇到Unable to get an update from the “stable” chart repository (<a href="https://kubernetes-charts.storage.googleapis.com/">https://kubernetes-charts.storage.googleapis.com</a>) 错误<br> 手动更换stable 存储库为阿里云的存储库</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 先移除原先的仓库</span></span><br><span class="line">helm repo <span class="keyword">remove</span> stable</span><br><span class="line"><span class="meta"># 添加新的仓库地址</span></span><br><span class="line">helm repo <span class="keyword">add</span> stable https:<span class="comment">//kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span><br><span class="line"><span class="meta"># 更新仓库</span></span><br><span class="line">helm repo update</span><br></pre></td></tr></table></figure>

<h3 id="2）查看在存储库中可用的所有-Helm-charts："><a href="#2）查看在存储库中可用的所有-Helm-charts：" class="headerlink" title="2）查看在存储库中可用的所有 Helm charts："></a>2）查看在存储库中可用的所有 Helm charts：</h3><figure class="highlight mercury"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">helm search</span><br><span class="line"> </span><br><span class="line">NAME                            CHART VERSION   APP VERSION     DESCRIPTION                                       </span><br><span class="line"><span class="meta">stable</span>/acs-engine-autoscaler    <span class="number">2.1</span>.<span class="number">3</span>           <span class="number">2.1</span>.<span class="number">1</span>           Scales worker nodes within agent pools            </span><br><span class="line"><span class="meta">stable</span>/aerospike                <span class="number">0.1</span>.<span class="number">7</span>           v3.<span class="number">14.1</span>.<span class="number">2</span>       A Helm chart for Aerospike in Kubernetes          </span><br><span class="line"><span class="meta">stable</span>/anchore-engine           <span class="number">0.1</span>.<span class="number">3</span>           <span class="number">0.1</span>.<span class="number">6</span>           Anchore container analysis and policy evaluatio...</span><br><span class="line"><span class="meta">stable</span>/artifactory              <span class="number">7.0</span>.<span class="number">3</span>           <span class="number">5.8</span>.<span class="number">4</span>           Universal Repository Manager supporting <span class="built_in">all</span> maj...</span><br><span class="line"><span class="meta">stable</span>/artifactory-ha           <span class="number">0.1</span>.<span class="number">0</span>           <span class="number">5.8</span>.<span class="number">4</span>           Universal Repository Manager supporting <span class="built_in">all</span> maj...</span><br><span class="line"><span class="meta">stable</span>/aws-cluster-autoscaler   <span class="number">0.3</span>.<span class="number">2</span>                           Scales worker nodes within autoscaling groups.</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure>

<h3 id="3）更新charts列表："><a href="#3）更新charts列表：" class="headerlink" title="3）更新charts列表："></a>3）更新charts列表：</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">helm repo update</span></span><br></pre></td></tr></table></figure>

<h3 id="4）安装charts："><a href="#4）安装charts：" class="headerlink" title="4）安装charts："></a>4）安装charts：</h3><p>Monocular是一个开源软件，用于管理kubernetes上以Helm Charts形式创建的服务，可以通过它的web页面来安装helm Charts</p>
<p>安装Nginx Ingress controller，安装的k8s集群启用了RBAC，则一定要加rbac.create&#x3D;true参数</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install stable/nginx-ingress --<span class="built_in">set</span> controller.<span class="attribute">hostNetwork</span>=<span class="literal">true</span>，rbac.create=true</span><br></pre></td></tr></table></figure>

<p>安装Monocular：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加新的源</span></span><br><span class="line">helm repo add monocular https:<span class="symbol">//kubernetes-helm.github.io/monocular</span></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">helm install monocular<span class="symbol">/monocular</span> <span class="operator">-</span>f custom-repos.yaml</span><br><span class="line"> </span><br><span class="line"><span class="comment"># custom-repos.yaml 内容</span></span><br><span class="line">cat custom-repos.yaml</span><br><span class="line"> </span><br><span class="line"><span class="params">api:</span></span><br><span class="line">  <span class="params">config:</span></span><br><span class="line">    <span class="params">repos:</span></span><br><span class="line">      <span class="operator">-</span> <span class="params">name:</span> stable</span><br><span class="line">        <span class="params">url:</span> https:<span class="symbol">//aliacs-app-catalog.oss-cn-hangzhou.aliyuncs.com/charts</span></span><br><span class="line">        <span class="params">source:</span> https:<span class="symbol">//github.com/kubernetes/charts/tree/master/stable</span></span><br><span class="line">      <span class="operator">-</span> <span class="params">name:</span> incubator</span><br><span class="line">        <span class="params">url:</span> https:<span class="symbol">//aliacs-app-catalog.oss-cn-hangzhou.aliyuncs.com/charts-incubator</span></span><br><span class="line">        <span class="params">source:</span> https:<span class="symbol">//github.com/kubernetes/charts/tree/master/incubator</span></span><br><span class="line">      <span class="operator">-</span> <span class="params">name:</span> monocular</span><br><span class="line">        <span class="params">url:</span> https:<span class="symbol">//kubernetes-helm.github.io/monocular</span></span><br><span class="line">        <span class="params">source:</span> https:<span class="operator">//</span>github.com<span class="operator">/</span>kubernetes-helm<span class="operator">/</span>monocular<span class="operator">/</span>tree<span class="operator">/</span>master<span class="operator">/</span>charts</span><br></pre></td></tr></table></figure>

<h3 id="5）查看K8S中已安装的charts："><a href="#5）查看K8S中已安装的charts：" class="headerlink" title="5）查看K8S中已安装的charts："></a>5）查看K8S中已安装的charts：</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">helm</span> list</span><br><span class="line"> </span><br><span class="line"><span class="attribute">NAME</span>                REVISION    UPDATED                     STATUS      CHART               NAMESPACE</span><br><span class="line"><span class="attribute">amber</span>-seal          <span class="number">1</span>           Mon Jul  <span class="number">2</span> <span class="number">17</span>:<span class="number">29</span>:<span class="number">25</span> <span class="number">2018</span>    DEPLOYED    nginx-ingress-<span class="number">0</span>.<span class="number">9</span>.<span class="number">5</span> default  </span><br><span class="line"><span class="attribute">my</span>-release          <span class="number">1</span>           Mon Jul  <span class="number">2</span> <span class="number">15</span>:<span class="number">19</span>:<span class="number">44</span> <span class="number">2018</span>    DEPLOYED    spark-<span class="number">0</span>.<span class="number">1</span>.<span class="number">10</span>        default  </span><br><span class="line"><span class="attribute">nonplussed</span>-panther  <span class="number">1</span>           Mon Jul  <span class="number">2</span> <span class="number">17</span>:<span class="number">27</span>:<span class="number">41</span> <span class="number">2018</span>    FAILED      nginx-ingress-<span class="number">0</span>.<span class="number">9</span>.<span class="number">5</span> default  </span><br><span class="line"><span class="attribute">turbulent</span>-tuatara   <span class="number">1</span>           Mon Jul  <span class="number">2</span> <span class="number">17</span>:<span class="number">31</span>:<span class="number">33</span> <span class="number">2018</span>    DEPLOYED    monocular-<span class="number">0</span>.<span class="number">6</span>.<span class="number">2</span>     default</span><br></pre></td></tr></table></figure>

<h3 id="6）删除安装的charts："><a href="#6）删除安装的charts：" class="headerlink" title="6）删除安装的charts："></a>6）删除安装的charts：</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 删除：helm <span class="keyword">delete</span> xxx</span><br><span class="line">helm <span class="keyword">delete</span> amber-seal</span><br></pre></td></tr></table></figure>

<h2 id="五、卸载-Helm-服务端"><a href="#五、卸载-Helm-服务端" class="headerlink" title="五、卸载 Helm 服务端"></a>五、卸载 Helm 服务端</h2><p>执行命令，加 –force强制卸载</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm <span class="keyword">reset</span> 或</span><br><span class="line">helm <span class="keyword">reset</span> <span class="comment">--force</span></span><br></pre></td></tr></table></figure>
<hr>
<p><strong>参考资料</strong><br><a href="https://github.com/gjmzj/kubeasz/blob/master/docs/guide/helm.md">https://github.com/gjmzj/kubeasz/blob/master/docs/guide/helm.md</a><br><a href="https://blog.csdn.net/wenwenxiong/article/details/79067054">https://blog.csdn.net/wenwenxiong/article/details/79067054</a><br><a href="https://blog.csdn.net/luanpeng825485697/article/details/80873236">https://blog.csdn.net/luanpeng825485697/article/details/80873236</a></p>
<hr>
<p>接下文: <a href="100063.html">kubernetes包管理工具Helm之 二.Helm模板使用</a></p>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="/" target="_blank">Ljjyy.com</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/archives/2018/10/100063.html" class="pre-post btn btn-default" title='kubernetes包管理工具Helm之 二.Helm模板使用'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">kubernetes包管理工具Helm之 二.Helm模板使用</span>
        </a>
    
    
        <a href="/archives/2018/10/100057.html" class="next-post btn btn-default" title='信息抽取、知识图谱、情感分析、社会计算等自然语言处理开源项目'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">信息抽取、知识图谱、情感分析、社会计算等自然语言处理开源项目</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>


    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '5MzTXYXkt03k101j0PmSDN34-gzGzoHsz',
            appKey: 'iwjYgwno6qj3wtDVVSbe8nYQ',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Helm-%E7%BB%84%E4%BB%B6"><span class="toc-text">一、Helm 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Helm%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-text">Helm工作原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Helm%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%9A"><span class="toc-text">Helm客户端：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tiller%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%9A"><span class="toc-text">Tiller服务端：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Helm-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E8%A3%85"><span class="toc-text">二、Helm 客户端安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Helm-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%89%E8%A3%85"><span class="toc-text">三、Helm 服务端安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E5%85%88%E5%9C%A8-K8S-%E9%9B%86%E7%BE%A4%E4%B8%8A%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85-socat-%E8%BD%AF%E4%BB%B6%EF%BC%8C%E4%B8%8D%E7%84%B6%E4%BC%9A%E6%8A%A5%E5%A6%82%E4%B8%8B%E9%94%99%E8%AF%AF%EF%BC%9A"><span class="toc-text">1）先在 K8S 集群上每个节点安装 socat 软件，不然会报如下错误：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%AE%89%E8%A3%85%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%88Tiller%EF%BC%89"><span class="toc-text">2）安装服务端（Tiller）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F%EF%BC%9A"><span class="toc-text">验证是否安装成功：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD-tiller%E5%8D%B8%E8%BD%BD%E5%90%8E-%E7%A7%BB%E9%99%A4tiller%E7%9B%B8%E5%85%B3svc-deploy%E4%BB%A5%E5%8F%8A-root-helm%E7%9B%AE%E5%BD%95-%E9%87%8D%E6%96%B0%E5%AE%89%E8%A3%85"><span class="toc-text">卸载 tiller卸载后(移除tiller相关svc,deploy以及&#x2F;root&#x2F;.helm目录),重新安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Helm-%E4%BD%BF%E7%94%A8"><span class="toc-text">四、Helm 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E6%9B%B4%E6%8D%A2%E4%BB%93%E5%BA%93%EF%BC%9A"><span class="toc-text">1）更换仓库：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E6%9F%A5%E7%9C%8B%E5%9C%A8%E5%AD%98%E5%82%A8%E5%BA%93%E4%B8%AD%E5%8F%AF%E7%94%A8%E7%9A%84%E6%89%80%E6%9C%89-Helm-charts%EF%BC%9A"><span class="toc-text">2）查看在存储库中可用的所有 Helm charts：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E6%9B%B4%E6%96%B0charts%E5%88%97%E8%A1%A8%EF%BC%9A"><span class="toc-text">3）更新charts列表：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E5%AE%89%E8%A3%85charts%EF%BC%9A"><span class="toc-text">4）安装charts：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%89%E6%9F%A5%E7%9C%8BK8S%E4%B8%AD%E5%B7%B2%E5%AE%89%E8%A3%85%E7%9A%84charts%EF%BC%9A"><span class="toc-text">5）查看K8S中已安装的charts：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%89%E5%88%A0%E9%99%A4%E5%AE%89%E8%A3%85%E7%9A%84charts%EF%BC%9A"><span class="toc-text">6）删除安装的charts：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%8D%B8%E8%BD%BD-Helm-%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-text">五、卸载 Helm 服务端</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2019-2025&emsp;<a href="/" class="copyright-links" target="_blank" rel="nofollow">Ljjyy.com</a>
                </span> |
                <span>
                    <a href="/about/" class="copyright-links" target="_blank" rel="nofollow">关于我们</a>
                </span> |                
                <span>
                    <a href="/sitemap.xml" class="copyright-links" target="_blank" rel="nofollow">网站地图</a>
                </span> |
                <span>
                    <a href="/archives/" class="copyright-links" target="_blank" rel="nofollow">时间轴</a>
                </span>              
            </div>
        </div>
    </div>
</div>








<script src="/js/app.js?rev=@@hash.js"></script>


</body>
</html>